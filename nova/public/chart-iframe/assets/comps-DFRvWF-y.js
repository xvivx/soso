var Pe=Object.defineProperty,Oe=Object.defineProperties;var Qe=Object.getOwnPropertyDescriptors;var Te=Object.getOwnPropertySymbols;var Fe=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable;var Le=(l,e,n)=>e in l?Pe(l,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[e]=n,ue=(l,e)=>{for(var n in e||(e={}))Fe.call(e,n)&&Le(l,n,e[n]);if(Te)for(var n of Te(e))ze.call(e,n)&&Le(l,n,e[n]);return l},xe=(l,e)=>Oe(l,Qe(e));var ae=(l,e,n)=>new Promise((r,i)=>{var t=o=>{try{a(n.next(o))}catch(c){i(c)}},s=o=>{try{a(n.throw(o))}catch(c){i(c)}},a=o=>o.done?r(o.value):Promise.resolve(o.value).then(t,s);a((n=n.apply(l,e)).next())});import{n as p}from"./cores-DvWBAqn4.js";p.UI=p.UI||{};p.UI.keyboardClaims=p.UI.keyboardClaims||new Set;p.UI.shadowComponents=p.UI.shadowComponents||new Map;p.UI.stxtap=function(l,e,n){l&&(p.installTapEvent(l),typeof n=="string"&&(l=l.querySelector(n)),l&&(l.selectFC&&l.removeEventListener("stxtap",l.selectFC),e&&l.addEventListener("stxtap",e)))};p.UI.addResizeListener=function(l,e){p.UI.getUIManager(l).registerForResize(l),l.resizeHandle=p.resizeObserver(l,e,null)};p.UI.removeResizeListener=function(l){p.UI.getUIManager(l).unregisterForResize(l),p.resizeObserver(l,null,l.resizeHandle)};p.UI.containerExecute=function(l,e,n){var r=n;n&&r.constructor!==Array&&(r=Array.prototype.slice.call(arguments,2));for(var i=l.parentElement;i;){if(i[e]&&i[e].constructor==Function)return i[e].apply(i,r);i=i.parentElement||i.getRootNode().host}return null};p.UI.animatePrice=function(l,e,n,r){l[0]&&(l=l[0]),l.timeoutHandle&&(clearTimeout(l.timeoutHandle),l.timeoutHandle=null),l.classList.remove("cq-stable","cq-up","cq-down"),e>n?l.classList.add("cq-up"):e<n&&l.classList.add("cq-down"),r&&(l.timeoutHandle=setTimeout(function(){l.classList.add("cq-stable").classList.remove("cq-up","cq-down")},0))};p.UI.makeFromTemplate=function(l,e){typeof l=="string"&&(l=document.querySelector(l)),l[0]&&p.UI.$(l)[0]==l[0]&&(l=l[0]);var n=l.content,r;function i(a){return function(o){a.appendChild(o.cloneNode(!0))}}function t(a){return function(o){a===!0?l.parentElement.appendChild(o):a[0]?a[0].appendChild(o):a.appendChild(o)}}n.childNodes.length?r=document.importNode(n,!0):(n=document.createElement("DIV"),Array.from(l.children).forEach(i(n)),r=n.cloneNode(!0));var s=Array.from(r.children);return e&&s.forEach(t(e)),p.UI.$(s)};p.UI.splitMethod=function(l){if(!l)return null;var e=l.indexOf("("),n=l.lastIndexOf(")");if(e==-1||n==-1)return console.log("malformed stxtap attribute: "+l),null;var r=null,i,t=l.substring(0,e),s=t.indexOf(".");s==-1?i=t:(r=t.substring(0,s),i=l.substring(s+1,e));var a=l.substring(e+1,n),o=a.match(/('[^']+'|[^,]+)/g),c=new RegExp("^[0-9]+([,.][0-9]+)?$","g"),h=new RegExp("^\\d+$"),d=[];if(o)for(var u=0;u<o.length;u++){for(var f=o[u];f.charAt(0)==" ";)f=f.substring(1);if(f.indexOf('"')!=-1||f.indexOf("'")!=-1)d.push(f.substring(1,f.length-1));else if(f=="true")d.push(!0);else if(f=="false")d.push(!1);else if(f=="null")d.push(null);else if(h.test(f))d.push(parseInt(f,10));else if(c.test(f))d.push(parseFloat(f));else{for(var g=f.split("."),y=window,m=0;m<g.length;m++)y=y[g[m]];d.push(y)}}return{helperName:r,functionName:i,args:d}};p.UI.observeProperty=function(l,e,n){if(!(!e||!l||!n)){l in e||(e[l]=void 0),p.UI.observables||(p.UI.observables={});var r=p.UI.observables;r[l]||(r[l]=[]);for(var i,t=0;t<r[l].length;t++){var s=r[l][t];s.obj==e&&(i=s)}i||(i={obj:e,value:e[l],listeners:[]},r[l].push(i)),i.listeners.push(n),n({obj:e,property:l,value:i.value}),Object.defineProperty(e,l,{enumerable:!0,configurable:!0,get:function(){return i.value},set:function(a){if(i.value!==a){i.value=a;for(var o={obj:e,property:l,value:a},c=0;c<i.listeners.length;c++)i.listeners[c](o)}}})}};p.UI.unobserveProperty=function(l,e,n){if(!(!l||!e||!p.UI.observables)){var r=p.UI.observables[l];if(r){for(var i=r.length-1;i>=0;i--){var t=r[i];if(t.obj==e){if(n)for(var s=t.listeners,a=s.length-1;a>=0;a--)s[a]===n&&s.splice(a,1);(!n||!t.listeners.length)&&(Object.defineProperty(e,l,{enumerable:!0,configurable:!0,writable:!0,value:t.value}),r.splice(i,1))}}r.length||delete p.UI.observables[l]}}};p.UI.getMyContext=function(l,e){for(e&&(l=p.UI.closestContextContainer(l)||l);l;){if(l.context)return l.context;if(l.CIQ&&l.CIQ.UI)return l.CIQ.UI.context;l=l.parentElement||l.getRootNode().host}return null};p.UI.contextsForEach=function(l,e){var n=((e||{}).ownerDocument||document).querySelectorAll("cq-context,*[cq-context]");n.forEach(function(r){r.CIQ&&r.CIQ.UI&&r.CIQ.UI.context&&l.apply(r.CIQ.UI.context)})};p.UI.release=!1;p.UI.bypassBindings=!1;p.UI.begin=function(l){p.UI.release=!0,setTimeout(function(){M.nextTick(),l&&l()},0)};p.UI.activatePluginUI=function(l,e){const{uiContext:n={},container:r}=l,i=n.topNode||r.closest("cq-context")||r,t=e.toLowerCase()+"-feature";i.setAttribute(t,""),p.UI.shadowComponents.forEach((s,a)=>{s===i&&a.setAttribute(t,"")})};p.UI._webcomponents={list:{}};p.UI.addComponentDefinition=function(l,e){const n=!!p.UI.registerComponentsImmediately;p.ensureDefaults(p.UI._webcomponents,{registered:n}),p.UI._webcomponents.list[l]={tag:l,classDefinition:e,registered:n},n&&customElements.define(l,e)};p.UI.registerComponents=function({except:l=[]}={}){const{exceptions:e={}}=p.UI._webcomponents;l.forEach(i=>e[i]=!0),p.UI._webcomponents.exceptions=e;const{list:n}=p.UI._webcomponents;Object.keys(n).filter(i=>!l.includes[i]).forEach(i=>{const t=n[i];t&&!t.registered&&!e[i]&&(customElements.define(i,t.classDefinition),t.registered=!0)})};p.UI.ensureComponentsRegistered=function(){p.UI.registerComponents()};p.UI.components=function(l){return Object.values(p.UI._webcomponents.list).filter(({tag:n,classDefinition:r})=>!l||l===n||l===r.name||l===r)};p.UI.componentMarkup=function(l,e){const n=this.components(l);if(e===void 0){if(!n.length)return;const t=n.map(i);return l?t[0]:t}const[r]=n;if(!r||!r.classDefinition.markup)return;return r.classDefinition.markup=e,i(r);function i(t){const{tag:s,registered:a,classDefinition:{markup:o,name:c}}=t;return{tag:s,name:c,registered:a,markup:o}}};p.UI.markupDependencies=function(){const l=p.UI.componentMarkup(),e={};l.forEach(r=>{if(r.markup)for(let i in p.UI._webcomponents.list){const t=p.UI._webcomponents.list[i];r.markup.indexOf("</"+t.tag+">")>-1&&(e[r.tag]||(e[r.tag]=[]),e[r.tag].push(t.tag))}});const n={};for(let r in e)e[r].forEach(i=>{n[i]=(n[i]||0)+1});return{dependencies:e,timesNeeded:n}};p.UI.addInheritance=function(l,e){for(var n in e.prototype)try{l.prototype[n]=e.prototype[n]}catch(r){}};var ke={};p.UI.supportedInputType=function(l){if(!ke[l]){var e=document.createElement("input");e.setAttribute("type",l),ke[l]=e.type}return ke[l]};p.UI.flattenInheritance=function(l,e){Object.getOwnPropertyNames(e.prototype).forEach(n=>{const r=t=>Object.getOwnPropertyDescriptor(t.prototype,n),i=r(e);i&&!r(l.constructor)&&Object.defineProperty(l,n,i)})};p.UI.Context=function(l,e,n){this.params=n||{},this.stx=l,l&&(l.uiContext=this),this.node=p.UI.$(e),this.topNode=this.node[0],p.isMobile&&e.setAttribute("ciq-mobile","");const r=p.UI.Context.assembleContext(e);this.advertised={};const i=e.CIQ.UI.context=this,t=new Map;r.Components.forEach(s=>{const a=s.closest("cq-context, *[cq-context]")||s.getRootNode();t.has(a)||t.set(a,[]),t.set(a,t.get(a).concat([s.tagName]))}),t.forEach((s,a)=>{a.querySelectorAll(s.join(",")).forEach(function(o){o.context||o.setContextPrivate(i)})})};p.UI.closestContextContainer=function(l,{isWrapper:e,includeSelf:n}={}){const r=e?"cq-context-wrapper":"cq-context,*[cq-context]";return n&&l.matches(r)?l:l&&l!=document&&l!=window&&(l.closest(r)||p.UI.closestContextContainer(l.getRootNode().host,{isWrapper:e}))};var te=p.UI.Context;te.assembleContext=function(l){return l.CIQ||(l.CIQ={}),l.CIQ.UI||(l.CIQ.UI={}),l.CIQ.UI.Components||(l.CIQ.UI.Components=[]),l.CIQ.UI};te.prototype.changeSymbol=function(l,e){console.log("Please implement CIQ.UI.Context.prototype.changeSymbol")};te.prototype.setLookupDriver=function(l){this.lookupDriver=l,l.deprecated&&console.warn("Using deprecated Lookup Driver, please see documentation: CIQ.ChartEngine.Driver.Lookup")};te.prototype.advertiseAs=function(l,e){this.advertised[e]=l};te.prototype.getAdvertised=function(l){return this.advertised[l]};te.prototype.setLoader=function(l){this.loader=l};te.prototype.isModal=function(){return this.stx.openDialog!==""};te.prototype.isLegendKeyboardActive=function(){const{topNode:l}=this,e=(p.UI.closestContextContainer(l)||l).querySelectorAll("cq-study-legend.ciq-active, cq-menu.cq-comparison-new.stxMenuActive");return!!Array.from(e).find(n=>{if(n.classList.contains("ciq-active")&&n.keyboardNavigation||n.classList.contains("stxMenuActive")&&n.parentElement.keyboardNavigation)return!0})};class M extends HTMLElement{constructor(){super(),this.node=p.UI.$(this),this.eventListeners=[],this.constructor.observedAttributes&&this.constructor.observedAttributes.forEach(e=>{Object.defineProperty(this,e,{get:()=>this[`_${e}`],set:n=>{if(this[`_${e}`]===n)return;let r=this[`_${e}`];this[`_${e}`]=n,typeof r=="object"&&(r=JSON.stringify(r)),typeof n=="object"&&(n=JSON.stringify(n)),this.hasAttribute(e)?this.getAttribute(e)!==n&&this.setAttribute(e,n):this.attributeChangedCallback(e,r,n)}})})}connectedCallback(){this.attached||(M.buildReverseBindings(this),this.attached=!0)}adoptedCallback(){p.UI.flattenInheritance(this,M)}disconnectedCallback(){if(!this.doNotDisconnect){if(this.attached=!1,this.context){for(var e=0;e<this.eventListeners.length;e++)this.context.stx.removeEventListener(this.eventListeners[e]);this.eventListeners=[]}this.copyStylesheetListener&&this.ownerDocument.head.removeEventListener(this.copyStylesheetListener),p.UI.shadowComponents.delete(this)}}attributeChangedCallback(e,n,r){n!==r&&(this[e]=r,this.handlePropertyChange(e,n,r))}addDefaultMarkup(e,n){const r=e||this;if((t=>t.children.length===0)(r)&&(r.constructor.markup||n)){const t=+new Date,s=n||r.constructor.markup;if(r.ownerDocument!==document){const a=document.createElement("template");a.innerHTML=s,document.body.append(a),r.append(document.importNode(a.content,!0)),a.remove()}else r.innerHTML=s;if(M.buildReverseBindings(r),p.debug){const a=+new Date-t;M.createMarkupTime=a+(M.createMarkupTime||0),console.log("Building markup "+this.constructor.name+" "+(this.getAttribute("cq-name")||"")+" built in="+a,"total="+M.createMarkupTime)}if(p.I18N&&p.I18N.localized){const a=p.getFromNS(this,"context.stx.preferences.language");p.I18N.translateUI(a,r)}}this.shadowRoot&&[...r.children].forEach(t=>this.shadowRoot.append(t))}emitCustomEvent({emitter:e,actualType:n,listenType:r="click",detail:i={}}){e.dispatchEvent(new CustomEvent(r,{bubbles:!0,cancelable:!0,composed:!0,detail:p.extend({emitter:e,actualType:n},i)}))}channelWrite(e,n,r){const{obj:i,prop:t}=p.UI.BaseComponent.getChannel(e,r,this);i&&(i[t]=n)}channelMergeObject(e,n,r){const{obj:i,prop:t}=p.UI.BaseComponent.getChannel(e,r,this);i&&(i[t]=Object.assign({},i[t],n))}channelRead(e,n){const{obj:r,prop:i}=p.UI.BaseComponent.getChannel(e,n,this);if(r)return r&&r[i]}channelSubscribe(e,n,r){const{obj:i,prop:t}=p.UI.BaseComponent.getChannel(e,r,this);if(!i)return;function s({value:o}){n(o)}p.UI.observeProperty(t,i,s);const a=()=>{p.UI.unobserveProperty(t,i,s)};return(r||this.stx).addEventListener("destroy",a),a}qs(e,n){return n==="thisChart"&&(n=this.getContextContainer()),(n||document).querySelector(e)}qsa(e,n,r){if(n==="thisChart"&&(n=this.getContextContainer()),!r)return[...(n||document).querySelectorAll(e)];const i=[],t=s=>{const a=s.ownerDocument.createTreeWalker(s,NodeFilter.SHOW_ELEMENT);let o=a.currentNode;for(o.matches||(o=a.nextNode());o;)o!==s&&o.matches(e)&&i.push(o),o.shadowRoot&&t(o.shadowRoot),o=a.nextNode()};return t(n||document),i}getContextContainer(e){return e?p.UI.closestContextContainer(e,{includeSelf:!0}):(this.contextContainer||(this.contextContainer=p.UI.closestContextContainer(this,{includeSelf:!0})),this.contextContainer)}getChartContainer(e){return M.selfOrParentElement(e||this,"ciq-chart")}static getHelper(e,n,r){if(!e)return;if(!n&&(n=e.getAttribute(r)||e[r],!n))return null;let i;const t=n.indexOf("("),s=n.substring(0,t),a=n.indexOf(".");if(t==-1||s.indexOf(".")!=-1){const o=a===-1?n:n.substring(0,a);let{context:c}=e;if(!c){if(!e.isConnected)return null;c=e.context=p.UI.getMyContext(e)}if(!c){const h=p.UI.closestContextContainer(e);return h?(h.bindingInitiated&&console.log("No context attached to "+e.tagName+". A context is required when binding to a helper."),null):(console.log(e.tagName+" is not inside cq-context element. A context element is required when binding to a helper."),null)}i=p.UI.getMyContext(e,!0).getAdvertised(o)}else{const o=n.substring(0,t),c=p.climbUpDomTree(e.parentElement,null,!0);for(let h of c)if(typeof h[o]=="function")return h}return i}static activate(e,n,r,i){var t=i?"stxsetget":"stxtap",s=p.UI.splitMethod(e.getAttribute(t));if(s){var a=s.helperName,o=s.functionName;i&&(o="set"+o);var c=[{node:e,e:n,params:r}].concat(s.args);if(a){var h=M.getHelper(e,null,t);if(!h[o]){console.log("Method '"+o+"' not found in helper",h);return}h[o].apply(h,c)}else{var d=p.climbUpDomTree(e.parentElement,null,!0);for(var u of d)typeof u[o]=="function"&&u[o].apply(u,c)}}}makeTap(e,n){M.makeTap(e,n)}static makeTap(e,n){p.UI.stxtap(e,n),e.selectFC=n}static bindNode(e,n){var r,i=e.getAttribute("stxbind"),t=e.getAttribute("stxtap"),s=e.getAttribute("stxsetget");function a(h){var d,u=i.indexOf("(");d=i.substring(i.indexOf(".")+1),u!==-1&&(d=i.substring(0,u)),h&&h[d](e)}if(e.bindingFC&&(r=M.getHelper(e,e.bindingFC,"stxbind"),r&&r.removeObservers&&r.removeObservers(e)),i)if(r=M.getHelper(e,i,"stxbind"),r)a(r);else return!1;e.bindingFC=i;function o(h){return function(d){M.activate(h,d,n,!1)}}e.tagName=="INPUT"&&(e.type==="text"||e.type==="number")?M.inputEntry(e,t&&o(e)):M.makeTap(e,t&&o(e));function c(h){function d(){return function(y){M.activate(e,y,n,!0)}}if(s){var u=p.UI.splitMethod(s);if(!u){console.log("Syntax error "+s);return}var f=[e].concat(u.args).concat(n),g="get"+u.functionName;h&&h[g]&&h[g].apply(h,f)}e.type==="text"||e.type==="number"?M.inputEntry(e,s&&d()):M.makeTap(e,s&&d())}if(!i){if(e.bindingFC&&(r=M.getHelper(e,e.bindingFC,"stxsetget"),r&&r.removeObservers&&r.removeObservers(e)),s)if(r=M.getHelper(e,s,"stxsetget"),r)c(r);else return!1;e.bindingFC=s}return!0}static scheduleForBinding(e,n){M.scheduledBindings.push({node:e,parentTag:n}),M.timeout&&clearTimeout(M.timeout),M.timeout=setTimeout(M.nextTick,0)}inputEntry(e,n){M.inputEntry(e,n),e.inputFC=n}static inputEntry(e,n){e.inputFC&&e.removeEventListener("keypress",e.inputFC),e.addEventListener("keypress",function(r){switch(r.which){case 13:case 9:n()}})}setupShadow(e){const n=this;n.setAttribute("interactable","");const r=t=>{[...t].reverse().forEach(s=>{if(s.tagName==="LINK"){const a=document.createElement("link"),{type:o,media:c,href:h}=s;Object.assign(a,{rel:"stylesheet",type:o,media:c,href:h}),a.onload=()=>{n.stylesheetLoaded=!0,n.refresh&&setTimeout(n.refresh.bind(n))},a.setAttribute("copied",""),e.insertBefore(a,e.firstChild)}else if(s.tagName==="STYLE"){const a=s.cloneNode(!0);a.setAttribute("copied",""),e.insertBefore(a,e.firstChild)}})};e.querySelectorAll("link[copied], style[copied]").forEach(t=>t.remove()),r(n.ownerDocument.head.querySelectorAll("link:not([no-wc-import]), style:not([no-wc-import])")),n.copyStylesheetListener||(n.copyStylesheetListener=n.ownerDocument.head.addEventListener("stylesheetload",t=>{r([t.detail.link])}));const i=p.UI.closestContextContainer(n);p.UI.shadowComponents.set(n,i),n.getAttributeNames().filter(t=>/-feature$/.test(t)).forEach(t=>n.removeAttribute(t)),i.getAttributeNames().filter(t=>/-feature$/.test(t)).forEach(t=>n.setAttribute(t,i.getAttribute(t))),i.currentTheme&&n.classList.add(i.currentTheme),i.classList.contains("full-screen")&&n.classList.add("full-screen")}addClaim(e){p.UI.keyboardClaims.add(e)}removeClaim(e){p.UI.keyboardClaims.delete(e)}static buildReverseBindings(e){if(!p.UI.bypassBindings){var n=function(t){if(t.hasAttribute("stxbind")||t.hasAttribute("stxtap")||t.hasAttribute("stxsetget"))return NodeFilter.FILTER_ACCEPT},r=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_ELEMENT,p.isIE?n:{acceptNode:n}),i;for(i=r.nextNode();i;)i.handlesBindings||M.scheduleForBinding(i,e),i=r.nextNode()}}static nextTick(){if(!p.UI.release)return;clearTimeout(M.timeout);const{scheduledBindings:e}=M;e.reverse().forEach(n=>{const{node:r}=n;(!r.ciqAlreadyBound||r.getAttribute("stxbind")!==r.bindingFC)&&(r.ciqAlreadyBound=M.bindNode(r,{parent:n.parentTag}))}),M.scheduledBindings=e.filter(n=>!n.node.ciqAlreadyBound)}static selfOrParentElement(e,n){let r=e;for(;r;){if(r.classList.contains(n)||r.getAttribute(n)!==null||r.nodeName.toLowerCase()===n)return r;r=r.parentElement}}static toPropAndObject(e,n){const r=e.split("."),i=r.pop(),t=r.reduce((s,a)=>s[a]!==void 0?s[a]:s[a]={},n);return{prop:i,obj:t}}static getChannel(e,n,r){if(!e)return console.warn("Missing channel path"),{};if(!n&&!r)return console.warn("Chart engine not provided while retrieving ",e),{};!n&&!r.stx&&(r.container||(r.container=p.UI.getMyContext(r)),r.stx=r.container.stx);const{obj:i,prop:t}=M.toPropAndObject(e,n||r.stx);return{obj:i,prop:t}}findFocused(e){return Array.from(e||[]).filter(n=>n.matches("[cq-focused]")||n===document.activeElement)}findKeyboardActive(e){return Array.from(e).filter(n=>n.matches("[cq-keyboard-active]"))}focusNextItem(e,n,r){if(!e.length)return;const i=this.findFocused(e);let t=-1;if(i.length)for(t=0;t<e.length&&e[t]!==i[0];t++);const s=t;if(n)do{if(t--,t<0)if(r)t=e.length-1;else break;if(t==s)break}while(!p.trulyVisible(e[t])||e[t].getAttribute("keyboard-selectable")==="false");else do{if(t++,t>=e.length)if(r)t=0;else break;if(t==s)break}while(!p.trulyVisible(e[t])||e[t].getAttribute("keyboard-selectable")==="false");if(t>-1&&t<e.length&&e[t]!==i[0])return this.removeFocused(e),this.focusItem(e[t]),e[t]}focusItem(e){this.scrollToElement&&this.scrollToElement(e),e.setAttribute("cq-focused","true"),this.activeElementName=e.getAttribute("name"),this.highlightItem(e),(e.tagName=="INPUT"||e.tagName=="TEXTAREA")&&this.clickItem(e)}removeFocused(e){e||(e=this.qsa?this.qsa("[cq-focused]",this,!0):this.querySelectorAll("[cq-focused]")),e.forEach(n=>{n.removeAttribute("cq-focused"),n.blur()})}highlightItem(e,n){if(!e||!this.keyboardNavigation||!this.keyboardNavigation.highlightPosition)return;const r=this.keyboardNavigation,i=()=>{const{x:t,y:s,width:a,height:o}=e.getBoundingClientRect();r.highlightPosition({element:e,position:{x:t,y:s,width:a,height:o}})};clearTimeout(this.highlightDelayTimeout),this.highlightDelayTimeout=setTimeout(i,n||0)}highlightFocusedItem(e){let n=this.findFocused(e);n.length&&this.highlightItem(n[0])}clickItem(e,n,r){if(e)return e.focus(),e.setAttribute("cq-keyboard-active","true"),r&&(e.keyboardOriginationElement=r),e.selectFC?e.selectFC.call(e,n):e.dispatchEvent(new Event("click",{bubbles:!0,cancelable:!0,composed:!0})),!0}deactivateItem(e){e.blur(),e.removeAttribute("cq-keyboard-active")}clickFocusedItem(e,n){let r=this.findFocused(e);r.length&&this.clickItem(r[0],n)}}M.scheduledBindings=[];p.UI.BaseComponent=M;class he extends M{constructor(){super(),this.injections=[]}connectedCallback(){this.attached||(this.setContextHolder(),super.connectedCallback())}adoptedCallback(){super.adoptedCallback(),p.UI.flattenInheritance(this,he)}disconnectedCallback(){const e=p.UI.closestContextContainer(this,{isWrapper:!0});if(!(this.doNotDisconnect||this.parentElement&&this.parentElement.doNotDisconnect||e&&e.doNotDisconnect)){if(this.attached=!1,this.context){var n;for(n=0;n<this.injections.length;n++)this.context.stx.removeInjection(this.injections[n]);for(this.injections=[],n=0;n<this.eventListeners.length;n++)this.context.stx.removeEventListener(this.eventListeners[n]);this.eventListeners=[]}this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.marker&&this.marker.remove(),this.marker=null,p.UI.shadowComponents.delete(this)}}setContextHolder(){let e=p.UI.closestContextContainer(this);if(!e){const i=p.climbUpDomTree(this,"cq-dialog",!0)[0];i&&(e=i.firstElementChild.context)}if(!e){console.log("No cq-context found for "+this.tagName);return}var n=e.topNode||e,r=te.assembleContext(n);r.Components.push(this),r.context&&this.setContextPrivate(r.context)}setContext(e){}setContextPrivate(e){this.context=e,this.uiManager=p.UI.getUIManager(e.topNode),this.matches("cq-marker,[cq-marker]")&&!this.convertedToMarker&&(this.convertedToMarker=!0,p.I18N&&p.I18N.localized&&p.I18N.translateUI(e.stx.preferences.language,this),this.marker=new p.Marker({stx:e.stx,node:this,xPositioner:"none",yPositioner:"none",label:"component",permanent:!0})),this.timeout=setTimeout(function(n,r){return function(){n.setContext(r),n.timeout=null}}(this,e))}addInjection(e,n,r){this.injections.push(this.context.stx[e](n,r))}}p.UI.ContextTag=he;customElements.define("cq-marker",he);class we extends he{constructor(){super()}connectedCallback(){this.attached||(this.onpointerover=function(){this.modalBegin()},this.onpointerout=function(){this.modalEnd()},super.connectedCallback())}adoptedCallback(){super.adoptedCallback(),p.UI.flattenInheritance(this,we)}modalBegin(){this.context&&this.context.stx.modalBegin()}modalEnd(){this.context&&(this.uiManager.activeMenuStack.length||this.context.stx.modalEnd())}}p.UI.ModalTag=we;class Ie extends M{constructor(){super()}adoptedCallback(){super.adoptedCallback(),p.UI.flattenInheritance(this,Ie)}close(){var e=this.closest("cq-dialog");e&&e.close(),Array.from(this.querySelectorAll("cq-swatch")).forEach(function(n){n.colorPicker&&n.colorPicker.close()})}naturalTabElements(e){return e||(e=this),Array.from(e.querySelectorAll("input, button, select, [tabindex='0']"))}open(e){e&&e.context&&this.setContext(e.context);var n=this.tagName.toLowerCase(),r=this.closest("cq-dialog,cq-menu");r.addActiveAttribute(n),r.open(e)}setContext(e){this.node.find("[stxtap],[stxbind],[stxsetget]").each(function(){this.context=e}),this.context=e}}p.UI.DialogContentTag=Ie;p.UI.defaultSwatchColors=["#8ec648","#00afed","#ee652e","#912a8e","#fff126","#e9088c","#ea1d2c","#00a553","#00a99c","#0056a4","#f4932f","#0073ba","#66308f","#323390"];p.UI.pickSwatchColor=function(l,e){if(!l.context||!e)return;const{stx:n}=l.context,{chart:r,crossSection:i}=n,{usedColors:t=new Set}=l;let s=e.style.backgroundColor;if(i)for(const c in i.curves){let h=i.curves[c];t.add(p.convertToNativeColor(h.color))}else for(const c in r.series){var a=r.series[c];a.parameters.isComparison&&(t.add(p.convertToNativeColor(a.parameters.color)),t.add(p.colorToHex(a.parameters.color)))}if(l.usedColors||(l.usedColors=t),!(s!==""&&!t.has(s)))for(var o=0;o<l.swatchColors.length;o++){const c=l.swatchColors[o];if(!t.has(c)){e.style.backgroundColor=c,e.value=c;return}}};p.UI.Helper=function(l,e){this.node=l,this.context=e};p.UI.Helper.prototype.addInjection=function(l,e,n){this.injections=this.injections||[],this.injections.push(this.context.stx[l](e,n))};p.UI.Helper.prototype.addObserver=function({node:l,base:e,path:n,listener:r}){const i=e instanceof p.ChartEngine,{obj:t,member:s}=p.deriveFromObjectChain(e,n);p.UI.observeProperty(s,t,r),this.observers=this.observers||[],this.observers.push({node:l,base:e,path:n,listener:r,isEngine:i}),i&&e.addEventListener("destroy",()=>p.UI.unobserveProperty(s,t,r))};p.UI.Helper.prototype.removeObservers=function(l){this.observers&&(this.observers.filter(e=>e.node===l).forEach(e=>{const{obj:n,member:r}=p.deriveFromObjectChain(e.base,e.path);p.UI.unobserveProperty(r,n,e.listener)}),this.observers=this.observers.filter(e=>e.node!==l))};p.UI.Helper.prototype.changeContext=function(l){this.stx&&(this.stx=l.stx),this.context&&(this.context=l),this.implementation&&this.implementation.stx&&(this.implementation.stx=l.stx),(this.observers||[]).forEach(r=>{const{path:i,listener:t,isEngine:s}=r;e(r.base,i,t),n(s?l.stx:l,i,t)}),this.stx&&(this.stx=l.stx),this.context&&(this.context=l);function e(r,i,t){let{obj:s,member:a}=p.deriveFromObjectChain(r,i);p.UI.unobserveProperty(a,s,t)}function n(r,i,t){let{obj:s,member:a}=p.deriveFromObjectChain(r,i);p.UI.observeProperty(a,s,t)}};p.UI.Helper.prototype.destroy=function(){if(this.injections)for(var l=0;l<this.injections.length;l++)this.context.stx.removeInjection(this.injections[l]);this.injections=[],(this.observers||[]).forEach(({base:e,path:n,listener:r})=>{const{obj:i,member:t}=p.deriveFromObjectChain(e,n);p.UI.unobserveProperty(t,i,r)}),this.observers=[]};p.UI.HeadsUp=function(l,e,n){this.params=n||{},typeof this.params.autoStart=="undefined"&&(this.params.autoStart=!0),this.node=l,l.remove(),this.context=e,this.injections=[],this.maxVolume={lastCheckDate:null,value:0},this.params.autoStart&&this.begin()};p.inheritsFrom(p.UI.HeadsUp,p.UI.Helper);p.UI.HeadsUp.prototype.begin=function(){if(!this.injections.length&&p.Marker){p.Marker.HeadsUp||(p.Marker.HeadsUp=function(e,n){this.className||(this.className="CIQ.Marker.HeadsUp"),p.Marker.call(this,e),this.prevTick=null,this.showClass=n},p.inheritsFrom(p.Marker.HeadsUp,p.Marker,!1),p.Marker.HeadsUp.placementFunction=function(e){function n(b,q,x,w){return Math.round(x-b.pixelFromPrice(w,q))}var r=e.panel,i=r.chart,t=e.stx,s=t.chart.highLowBars;e.showClass||(e.showClass="stx-show");for(var a=0;a<e.arr.length;++a){var o=e.arr[a],c=o.node,h=c.classList;if(r.hidden||!t.insideChart){h.remove(e.showClass);return}if(o.params.x<0||o.params.x>=i.dataSet.length){h.remove(e.showClass);return}if(t.currentVectorParameters.vectorType){h.remove(e.showClass);return}var d=i.dataSet[o.params.x],u=t.pixelFromTick(o.params.x);if(!d||u<i.left||u>i.right){h.remove(e.showClass);return}if(!d[t.chart.defaultPlotField]&&d[t.chart.defaultPlotField]!==0){h.remove(e.showClass);return}h.add(e.showClass);var f=p.elementDimensions(c);o.clientWidth||(o.clientWidth=f.width),o.clientHeight||(o.clientHeight=f.height),o.clientWidth>u?(h.remove("stx-left"),h.add("stx-right"),Object.assign(o.node.style,{left:u+"px",right:"auto"})):(h.add("stx-left"),h.remove("stx-right"),Object.assign(o.node.style,{right:t.chart.canvasWidth-u+"px",left:"auto"}));var g,y=o.params.chartContainer?t.chart.canvasHeight:r.bottom;s?g=n(t,r,y,t.getBarBounds(d)[r.yAxis.flipped?"low":"high"]):g=n(t,r,y,d[t.chart.defaultPlotField]);var m=y-g-o.clientHeight;m<0?(h.add("stx-below"),g=(s?n(t,r,y,t.getBarBounds(d).low):g)-o.clientHeight):h.remove("stx-below");var v=g+"px";o.node.style.bottom!=v&&(o.node.style.bottom=v)}});var l;this.params.followMouse?(this.node.style.top="auto",l={stx:this.context.stx,label:"headsup",xPositioner:"bar",chartContainer:!0,x:0,node:this.node},this.marker=new p.Marker.HeadsUp(l,this.params.showClass),this.addInjection("append","handleMouseOut",function(e){return function(){e.followMouse(-1)}}(this))):this.params.staticNode||(Object.assign(this.node.style,{top:"",left:""}),l={stx:this.context.stx,label:"headsup",xPositioner:"none",chartContainer:!1,node:this.node},p.extend(l,this.params),this.marker=new p.Marker(l)),this.calculateMaxVolume(),this.addInjection("prepend","headsUpHR",function(e){return function(){e.position()}}(this)),this.addInjection("append","createXAxis",function(e){return function(){e.position()}}(this)),this.addInjection("append","createDataSet",function(e){return function(n,r,i){e.calculateMaxVolume(i.appending)}}(this))}};p.UI.HeadsUp.prototype.end=function(){this.marker&&this.marker.remove(),this.destroy(),this.marker=null};p.UI.HeadsUp.prototype.calculateMaxVolume=function(l){l||(this.maxVolume={lastCheckDate:null,value:0});var e=this.context.stx.chart.dataSet;if(!(!e||!e.length)){for(var n=e.length-1;n>=0;n--){var r=e[n];if(r.DT<this.maxVolume.lastCheckDate)break;r.Volume>this.maxVolume.value&&(this.maxVolume.value=r.Volume)}this.maxVolume.lastCheckDate=e[e.length-1].DT}};p.UI.HeadsUp.prototype.position=function(){var l=this.context.stx,e=l.barFromPixel(l.cx);this.tick=l.tickFromPixel(l.cx);var n=l.chart.xaxis[e],r=l.chart.defaultPlotField,i=l.chart.highLowBars;(!r||i)&&(r="Close");var t=this.node,s=this;function a(c){var h="",d=l.layout.chartScale,u=l.chart.panel,f=l.chart.yAxis;return f.originalPriceFormatter&&f.originalPriceFormatter.func?h=f.originalPriceFormatter.func(l,u,c):f.priceFormatter&&d!="percent"&&d!="relative"?h=f.priceFormatter(l,u,c):h=l.formatYAxisPrice(c,u),h.replace(/(\.[0-9]*[1-9])0+$|\.0*$/,"$1")}function o(){var c=p.UI.$(t);s.timeout=null,c.find("cq-hu-price").text("N/A"),c.find("cq-hu-open").text("N/A"),c.find("cq-hu-close").text("N/A"),c.find("cq-hu-high").text("N/A"),c.find("cq-hu-low").text("N/A"),c.find("cq-hu-date").text("N/A"),c.find("cq-hu-volume").text("N/A"),c.find("cq-volume-rollup").text("");function h(v){return p.isValidNumber(parseFloat(v))?v:"N/A"}if(n&&n.data){var d=p.clone(n.data);d.Open===void 0&&(d.Open=d.Close),d.High===void 0&&(d.High=Math.max(d.Open,d.Close)),d.Low===void 0&&(d.Low=Math.min(d.Open,d.Close)),c.find("cq-hu-open").text(a(h(d.Open))),c.find("cq-hu-price").text(a(h(d[r]))),c.find("cq-hu-close").text(a(h(d.Close))),c.find("cq-hu-high").text(a(h(d.High))),c.find("cq-hu-low").text(a(h(d.Low)));var u=p.condenseInt(d.Volume),f=u.charAt(u.length-1);f>"9"&&(u=u.substring(0,u.length-1),c.find("cq-volume-rollup").text(f.toUpperCase())),c.find("cq-hu-volume").text(u);var g=d.displayDate;g||(g=d.DT),l.internationalizer?p.ChartEngine.isDailyInterval(l.layout.interval)?c.find("cq-hu-date").text(l.internationalizer.yearMonthDay.format(g)):c.find("cq-hu-date").text(l.internationalizer.yearMonthDay.format(g)+" "+l.internationalizer.hourMinute.format(g)):p.ChartEngine.isDailyInterval(l.layout.interval)?c.find("cq-hu-date").text(p.mmddyyyy(p.yyyymmddhhmm(g))):c.find("cq-hu-date").text(p.mmddhhmm(p.yyyymmddhhmmssmmm(g)));var y=c.find("cq-volume-visual");if(y.length){var m=s.maxVolume.value?d.Volume/s.maxVolume.value:0;y.css({width:Math.round(m*100)+"%"})}}}(this.tick!=this.prevTick||n&&+n.DT==+l.chart.endPoints.end)&&(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(o,0)),this.prevTick=this.tick,this.params.followMouse&&(l.openDialog&&(this.tick=-1),this.followMouse(this.tick))};p.UI.HeadsUp.prototype.followMouse=function(l){this.marker.params.x=l;var e=this;e.marker.render()};p.UI.DrawingEdit=W;function W(l,e){var n=e.stx,r=p.UI.$(l||e.topNode);if(this.node=r[0],this.context=e,this.editing=null,this.drawingContext=e.topNode.querySelector("cq-drawing-context")||this.node.ownerDocument.querySelector("cq-drawing-context"),this.cvpController=r.find("cq-cvp-controller"),this.toolbar=r.find("cq-toolbar"),this.toolbar.length||(this.toolbar=r.find("cq-drawing-settings")),!this.toolbar.length){const t=this.node.parentElement.closest("cq-context");t&&(this.toolbar=p.UI.$(t).find("cq-drawing-settings"))}var i=this;Array.from(this.toolbar).forEach(function(t){var s=Re(n,i);t.addEventListener("change",s),n.addEventListener("destroy",function(){t.removeEventListener("change",s)})}),this.count=n.drawingObjects.length,e.advertiseAs(this,"DrawingEdit"),n.addEventListener("drawing",Ve(this)),n.addEventListener("drawingEdit",je(this)),r.find("cq-toolbar .ciq-drawing-edit-only").each(function(t,s){s.querySelector(".ciq-btn")&&["mouseenter","mouseleave"].forEach(function(a){s.addEventListener(a,Be(n,i))})})}p.inheritsFrom(W,p.UI.Helper);function Re(l,e){return function(){if(l.activeDrawing&&l.editingAnnotation&&(l.activeDrawing.copyConfig(),l.activeDrawing.adjust(),l.draw()),!!e.editing){if(e.editing.name!==l.currentVectorParameters.vectorType){e.endEdit(null,"tool");return}e.editing.copyConfig(),e.editing.adjust(),l.draw(),l.changeOccurred("vector")}}}function Ve(l){return function(e){var n=e.drawings.length;l.count!==n&&(l.endEdit(null,"count"),l.count=n)}}function je(l){return function(e){e.forceEdit===!0?(l.endEdit(null,"edit"),l.showToolbar(e.drawing),l.beginEdit(e.drawing)):e.forceText===!0?l.text(e.drawing):l.showContext(e)}}function Be(l,e){return function(n){var r=n.type==="mouseenter";e.editing&&e.editing.highlighted!==r&&(e.editing.highlighted=r,l.draw())}}W.prototype.showContext=function(l){l.context=this.context,l.x=p.ChartEngine.crosshairX,l.y=p.ChartEngine.crosshairY,this.count=this.context.stx.drawingObjects.length,this.drawingContext&&this.drawingContext.open&&this.drawingContext.open(l)};W.prototype.getToolActivator=function(l){var e=this.toolbar.find('cq-item[cq-tool="'+l+'"]');return e.length||(e=this.toolbar.find(`cq-item[stxtap="tool('`+l+`')"]`)),{node:e[0]}};W.prototype.showToolbar=function(l){var e=this,n=e.getToolActivator(l.name);e.node,this.toolbar.each(function(){var r=l.lineWidth,i=l.pattern,t=l.parameters&&l instanceof p.Drawing.fibonacci;t&&(r=l.parameters.fibs[0].parameters.lineWidth,i=l.parameters.fibs[0].parameters.pattern),this.tool(n,l.name),this.sync(Object.assign({},l,{lineWidth:r,pattern:i,annotation:{font:l.font?p.clone(l.font):{}},currentColor:l.color})),this.dirty(!1),t&&(this.context.stx.currentVectorParameters.fibonacci=p.clone(l.parameters)),l.name=="measurementline"&&(this.context.stx.currentVectorParameters.measurementline=p.clone(l.parameters)),l.name==="volumeprofile"&&(this.context.stx.currentVectorParameters.volumeProfile.priceBuckets=l.priceBuckets)})};W.prototype.beginEdit=function(l){this.editing=l,this.beforeEdit=l.serialize(),this.toolbar.attr("cq-drawing-edit",l.name);var e=new CustomEvent("drawing-edit-begin",{bubbles:!0,cancelable:!0,detail:{drawing:l,tool:l.name}});this.node.dispatchEvent(e)};W.prototype.endEdit=function(l,e){const n=function(t,s){const a=this.context.stx;let o=null,c=null;if(this.editing){c=this.editing.name,o=new CustomEvent("drawing-edit-end",{bubbles:!0,cancelable:!0,detail:{action:s,drawing:this.editing,tool:c}});const h=a.drawingObjects.indexOf(this.editing),d=a.exportDrawings();h>-1&&this.beforeEdit&&(d[h]=this.beforeEdit,a.undoStamp(d,a.exportDrawings())),s==="close"&&this.editing.highlighted&&(this.editing.highlighted=!1,a.draw())}this.editing=null,this.beforeEdit=null,this.toolbar.attr("cq-drawing-edit","none"),s==="close"&&(c&&(t=this.getToolActivator(c),this.toolbar.each(function(){this.tool(t,c)})),a.changeVectorType(c)),o&&this.node.dispatchEvent(o)},{multiChartContainer:r}=this.node;(r?r.getCharts().map(t=>t.uiContext.getAdvertised("DrawingEdit")):[this]).forEach(t=>{n.call(t,l,e)})};W.prototype.edit=function(){if(this.drawingContext){const l=this.drawingContext.drawing,e=p.UI.getMyContext(l.stx.container).topNode,n=e.ownerDocument.querySelector("cq-drawing-context").parentNode;let r=e.querySelector("cq-drawing-settings");!r&&e.multiChartContainer&&(r=e.multiChartContainer.querySelector("cq-drawing-settings"));const i={left:n.offsetLeft,top:n.offsetTop};if(this.drawingContext.close(),this.node&&this.node.multiChartContainer){const t=this.node.multiChartContainer.context.getAdvertised("DrawingEdit");this.endEdit(null,"edit"),t.showToolbar(l,i),this.beginEdit(l)}else this.endEdit(null,"edit"),this.showToolbar(l,i),this.beginEdit(l);r&&!/break.*sm\b/.test(this.context.topNode.className)&&r.detach(i.left,i.top)}};W.prototype.text=function(l){let e=this.drawingContext;if(e){e.close();let n=l instanceof p.Drawing?l:e.drawing;this.endEdit(null,"text"),n.edit&&n.edit(null,!0)}};W.prototype.clone=function(){var l=this,e=this.context.stx;if(this.endEdit(null,"clone"),this.drawingContext){this.drawingContext.close();var n=this.drawingContext.drawing,r=new p.Drawing[n.name],i=n.serialize();r.reconstruct(e,i),n.name=="measurementline"&&(n.repositioner={action:"move",p0:r.p0,p1:r.p1,tick:r.p1[0],value:r.p1[1]}),r.repositioner=n.repositioner,r.highlighted=!0,n.highlighted=!1,l.count+=1,e.addDrawing(r),e.activateRepositioning(r)}};W.prototype.reorderLayer=function(l,e){var n=this.context.stx;if(this.endEdit(null,"reorderLayer"),this.drawingContext){this.drawingContext.close();var r=n.drawingObjects.length-1,i=n.drawingObjects.indexOf(this.drawingContext.drawing),t=NaN;if(i===-1)return;switch(e){case"up":i<r&&(t=i+1);break;case"down":i>0&&(t=i-1);break;case"top":i<r&&(t=r);break;case"bottom":i>0&&(t=0);break}if(t!==t)return;var s=n.exportDrawings();n.drawingObjects.splice(i,1),n.drawingObjects.splice(t,0,this.drawingContext.drawing),n.undoStamp(s,n.exportDrawings()),n.draw(),n.changeOccurred("vector")}};W.prototype.remove=function(){var l=this,e=this.context.stx;if(this.endEdit(null,"remove"),this.drawingContext){if(this.drawingContext.drawing.permanent)return;var n=e.exportDrawings();l.count-=1,e.removeDrawing(this.drawingContext.drawing),e.undoStamp(n,e.exportDrawings()),this.drawingContext.close()}};p.UI.StudyEdit=function(l,e){const n=this instanceof p.UI.StudyEdit?this:Object.create(p.UI.StudyEdit.prototype);n.context=e,n.node=l||e.topNode,n.contextDialog=[];for(var r=n.node.ownerDocument.querySelectorAll("cq-study-context"),i=0;i<r.length;i++)n.contextDialog.push(r[i]);return e.advertiseAs(n,"StudyEdit"),n.initialize(),n};p.inheritsFrom(p.UI.StudyEdit,p.UI.Helper);p.UI.StudyEdit.prototype.remove=function(){p.Studies.removeStudy(this.params.stx,this.params.sd),this.contextDialog.forEach(function(l){l.close&&l.close()})};p.UI.StudyEdit.prototype.edit=function(){this.contextDialog.forEach(function(l){l.close&&l.close()}),this.editPanel(this.params)};p.UI.StudyEdit.prototype.editPanel=function(l){const{stx:e,config:n}=this.context;l.context=this.context,l.x=null,l.y=null;const{channelWrite:r}=p.UI.BaseComponent.prototype;if(n){const i=(n.channels||{}).dialog||"channel.dialog";r(i,{type:"study",params:l},e)}else l.context.topNode.ownerDocument.querySelector("cq-study-dialog").open(l)};p.UI.StudyEdit.prototype.editOverlay=function(l){this.params=l,l.context=this.context,l.forceEdit?this.editPanel(l):this.contextDialog.forEach(function(e){l.x=p.ChartEngine.crosshairX,l.y=p.ChartEngine.crosshairY,e.open&&e.open(l)})};p.UI.StudyEdit.prototype.initialize=function(){var l=this.context.stx,e=this;function n(r){return function(){r.apply(e,arguments)}}l.addEventListener("studyOverlayEdit",n(e.editOverlay)),l.addEventListener("studyPanelEdit",n(e.editPanel))};p.UI.Layout=function(l,e){const n=this instanceof p.UI.Layout?this:Object.create(p.UI.Layout.prototype);return n.params=e||{},n.params.activeClassName||(n.params.activeClassName="ciq-active"),n.context=l,l.advertiseAs(n,"Layout"),n};p.inheritsFrom(p.UI.Layout,p.UI.Helper);p.UI.Layout.prototype.setCheckedState=function(l,e){l.classList[e?"add":"remove"](this.params.activeClassName),l.ariaChecked=e?"true":"false"};p.UI.Layout.prototype.getChartType=function(l,e){const{stx:n}=this.context;typeof e!="string"&&(e=l.dataset.value||"");const r=i=>{const t=i.obj;t.aggregationType&&t.aggregationType!="ohlc"?this.setCheckedState(l,e===t.aggregationType):this.setCheckedState(l,e===t.chartType)};this.addObserver({node:l,base:n,path:"layout.chartType",listener:r}),this.addObserver({node:l,base:n,path:"layout.aggregationType",listener:r})};p.UI.Layout.prototype.setChartType=function(l,e){var n={heikinashi:!0,kagi:!0,linebreak:!0,pandf:!0,rangebars:!0,renko:!0};typeof e!="string"&&(e=l.node.dataset.value||""),n[e]?this.context.stx.setAggregationType(e):this.context.stx.setChartType(e)};p.UI.Layout.prototype.getChartScale=function(l,e){const n=r=>{this.setCheckedState(l,r.value==e)};this.addObserver({node:l,base:this.context.stx,path:"layout.chartScale",listener:n})};p.UI.Layout.prototype.setChartScale=function(l,e){var n=this.context.stx,r=n.layout.chartScale;r==e?n.setChartScale(null):(!r||r=="linear")&&n.setChartScale(e)};p.UI.Layout.prototype.getFlippedChart=function(l){const e=n=>{this.setCheckedState(l,n.value)};this.addObserver({node:l,base:this.context.stx,path:"layout.flipped",listener:e})};p.UI.Layout.prototype.setFlippedChart=function(l){var e=this.context.stx;e.flipChart(!e.layout.flipped)};p.UI.Layout.prototype.getExtendedHours=function(l){const e=n=>{this.setCheckedState(l,n.value)};this.addObserver({node:l,base:this.context.stx,path:"layout.extended",listener:e})};p.UI.Layout.prototype.setExtendedHours=function(l){const{stx:e,loader:n,stx:{extendedHours:r,chart:{market:{market_def:i,sessions:t}}}}=this.context;if(e.layout.extended=!e.layout.extended,e.changeOccurred("layout"),e.layout.extended&&!(i&&t.length)&&p.alert("There are no Extended Hours for this instrument."),r){const s=e.drawingObjects.map(a=>a.serialize());n&&n.show(),r.set(e.layout.extended,null,()=>{r.filter||(e.importDrawings(s),e.draw()),n&&n.hide()})}};p.UI.Layout.prototype.getAnimation=function(l){const e=n=>{this.setCheckedState(l,n.value)};this.addObserver({node:l,base:this.context.stx,path:"layout.animation",listener:e})};p.UI.Layout.prototype.setAnimation=function(l){const{stx:e}=this.context;e.layout.animation=!e.layout.animation,e.changeOccurred("layout")};p.UI.Layout.prototype.getRangeSlider=function(l){const e=n=>{this.setCheckedState(l,n.value)};this.addObserver({node:l,base:this.context.stx,path:"layout.rangeSlider",listener:e})};p.UI.Layout.prototype.setRangeSlider=function(l){var e=this.context.stx;e.layout.rangeSlider=!e.layout.rangeSlider,e.slider&&e.slider.display(e.layout.rangeSlider),e.changeOccurred("layout")};p.UI.Layout.prototype.getOutliers=function(l){const e=n=>{this.setCheckedState(l,n.value)};this.addObserver({node:l,base:this.context.stx,path:"layout.outliers",listener:e})};p.UI.Layout.prototype.setOutliers=function(l){var e=this.context.stx;e.layout.outliers=!e.layout.outliers,e.draw(),e.changeOccurred("layout")};p.UI.Layout.prototype.getHeadsUp=function(l,e){const n=r=>{const i=e==="crosshair"?!r.value.static&&r.obj.crosshair:r.value[e];this.setCheckedState(l,i),["static","dynamic"].includes(e)&&(this[e]||(this[e]=!0,this.context.topNode.querySelectorAll(".ciq-chart-area").forEach(t=>{t.append(document.createElement("cq-hu-"+e))})))};this.addObserver({node:l,base:this.context.stx,path:"layout.headsUp",listener:n})};p.UI.Layout.prototype.setHeadsUp=function({node:l},e){const{stx:n}=this.context,{layout:r}=n;let{headsUp:i}=r;switch(!i||typeof i!="object"?i={}:i=Object.assign({},i),e){case"crosshair":i.static=!1,r.crosshair=!0;break;case"dynamic":i.dynamic=!0,i.floating=!1;break;case"floating":i.dynamic=!1,i.floating=!0;break;case"static":i.static=!0,r.crosshair=!0;break}r.headsUp=i,n.draw(),n.changeOccurred("layout")};p.UI.Layout.prototype.getAggregationType=function(l,e){const n=r=>{this.setCheckedState(l,r.value==e)};this.addObserver({node:l,base:this.context.stx,path:"layout.aggregationType",listener:n})};p.UI.Layout.prototype.setAggregationType=function(l,e){this.context.stx.layout.aggregationType==e?this.context.stx.setAggregationType(null):this.context.stx.setAggregationType(e)};p.UI.Layout.prototype.getAggregationEdit=function(l,e){const{stx:n}=this.context,r=i=>{l.value=n.chart.defaultChartStyleConfig[l.name]||i.value};this.addObserver({node:l,base:n,path:"layout."+p.deriveFromObjectChain(n.layout,e).member,listener:r})};p.UI.Layout.prototype.setAggregationEdit=function(l,e){var n=this.context.stx;function r(){n.changeOccurred("layout"),n.createDataSet(),n.draw()}if(e==="auto"){n.layout.aggregationType==="kagi"?n.layout.kagi=null:n.layout.aggregationType==="renko"?n.layout.renko=null:n.layout.aggregationType==="linebreak"?n.layout.priceLines=null:n.layout.aggregationType==="rangebars"?n.layout.rangebars=null:n.layout.aggregationType==="pandf"&&(n.layout.pandf||(n.layout.pandf={box:null,reversal:null}),n.layout.pandf.box=null,n.layout.pandf.reversal=null),r();const t=l.params.parent;if(!t)return;Array.from(t.querySelectorAll(".ciq"+n.layout.aggregationType+" input")).forEach(function(s){var a=s.name;(a=="box"||a=="reversal")&&(a="pandf."+a);var o=p.deriveFromObjectChain(n.layout,a);o&&!o.obj[o.member]&&n.chart.defaultChartStyleConfig[s.name]&&(s.value=n.chart.defaultChartStyleConfig[s.name])})}else{var i=p.deriveFromObjectChain(n.layout,e);i.obj[i.member]=l.node.value,r()}};p.UI.Layout.prototype.showAggregationEdit=function(l,e){const{context:n}=this;if(n.config){const{channelWrite:r}=p.UI.BaseComponent.prototype,i=(n.config.channels||{}).dialog||"channel.dialog";r(i,{type:"aggregation",params:{context:n,aggregationType:e}},n.stx)}else l.ownerDocument.querySelector("cq-aggregation-dialog").open({context:this.context,aggregationType:e})};p.UI.Layout.prototype.clearStudies=function(l){if(p.Studies){var e=this.context.stx;for(var n in e.layout.studies){var r=e.layout.studies[n];!r.customLegend&&!r.permanent&&!r.signalData&&p.Studies.removeStudy(e,r)}e.draw()}};p.UI.Layout.prototype.setPeriodicity=function(l,e,n,r){var i=this;i.context.loader&&i.context.loader.show(),i.context.stx.setPeriodicity({period:e,interval:n,timeUnit:r},function(){i.context.loader&&i.context.loader.hide()})};p.UI.Layout.prototype.showPeriodicity=function(l,e){var n="",{period:r,interval:i,timeUnit:t}=l.getPeriodicity();r*=i,n=r,t=="day"?n+="D":t=="week"?n+="W":t=="month"?n+="M":t=="second"?n+="s":t=="millisecond"?n+="ms":r>=60&&r%15===0?n=r/60+"H":t=="tick"?n=(r>1?r:"")+"T":n+="m",p.makeTranslatableElement(e.selector,l,n)};p.UI.Layout.prototype.periodicity=function(l){const{stx:e}=this.context,n=l.label||l,r=()=>{this.showPeriodicity(this.context.stx,{selector:n})};this.addObserver({node:l,base:e,path:"layout.interval",listener:r}),this.addObserver({node:l,base:e,path:"layout.periodicity",listener:r}),this.addObserver({node:l,base:e,path:"layout.timeUnit",listener:r})};p.UI.Layout.prototype.chartType=function(l){const{stx:e,stx:n}=this.context,r=l.closest("cq-menu")||l.getRootNode(),i=l.qsa(".icon",r,!0)[0],t=l.qsa("[label]",r,!0)[0],s=l.qsa("[cq-tooltip]",r,!0)[0],a=({obj:{chartType:o,aggregationType:c}})=>{const h=c==="ohlc"?o:c;i&&(i.className=`icon generic ${i.classList.contains("hidden")?"hidden ":""}${h.replace(/_| /,"-")}`.trim());const d=h.split(" ").map(u=>p.capitalize(u)).join(" ");if(t&&p.makeTranslatableElement(t,e,d),s&&p.makeTranslatableElement(s,e,d),!t&&!i){const u=l.closest("cq-menu").querySelector(`*[data-value='${h}'] *[ciq-label]`),f=l.querySelector("*[ciq-menu-icon]"),g=l.querySelector("cq-tooltip"),y=p.getFromNS(this,"context.config.displayStyleIcons"),m=u?(u.closest("cq-item").querySelector("[ciq-menu-icon]")||{}).className:`ciq-icon-${h.replace(/_/,"-")}`;g&&(g.innerHTML=u?u.innerHTML:p.capitalize(h.replace(/-|_/," "))),y&&f&&(l.classList.add("ciq-menu-icon"),f.className=m)}};this.addObserver({node:l,base:n,path:"layout.chartType",listener:a}),this.addObserver({node:l,base:n,path:"layout.aggregationType",listener:a})};p.UI.Layout.prototype.setLanguage=function(l){const{config:e,stx:n}=this.context;if(e){const{channelWrite:r}=p.UI.BaseComponent.prototype,i=(e.channels||{}).dialog||"channel.dialog",t={context:n.uiContext};r(i,{type:"language",params:t},n)}else l.node.ownerDocument.querySelector("cq-language-dialog").open()};p.UI.Layout.prototype.getLanguage=function(l){const{stx:e}=this.context,n=r=>{p.I18N.languages||(p.I18N.languages={en:"English"});const i=l.querySelector("cq-language-name, [label]");if(i){const t=e.preferences.language||p.I18N.language;p.makeTranslatableElement(i,e,p.I18N.languages[t],t);const s=l.querySelector("cq-flag");s&&s.setAttribute("cq-lang",t)}};this.addObserver({node:l,base:e,path:"preferences.language",listener:n})};p.UI.Layout.prototype.addChart=function(l,e){const n=this.context.topNode;(p.UI.closestContextContainer(n.parentNode)||n).addChart(null,e)};p.UI.Layout.prototype.removeChart=function(l){const e=this.context.topNode;(p.UI.closestContextContainer(e.parentNode)||e).removeChart()};class We extends p.UI.Helper{constructor(e){super(),this.context=e,e.advertiseAs(this,"Channel")}write(e,n,r){M.prototype.channelWrite(`channel.${n}`,r,this.context.stx)}}p.UI.Channel=function(...l){return new We(...l)};p.UI.Layout.prototype.toggleHelp=function({node:l}){let{topNode:e,stx:n}=this.context;const r="ciq-show-help";if(e.classList.contains(r)){e.classList.remove(r),l.classList.remove(r),p.UI.shadowComponents.forEach((i,t)=>{i===e&&t.classList.remove(r)});return}p.UI.BaseComponent.prototype.qsa("cq-help",e,!0).forEach(i=>i.verifyHelpContent()),e.classList.add(r),l.classList.add(r),p.UI.shadowComponents.forEach((i,t)=>{i===e&&t.classList.add(r)}),p.Help.MessageShown||n.dispatch("notification",{message:p.Help.Message,displayTime:10,position:"bottom"})};p.UI.Markers=function(l,e){const n=this instanceof p.UI.Markers?this:Object.create(p.UI.Markers.prototype);return n.context=l,e||(e={}),n.menuItemSelector=e.menuItemSelector,n.activeClassName=e.activeClassName||"ciq-active",n.implementation=e.implementation,l.advertiseAs(n,"Markers"),n};p.inheritsFrom(p.UI.Markers,p.UI.Helper);p.UI.Markers.prototype.showMarkers=function(l,e,n){const{activeClassName:r,context:i,implementation:t}=this;let{topNode:s}=i;!t||!s.parentElement||(s=s.multiChartContainer||s,e&&(t.activeLabels.includes(e)?(t.hideMarkers(e),l.node.classList.remove(r)):(t.showMarkers(e,n),l.node.classList.add(r))))};p.UI.Keystroke=function(l,{keysToRepeat:e=[],node:n={}}={}){this.cb=l,this.shift=!1,this.ctrl=!1,this.cmd=!1,this.alt=!1,this.capsLock=!1,this.downValue="",this.keysToRepeat=e,this.recentKeys={},this.commandKeys={},this.initialize(n)};p.UI.Keystroke.noKeyCapture=!1;p.UI.Keystroke.prototype.androidWorkaroundKeyup=function(l){var e=l.target.value,n;e.length>this.downValue.length?n=e.charAt(e.length-1):n="Delete",this.key=n,this.cb({key:n,e:l,keystroke:this})};p.UI.Keystroke.prototype.mapKey=function(l){return{Shift:"shift",Control:"ctrl",Alt:"alt",Meta:"cmd",Win:"cmd"}[l]||l};p.UI.Keystroke.prototype.keyup=function(l){if(this.implementAndroidWorkaround){this.androidWorkaroundKeyup(l),this.implementAndroidWorkaround=!1;return}const{recentKeys:e}=this,{key:n,code:r}=l,i=this.mapKey(n),t=n!==i,s=new Date().getTime();if(e[r]||(e[r]={}),e[r].keyup=s,t)return this.commandKeys[r]?(this.commandKeys[r].pressed=!1,Object.values(this.commandKeys).some(({command:o,pressed:c})=>c&&o===i)||(this[i]=!1),this.cb({key:n,e:l,keystroke:this})):void 0;let a=[];Object.entries(this.commandKeys).forEach(([o,{command:c}])=>{let h=e[o]||{},d=e[r]||{};h.keydown<d.keydown&&d.keydown<h.keyup&&h.keyup+500>s&&(a.push(o),this[c]=!0)}),a.length&&setTimeout(()=>{a.forEach(o=>{e[o].keydown<s&&(this[this.commandKeys[o].command]=!1)})}),this.keysToRepeat.includes(n)?this.key=null:(this.key=n,this.cb({key:n,e:l,keystroke:this}))};p.UI.Keystroke.prototype.keydown=function(l){if(this.noKeyCapture)return;if(l.which==229&&p.isAndroid){this.implementAndroidWorkaround=!0;return}const{key:e,code:n}=l,r=this.mapKey(e),i=e!==r;if(this.recentKeys[n]||(this.recentKeys[n]={}),this.recentKeys[n].keydown=new Date().getTime(),i&&(this.commandKeys[n]={command:r,pressed:!0}),e=="Tab"){const t=document.querySelector("[cq-keyboardnavigation-active]");if(t){const{uiManager:s}=p.UI.getMyContext(t);if(s){const a=s.topMenu();(!a||!a.hasAttribute("native-tabbing"))&&l.preventDefault()}}else if(l.target.hasAttribute("cq-exit")){let s=l.target.getAttribute("cq-exit");(s=="head"&&!l.shiftKey||s=="foot"&&l.shiftKey)&&(l.target.setAttribute("cq-keyboardnavigation-active",""),l.preventDefault()),l.target.removeAttribute("cq-exit")}}this.key=e,i?this[r]=!0:e==="CapsLock"?this.capsLock=!this.capsLock:this.keysToRepeat.includes(e)&&(this.key=null,this.cb({key:e,e:l,keystroke:this}))};p.UI.Keystroke.prototype.keypress=function(l){if(!this.noKeyCapture){var e=l.which;e<32||e>222||(this.key=l.key)}};p.UI.Keystroke.prototype.initialize=function(l){var e=this,n=(l||{}).ownerDocument||document;["keyup","keydown","keypress"].forEach(function(r){n.addEventListener(r,function(i){r==="keydown"&&(e.downValue=i.target.value),e[r](i)})}),n.defaultView.addEventListener("blur",function(r){e.ctrl=!1,e.cb({key:"Control",e:r,keystroke:e})})};p.UI.KeystrokeHub=function(l,e,n){l=p.UI.$(l||e.topNode.ownerDocument)[0],this.infocus=!1;var r=this;[void 0,"#document","BODY"].indexOf(l.nodeName)>-1?this.infocus=!0:(l.addEventListener("mouseout",function(){r.infocus=!1}),l.addEventListener("mouseover",function(){r.infocus=!0})),this.context=e,this.params=n||{},{hotkeyConfig:this.hotkeyConfig}=e.config||{},this.uiManager=p.UI.getUIManager(e.topNode),this.uiManager.keystrokeHub=this;function i(){return function(){r.handler.apply(r,arguments)}}this.keystroke=new p.UI.Keystroke(i(),{keysToRepeat:this.hotkeyConfig.keysToRepeat,node:l}),this.tabOrder=[null],this.tabIndex=0,this.yNormalizationThreshold=this.context.topNode.getBoundingClientRect().height/25,this.tabElementSelectors=["cq-clickable.symbol-search","cq-lookup","cq-comparison[cq-marker]","cq-study-legend[chart-legend]","cq-menu.ciq-menu","cq-menu.dropdown",".ciq-toggles cq-toggle",".chart-control-group cq-toggle",".chartControls .chartSize span",".ciq-footer cq-toggle","cq-show-range div","cq-share-button","ciq-data-table-container button","[keyboard-navigation='true']"],this.tabActiveElement=null,this.tabActiveModals=[],this.keyControlElement=null,this.highlightElement=null;const{channelSubscribe:t}=p.UI.BaseComponent.prototype,s=(this.context.config.channels||{}).keyboardNavigation||"channel.keyboardNavigation";t(s,a=>{a&&a.action==="registerElements"&&this.setTabOrderElements()},this.context.stx)};p.inheritsFrom(p.UI.KeystrokeHub,p.UI.Helper);p.UI.KeystrokeHub.defaultHotKeys=function(l,e,n={}){const{hotkeyConfig:r={},keystroke:i,context:t}=e,{hotkeys:s=[]}=r,{stx:a}=t,{code:o,keyCode:c,shiftKey:h}=n||{},d=o&&o.includes("Numpad");return l=="Unidentified"&&(l=String.fromCharCode(c)),i.shift=h,s.slice().reverse().reduce(function(f,{action:g,commands:y,options:m}){return f.concat(y.map(v=>({action:g,command:v,options:m})))},[]).map(function({action:f,command:g,options:y}){return g==="+"?g=["+"]:g.slice(-2)==="++"?g=g.slice(0,-2).split("+").concat("+"):g=g.split("+"),{action:f,options:y,modifiers:g.slice(0,-1),commandKey:g.slice(-1)[0],specificity:g.length}}).filter(function({modifiers:f,commandKey:g}){let y=(d?[o]:[o,l]).includes(g),m=!f.length||f.every(v=>i[i.mapKey(v)]);return y&&m}).sort(function(f,g){return g.specificity-f.specificity}).some(function({action:f,options:g}){if(typeof f=="string")return p.UI.KeystrokeHub.executeHotkeyCommand({stx:a,action:f,options:g});if(typeof f=="function")return f({stx:a,options:g})!==!1})};p.UI.KeystrokeHub.addHotKeyHandler=function(l,e,n){const r=({value:i})=>{i&&setTimeout(()=>{const t=p.getFromNS(i.config,"hotkeyConfig.hotkeys",[]).find(({action:s})=>s===l);t&&(t.action=e)})};p.UI.observeProperty("uiContext",n,r),n.addEventListener("destroy",()=>p.UI.unobserveProperty("uiContext",n,r))};p.UI.KeystrokeHub.executeHotkeyCommand=function({stx:l,action:e,options:n={}}){const{crosshair:r,candleWidth:i}=l.layout,{left:t,right:s,panel:a}=l.chart,o=l.height-l.xaxisHeight,{percent:c=0,bars:h=0}=n,{topNode:d}=l.uiContext,u=d.ownerDocument.body.keystrokeHub,f=({axis:v,direction:b=1}={})=>{const{cx:q,cy:x}=l;let w=0;if(v==="x"&&(w=i*h),v==="y"&&(w=o*c),l.crossSection&&l.crossSection.crosshairBreakDistance&&(w=l.crossSection.crosshairBreakDistance),q||q===0||(l.cx=Math.round(l.width/2)),x||x===0||(l.cy=Math.round(o/2)),w){let C=l["c"+v]+w*b;C=Math.max(C,v==="x"?t+1:0),C=Math.min(C,v==="x"?s-1:o),l["c"+v]=Math.round(C)}l.mousemoveinner(l.resolveX(l.cx),l.resolveY(l.cy)),l.draw()},g=({direction:v=1,page:b}={})=>{const{dataSet:q,scroll:x,maxTicks:w}=l.chart;let C=b?w:h;C*=v,x+C>=q.length?l.chart.scroll=q.length:l.chart.scroll+=C,l.draw(),l.headsUpHR()},y=(v=1)=>{let b=o*c*v;l.chart.yAxis.scroll+=b,l.draw()},m=(v=1)=>{[...a.yaxisLHS,...a.yaxisRHS].forEach(q=>{let x=q.zoom+25*v;x<q.height&&(q.zoom=x)}),l.draw()};switch(e){case"up":r?f({axis:"y",direction:-1}):y();break;case"down":r?f({axis:"y"}):y(-1);break;case"right":r?f({axis:"x"}):g({direction:-1});break;case"left":r?f({axis:"x",direction:-1}):g();break;case"pageRight":g({direction:-1,page:!0});break;case"pageLeft":g({page:!0});break;case"zoomInXAxis":if(!l.allowZoom||l.activeDrawing&&!l.allowDrawingZoom)return;l.zoomIn();break;case"zoomOutXAxis":if(!l.allowZoom||l.activeDrawing&&!l.allowDrawingZoom)return;l.zoomOut();break;case"zoomInYAxis":m(-1);break;case"zoomOutYAxis":m();break;case"toggleCrosshairs":const v=d.querySelector('cq-toggle[cq-member="crosshair"]');v?v.dispatchEvent(new Event("stxtap")):l.layout.crosshair=!l.layout.crosshair,f();break;case"toggleContinuousZoom":l.continuousZoom&&l.continuousZoom.smartZoomToggle();break;case"symbolLookup":let q=(d.parentElement&&d.parentElement.closest("cq-context")||d).querySelector(".ciq-search cq-lookup cq-lookup-input input");if(q)q.focus();else{const x=p.UI.getMyContext(d);p.UI.BaseComponent.prototype.channelWrite("channel.dialog",{type:"lookup",params:{context:x}},l)}break;case"home":l.home(),l.headsUpHR();break;case"end":l.chart.scroll=l.chart.dataSet.length,l.draw(),l.headsUpHR();break;case"delete":if(p.ChartEngine.drawingLine)l.undo();else if(l.anyHighlighted)l.deleteHighlighted();else return!1;break;case"escape":if(p.ChartEngine.drawingLine)l.currentVectorParameters.vectorType=="continuous"&&p.ChartEngine.completeDrawing(l),l.undo();else if(l.repositioningAnchorSelector)p.Studies.cancelRepositionAnchor(l);else{const x=p.UI.getUIManager(d);if(u.tabActiveModals.length){if(u.tabActiveModals[0].processEsc&&u.tabActiveModals[0].processEsc(u))break;x&&x.closeMenu(u.tabActiveModals[0]),u.tabActiveModals[0]&&u.setKeyControlElement(u.tabActiveModals[0])}else x&&x.closeMenu()}break;case"keyboardNavigateDeselect":u.tabOrderDeselect();break;case"keyboardNavigateNext":if(u.tabActiveModals.length)return!1;u.tabIndexNext();break;case"keyboardNavigatePrevious":if(u.tabActiveModals.length)return!1;u.tabIndexNext(!0);break;case"keyboardNavigateClick":if(u.tabActiveModals.length)return!1;u.tabOrderClickSelected();break;default:return!1}return!0};p.UI.KeystrokeHub.prototype.resetTabNavigation=function(){const{topNode:l}=this.context;this.tabOrder=[null],this.tabIndex=0,this.yNormalizationThreshold=l.getBoundingClientRect().height/25,this.tabActiveElement=null,this.tabActiveModals=[],this.keyControlElement=null,this.highlightElement&&this.highlightElement.parentElement!==l?(this.highlightElement.remove(),l.append(this.highlightElement)):this.highlightHide();const e={pointerdown:()=>this.tabOrderDeselect(),pointermove:()=>l.classList.remove("disable-mouse-pointer")};for(const n in e)l.pointerHandlers&&l.removeEventListener(n,l.pointerHandlers[n]),l.addEventListener(n,e[n]);l.pointerHandlers=e,this.context.stx.append("resizeChart",()=>{this.setTabOrderElements(),this.highlightAlign()}),this.setTabOrderElements()};p.UI.KeystrokeHub.prototype.setTabOrderElements=function(){let l=null;if(this.tabIndex!==0){let e=this.tabOrder[Math.abs(this.tabIndex)];e?l=e.element:this.tabIndex=0}this.tabOrder=[null];for(let e=0;e<this.tabElementSelectors.length;e++){const n=p.UI.BaseComponent.prototype.qsa(this.tabElementSelectors[e],this.context.topNode,!0);for(let r=0;r<n.length;r++){const i=n[r];i.getAttribute("keyboard-navigation")!=="false"&&(i.tabListenerAdded||(i.addEventListener("stxtap",function(t){let s=this.tabOrder.findIndex(a=>a&&a.element===t);return s!=this.tabIndex&&(this.tabOrderDeselect(),this.tabIndex=-s),!0}.bind(this,i)),i.tabListenerAdded=!0),this.tabOrder.push({element:i}))}}this.sortTabOrderElements(l)};p.UI.KeystrokeHub.prototype.sortTabOrderElements=function(l){const e=this.tabIndex<0;!l&&this.tabIndex!==0&&this.tabOrder[Math.abs(this.tabIndex)]&&(l=this.tabOrder[Math.abs(this.tabIndex)].element),this.tabOrder.forEach(n=>{if(!n)return;const{x:r,y:i,width:t,height:s}=n.element.getBoundingClientRect();n.position={x:r,y:i,width:t,height:s}}),this.tabOrder.sort((n,r)=>{if(!(n===null||r===null))return Math.floor(n.position.y/this.yNormalizationThreshold)-Math.floor(r.position.y/this.yNormalizationThreshold)||n.position.x-r.position.x}),l&&this.tabOrder.forEach((n,r)=>{n&&n.element==l&&(this.tabIndex=e?-r:r)})};p.UI.KeystrokeHub.prototype.setKeyControlElement=function(l,e){!this.keyControlElement&&!l||(this.disableKeyControlElement(this.keyControlElement,e),l&&(this.keyControlElement=l,this.keyControlElement.keyboardNavigation=this,typeof this.keyControlElement.onKeyboardSelection=="function"&&this.keyControlElement.onKeyboardSelection()))};p.UI.KeystrokeHub.prototype.disableKeyControlElement=function(l,e){l&&(!e&&typeof l.onKeyboardDeselection=="function"&&l.onKeyboardDeselection(),l.keyboardNavigation=null)};p.UI.KeystrokeHub.prototype.tabOrderDeselect=function(l){const{tabOrder:e,tabIndex:n}=this;n<=0||(e[n]&&this.disableKeyControlElement(e[n].element),l||(this.tabActiveElement=null,this.tabIndex=-this.tabIndex,this.highlightHide(),this.context.topNode.classList.remove("disable-mouse-pointer")))};p.UI.KeystrokeHub.prototype.tabOrderSelect=function(){this.tabActiveElement&&clearTimeout(this.tabActiveElement.element.highlightDelayTimeout);const{tabOrder:l,tabIndex:e}=this;e<=0?this.highlightHide():this.highlightPosition(l[e])};p.UI.KeystrokeHub.prototype.tabOrderClickSelected=function(){const{tabOrder:l,tabIndex:e}=this;l.length<=1||e<=0||(this.setKeyControlElement(l[e].element),l[e].element.dispatchEvent(new Event("stxtap")))};p.UI.KeystrokeHub.prototype.tabIndexNext=function(l){if(!this.context.stx.uiContext.topNode.hasAttribute("cq-keyboardnavigation-active")||this.tabOrder.length<=1)return;this.context.stx.uiContext.topNode.focus(),this.sortTabOrderElements(),this.tabIndex<0?this.tabIndex=Math.abs(this.tabIndex):this.tabOrderDeselect(!0),(this.tabIndex<1||this.tabIndex>=this.tabOrder.length)&&(this.tabIndex=l?this.tabOrder.length:1);let e=this.tabIndex,n=!1;do if(l===!0?e--:e++,this.tabOrder[e]&&p.trulyVisible(this.tabOrder[e].element)&&this.tabOrder[e].element.getAttribute("keyboard-selectable")!=="false")if(!n)this.tabIndex=e,n=!0;else break;while(e<this.tabOrder.length&&e>0);(e>=this.tabOrder.length||e<=1)&&(e>=this.tabOrder.length?this.context.topNode.setAttribute("cq-exit","foot"):e<=1&&this.context.topNode.setAttribute("cq-exit","head"),this.context.topNode.removeAttribute("cq-keyboardnavigation-active")),this.tabOrderSelect(),this.uiManager.closeMenu()};p.UI.KeystrokeHub.prototype.addActiveModal=function(l){this.tabActiveModals.indexOf(l)>-1||(this.tabActiveModals.unshift(l),this.tabOrderDeselect(),l.hasAttribute("native-tabbing")||this.setKeyControlElement(l))};p.UI.KeystrokeHub.prototype.removeActiveModal=function(l){let{tabActiveModals:e}=this,n=e.indexOf(l);n>-1&&(e.splice(n,1),e[0]?this.setKeyControlElement(e[0]):this.setKeyControlElement())};p.UI.KeystrokeHub.prototype.highlightPosition=function(l){if(!l||!l.element||!l.position){const{tabOrder:e,tabIndex:n}=this;if(n<=0)return;l=e[n]}this.tabActiveElement=l,this.highlightAlign()};p.UI.KeystrokeHub.prototype.highlightAlign=function(){if(this.tabActiveElement){const l=this.tabActiveElement.element.getBoundingClientRect(),e=this.context.topNode.getBoundingClientRect();if(l.width<=0||l.height<=0){this.highlightHide();return}this.highlightCreate(),Object.assign(this.highlightElement.style,{top:l.top-e.top+"px",left:l.left-e.left+"px",width:l.width+"px",height:l.height+"px"})}};p.UI.KeystrokeHub.prototype.highlightCreate=function(){return this.highlightElement?this.highlightElement.classList.remove("disabled"):(this.highlightElement=document.createElement("div"),this.highlightElement.classList.add("cq-keyboard-selected-highlight"),this.context.topNode.appendChild(this.highlightElement)),this.context.topNode.classList.add("disable-mouse-pointer"),this.context.topNode.classList.add("cq-navigation-highlight-visible"),this.highlightElement};p.UI.KeystrokeHub.prototype.highlightHide=function(){this.highlightElement&&this.highlightElement.classList.add("disabled"),this.context.topNode.classList.remove("cq-navigation-highlight-visible")};p.UI.KeystrokeHub.prototype.setActiveContext=function(l){l.topNode.querySelector("cq-context")||(this.context=l)};p.UI.KeystrokeHub.prototype.processKeyStrokeClaims=function(l,e,n,r){for(let t of Array.from(p.UI.keyboardClaims).reverse())if(t.ownerDocument===n.target.ownerDocument){var i=t.keyStroke(l,e,n,r);if(i)return i.allowDefault||n.preventDefault(),!0}return!1};p.UI.KeystrokeHub.prototype.handler=function(l){const{stx:e}=this.context;if(e.editingAnnotation)return;const{e:n,key:r,keystroke:i}=l;if(!this.infocus&&r!=="Tab")return;const t=n.composedPath()[0].tagName;switch(r){case"Shift":e.shift=i.shift;break;case"Control":case"Alt":e.ctrl=i.ctrl;break;case"Meta":case"Win":e.cmd=i.cmd;break;case"CapsLock":this.capsLock=!this.capsLock;break}const s=n.key==="Escape"||n.key==="Esc"||n.key==="Tab",a=t==="INPUT"||t==="TEXTAREA",o=this.uiManager.activeMenuStack.length;if(this.params.cb&&!this.context.isLegendKeyboardActive()&&(s||!a&&!o)&&this.params.cb(r,this,n))return n.preventDefault();!p.ChartEngine.drawingLine&&this.processKeyStrokeClaims(this,r,n,i)};class Ae extends HTMLElement{constructor(){super(),this.activeMenuStack=[],this.registeredForResize=[],this.keystrokeHub=null}getColorPicker(e){const{topNode:n}=p.UI.getMyContext(e)||{};if(!n)return;let r=n.querySelector("cq-color-picker");return r||(r=document.createElement("cq-color-picker"),n.appendChild(r)),r}closeOpenColorPicker(){this.activeMenuStack.forEach(e=>{e.matches("cq-color-picker")&&e.close()})}connectedCallback(){var e=this;this.resize=function(){for(var i=e.registeredForResize,t=0;t<i.length;t++)typeof i[t].resize=="function"&&i[t].resize();e.closeOpenColorPicker()};var n=this.document||document;function r(i){i.ciqStamp>(n.lastTap||0)&&e.closeTopMenu()}n.body.addEventListener("stxtap",r),p.installTapEvent(n.body,{preventUnderlayClick:!1,preventClickEvent:!0,absorbDownEvent:!1}),n.defaultView.addEventListener("resize",this.resize),n.body.contains(this)&&(p.UI.registerComponentsImmediately=!0,p.UI.ensureComponentsRegistered())}disconnectedCallback(){var e=this.document||document;e.defaultView.removeEventListener("resize",this.resize)}closeMenu(e,n){var r=this.activeMenuStack,i=[];if(n=(n||"").split(",").map(s=>s.trim()).filter(s=>s),e)for(i.push(e),e=e.parentElement;e;)e.matches("cq-menu")&&e.active&&i.push(e),e=e.parentElement;else i=r;for(var t=0;t<i.length;t++){const s=i[t];n.length&&!n.includes(s.tagName)||s.keepOpen||s.hide&&s.hide()}this.activeMenuStack=r.filter(function(s){return s.active}),this.ifAllClosed()}closeTopMenu(){var e=this.activeMenuStack;if(e.length){var n=e[e.length-1],r=this;(!n.isDialog||n.active)&&(e.pop(),n.hide(),n.onClose&&n.onClose(),setTimeout(function(){r.ifAllClosed()},0));var i=n.getAttribute("cq-close-top");i&&p.climbUpDomTree(n.parentElement,i).forEach(function(t){r.closeMenu(t)})}}ifAllClosed(){this.activeMenuStack.length||Array.from((this.document||document).querySelectorAll("cq-context,*[cq-context]")).forEach(function(e){e.CIQ&&e.CIQ.UI&&e.CIQ.UI.context&&e.CIQ.UI.context.stx&&e.CIQ.UI.context.stx.modalEnd()})}initializeMenuListeners(e){e.callbackListeners.menu=[]}lift(e){var n=e;if(n){var r=n.ownerDocument;n.remember={parentNode:n.parentNode,css:{position:n.style.position,display:n.style.display,left:n.style.left,top:n.style.top,height:n.style.height,width:n.style.width,opacity:n.style.opacity}};var i=n.getBoundingClientRect(),t=n.scrollHeight;n.doNotDisconnect=!0,n.remove(),n.reduceMenuHeight=5,Object.assign(n.style,{position:"fixed",display:"block",left:i.left+"px",top:i.top+"px",height:t+"px",opacity:1}),r.body.appendChild(n),delete n.doNotDisconnect,typeof n.resize!="undefined"&&n.resize(),Array.from(n.querySelectorAll("cq-scroll")).forEach(function(s){s.resize()})}}openMenu(e,n){setTimeout(function(){var r=e.querySelector("input:first-child");r&&r.focus()},0),this.activeMenuStack.push(e),e.show(n),e.ownerDocument.querySelectorAll("cq-context,*[cq-context]").forEach(function(r){const i=p.getFromNS(r,"CIQ.UI.context.stx");i&&(i.modalBegin(),i.callbackListeners.menu&&i.dispatch("menu",{stx:i,menu:e}))})}registerForResize(e){this.registeredForResize.push(e)}topMenu(){var e=this.activeMenuStack;return e.length?e[e.length-1]:null}unregisterForResize(e){for(var n=this.registeredForResize,r=0;r<n.length;r++)if(n[r]===e){n.splice(r,1);return}}}p.UI.UIManager=Ae;p.ChartEngine.registerGlobalEvent("unload",function(){const l=p.UI._uiManagers.get(this.document);if(l){p.UI._uiManagers.delete(this.document);try{l.disconnectedCallback()}catch(e){}}},!1,!0);p.UI.getUIManager=function(l){let e=document;if(l){const i=p.UI.closestContextContainer(l);i?e=i.portalDoc||e:e=l.ownerDocument||e}p.UI._uiManagers||(p.UI._uiManagers=new WeakMap);const n=p.UI._uiManagers.get(e);if(n)return n;let r=e.querySelector("cq-ui-manager");return r||(r=new p.UI.UIManager,r.document=e,r.connectedCallback()),p.UI._uiManagers.set(e,r),r};customElements.define("cq-ui-manager",Ae);const{qs:B,qsa:Ii,channelWrite:ce,channelRead:De,channelSubscribe:ne}=p.UI.BaseComponent.prototype;class $e{createChartAndUI({container:e,config:n}){e||(e=document.body),n&&!n.chartId&&(n.chartId=e.id);const r=d(e),i=B("cq-context",r),t=p.getFromNS(i,"CIQ.UI.context"),s=B(t?"[cq-context-engine]":".chartContainer",r);t&&(s.parentElement.style.display="none",s.dimensionlessCanvas=!0);const a=p.ChartEngine.create({container:s,config:n,deferLoad:!0});s.stx=a;const o=a.container.closest("cq-context-wrapper");if(o&&n.multiChartCopySymbol===null&&!n.initialSymbol){const{onChartReady:u,onMultiChartEvent:f}=n;n.onChartReady=function(g){u&&u.call(n,g),f&&f("chartReady",{stx:g}),g.chart.symbolObject.symbol===null&&(g.container.insertAdjacentHTML("beforeend",`<div class='ciq-empty-message'>${g.translateIf(n.multiChartLoadMsg)}</div>`),o&&(o.classList.add("ciq-empty-chart"),o.removeEmptyMsg=()=>{o.querySelector(".ciq-empty-message").remove(),o.classList.remove("ciq-empty-chart"),delete o.removeEmptyMsg}))}}p.UI.scrollbarStyling=n.scrollbarStyling,p.UI.ensureComponentsRegistered(),this.portalizeContainerIfInDifferentDocument(e);let c=new p.UI.Context(a,r);c.topNode.hasAttribute("tabindex")||c.topNode.setAttribute("tabindex","0"),c.config=n,e.context=c,p.UI.Layout(c),p.UI.Channel(c),this.initMenusAndToggles(c),this.initLookup(c),this.initDialogHandler(c),this.initContainerListeners(c),this.initEventMarkers(c),this.initDrawingTools(c),this.initDrawingEditListeners(c),this.loadPreferences(c),h(c);function h(u){const f=u.topNode.parentNode.closest("cq-context"),g=f||u.topNode;if(g.querySelector(".cq-plugin-container"))return;const y=document.createElement("div");y.classList.add("cq-plugin-container"),g.appendChild(y);const m=f?B(".ciq-multi-chart-container-wrapper",f):B(".ciq-chart-area",u.topNode),v=p.resizeObserver(y,()=>{const{height:b}=getComputedStyle(y);m.style.marginTop=b,u.stx.resizeChart()});u.stx.addEventListener("destroy",()=>{p.resizeObserver(y,null,v)})}if(t||(p.UI.StudyEdit(null,c),this.initColorPicker(c),p.Renderer.Bars&&p.UI.activatePluginUI(a,"advanced"),this.initExtensions({stx:a,uiContext:c,type:"plugins"}),this.initPluginChannelListeners(a,c),n.onEngineReady&&n.onEngineReady(a),this.loadChart(c)),n.language&&p.I18N.localize(a,n.language),p.UI.BaseComponent.buildReverseBindings(r),t)return c;return r.bindingInitiated=!0,p.UI.begin(n.onWebComponentsReady),c.uiManager=p.UI.getUIManager(c.topNode),c.uiManager.initializeMenuListeners(a),window.setTimeout(function(){c.topNode.ownerDocument.body.keystrokeHub.resetTabNavigation(),p.UI.setDefaultStates(c)},0),c;function d(u){return u.matches("cq-context")||u.getAttribute("cq-container")?u:u.querySelector("cq-context, [cq-context]")}}initContainerListeners(e){const{config:{channels:{className:n="channel.componentClass",breakpoint:r="channel.breakpoint",sidenavSize:i="channel.sidenavSize",sidepanelSize:t="channel.sidepanelSize",drawingPalettes:s="channel.drawingPalettes",pluginPanelHeight:a="channel.pluginPanelHeight"}={}}={},stx:o,topNode:c}=e;p.UI.addResizeListener(c,()=>this.notifySizeChanges(e)),o.addEventListener("destroy",()=>p.UI.removeResizeListener(c)),this.notifySizeChanges(e),ne(n,this.classSetter(e),o),ne(r,this.breakpointSetter(e),o),ne(i,this.sidenavSizeSetter(e),o),ne(t,this.sidepanelSizeSetter(e),o),ne(s,this.chartPositionSetter(e),o);const h=this.initKeystrokeHub(e),d=this.getKeystrokeHubSetter(e,h);c.addEventListener("mouseover",d),c.addEventListener("focus",u=>{u.target.hasAttribute("cq-keyboardnavigation-active")||(d(u),u.target.setAttribute("cq-keyboardnavigation-active",""),h.resetTabNavigation())}),c.addEventListener("blur",u=>{const f=document.querySelector(".cq-dialogs"),g=u.relatedTarget?u.relatedTarget.closest("[cq-lift]"):null;u.relatedTarget&&(c.contains(u.relatedTarget)||f&&f.contains(u.relatedTarget)||g)||(u.target.removeAttribute("cq-keyboardnavigation-active"),h.tabOrderDeselect(),h.highlightHide())})}initLookup(e){const{config:n,topNode:r,stx:i}=e,{channels:{lookup:t}={},dialogs:{lookup:s}={}}=n;if(t&&s){const{channelSubscribe:a,channelWrite:o}=p.UI.BaseComponent.prototype;a(t,c=>{o("channel.dialog",c?{type:"lookup",params:{stx:i,context:e}}:{},i)},i)}this.initKeystrokeHub(e),e.changeSymbol=function(a,o){const{stx:c,loader:h}=e;h&&h.show();const{removeSeries:d,loadError:u}=n.onNewSymbolLoad||{};if(d&&Object.values(c.chart.series).filter(d).forEach(f=>{f.parameters.isEvent?c.removeEvent(f.id):c.removeSeries(f.id)}),c.loadChart(a,{masterData:a._masterData},function(f){if(h&&h.hide(),f){u&&u(f,e);return}o&&o(c),n.restore&&p.ChartEngine.restoreDrawings(c,c.chart.symbol,n.chartId)}),a.symbol){const f=e.topNode.closest("cq-context-wrapper");f&&f.removeEmptyMsg&&f.removeEmptyMsg()}},n.lookupDriver&&e.setLookupDriver(new n.lookupDriver)}initKeystrokeHub(e){let n=document;return e&&(n=e.topNode.portalDoc||n),n.body.keystrokeHub||(n.body.keystrokeHub=new p.UI.KeystrokeHub(n.body,e,{cb:p.UI.KeystrokeHub.defaultHotKeys})),n.body.keystrokeHub}getKeystrokeHubSetter(e,n){return function(){n.context!==e&&n.setActiveContext(e)}}initDialogHandler(e){const{config:{channels:n={},dialogs:r={}}={},stx:i}=e;ne(n.dialog||"channel.dialog",t,i);function t({type:s=null,params:a={}}={}){if(!s)return;const o=r[s]||r[p.makeCamelCase(s)];if(!o)return;const c=a.context.topNode.ownerDocument;let h=B(o.tag,c);if(!h){const u=d(c),f=document.createElement("cq-dialog");h=document.createElement(o.tag),Object.entries(o.attributes||{}).forEach(([g,y])=>h.setAttribute(g,y)),f.append(h),u.append(f)}h&&h.open&&h.open(a);function d(u){let f=B(".cq-dialogs",u);return f||(f=document.createElement("div"),f.classList.add("cq-dialogs"),u.body.append(f),f)}}}initDrawingTools(e){const{stx:n,config:{channels:r={}}={},topNode:i}=e;ne(r.drawing||"channel.drawing",t,n);function t(s){i.classList[s?"add":"remove"]("toolbar-on"),n.resizeChart()}}initDrawingEditListeners(e){const{config:{channels:n={}}={},stx:r}=e,i=new p.UI.DrawingEdit(null,e);let t=!0;const s=n.drawing||"channel.drawing";i.node.addEventListener("drawing-edit-begin",function(a){De(s,r)||(t=!1,ce(s,!0,r))},!1),i.node.addEventListener("drawing-edit-end",function({detail:a}){t||(a.action!=="edit"&&(t=!0),a.action==="close"&&ce(s,!1,r))},!1)}initColorPicker(e){let n=document;e&&(n=e.topNode||n);let r=n.querySelector("cq-color-picker");r||(n=n.ownerDocument||n,r=n.querySelector("body > cq-color-picker"),!r&&(r=document.createElement("cq-color-picker"),document.body.append(r),n.ownerDocument&&n.ownerDocument.body.append(r)))}loadPreferences(e){const{stx:n,topNode:r,config:{chartId:i,multiChartId:t,restore:s}={}}=e;s&&p.ChartEngine.restorePreferences(n,t||i||r.id)}loadChart(e){const{stx:n,config:{chartId:r,initialSymbol:i,restore:t,onChartReady:s,initialData:a}={},loader:o}=e;o&&o.show(),t?p.ChartEngine.restoreLayout(n,function(){if(o&&o.hide(),!n.chart.symbol){c();return}h()},r,e.config):c();function c(){if(n.crossSection&&n.setChartType("crosssection"),!i){h();return}const d=typeof i=="string"?{symbol:i}:i;d._masterData=a,e.changeSymbol(d,h)}function h(){s&&setTimeout(()=>s(n))}}notifySizeChanges(e){const{stx:n,topNode:{clientWidth:r,clientHeight:i,classList:t},config:{channels:s={}}={}}=e;if(n.destroyed)return;const a=De(s.containerSize||"channel.containerSize",n);if(a&&a.width===r&&a.height===i)return;const o=this.getBreakpoint(r,i);t.contains(o[1])||ce(s.breakpoint||"channel.breakpoint",o[1],n),o[0]!==n.chart.breakpoint&&window.setTimeout(()=>{ce(s.breakpoint||"channel.breakpoint",o[0],n),n.notifyBreakpoint(o[0]),n.resizeChart()}),ce(s.containerSize||"channel.containerSize",{width:r,height:i},n),n.resizeChart()}getBreakpoint(e,n){let r="break-sm";if(e>768?r="break-lg":e>584&&(r="break-md"),typeof n=="undefined")return r;let i="break-height-sm";return n>768?i="break-height-lg":n>350&&(i="break-height-md"),[r,i]}initEventMarkers(e){const n=e.config;if(n.eventMarkersImplementation&&p.UI.Markers){const r=n.eventMarkersImplementation&&new n.eventMarkersImplementation(e.stx),i=n.selector.markersMenuItem;p.UI.Markers(e,{menuItemSelector:i,implementation:r})}}initExtensions({stx:e,uiContext:n,type:r}){const{config:i}=n,t=i[r];Object.entries(t).filter(([,s])=>!!s).forEach(([s,a])=>{this.constructor.applyPlugin(e,s,a)})}static applyPlugin(e,n,r){const{uiContext:i}=e,t=r.moduleName||p.capitalize(n);try{if(!p[t]){if(r.load&&r.toggleMarkup&&r.container&&(typeof r.container=="string"&&(r.container=i.topNode.querySelector(r.container)),r.container)){const o=document.createElement("div");p.innerHTML(o,r.toggleMarkup),Array.from(o.childNodes,c=>{r.container.appendChild(c.cloneNode(!0))}),p.UI.activatePluginUI(e,t)}p.debug&&console.log(`${t} not available for ${n} with params:`,r);return}const s=Object.assign({stx:e,context:i},r),a=new p[t](s);p.UI.activatePluginUI(e,t),r.postInstall&&r.postInstall({uiContext:i,extension:a}),r.init=!0}catch(s){p.debug&&console.error("Error configuring "+n+" using params ",r,"error",s)}}static loadPlugin(e,n){const r=e.uiContext.config.plugins[n],i=r.moduleName||p.capitalize(n);if(r.init)return Promise.resolve();p[i]?this.applyPlugin(e,n,r):r.load&&r.load().then(t=>{p.UI.registerComponents(),this.applyPlugin(e,n,r)})}initPluginChannelListeners(e,n){Object.entries(n.config.plugins).forEach(([r,i])=>{i&&(i.init||!i.channel||!i.load||M.prototype.channelSubscribe(i.channel,t=>{t&&this.constructor.loadPlugin(e,r)},e))})}initMenusAndToggles(e){const{config:n}=e;n.toggles=n.toggles||{},e.advertiseAs(n.toggles,"ToggleConfig"),n.menus=n.menus||{},e.advertiseAs(n.menus,"MenuConfig"),[...p.UI.shadowComponents.keys()].forEach(r=>r.fireConfigChange&&r.fireConfigChange())}chartPositionSetter(e){let n=B(".ciq-multi-chart-container",e.topNode);return n||(n=B(".chartContainer",e.topNode)),function(i){if(!i)return;const{top:t,left:s}=i;Object.assign(n.style,{top:t+"px",marginLeft:s+"px",height:`calc(100% - ${t}px)`})}}sidenavSizeSetter(e){const n=B(".ciq-multi-chart-container-wrapper, .ciq-chart-area",e.topNode);return e.stx,function(i){n.style.left=i+"px",p.getFnFromNS(e,"topNode.getCharts",[e.stx])().forEach(t=>t.resizeChart())}}chartAreaTopSetter(e){const n=B(".ciq-chart-area",e.topNode);return function(i){let t=Object.values(i||{}).reduce((a,o)=>a+o,0);const s=e.topNode.querySelector(".cq-plugin-container");s&&(t=s.offsetHeight),n.style.marginTop=t+"px",e.stx.resizeChart()}}sidepanelSizeSetter(e){const{multiChartContainer:n}=e.topNode,r=B(".ciq-multi-chart-container, .ciq-chart-area",n||e.topNode),i=e.stx;return function(t){r.style.marginRight=t+"px";const s=B(".cq-plugin-container",e.topNode);s&&(s.style.marginRight=t+"px"),i.resizeChart()}}breakpointSetter(e){return function(r){let i=[["break-lg","break-md","break-sm"],["break-height-lg","break-height-md","break-height-sm"]];const t=[e.topNode];p.UI.shadowComponents.forEach((s,a)=>{s===e.topNode&&t.push(a)}),t.forEach(s=>{i.forEach(a=>{a.includes(r)&&s.classList.remove(...a)}),s.classList.add(r)})}}classSetter(e){return function(r){r&&p.UI.shadowComponents.forEach((i,t)=>{for(const[s,a]of Object.entries(r))i===e.topNode&&t.classList[a](s)})}}portalizeContainerIfInDifferentDocument(e){if(e.ownerDocument===document)return;const n=Object.keys(p.UI._webcomponents.list).join(","),r=Array.from(e.querySelectorAll(n)),i=r.filter(s=>!r.some(o=>o!==s&&o.contains(s)));e.matches("cq-context")||(e=e.querySelector("cq-context")),(e||{}).portalDoc=e.ownerDocument,i.forEach(s=>{t(s);const a=document.createElement("div");a.innerHTML=s.outerHTML,s.parentElement.replaceChild(a.firstChild,s)});function t(s){s.querySelectorAll("template").forEach(a=>{for(;a.firstChild;)a.content.append(a.firstChild)})}}}p.UI.Chart=$e;class Ke{createCharts({containerId:e,chartsConfig:n},r){const i=!e||typeof e=="string"?document.querySelector(e||"cq-context"):e;i.styles={},i.isMultiChartHost=!0;const t=Array.from(i.querySelectorAll("cq-context-wrapper"));if(!t.length)throw"cq-context-wrapper element is required for multichart template setup";const s=t[0].outerHTML;let{charts:a,colCount:o,rowCount:c,gridTemplate:h,offgridCharts:d=[]}=n;a.slice(0,a.length-t.length).forEach(()=>{t[0].parentElement.insertAdjacentHTML("beforeend",s)});const u=i.querySelectorAll("cq-context");r.root=null,r.multiChartCopySymbol===null&&(r.initialSymbol=""),r.hotkeyConfig.hotkeys=r.hotkeyConfig.hotkeys.filter(({label:v})=>!/\btab\b/i.test(v));const f=new p.UI.Chart,g=a.map(({symbol:v,chartId:b},q)=>{const x=p.clone(r);x.initialSymbol=typeof v!="undefined"?v:x.initialSymbol,x.chartId=b||(r.chartId||"")+"_c"+p.uniqueID();const w=u[q];x.root=w,w.multiChartContainer=i;const{stx:C}=f.createChartAndUI({container:w,config:x});return this.initChart(w,x,C),C});f.createChartAndUI({container:i,config:r}),this.initContainer(i,r,s),this.setGridUI(i,o,c,h),g.forEach(v=>{v.setDrawingContainer(i.context.stx.drawingContainer),v.currentVectorParameters=i.context.stx.currentVectorParameters,v.preferences.drawings=i.context.stx.preferences.drawings}),ne(r.channels.drawing||"channel.drawing",m,i.context.stx);let y;function m(v){i.classList[v?"add":"remove"]("toolbar-on");const{onDraw:b}=r.soloActive||{},{shouldSolo:q}=b||{},x=i.querySelector("cq-context-wrapper.active cq-context");if(i.activeRequests&&v&&(y=null),b&&i.soloActive&&x){const{stx:w}=x.CIQ.UI.context,C=typeof q!="function"||v&&q(w);(C||!v&&y===w)&&i.soloActive(v,"onDraw"),C&&(y=w)}i.context.stx.resizeChart()}return i.colCount=o,i.rowCount=c,i.gridTemplate=h,i.offgridCharts=d,i.updateLayout(),g}initContainer(e,n,r){const i=e.querySelector("cq-context");e.plugins=e.plugins||[],this.contextSwitcher(e),this.addChart(e,n,r),this.moveChart(e,n),this.removeChart(e,n),this.solo(e,n),this.toggleSolo(e,n),this.setColCount(e),this.setRowCount(e),this.setGridTemplate(e),this.cleanGridStyles(e),this.fillLayoutWithCharts(e),this.updateGridListener(e),this.updateLayout(e,n),this.utils(e),this.copyAttributes(i,e),setTimeout(()=>{e.switchContext(i.CIQ.UI.context)})}initChart(e,n,r){const i=p.UI.closestContextContainer(e.parentElement);r.keepDrawingToolSelected=n.keepDrawingToolSelected;let t;["mousedown","touchstart","pointerdown"].forEach(a=>{e.addEventListener(a,o=>{if(s())return;const c=o.target.closest("cq-context");if(c){const h=c.CIQ.UI.context;i.switchContext(h,o)}},!0)});function s(){const a=+new Date,o=a-t;if(t&&o<10)return!0;t=a}if(n.onMultiChartEvent){const a=()=>{n.onMultiChartEvent("chartDestroy",{stx:r}),r.removeEventListener("destroy",a)};r.addEventListener("destroy",a)}r.keepDrawingToolSelected===void 0&&(r.keepDrawingToolSelected=!0),r.preserveCandleWidthOnResize===null&&(r.preserveCandleWidthOnResize=!0),r.prepend("mousemoveinner",()=>{if(r.__notifiedExit)return;i.getCharts().forEach(o=>{o!==r&&(o.insideChart=o.overYAxis=o.overXAxis=!1,o.undisplayCrosshairs(),o.draw(),o.__notifiedExit=!1)}),r.__notifiedExit=!0}),p.UI.closestContextContainer(e,{isWrapper:!0}).close=function(){i.activeRequests&&i.toggleSolo({node:this}),i.removeChart(this)},p.UI.closestContextContainer(e,{isWrapper:!0}).move=function(a,o="after"){i.activeRequests&&i.toggleSolo({node:this}),i.moveChart(this,o)}}addChart(e,n,r){e.addChart=(i,t="after")=>{e.activeRequests&&e.toggleSolo({node:e.querySelector("cq-context-wrapper.active .ciq-solo-toggle")});let{node:s,symbol:a,chartId:o}=i||{};const c=s?p.UI.closestContextContainer(s,{isWrapper:!0}):e.querySelector("cq-context-wrapper.active");n.multiChartCopySymbol?a=ue({},p.getFromNS(c.querySelector("cq-context"),"CIQ.UI.context.stx.chart.symbolObject")):n.multiChartCopySymbol===null&&(a="");const{crosshair:h,headsUp:d}=c.querySelector("cq-context").CIQ.UI.context.stx.layout;let u;t==="after"?(c.insertAdjacentHTML("afterEnd",r),u=c.nextSibling):t==="before"&&(c.insertAdjacentHTML("beforeBegin",r),u=c.previousSibling),u.querySelector("cq-context").multiChartContainer=e,p.UI.BaseComponent.buildReverseBindings(u);const f=u.querySelector("cq-context"),g=p.clone(n);g.initialSymbol=typeof a!="undefined"?a:g.initialSymbol,g.chartId=o||`_c${p.uniqueID()}`,g.root=f;const y=g.createChart(f);return y.layout.crosshair=h,y.layout.headsUp=Object.assign({},d),e.querySelectorAll("cq-info-toggle-dropdown").forEach(m=>m.initInfoComponents(e)),e.setCurrentThemeClass&&e.setCurrentThemeClass(f,y),this.initChart(f,g,y),y.setDrawingContainer(e.context.stx.drawingContainer),y.currentVectorParameters=e.context.stx.currentVectorParameters,y.preferences.drawings=e.context.stx.preferences.drawings,e.updateLayout(),y}}moveChart(e,n){e.moveChart=(r,i="after")=>{const t=r||e.querySelector("cq-context-wrapper.active");let s=i=="before"?t.previousElementSibling:t.nextElementSibling;s&&(i=="after"&&(s=s.nextElementSibling),t.doNotDisconnect=!0,t.parentElement.insertBefore(t,s),delete t.doNotDisconnect),e.updateLayout()}}removeChart(e,n){e.removeChart=function(i){const t=i||e.querySelector("cq-context-wrapper:last-of-type"),s=t.classList.contains("active"),a=t.nextElementSibling||t.previousElementSibling;if(!a)return;s&&a.querySelector("cq-context").dispatchEvent(new Event("stxtap")),t.querySelector("cq-context").CIQ.UI.context.stx.destroy(),t.remove();const o=n.nameValueStore||p.NameValueStore,c=new o,h=p.getFromNS(t.querySelector("cq-context")||{},"CIQ.UI.context.config.chartId");if(p.getFromNS(t.querySelector("cq-context")||{},"CIQ.UI.context.config.chartId"),h){c.remove(`myChartLayout${h}`);const d=`${h||""}_drawings`;c.get(d,(u,f)=>{u||!f||(Object.keys(f).forEach(g=>{c.remove(g)}),c.remove(d))}),e.updateLayout()}e.switchContext(a.querySelector("cq-context").CIQ.UI.context)}}contextSwitcher(e){e.activeContext=e.CIQ.UI.context;const n=e.CIQ.UI.context;e.switchContext=(t,s)=>{if(o(s),t===e.activeContext)return;this.getCommonUI(e).forEach(c=>r(c,t)),i(t),e.plugins.forEach(c=>{c.switchContext&&c.switchContext(t)}),Array.from(e.querySelectorAll("cq-context-wrapper")).forEach(c=>{const h=c.querySelector("cq-context").CIQ.UI.context;c.classList.toggle("active",t===h)}),e.activeContext=t,p.getFnFromNS(t,"config.onMultiChartEvent")("contextSwitch",{prev:e.activeContext,context:t});function o(c){if(c&&!t.stx.chart.symbolObject.symbol){if(c.target.closest("cq-menu"))return;p.UI.getUIManager(c.target).closeTopMenu(),c.stopPropagation();const d=e.querySelector(".ciq-search cq-lookup cq-lookup-input input");if(d){setTimeout(()=>{d.click(),d.focus()});return}const u=(t.config.channels||{}).dialog||"channel.dialog",{channelWrite:f}=p.UI.BaseComponent.prototype;f(u,{type:"lookup",params:{context:t}},t.stx)}}};function r(t,s){if(t.changeContext){t.changeContext(s);return}t.stx&&(t.stx=s.stx),t.context&&(t.context=s)}function i(t){Object.values(n.advertised).forEach(s=>{s.changeContext&&s.changeContext(t)})}}solo(e,n){const{freezeEngineRendering:r,transitionToSolo:i,transitionFromSolo:t}=this;e.resized=-1,e.soloActive=(s,a)=>{let{activeRequests:o=0}=e;const c=o;if(!s&&a!=="toggle"&&e.soloType==="toggle")return;s&&o===0&&(e.soloType=a),o+=s?1:o?-1:0,a==="toggle"&&!s&&(o=0),Object.assign(e,{activeRequests:o});const h=e.querySelector("cq-context-wrapper.active");if(!h)return;o?setTimeout(()=>{i(e,r)},100):t(e);const d=h.querySelector("cq-context").context.stx;if(s){const u=p.getFromNS(n,`soloActive.${a}.notify`);!c&&u&&e.classList.contains("ciq-multi-chart")&&d.dispatch("notification",u)}else o||(Object.values(n.soloActive||{}).filter(u=>u.notify).forEach(({notify:u})=>{d.dispatch("notification",Object.assign({},u,{remove:!0}))}),e.plugins.forEach(u=>{u.deactivateOnGrid&&u.deactivateOnGrid()}))}}freezeEngineRendering(e){const n={draw(){},resizeChart(){}};function r(d){const{draw:u,resizeChart:f}=d;return Object.assign(d,n),{draw:u,resizeChart:f}}let i=0;const{quoteDriver:t}=e;t&&(i=t.behavior.refreshInterval,t.resetRefreshInterval(t.behavior.backgroundRefreshInterval||0));const{slider:s}=e.slider||{},{marketDepth:a}=e.marketDepth||{},o=r(e),c=r(s||{}),h=r(a||{});return()=>{Object.assign(e,o),t&&t.resetRefreshInterval(i),s&&Object.assign(s,c),a&&Object.assign(a,h),e.draw()}}transitionToSolo(e,n){const r=e.querySelector(".ciq-multi-chart-container"),{top:i,left:t}=r.getBoundingClientRect(),s=[];e.querySelectorAll("cq-context-wrapper").forEach(a=>{const o=a.classList.contains("active");if(!o){const f=a.querySelector("cq-context").CIQ.UI.context.stx;a.restoreDraw=n(f),setTimeout(()=>{a.style.visibility="hidden"},550)}const{height:c,width:h,top:d,left:u}=a.getBoundingClientRect();s.push({el:a,style:{height:c+"px",width:h+"px",top:d-i+"px",left:u-t+"px"},className:o?"ciq-solo":"ciq-solo-minimized"})}),e.classList.add("ciq-solo"),s.forEach(({el:a,style:o,className:c})=>{Object.assign(a.style,o),setTimeout(()=>{a.classList.add(c)},50)}),e.rHandle=p.resizeObserver(e,()=>{e.resized+=1})}transitionFromSolo(e){const n=e.querySelectorAll("cq-context-wrapper");n.forEach(r=>{r.classList.remove("ciq-solo-minimized","ciq-solo"),e.resized||(r.style.visibility="")}),setTimeout(()=>{e.classList.remove("ciq-solo"),n.forEach(r=>{r.classList.remove("ciq-solo-minimized","ciq-solo"),Object.assign(r.style,{height:"",width:"",top:"",left:"",visibility:""}),r.restoreDraw&&(r.restoreDraw(),delete r.restoreDraw)})},e.resized?0:350),p.resizeObserver(e,null,e.rHandle),e.resized=-1}toggleSolo(e,n){e.toggleSolo=({node:r})=>{const t=p.UI.closestContextContainer(r,{isWrapper:!0}).querySelector("cq-context").CIQ.UI.context;if(e.activeRequests){const{drawing:s="channel.drawing",tfc:a="channel.tfc"}=n.channels||{},{channelWrite:o}=p.UI.BaseComponent.prototype;o(s,!1,t.stx),o(a,!1,t.stx),e.soloActive(!1,"toggle")}else p.UI.closestContextContainer(r,{isWrapper:!0}).classList.contains("active")||e.switchContext(t),e.soloActive(!0,"toggle")}}setColCount(e){e.setColCount=function(r){e.gridTemplate="",e.colCount=r,e.updateLayout()}}setRowCount(e){e.setRowCount=function(r){e.gridTemplate="",e.rowCount=r,e.updateLayout()}}setGridTemplate(e){e.setGridTemplate=function(r){e.colCount="",e.rowCount="",e.gridTemplate=r,e.updateLayout()}}cleanGridStyles(e){e.cleanGridStyles=function(r){const t=e.querySelector("cq-grid-size-picker").templates.split(" "),s=e.querySelector(".ciq-multi-chart-container");s.style.gridTemplateRows="",s.style.gridTemplateColumns="",s.className=s.className.split(" ").filter(a=>!t.includes(a)).join(" ")}}fillLayoutWithCharts(e){e.fillLayoutWithCharts=function(){const r=e.querySelector(".ciq-multi-chart-container");if(!r)return;const i=getComputedStyle(r);let t=0;i.gridTemplateAreas&&i.gridTemplateAreas!="none"?t=[...new Set(i.gridTemplateAreas.match(/([a-z])+/gi))].length:i.getPropertyValue("--grid-dimension")?(t=parseInt(i.getPropertyValue("--grid-dimension"))||0,t++):t=parseInt(e.rowCount)*parseInt(e.colCount);const{restoreOffgridCharts:s}=e.CIQ.UI.context.config;let{offgridCharts:a}=e;for(;t&&r.childElementCount!==t;)if(r.childElementCount>t){const o=e.querySelector("cq-context-wrapper:last-of-type").querySelector("cq-context").CIQ.UI.context.config,c=o.chartId;s&&a.push(c),o.chartId="",e.removeChart()}else{const o=r.querySelector("cq-context-wrapper:last-of-type cq-context"),c=s?a.pop():void 0;if(e.addChart({node:o,chartId:c}),r.childElementCount>=25)break}s&&e.updateLayout()}}updateGridListener(e){e.addEventListener("update-grid",({detail:{columns:n,rows:r,template:i,container:t}})=>{t===e&&(i?e.setGridTemplate(i):n&&r&&(e.setColCount(n),e.setRowCount(r)),e.fillLayoutWithCharts())})}updateLayout(e,n){e.updateLayout=function(){const r=n.nameValueStore||p.NameValueStore,i=new r,t=Array.from(e.ownerDocument.querySelectorAll("cq-context-wrapper"),u=>{const f=p.getFromNS(u.querySelector("cq-context")||{},"CIQ.UI.context.config.chartId");if(f)return{chartId:f}}).filter(u=>u);i.set("multiCharts"+(n.multiChartId||""),{charts:t,colCount:e.colCount,rowCount:e.rowCount,gridTemplate:e.gridTemplate,offgridCharts:e.offgridCharts}),e.classList[t.length>1?"add":"remove"]("ciq-multi-chart"),e.cleanGridStyles();const s=e.querySelector(".ciq-multi-chart-container");e.gridTemplate?s.classList.add(e.gridTemplate):e.rowCount&&e.colCount&&(s.style.gridTemplateColumns=Array(parseInt(e.colCount)).fill("1fr").join(" ")),s.style.setProperty("--orphan-span-start","1");const a=getComputedStyle(s),o=s.childElementCount,h=a.gridAutoFlow=="column"?a.gridTemplateRows.split(" ").length:a.gridTemplateColumns.split(" ").length,d=o%h||h;s.style.setProperty("--orphan-span-start",d)}}copyAttributes(e,n){e.getAttributeNames().filter(r=>/-feature$/.test(r)).forEach(r=>n.setAttribute(r,e.getAttribute(r)))}getCommonUI(e){return n(".ciq-nav, .ciq-footer",e).filter(r=>r.localName!=="cq-themes"&&r.localName!=="cq-info-toggle-dropdown"&&r.localName!=="cq-side-nav"&&!r.classList.contains("ciq-sidenav")&&!r.classList.contains("ciq-draw")&&!r.classList.contains("ciq-shortcut-button")&&!r.matches("cq-toggle[cq-member=tfc]"));function n(r,i){return r.split(/, |,/g).reduce((t,s)=>{const a=i.querySelector(s);if(!a)return t;const o=Array.from(a.querySelectorAll("*"));return t.concat(o)},[])}}setGridUI(e,n,r,i){const t=e.querySelector("cq-grid-size-picker");t&&(t.generateTable(+n+1,+r+1),t.highlightTable(+n,+r),t.highlightTemplate(i))}utils(e){e.getChartContainers=()=>Array.from(e.querySelectorAll("cq-context")).map(n=>n.querySelector(".chartContainer")).concat(e.CIQ.UI.context.stx.container),e.getCharts=()=>e.getChartContainers().map(({stx:n})=>n)}}p.UI.Multichart=Ke;p.UI.setDefaultStates=function(l){const e=l.config.ariaActive;if(e===null)return;e&&e.length?e.forEach(r=>{let i=l.topNode.querySelector(r);i&&n(i)}):l.topNode.setAttribute("aria-hidden",!0);function n(r){const i=r.parentElement;i&&([...i.children].forEach(t=>{t.ariaHidden=r!==t&&t.ariaHidden!=="false"}),!(i.ariaHidden==="false"||i.matches("cq-context"))&&n(i))}};class le{constructor(e,n){n!==void 0&&console.log("CIQ.UI.$() only accepts one input parameter.");let r=[];if(e instanceof le)return e;Array.isArray(e)&&(r=e),typeof e=="object"?e.ownerDocument?r.push(e):(e.toString()==="[object NodeList]"||e.toString()==="[object HTMLCollection]")&&(r=Array.from(e)):typeof e=="string"&&(console.log("Note: string argument for CIQ.UI.$(element) deprecated and may be removed in the future"),r=r=Array.from(document.querySelectorAll(e)));const i=this.length=r.length;for(let t=0;t<i;t++)this[t]=r[t]}_(e,n){const r=[],i=t=>{(!n||t.matches(n))&&(r.includes(t)||r.push(t))};for(let t=0;t<this.length;t++){const s=this[t];Array.from(e(s)).forEach(i)}return new le(r)}addClass(e){return typeof e=="string"&&(e=e.split(" ")),e.forEach(n=>this._(r=>(r.classList.add(n),[r]))),this}append(e,n){if(typeof n!="undefined"&&console.log("CIQ.UI.$#append only accepts one argument."),e instanceof Array)for(let r=0;r<e.length;r++)this.append(e[r]);else{if(typeof e=="string")return this._(r=>(r[e[0]==="<"?"innerHTML":"innerText"]+=e,[r]));if(e.ownerDocument){const r=this._(t=>(t.appendChild(e.cloneNode(!0)),[t])),i=r[r.length-1];return i.replaceChild(e,i.lastChild),r}else if(e[0])return this.append(Array.from(e))}return this}attr(e,n){if(typeof e=="object")return this._(r=>(Object.keys(e).forEach(i=>r.setAttribute(i,e[i])),[r]));if(typeof n=="undefined"){if(!this[0])return;const r=this[0].getAttribute(e);return r===null?void 0:r}return this._(r=>(r.setAttribute(e,n),[r]))}children(e){return this._(n=>n.children,e)}css(e,n){return typeof e=="object"?this._(r=>(Object.assign(r.style,e),[r])):typeof n=="undefined"?this[0]?getComputedStyle(this[0])[e]:void 0:this._(r=>(r.style[e]=n,[r]))}each(e){for(let n=0;n<this.length;n++)e.call(this[n],n,this[n]);return this}empty(){return this._(e=>(e.innerHTML="",[e]))}find(e){return e?this._(n=>n.querySelectorAll(e)):new le([])}hasClass(e){return this._(n=>n.classList.contains(e)&&[n]).length>0}hide(){return this._(e=>(e.style.display!=="none"&&(e.style.displayCache=e.style.display,e.style.display="none"),[e]))}html(e){return this.prop("innerHTML",e)}nextAll(e){return this._(n=>{const r=Array.from(n.parentNode.children);return r.slice(r.indexOf(n)+1)},e)}not(e){return this._(n=>!n.matches(e)&&[n])}parent(e){return this._(n=>[n.parentNode],e)}parents(e){return this._(n=>p.climbUpDomTree(n.parentElement,e)||[])}prop(e,n){return typeof e=="object"?this._(r=>(Object.keys(e).forEach(i=>r[i]=e[i]),[r])):typeof n=="undefined"?this[0]?this[0][e]:void 0:this._(r=>(r[e]=n,[r]))}remove(e){return Array.from(this).forEach(n=>{(!e||n.matches(e))&&n.parentNode.removeChild(n)}),this}removeAttr(e){return typeof e=="string"&&(e=e.split(" ")),e.forEach(n=>this._(r=>(r.removeAttribute(n),[r]))),this}removeClass(e){return typeof e=="string"&&(e=e.split(" ")),e?e.forEach(n=>this._(r=>(r.classList.remove(n),[r]))):this._(n=>(n.className="",[n])),this}show(){return this._(e=>(e.style.display==="none"&&(e.style.displayCache===void 0?e.style.display="block":(e.style.display=e.style.displayCache,e.style.displayCache=void 0)),[e]))}text(e){return this.prop("innerText",e)}val(e){return this.prop("value",e)}}p.UI.$=function(l,e){return!e&&typeof $=="function"&&$.fn?(Ue||(console.log("Using jQuery."),Ue=!0),$(l)):new le(l)};let Ue=!1,Ye=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.BaseComponent{connectedCallback(){this.attached||(super.connectedCallback(),this.init())}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}init(){this.type=this.getAttribute("cq-type")||"helicopter";const{markups:i}=this.constructor;this.addDefaultMarkup(this,i[this.type])}}n.markups={helicopter:`
		<div class="stx-marker-templates" style="left: -1000px; visibility:hidden;">
			<!-- Abstract Markers. You can remove this unless you actually need a helicopter. Seriously though, markers can be anything you want them to be! -->
			<div class="abstract">
				<div class="stx-marker abstract">
					<div class="stx-marker-content">
						<div class="sample">
							<div stage>
								<div helicopter>
									<div propeller style="height: 160px;">
										<div spinner style="-webkit-transform-origin: 40px 0 0; transform-origin: 40px 0 0;">
											<div style="-webkit-transform: rotateY(0deg) translateX(40px); transform: rotateY(0deg) translateX(40px);"></div>
											<div style="-webkit-transform: rotateY(-90deg) translateX(40px); transform: rotateY(-90deg) translateX(40px);"></div>
											<div style="-webkit-transform: rotateY(-180deg) translateX(40px); transform: rotateY(-180deg) translateX(40px);"></div>
											<div style="-webkit-transform: rotateY(-270deg) translateX(40px); transform: rotateY(-270deg) translateX(40px);"></div>
										</div>
									</div>
									<div heli-body></div>
								</div>
							</div>
							<div class="text">This is an example of a complex marker which can contain html, video, images, css, and animations.</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		`},e.UI.addComponentDefinition("cq-abstract-marker",n)},Ge=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;if(!e.Marker)console.error("advertisement component requires first activating markers feature.");else{class n extends e.UI.ModalTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}close(){this.node.css({display:"none"});var i=this;this.nameValueStore.get("cq-advertisement",function(t,s){if(!t){var a=new Date;i.sleepAmount||(i.sleepAmount={units:1,unitType:"day"});var o=i.sleepAmount.units,c=i.sleepAmount.unitType;c=="minute"?a.setMinutes(a.getMinutes()+o):c=="hour"?a.setHours(a.getHours()+o):c=="day"?a.setDate(a.getDate()+o):c=="week"?a.setDate(a.getDate()+o*7):c=="month"&&a.setMonth(a.getMonth()+o);var h=a.getTime();(!s||typeof s!="object")&&(s={}),s[i.selector]=h,i.nameValueStore.set("cq-advertisement",s)}})}makeMarker(){this.markerExists||(e.Marker({stx:this.context.stx,xPositioner:"none",label:"advertisement",permanent:!0,node:this.node[0]}),this.markerExists=!0)}setContext(i){const{config:{nameValueStore:t}}=i;this.setNameValueStore(t)}setNameValueStore(i){!i&&e.NameValueStore&&(i=e.NameValueStore),this.nameValueStore=i?new i:{get:function(){},set:function(){}}}setSleepAmount(i,t){this.sleepAmount={units:i,unitType:t}}show(i,t=!1){if(this.selector){var s=this.node.find(this.selector);s.removeClass("ciq-show")}if(this.selector=i,!this.selector){var a=this.node.find("div:first-of-type");this.selector="."+a.attr("class")}this.ignoreSleep=t;var o=this;function c(){o.makeMarker(),o.node.css({display:"block"});var h=o.node.find(o.selector);h.addClass("ciq-show"),o.node.css({height:"0px"}),setTimeout(function(){o.node.css({height:o.node[0].scrollHeight+"px"})},0)}t?c():this.nameValueStore.get("cq-advertisement",function(h,d){if(!h){(!d||typeof d!="object")&&(d={});var u=d[o.selector];u&&u>Date.now()||c()}})}watchForRemoteClose(i){i||(i=1e3);var t=this;setInterval(function(){t.node.css("display")!="none"&&t.nameValueStore.get("cq-advertisement",function(s,a){if(!s){(!a||typeof a!="object")&&(a={});var o=a[t.selector];o&&o>Date.now()&&t.close()}})},i)}}e.UI.addComponentDefinition("cq-advertisement",n)}},Xe=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}open(i){this.addDefaultMarkup(),super.open(i);var t=this.context.stx,s=i.aggregationType,a={kagi:{title:"Set Reversal Percentage"},renko:{title:"Set Brick Size"},linebreak:{title:"Set Price Lines"},rangebars:{title:"Set Range"},pandf:{title:"Set Point & Figure Parameters"}};t.layout.aggregationType!=s&&t.setAggregationType(s);var o=a[s],c=this.node;c.find(".title").text(t.translateIf(o.title));for(var h in a)c.find(".ciq"+h).css(s===h?{display:""}:{display:"none"});c.find(".ciq"+s+" input").each(function(){var d=this.name;(d=="box"||d=="reversal")&&(d="pandf."+d);var u=e.deriveFromObjectChain(t.layout,d);u&&(u.obj[u.member]||u.obj[u.member]===0)?this.value=u.obj[u.member]:t.chart.defaultChartStyleConfig[this.name]&&(this.value=t.chart.defaultChartStyleConfig[this.name])})}}n.markup=`
		<h4 class="title"></h4>
		<cq-close></cq-close>
		<div style="text-align:center;margin-top:10px;">
			<div class="ciqkagi">
				<em>Enter value and hit "Enter"</em>
				<p>
					<input name="kagi" stxtap="Layout.setAggregationEdit('kagi')">
				</p>
			</div>
			<div class="ciqrenko">
				<em>Enter value and hit "Enter"</em>
				<p>
					<input name="renko" stxtap="Layout.setAggregationEdit('renko')">
				</p>
			</div>
			<div class="ciqlinebreak">
				<em>Enter value and hit "Enter"</em>
				<p>
					<input name="priceLines" stxtap="Layout.setAggregationEdit('priceLines')">
				</p>
			</div>
			<div class="ciqrangebars">
				<em>Enter value and hit "Enter"</em>
				<p>
					<input name="range" stxtap="Layout.setAggregationEdit('rangebars')">
				</p>
			</div>
			<div class="ciqpandf">
				<i>Enter box size and hit "Enter"</i>
				<p>
					<input name="box" stxtap="Layout.setAggregationEdit('pandf.box')">
				</p>
				<p>
					<i>Enter reversal and hit "Enter"</i>
				</p>
				<p>
					<input name="reversal" stxtap="Layout.setAggregationEdit('pandf.reversal')">
				</p>
			</div>
			<p>or</p>
			<div class="ciq-btn" stxtap="Layout.setAggregationEdit('auto')">Auto Select</div>
		</div>

	`,e.UI.addComponentDefinition("cq-aggregation-dialog",n)},Ze=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;if(!e.Marker)console.error("attribution component requires first activating markers feature.");else{class n extends e.UI.ModalTag{constructor(){super(),this.messages={sources:{simulator:"Simulated data.",demo:"Demo data.",xignite:'<a target="_blank" href="https://www.xignite.com">Market Data</a> by Xignite.',fis_mm:'<a target="_blank" href="https://www.fisglobal.com/">Market Data</a> by FIS MarketMap.',Twiggs:'Twiggs MF Formula courtesy <a target="_blank" href="https://www.incrediblecharts.com/indicators/twiggs_money_flow.php">IncredibleCharts</a>.'},exchanges:{RANDOM:"Data is randomized.","REAL-TIME":"Data is real-time.",DELAYED:"Data delayed 15 min.",RATES:"Yield data latest from source, bid/ask simulated.",BATS:"BATS BZX real-time.",EOD:"End of day data."}}}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}insert(i,t){if(e.Marker){var s=e.UI.makeFromTemplate(this.template);return s.marker=new e.Marker({stx:i,node:s[0],xPositioner:"none",yPositioner:"none",label:"component",panelName:t,permanent:!0}),s}}setContext(i){this.addDefaultMarkup(),this.template=this.node.find("template"),this.marker=this.insert(i.stx,"chart");var t=this;this.addInjection("append","createDataSet",function(){return t.displayAttribution(this)}),this.displayAttribution()}displayAttribution(i){i||(i=this.context.stx);var t=i.chart,s=i.layout,a=this.marker,o,c;t.attribution&&(o=this.messages.sources[t.attribution.source],c=this.messages.exchanges[t.attribution.exchange],o||(o=""),c||(c=""),o+c!=a.attr("lastAttrib")&&(a.find("cq-attrib-source").html(o),a.find("cq-attrib-quote-type").html(c),i.translateUI&&i.translateUI(a[0]),a.attr("lastAttrib",o+c)));for(var h in s.studies){var d=s.studies[h],u=d.type;if(this.messages.sources[u]){if(d.attribution&&d.attribution.marker.params.panelName==d.panel)continue;o=this.messages.sources[u]||"",c=this.messages.exchanges[u]||"";var f=this.insert(i,d.panel);f.find("cq-attrib-source").html(o),f.find("cq-attrib-quote-type").html(c),i.translateUI&&i.translateUI(f[0]),d.attribution=f}}}}n.markup=`
		<template>
			<cq-attrib-container>
				<cq-attrib-source></cq-attrib-source>&nbsp;
				<cq-attrib-quote-type></cq-attrib-quote-type>
			</cq-attrib-container>
		</template>
	`,e.UI.addComponentDefinition("cq-attribution",n)}},Je=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}setContext(){this.addDefaultMarkup(),this.content=this.querySelector("span")||this.firstElementChild,this.instructions=this.querySelector("p")||this.content;const{config:{hotkeyConfig:i={}}={}}=this.context;if(i.hotkeys){const t=i.hotkeys.filter(s=>s.ariaLabel);this.setHotKeyCommands(t)}}setHotKeyCommands(i){const t=document.createElement("UL");this.instructions.innerText+=" The following is a list of keyboard commands available to interact with the chart.",i.map(a=>{const{commands:o,label:c,ariaLabel:h}=a,d=[];o.forEach(f=>d.push(f.split("+").map(g=>g.replace("Key","")).join(" + ")));const u=d.length>1?d.join(" or "):d[0];return`${c}. ${h}. Hotkeys press ${u}. `}).forEach(a=>{const o=document.createElement("LI");o.innerText=a,t.append(o)}),this.content.append(t)}}n.markup=`
<span>
	<p>ChartIQ interactive chart component. Instructions for use with screen readers.</p>
</span>
`,e.UI.addComponentDefinition("cq-chart-instructions",n)},et=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}setContext(){this.contextSet||(this.contextSet=!0,this.addDefaultMarkup())}}n.markup=`
		<cq-study-legend cq-signal-studies-only cq-marker-label="Signals" cq-marker cq-hovershow>
				<template cq-study-legend>
					<cq-item>
						<cq-label class="click-to-edit"></cq-label>
					</cq-item>
				</template>
		</cq-study-legend>
		<cq-study-legend cq-chart-legend cq-marker-label="Plots" cq-clone-to-panels="Plots" cq-panel-only cq-marker cq-hovershow cq-content-keys="cq-label,cq-comparison-label">
			<cq-comparison>
				<cq-comparison-key cq-panel-only cq-all-series>
					<template cq-comparison-item>
						<cq-comparison-item>
							<span class="ciq-switch" keyboard-selectable-child></span>
							<cq-swatch cq-overrides="auto"></cq-swatch>
							<div class="stx-btn-ico ciq-close" keyboard-selectable-child="true"></div>
							<cq-comparison-label>AAPL</cq-comparison-label>
							<!-- cq-comparison-price displays the current price with color animation -->
							<cq-comparison-price cq-animate></cq-comparison-price>
							<!-- cq-comparison-tick-price displays the price for the active crosshair item -->
							<!-- <cq-comparison-tick-price></cq-comparison-tick-price>	-->
							<cq-comparison-loader></cq-comparison-loader>
						</cq-comparison-item>
					</template>
				</cq-comparison-key>
			</cq-comparison>
			<template cq-study-legend>
				<cq-item>
					<div class="ciq-icon ciq-close"></div>
					<cq-label></cq-label>
				</cq-item>
			</template>
		</cq-study-legend>
	`,e.UI.addComponentDefinition("cq-chart-legend",n)},tt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ModalTag{get displayExchange(){return this.getAttribute("display-exchange")}constructor(){super(),this.previousClose=null}begin(){const i=this;this.addInjection("append","createDataSet",function(){i.update()}),this.update()}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}disconnectedCallback(){this.context&&e.UI.unobserveProperty("symbolObject",this.context.stx.chart,this.listener),super.disconnectedCallback()}initialize(i){this.params=i||{},typeof this.params.autoStart=="undefined"&&(this.params.autoStart=!0),this.marker=null,this.params.autoStart&&this.begin()}setContext(i){if(this.listener)return;var t=this,s=this.context.stx;let{markup:a}=this.constructor;this.hasAttribute("cq-activate-symbol-search-on-click")||(a=a.replace('<cq-clickable role="button" cq-selector="cq-lookup-dialog" cq-method="open">',"").replace("</cq-clickable>","")),this.addDefaultMarkup(this,a),this.symbolDiv=this.querySelector("cq-symbol"),this.symbolDescriptionDiv=this.querySelector("cq-symbol-description"),this.currentPriceDiv=this.querySelector("cq-current-price"),this.todaysChangeDiv=this.querySelector("cq-todays-change"),this.todaysChangePctDiv=this.querySelector("cq-todays-change-pct"),this.chartPriceDiv=this.querySelector("cq-chart-price"),this.changeDiv=this.querySelector("cq-change"),this.exchangeDiv=this.querySelector(".exchange"),this.listener=function(o){const{exchangeDiv:c}=t;if(t.mostRecentClose=s.mostRecentClose("iqPrevClose"),c){const{value:{exchDisp:h}}=o;t.displayExchange&&h?c.innerText=`Exchange: ${h}`:o.value.static?c.innerText="STATIC":c.innerText=""}},e.UI.observeProperty("symbolObject",s.chart,this.listener),this.initialize()}update(){const{stx:i}=this.context,{chart:{symbol:t,symbolDisplay:s},internationalizer:a}=i,{symbolDiv:o,symbolDescriptionDiv:c,exchangeDiv:h,currentPriceDiv:d,changeDiv:u,chartPriceDiv:f,todaysChangeDiv:g,todaysChangePctDiv:y}=this;var m=["false","0",null].indexOf(this.getAttribute("cq-browser-tab"))==-1,v=this.closest("cq-context-wrapper"),b=!v||v&&v.classList.contains("active");b||(m=!1);const q=f&&d;let x=!1,w=!1,C=t?"add":"remove";if(this.classList[C]("stx-show"),o.innerText!==t&&(o.innerText=t,w=!0),c&&c.innerText!==(s||t)&&(c.innerText=s||t),i.isHistoricalModeSet){d.innerText!==""&&(d.innerText=""),u.style.display="none";return}let S="",k=0,T="";const E=i.getFirstLastDataRecord(i.chart.dataSet,"Close",!0);let I="",D="";if(E&&(I=E.Close),q){I!==""&&(D=i.formatYAxisPrice(I,i.chart.panel,i.chart.decimalPlaces));let A=parseFloat(d.innerText);if(d.innerText!==D){d.innerText=D,x=!0;var L=this.currentPriceDiv.getAttribute("cq-animate");typeof L!="undefined"&&e.UI.animatePrice(d,I,A,L=="fade")}}if((q||m)&&t&&(w||x)){let A=this.previousClose;!A&&A!==0&&(A=E&&E.iqPrevClose),!A&&A!==0&&(A=this.mostRecentClose),u&&(I||I===0)?(S=e.fixPrice(I-A),k=S/A*100,A<=0||I<0?T="N/A":a?T=a.percent2.format(k/100):T=k.toFixed(2)+"%",u.style.display=""):u&&(u.style.display="none");const F=Math.abs(S),U=i.formatYAxisPrice(F,i.chart.panel,i.chart.decimalPlaces);F&&g.innerText!==U&&(g.innerText=U),y&&y.innerText!==T&&(y.innerText=T),T!==""&&S<0?f.classList.add("stx-down"):f.classList.remove("stx-down"),T!==""&&S>0?f.classList.add("stx-up"):f.classList.remove("stx-up"),I=I!==void 0?I:"",S=S!==void 0?S:"",this.title=t+"   "+D+"    ",S>0?this.title+=" "+U:S<0&&(this.title+=" "+U),m&&(this.ownerDocument.title=this.title)}}}n.markup=`
		<cq-clickable role="button" cq-selector="cq-lookup-dialog" cq-method="open" title="Symbol Search">
			<cq-symbol class="hide-outline"></cq-symbol>
		</cq-clickable>
		<cq-menu class="ciq-menu ciq-period" title="Interval Selector">
			<span><cq-clickable stxbind="Layout.periodicity">1D</cq-clickable></span>
			<cq-menu-dropdown cq-lift>
				<cq-menu-container cq-name="menuPeriodicity"></cq-menu-container>
			</cq-menu-dropdown>
		</cq-menu>
		<cq-chart-price>
			<cq-current-price cq-animate></cq-current-price>
			<cq-change>
				<div class="ico"></div>
				<cq-todays-change></cq-todays-change>
				<cq-todays-change-pct></cq-todays-change-pct>
			</cq-change>
		</cq-chart-price>
		<div class="exchange"></div>
	`,e.UI.addComponentDefinition("cq-chart-title",n)},it=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ModalTag{connectedCallback(){this.attached||super.connectedCallback()}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}setContext(i){this.addDefaultMarkup();var t=this.node;t[0].addEventListener("touchstart",function(a){a.stopPropagation()},{passive:!1}),t[0].addEventListener("mousedown",function(a){a.stopPropagation()});var s=t.find("input");e.UI.stxtap(s[0],function(){this.focus()})}}n.markup=`
		<cq-clickable role="button" class="symbol-search" cq-selector="cq-lookup-dialog" cq-method="open">
			<cq-help help-id="search_symbol_lookup"></cq-help>
			<span class="ciq-lookup-icon"></span>
			<cq-tooltip>Symbol Search</cq-tooltip>
		</cq-clickable>
		<cq-clickable role="button" class="symbol-search" cq-selector="cq-lookup-dialog" cq-method="open" comparison="true">
			<cq-help help-id="add_comparison"></cq-help>
			<span class="ciq-comparison-icon"></span>
			<cq-tooltip>Add Comparison</cq-tooltip>
		</cq-clickable>
		<cq-toggle class="ciq-draw" cq-member="drawing"><span></span><cq-tooltip>Draw</cq-tooltip></cq-toggle>
		<cq-toggle class="ciq-CH" cq-member="crosshair"><span></span><cq-tooltip>Crosshair</cq-tooltip></cq-toggle>
		<cq-toggle class="ciq-DT" cq-member="tableView"><span></span><cq-tooltip>Table View</cq-tooltip></cq-toggle>
		<cq-menu class="ciq-menu ciq-period">
			<span><cq-clickable stxbind="Layout.periodicity">1D</cq-clickable></span>
			<cq-menu-dropdown>
				<cq-menu-container cq-name="menuPeriodicity"></cq-menu-container>
			</cq-menu-dropdown>
		</cq-menu>
	`,e.UI.addComponentDefinition("cq-chartcontrol-group",n)},st=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{connectedCallback(){if(!this.attached){super.connectedCallback();var i=this;e.UI.stxtap(this,function(t){this.closest("cq-menu")||(this.uiManager.closeMenu(),t.stopPropagation()),i.runMethod()})}}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}runMethod(){const{context:i}=this,t=this.getAttribute("cq-selector"),s=this.getAttribute("cq-method");if(/-dialog/.test(t)&&s==="open"&&i.config){const o=(i.config.channels||{}).dialog||"channel.dialog";this.channelWrite(o,{type:t.replace(/cq-|-dialog/g,""),params:{context:i,caller:this}},i.stx);return}var a=this;this.ownerDocument.querySelectorAll(t).forEach(function(o){o[s]&&o[s].call(o,{context:a.context,caller:a})})}}e.UI.addComponentDefinition("cq-clickable",n)},nt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.BaseComponent{connectedCallback(){if(this.attached)return;var i=this;function t(s){i.tap(),s.stopPropagation()}e.UI.stxtap(this,t),super.connectedCallback()}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}tap(){e.UI.containerExecute(this,"close")}}e.UI.addComponentDefinition("cq-close",n)},at=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ModalTag{constructor(){super(),this.swatchColors=[],this.loading=[]}connectedCallback(){this.attached||(super.connectedCallback(),this.swatchColors=["#8ec648","#00afed","#ee652e","#912a8e","#fff126","#e9088c","#ea1d2c","#00a553","#00a99c","#0056a4","#f4932f","#0073ba","#66308f","#323390"])}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}disconnectedCallback(){this.removeClaim(this),super.disconnectedCallback()}configureUI(){const i=this.node,t=i.find("cq-accept-btn");this.template=i.find("*[cq-comparison-item]");const s=i.find("cq-swatch").attr("cq-colors");s&&(this.swatchColors=s.split(",")),this.swatchColors=e.convertToNativeColor(this.swatchColors);const a=i.find("cq-lookup");a.length&&a[0].setCallback(function(h){return function(){h.selectItem.apply(h,arguments)}}(this)),e.UI.stxtap(t[0],function(h){a[0].forceInput(),h.stopPropagation()}),this.addClaim(this);const o=this.ownerDocument.body.keystrokeHub;if(!o)return;let c=this.querySelector("cq-menu.cq-comparison-new");if(c){let h=c.hide.bind(c);c.hide=()=>{o.removeActiveModal(this),o.tabOrderSelect(),h()}}e.UI.stxtap(this,function(h){this.keyboardNavigation&&(c&&c.open(),o.addActiveModal(this)),h.stopPropagation()})}keyStroke(i,t,s){if(!this.keyboardNavigation)return;const a=this.querySelectorAll("cq-lookup, cq-swatch, cq-accept-btn, [keyboard-selectable='true']");if(!a.length)return;const o=this.findFocused(a);switch(t){case"Enter":if(!o[0])return;this.clickItem(o[0],s,this);break;case"Tab":o[0]&&o[0].tagName=="CQ-LOOKUP"&&(this.keyboardNavigation.disableKeyControlElement(o[0],!0),i.tabActiveElement.element.blur(),o[0].overrideIsActive=!0);let c=this.focusNextItem(a,!1,!0);c.tagName=="CQ-LOOKUP"&&(c.keyboardNavigation=this.keyboardNavigation,c.onKeyboardSelection&&c.onKeyboardSelection(),c.overrideIsActive=!1);break;case"Esc":case"Escape":this.removeFocused(a);let h=this.querySelector("cq-menu.cq-comparison-new");h&&h.hide();break;default:s.preventDefault();break}}onKeyboardSelection(){let i=this.querySelector("cq-lookup");i.setAttribute("cq-focused","true"),i.overrideIsActive=!1,i.keyboardNavigation=this.keyboardNavigation,i.onKeyboardSelection&&i.onKeyboardSelection()}pickSwatchColor(){e.UI.pickSwatchColor(this,this.querySelector("cq-swatch"))}position(){var i=this.context.stx,t=i.barFromPixel(i.cx);this.tick=i.tickFromPixel(i.cx);var s=i.chart.xaxis[t],a=this;function o(){var h;a.timeout=null;for(var d in i.chart.series){h||(h=a.node.find("cq-comparison-key"));var u=h.find('cq-comparison-item[cq-symbol="'+d+'"] cq-comparison-tick-price');if(u.text()!==""&&u.text(""),u.length&&s&&s.data){var f=i.chart.series[d].parameters.symbol,g=i.padOutPrice(s.data[f]);u.text()!==g&&u.text(g);var y=s.data[f];y!==null&&(typeof y=="object"&&(y=y.Close),g=i.padOutPrice(y),u.text()!==g&&u.text(g))}}}if(this.tick!=this.prevTick){this.timeout&&clearTimeout(this.timeout);var c=0;this.timeout=setTimeout(o,c)}this.prevTick=this.tick}removeSeries(i,t){this.context.stx.removeSeries(i)}renderLegend(){function i(U,P,Q){return function(){U.nomore=!0,Q.parameters.permanent||U.removeSeries(P,Q),U.modalEnd()}}this.pickSwatchColor();var t=this.closest(".stx-holder"),s=e.cqvirtual(this.querySelector("cq-comparison-key"));if(!s)return;var a=function(U){s.appendChild(U)},o=this.context.stx;o.getDefaultColor();var c=s.hasAttribute("cq-panel-only"),h=!s.hasAttribute("cq-all-series");for(var d in o.chart.seriesRenderers){var u=o.chart.seriesRenderers[d];if(u!=o.mainSeriesRenderer&&!(h&&!u.params.isComparison)&&!(c&&(!t||u.params.panel!=t.panel.name)))for(var f=0;f<u.seriesParams.length;f++){var g=u.seriesParams[f],y=e.UI.makeFromTemplate(this.template),m=y.find(".ciq-switch"),v=y.find("cq-comparison-swatch"),b=y.find("cq-swatch"),q=y.find("cq-comparison-label"),x=y.find("cq-comparison-description"),w=y.find("cq-comparison-loader"),C=y.find(".ciq-close"),S=o.chart.series[g.id],k=S.parameters,T=k.color||u.colors[S.id].color,E=T=="auto";E&&(T=o.defaultColor),v.css({background:T}),b.length&&(b[0].seriesId=g.id,b[0].setColor(T,!1,E)),k.opacity&&(v.css({opacity:k.opacity}),b.css({opacity:k.opacity})),q.text(o.translateIf(S.display)),x.text(o.translateIf(S.description)),y.attr("cq-symbol",S.id);var I=k.symbol,D=o.mostRecentClose(I);if(D||D===0){var L=y.find("cq-comparison-price");L.length&&L.text(o.padOutPrice(D))}this.loading[k.symbolObject.symbol]?w.addClass("stx-show"):w.removeClass("stx-show"),k.error&&y.attr("cq-error",!0),!k.color||k.permanent?C.hide():e.UI.stxtap(C[0],i(this,S.id,S)),Array.from(y).forEach(a),m[0].parentElement.classList[k.disabled?"remove":"add"]("ciq-active"),e.safeClickTouch(m[0],A(S,o))}}function A(U,P){return function(){P.modifySeries(U.id,{disabled:!U.parameters.disabled}),P.changeOccurred("layout")}}var F=e.climbUpDomTree(e.cqrender(s),"cq-study-legend");F.forEach(function(U){U.displayLegendTitle&&U.displayLegendTitle()})}setColor(i,t){t.seriesId&&this.context.stx.modifySeries(t.seriesId,{color:i})}startPriceTracker(i){var t=this;this.addInjection("append","createDataSet",function(){i&&t.updatePrices(),this.chart.dataSet&&this.chart.dataSet.length?t.node.attr("cq-show")!=="true"&&t.node.attr("cq-show","true"):t.hasAttribute("cq-show")&&t.removeAttribute("cq-show")})}startTickPriceTracker(){this.prevTick=null,this.addInjection("prepend","headsUpHR",function(i){return function(){i.position()}}(this))}selectItem(i){var t=this.context,s=this;function a(v,b){v&&(b.parameters.error=!0),s.loading[b.parameters.symbolObject.symbol]=!1,s.renderLegend()}var o=this.node.find("cq-swatch"),c="auto",h=null,d=1;if(o[0]){var u=o[0].style;c=u.backgroundColor,h=u.borderTopStyle,d=u.width||1}var f=t.stx;this.loading[i.symbol]=!0;for(var g={name:"comparison "+i.symbol,symbolObject:i,isComparison:!0,color:c,pattern:h,width:d||1,data:{useDefaultQuoteFeed:!0},forceData:!0},y=f.getSeries({symbolObject:i}),m=0;m<y.length;m++)if(y[m].parameters.isComparison){this.loading[i.symbol]=!1;return}i.symbol&&i.symbol.trim().length>0&&(!t.stx.chart.symbol||t.stx.chart.symbol.toLowerCase()!==i.symbol.toLowerCase())?f.addSeries(i.symbol,g,a):this.loading[i.symbol]=!1}setContext(i){this.node.attr("cq-show","true"),this.configureUI();var t=this,s=this.context.stx;s.chart;function a(c){t.renderLegend()}if(["layout","symbolImport","symbolChange","theme"].forEach(function(c){s.addEventListener(c,a)}),this.addInjection("append","modifySeries",function(){t.renderLegend()}),this.renderLegend(),!!this.template.length){var o=e.UI.makeFromTemplate(this.template);this.startPriceTracker(o.find("cq-comparison-price").length),o.find("cq-comparison-tick-price")&&this.startTickPriceTracker()}}updatePrices(){var i,t=this.context.stx,s=t.isHistoricalModeSet,a=e.ChartEngine.isDailyInterval(t.layout.interval);for(var o in t.chart.series){i||(i=this.node.find("cq-comparison-key"));var c=i.find('cq-comparison-item[cq-symbol="'+o+'"] cq-comparison-price');if(c.length){t.chart.series[o].parameters.symbol;var h=t.chart.series[o].lastQuote;if(!h||!h.DT||!h.Close&&h.Close!==0||!a&&t.chart.market&&t.chart.market.getSession(h.DT)===null)continue;var d=h.Close,u=t.chart.series[o].parameters.subField||"Close",f=parseFloat(c.text());d&&(d[u]||d[u]===0)&&(d=d[u]),!d&&d!==0&&t.chart.series[o].lastQuote&&(d=t.chart.series[o].lastQuote[u]);var g=t.padOutPrice(s?"":d);if(c.text()!==g&&c.text(g),s)return;typeof c.attr("cq-animate")!="undefined"&&e.UI.animatePrice(c,d,f)}}}}e.UI.addComponentDefinition("cq-comparison",n)},ot=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}setContext(){this.contextSet||(this.contextSet=!0,this.addDefaultMarkup())}}n.markup=`
		<cq-comparison cq-marker>
			<cq-menu class="cq-comparison-new" cq-focus="input">
				<cq-comparison-add-label class="ciq-no-share">
					<cq-comparison-plus></cq-comparison-plus><span>Compare</span><span>...</span>
				</cq-comparison-add-label>
				<cq-comparison-add>
					<cq-comparison-lookup-frame>
						<cq-lookup cq-keystroke-claim cq-uppercase></cq-lookup>
					</cq-comparison-lookup-frame>
					<cq-swatch cq-no-close></cq-swatch>
					<span><cq-accept-btn class="stx-btn">ADD</cq-accept-btn></span>
				</cq-comparison-add>
			</cq-menu>
		</cq-comparison>
	`,e.UI.addComponentDefinition("cq-comparison-lookup",n)},rt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{get active(){return this.context.stx.currentVectorParameters["active"+this._scope]}set active(i){this.context.stx.currentVectorParameters["active"+this._scope]=i}get color(){return this.context.stx.currentVectorParameters["color"+this._scope]}set color(i){this.context.stx.currentVectorParameters["color"+this._scope]=i}get lineWidth(){return this.context.stx.currentVectorParameters["lineWidth"+this._scope]}set lineWidth(i){this.context.stx.currentVectorParameters["lineWidth"+this._scope]=i}get pattern(){return this.context.stx.currentVectorParameters["pattern"+this._scope]}set pattern(i){this.context.stx.currentVectorParameters["pattern"+this._scope]=i}connectedCallback(){if(!this.attached){Object.defineProperty(this,"_scope",{configurable:!0,enumerable:!1,value:this.getAttribute("cq-cvp-header")||"",writable:!1});var i=this.ownerDocument.querySelector('template[cq-cvp-controller], template[cvp-controller="true"]');if(this.children.length===0&&i){e.UI.makeFromTemplate(i,this);var t=this.querySelector(".ciq-heading");t&&(t.innerHTML=this._scope)}super.connectedCallback()}}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}emit(i,t){this.toolbar?this.toolbar.emit():this.dispatchEvent(new CustomEvent(i,{bubbles:!0,cancelable:!0,detail:t}))}getColor(i){var t=e.UI.$(i.node||this.node.find("cq-line-color")),s=this.color;(s=="transparent"||s=="auto")&&(s=""),t.css({background:s});var a=e.getBackgroundColor(this.parentNode);if(!s||Math.abs(e.hsl(a)[2]-e.hsl(s)[2])<.2){var o=e.chooseForegroundColor(a);t.css({border:"solid "+o+" 1px"}),s||t.css({background:"linear-gradient(to bottom right, "+o+","+o+" 49%, "+a+" 50%, "+a+")"})}else t.css({border:""})}pickColor(i){var t=e.UI.$(i.node),s=this.ownerDocument.querySelector("cq-color-picker"),a=this,o=t.attr("cq-overrides");if(!s)return console.error("CVPController.prototype.pickColor: no <cq-color-picker> available");o&&(i.overrides=o.split(",")),s.callback=function(c){a.color=c,a.getColor(i),a.emit("change",{color:c})},i.context=this.context,s.display(i)}setContext(){this.setStyle(),this.toolbar&&this.toolbar.dirty(!1)}setStyle(i,t,s){t=t||"1",s=s||"dotted",this.lineWidth=parseInt(t,10),this.pattern=s;var a=this.node.find("*[cq-cvp-line-style]");this.lineStyleClassName&&a.removeClass(this.lineStyleClassName),s&&s!=="none"?(this.lineStyleClassName="ciq-"+s+"-"+this.lineWidth,a.addClass(this.lineStyleClassName)):this.lineStyleClassName=null,this.emit("change",{lineWidth:t,pattern:s})}sync(i){var t=i["active"+this._scope],s=i["color"+this._scope],a=i["lineWidth"+this._scope],o=i["pattern"+this._scope],c="ciq-active",h=this.node.find(".ciq-checkbox");t?h.addClass(c):h.removeClass(c),this.active=!!t,this.color=s||"",this.getColor({}),this.setStyle(null,a,o)}toggleActive(i){var t=e.UI.$(i.node),s="ciq-active";this.active?(this.active=!1,t.removeClass(s)):(this.active=!0,t.addClass(s)),this.emit("change",{active:this.active})}}e.UI.addComponentDefinition("cq-cvp-controller",n)},ct=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.DialogContentTag{constructor(){super(),this.fileMap=new Map,this.swatchColors=e.UI.defaultSwatchColors}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}abortImport(i){const t=this,s=i.target.nodeName==="CQ-CLOSE",a=[...this.fileMap.keys()],o=c=>h=>h.name===c;for(let c of this.form.querySelectorAll("fieldset[name]")){let h=c.getAttribute("fields");if(i&&i.target.getAttribute("fields")!==h&&!s)continue;let d=a.findIndex(o(h));this.form.removeChild(c.parentElement),this.fileMap.delete(a[d])}s&&(this.fileInput.value=""),this.fileMap.size||(this.fileInput.value="",this.loadDataBtn.style.display="inline-block",this.importBtn.style.display="none",this.querySelector("cq-section.loader").style.display="flex",this.warn("","",!0),e.UI.containerExecute(this,"resize")),t.resetTabSelect()}close(){this.abortImport({target:this.querySelector("cq-close")}),this.channelWrite("channel.dataLoader",!1,this.context.stx),this.loadDataBtn.style.display=this.fileInput.value?"none":"inline",this.querySelector("cq-section.loader").style.display="flex",this.warn("","",!0),super.close()}getFormData(){const i=(t,s)=>a=>{const o=t.elements[a];let c;if(o)c=o.type==="checkbox"?o.checked:o.value;else{const h=t.querySelector(`[name='${a}']`);h&&(c=h.value)}s.formData.append(a,c)};for(let t of this.fileMap){const[s,a]=t;let o=this.querySelector(`[name='${s.name}'] fieldset`);a.formData=new FormData,["name","display","periodicity","panel","color"].forEach(i(o,a))}}hide(){this.channelWrite("channel.dataLoader",!1,this.context.stx)}importData(i){i.preventDefault();const{dialog:t}=this;if(!t.validate()())return;let{context:{stx:s},fileMap:a}=t;t.getFormData(),a.forEach(o=>{s.dataLoader.importData(o)}),t.close()}loadData(){return ae(this,null,function*(){if(this.validateFileInput()(),!this.warning.getAttribute("cq-active")){for(const i of this.fileInput.files){let t=new e.CSVReader(i);this.fileMap.set(i,t),yield t.parse(i)}this.loadDataBtn.style.display="none",this.querySelector("cq-section.loader").style.display="none",this.showData()}})}resetTabSelect(){const{uiManager:{keystrokeHub:i}}=this.context;i.highlightAlign()}showData(){const{context:{stx:i,config:t={}},keystrokeHub:s}=this,a=h=>d=>{d.setAttribute("fields",h),d.addEventListener("pointerup",u=>{u.preventDefault(),e.UI.containerExecute(d,"abortImport",[u])})};let o=!1,c=this.querySelector("template");for(const h of this.fileMap){const[d,u]=h,f=d.name,g=c.content.cloneNode(!0);g.firstElementChild.id+=`${f}`,g.firstElementChild.setAttribute("name",f);const y=g.querySelector("fieldset");y&&(y.setAttribute("fields",f),y.setAttribute("name","fields"));const m=g.querySelector("legend.file-name");m.innerText=`File: ${f}`;const v=g.querySelector(".data-name input");v.setAttribute("placeholder",f),v.value=f;const b=g.querySelector(".ciq-select[name='periodicity']");(t.menuPeriodicity?t.menuPeriodicity:function(){const k=i.getPeriodicity();return[{value:k,label:`${k.period}, ${k.timeUnit}`}]}()).filter(k=>k.label).forEach(k=>{const T=document.createElement("option");T.value=T.innerText=k.label,T.value=JSON.stringify(k.value),b.append(T)});const x=g.querySelector(".data-fields ul");let{fields:w=[]}=u;w.forEach(k=>{const T=document.createElement("li");T.innerText=k,x.append(T)});const C=g.querySelector("[name=display]"),S=g.querySelector(".secondary-options");o?(C.value="secondary",S.style.display="block"):o=!0,C.addEventListener("change",function(k){let T=this.value.toLowerCase()==="secondary";S.style.display=T?"block":"none",s.highlightAlign()}),g.querySelectorAll(".abort").forEach(a(f)),e.UI.pickSwatchColor(this,g.querySelector("cq-swatch")),this.form.append(g),this.form.querySelectorAll("input:not([type=submit]").forEach(k=>{k.addEventListener("keypress",T=>{T.key==="Enter"&&T.preventDefault()})})}this.importBtn.style.display="inline",e.UI.containerExecute(this,"resize"),this.resetTabSelect()}setContext(i){this.context=i,this.addDefaultMarkup(),this.form=this.querySelector("form"),this.fileInput=this.querySelector("input[type=file]"),this.loadDataBtn=this.querySelector("button.load"),this.importBtn=this.querySelector("button.import"),this.controls=this.querySelector("div.ciq-dialog-cntrls"),this.warning=this.querySelector(".invalid-warning"),this.warningTitle=this.warning.querySelector(".invalid-warning-title"),this.warningText=this.warning.querySelector(".invalid-warning-text"),this.form.dialog=this,this.form.addEventListener("submit",this.importData),this.form.addEventListener("change",this.validate()),this.fileInput.addEventListener("change",this.validateFileInput()),this.keystrokeHub=i.uiManager.keystrokeHub}validate(){const i=this;return function(t){i.getFormData();let s,a=!0;for(const c of i.fileMap){const[,h]=c,{formData:d,fields:u}=h,f=d.get("display"),g=d.get("periodicity");if(!((u.includes("DT")||u.includes("Date"))&&u.some(m=>m==="Close"||m==="Value")))return a=!1,o({messageTitle:"Invalid Data fields",messageText:'Your data contains invalid schema to display. It must include a "DT" column and either a "Close" or "Value" column.'},a);if(f==="secondary"){if(!e.equals(JSON.parse(g),i.context.stx.getPeriodicity()))return a=!1,o({messageTitle:"Mis-matched periodicities:",messageText:"Having mixed periodicities can result in chart displaying incorrect time scales. Check your data and try again."},a)}else{if(s)return a=!1,o({messageTitle:"Multiple Main series",messageText:"Detected multiple data files set to display main data. Only one data file can be main."},a);s=!0}}return o({messageTitle:"",messageText:""},a);function o({messageTitle:c,messageText:h},d){return i.warn(c,h,d),i.resetTabSelect(),d}}}validateFileInput(){const i=this;return function(t){const s=i.files||i.fileInput.files;let a=!0,o="",c="";Object.values(s).forEach(function(h){const{name:d}=h,u=d.lastIndexOf(".")>0&&d.slice(d.lastIndexOf("."),d.length);(u&&u!==".csv"||n.mimeTypes.indexOf(h.type)==-1)&&(o="Invalid File Type",c="Data Importer requires a text/csv file to work. Please select a CSV file.",a=!1)}),s.length||(o="Please select a file!",c="Data Importer requires a text/csv file to work. Please select a CSV file.",a=!1),i.warn(o,c,a),i.resetTabSelect()}}warn(i,t,s){this.warningTitle.innerText=i,this.warningText.innerText=t,s?this.warning.removeAttribute("cq-active"):this.warning.setAttribute("cq-active",!0)}}n.mimeTypes=["text/csv","application/csv","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"],n.markup=`
<h4 class="title">Import Data</h4>
<cq-close></cq-close>
<cq-scroll cq-no-maximize>
	<cq-section class="loader">
		<label for="fileSelector">Choose one or more CSV files to load data into the chart:</label>
		<input name="fileSelector" type="file" multiple accept=".csv" />
	</cq-section>
	<cq-section class="ciq-dialog-cntrls">
		<button class="ciq-btn load" stxtap="loadData()">Open Files</button>
	</cq-section>
	<cq-section>
		<form class="import-data" id="data-wizard"></form>
	</cq-section>
	<template class="table">
		<cq-section class="data-table">
			<fieldset form="data-wizard" name="file-fields">
			<legend class="file-name"></legend>
			<div class="data-name"><label for="name">Name for imported data:</label><input type="text" name="name" required /></div>
			<div class="data-periodicity">
				<label for="periodicity">Data Periodicity:</label>
				<span class="select-holder">
					<select name="periodicity" class="ciq-select" form="data-wizard" required>
				</span>
				</select>
			</div>
			<div class="data-fields">
				<label>Data Fields:</label>
				<ul class="content-justify-end"></ul>
			</div>
			<div class="data-display">
				<label>Display As:</label>
				<span class="select-holder">
					<select name="display" form="data-wizard" class="ciq-select" required>
					<option value="main">Main Series</option>
					<option value="secondary">Secondary Series</option>
					</select>
				</span>
			</div>
			<div class="content-justify-end">
				<fieldset class="secondary-options">
				<legend>Secondary Series Options:</legend>
					<div>
						<label>Add in new panel: </label><input type="checkbox" name="panel" />
					</div>
					<div>
						<label>Color: </label><cq-swatch name="color"></cq-swatch>
					</div>
				</fieldset>
			</div>
		</div>
		<div class="buttons">
			<button class="ciq-btn-negative abort">Remove</button>
		</div>
		</fieldset>
		</cq-section>
	</template>
	<cq-section>
		<div class="invalid-warning">
			<div class="invalid-warning-title"></div>
			<div class="invalid-warning-text"></div>
		</div>
	</cq-section>
	<cq-section class="ciq-dialog-cntrls">
		<button class="ciq-btn import" form="data-wizard" type="submit">Confirm</button>
	</cq-section>

</cq-scroll>
`,e.UI.addComponentDefinition("cq-data-dialog",n)},lt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.BaseComponent{constructor(){super(),this.activeAttributes={}}connectedCallback(){if(this.attached)return;this.isDialog=!0,super.connectedCallback();var i=this;function t(a){i.tap(a)}e.UI.stxtap(this,t);var s=e.UI.getUIManager(this);s.registerForResize(this),this.uiManager=s,this.hasAttribute("cq-no-claim")||this.addClaim(this),this.hasAttribute("tabindex")||this.setAttribute("tabindex","0")}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}disconnectedCallback(){this.removeClaim(this),this.uiManager.unregisterForResize(this),super.disconnectedCallback()}refreshFocus(){const i=this.getKeyboardSelectableItems();let t=this.findFocused(i)[0];t||(t=Array.from(i||[]).find(s=>s.matches("[name="+this.activeElementName+"]"))),t&&this.focusItem(t)}getKeyboardSelectableItems(){return this.querySelectorAll("[keyboard-selectable='true'], input, .ciq-select, cq-swatch, .ciq-btn, .ciq-btn-negative, cq-scroll li, ul cq-item")}keyStroke(i,t,s){if(i.tabActiveModals[0]!==this)return;let{shiftKey:a}=s||{};const o=this.hasAttribute("native-tabbing"),c=this.getKeyboardSelectableItems();if(t==="Tab"&&!o){const h=this.focusNextItem(c,a,!0),d=this.querySelector("cq-scroll");h&&d&&(d.scrollToElement(h),setTimeout(()=>i.highlightAlign()))}else if(t=="Enter"){const h=this.findFocused(c)[0];h&&(this.clickItem(h,s,this),h.tagName==="INPUT"&&typeof h.click=="function"&&h.click())}}onKeyboardSelection(){this.keyboardNavigation.highlightHide()}onKeyboardDeselection(){this.keyboardNavigation&&this.keyboardNavigation!==null&&this.keyboardNavigation.highlightAlign()}clickItem(i,t,s){if(i&&this.keyboardNavigation){const a=i.querySelector("cq-menu-dropdown");a&&(a.keyboardOriginationElement=s,this.keyboardNavigation.setKeyControlElement(a))}super.clickItem(i,t,this)}processEsc(i){return this.closeActiveMenu()?(i.tabActiveModals[0]&&i.setKeyControlElement(i.tabActiveModals[0]),!0):!1}closeActiveMenu(){const i=this.querySelector("*.stxMenuActive");if(i){const t=e.UI.getUIManager(this);return t&&t.closeMenu(i),!0}return!1}addActiveAttribute(i){this.activeAttributes[i]=!0}center(){}close(){this.uiManager.closeMenu(this),this.onClose&&this.onClose(),this.parentElement.removeAttribute("cq-active")}hide(){if(this.node.find(":invalid").length)return;this.node.children().each(function(){typeof this.hide=="function"&&this.hide()}),this.active=!1,this.opener&&(delete this.opener.keepOpen,delete this.opener),this.uiManager.overlay&&this.uiManager.overlay.hasAttribute("cq-active")&&this.uiManager.overlay.removeAttribute("cq-active");for(var i in this.activeAttributes)this.hasAttribute(i)&&this.removeAttribute(i);this.activeAttributes={},this.node.find("input").each(function(){this==this.ownerDocument.activeElement&&this.blur()}),this.removeFocused();const t=this.ownerDocument.body.keystrokeHub;t&&t.removeActiveModal(this),this.parentElement.removeAttribute("cq-active"),this.matches("cq-color-picker")||this.ownerDocument.body.classList.remove("ciq-dialog-open")}launchColorPicker(){this.uiManager&&this.uiManager.closeMenu(null,"CQ-MENU")}open(i){this.uiManager.openMenu(this,i);const{context:t,opener:s}=i||{};if(!t||!t.config){this.onClose=null;return}const{config:{channels:a},stx:o}=t;o.translateUI&&o.translateUI(this.node[0]),this.onClose=()=>{this.channelWrite(a.dialog||"channel.dialog",{},o),this.onClose=null,this.firstElementChild.hide&&this.firstElementChild.hide()},s&&(this.opener=s,this.opener.keepOpen=!0),this.parentElement.setAttribute("cq-active",!0),this.matches("cq-color-picker")||this.ownerDocument.body.classList.add("ciq-dialog-open")}resize(){var i=this.node.find("cq-scroll");i.each(function(){this.resize&&this.resize()}),this.params&&this.params.x?this.stxContextMenu():this.center()}show(i){this.params=i,i||(i=this.params={});var t=this,s=i.context||e.UI.getMyContext(this);if(!this.uiManager.overlay&&!i.bypassOverlay&&(this.uiManager.overlay=document.createElement("cq-dialog-overlay"),s&&s.node.append(this.uiManager.overlay)),t.active=!0,setTimeout(function(){t.uiManager.overlay&&!i.bypassOverlay&&t.uiManager.overlay.getAttribute("cq-active")!=="true"&&t.uiManager.overlay.setAttribute("cq-active","true"),t.activeAttributes["cq-active"]=!0;for(var o in t.activeAttributes)t.node.attr(o)!=="true"&&t.node.attr(o,"true");t.resize()}),s&&s.config&&s.config.themes){let o=Object.keys(s.config.themes.builtInThemes);this.classList.remove(...o);let c=o.find(h=>s.topNode.classList.contains(h)===!0);c&&this.classList.add(c)}const a=this.ownerDocument.body.keystrokeHub;a&&a.addActiveModal(this)}stxContextMenu(){var i=this.parentElement;i.tagName=="BODY"&&(i=window);var t=e.guaranteedSize(i),s=t.width,a=t.height,o=e.elementDimensions(this,{padding:1,border:1}),c=o.width,h=o.height,d=this.params.x,u=this.params.y,f=!1;this.node.find("cq-menu.stxMenuActive").each(function(){if(this.querySelector(".context-menu-right")){var m=e.UI.$(this).nextAll().length+1,v=e.elementDimensions(this,{padding:1,border:1}),b=e.elementDimensions(this.querySelector(".context-menu-right"),{padding:1,border:1});c+=o.width,h+=b.height-v.height*m,f=!0}});const g=this.params.context.topNode.getBoundingClientRect().left,y=this.params.context.topNode.getBoundingClientRect().top;d-g+c>s&&(d=g+(s-c)),u-y+h>a&&(u=y+(a-h)),u<0&&(u=0),f&&(this.params.x=d,this.params.y=u),Object.assign(this.style,{top:`${u}px`,left:`${d}px`,"margin-top":"auto"})}tap(i){var t=this.uiManager.topMenu();if(t===this){i.stopPropagation();return}i.currentTarget.active||i.stopPropagation()}}e.UI.addComponentDefinition("cq-dialog",n)},ht=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.BaseComponent{connectedCallback(){this.attached||(super.connectedCallback(),this.init())}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}init(){this.addDefaultMarkup(),this.textRange=this.querySelector(".ciq-double-slider-text"),this.lowSlider=this.querySelector(".ciq-double-slider-range[range='low']"),this.highSlider=this.querySelector(".ciq-double-slider-range[range='high']"),this.backing=this.querySelector("cq-double-slider-range"),this.name=this.getAttribute("name")||e.uniqueID(),["min","max","step","low","high"].forEach(s=>{this.hasAttribute(s)&&(this[s]=Number(this.getAttribute(s)))}),this.setBounds(this);const i=this;function t(s,a){let o=s.value;if(a){const c=a.touches[0],h=i.highSlider.getBoundingClientRect();let{height:d,width:u}=getComputedStyle(i.highSlider);d=parseFloat(d),u=parseFloat(u);let f=1;d>u?f=Math.max(0,Math.min(d,c.pageY-h.top))/d:f=Math.max(0,Math.min(u,c.pageX-h.left))/u,o=i.min+f*(i.max-i.min)}i.whichSlider||(i.whichSlider=o*2>(isNaN(i.high)?i.max:i.high)+(isNaN(i.low)?i.min:i.low)+1?i.highSlider:i.lowSlider),i.whichSlider===i.lowSlider?i.low=i.lowSlider.value=Math.min(typeof i.high=="undefined"?i.max:i.high,o):i.whichSlider===i.highSlider&&(i.high=i.highSlider.value=Math.max(typeof i.low=="undefined"?i.min:i.low,o)),i.setValue(i)}[this.highSlider,this.lowSlider].forEach(s=>{["mousedown","pointerdown"].forEach(a=>{s.addEventListener(a,o=>{i.whichSlider=null})}),s.addEventListener("input",()=>t(s)),e.touchDevice&&(s.addEventListener("touchstart",a=>{i.whichSlider=null,i.engaged=!0,t(s,a)},{passive:!1}),s.addEventListener("touchmove",a=>{i.engaged&&t(s,a)},{passive:!1}),s.addEventListener("touchend",a=>{i.engaged=!1},{passive:!1}))})}setBounds(i){Array.from(this.querySelectorAll('input[type="range"]')).forEach(t=>{["min","max","step"].forEach(s=>{(i[s]||i[s]===0)&&(t.setAttribute(s,i[s]),this[s]=i[s])})}),this.updateVisual()}setValue(i){const t={};i&&(i.low!==void 0&&(t.low=this.min===void 0?i.low:Math.max(this.min,i.low)),i.high!==void 0&&(t.high=this.max===void 0?i.high:Math.min(this.max,i.high))),e.equals(this.value,t)||(this.value=t),this.low=t.low,this.high=t.high,this.updateVisual()}updateVisual(){this.setAttribute("min",this.min),this.setAttribute("max",this.max),this.setAttribute("low",this.low),this.setAttribute("high",this.high),this.setAttribute("step",this.step);const i=getComputedStyle(this.textRange),t=i.color,s=i.borderLeftColor;let a=this.low;(isNaN(a)||a<this.min)&&(a=this.min);let o=this.high;(isNaN(o)||o>this.max)&&(o=this.max),this.lowSlider.value=a,this.highSlider.value=o,typeof a!="undefined"&&(a=Number(this.lowSlider.value)),typeof o!="undefined"&&(o=Number(this.highSlider.value));const c=a-this.min,h=o-this.min;this.textRange.innerHTML=a+"-"+o;const d=this.max-this.min,u=[c/d*100,h/d*100];this.backing.style.background=`linear-gradient(to right,
			${s} 0% ${u[0]}%,
			${t} ${u[0]}% ${u[1]}%,
			${s} ${u[1]}% 100%)`}}n.markup=`
		<cq-double-slider-text class="ciq-double-slider-text"></cq-double-slider-text>
		<cq-double-slider-range class="ciq-double-slider-range"></cq-double-slider-range>
		<input type="range" class="ciq-double-slider-range" range="low">
		<input type="range" class="ciq-double-slider-range" range="high">
`,e.UI.addComponentDefinition("cq-double-slider",n)},dt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}open(i){this.addDefaultMarkup(),this.classList.add("ciq-context-menu"),this.drawing=i.drawing;var t=this.node.find("[cq-edit-text]");return this.drawing.edit?t.show():t.hide(),super.open(i)}}n.markup=`
		<div stxtap="DrawingEdit.text()" cq-edit-text>Edit Text</div>
		<div stxtap="DrawingEdit.edit()">Edit Settings</div>
		<div stxtap="DrawingEdit.clone()">Clone Drawing</div>
		<cq-menu stxtap="resize()" cq-close-top="cq-dialog[cq-drawing-context]">
			<cq-menu-dropdown cq-no-scroll="true" class="context-menu-right">
				<cq-item stxtap="DrawingEdit.reorderLayer('top')">Bring to Top</cq-item>
				<cq-item stxtap="DrawingEdit.reorderLayer('up')">Bring Forward</cq-item>
				<cq-item stxtap="DrawingEdit.reorderLayer('down')">Send Backward</cq-item>
				<cq-item stxtap="DrawingEdit.reorderLayer('bottom')">Send to Bottom</cq-item>
			</cq-menu-dropdown>
			<!-- element here so that <cq-menu-dropdown> can keep "top: auto;" -->
			<div>Layer Management<div class="context-button-right-arrow"></div></div>
		</cq-menu>
		<div stxtap="DrawingEdit.remove()">Delete Drawing</div>
	`,e.UI.addComponentDefinition("cq-drawing-context",n)},ut=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}add(){var i=this.node.find("[cq-custom-fibonacci-setting] input").val();if(i&&(i=parseFloat(i)/100,!isNaN(i))){for(var t=this.context.stx.currentVectorParameters.fibonacci.fibs||[],s,a,o=0;o<t.length;o++)if(s=t[o],s.level>i){a=e.clone(s),a.level=i,a.display=!0,a.parameters&&(a.parameters.opacity=.25),t.splice(o,0,a);break}a||(t.length?s=e.clone(t[0]):s={color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},a=e.clone(s),a.level=i,a.display=!0,t.push(a)),this.open()}}close(){if(this.opener){var i=new Event("change",{bubbles:!0,cancelable:!0});this.opener.dispatchEvent(i),this.context.stx.currentVectorParameters.fibonacci.fibsAlreadySet=!0}super.close()}open(i){this.addDefaultMarkup(),super.open(i),i&&(this.opener=i.caller);var t=this.context.stx.currentVectorParameters,s=t.vectorType,a=this.node,o;if(t.fibonacci&&s!="fibtimezone"){a.find(".title").text("Fibonacci Settings");var c=t.fibonacci.fibs||[];o=a.find("cq-fibonacci-settings"),o.children(":not(template)").remove();for(var h=0;h<c.length;h++){var d=c[h];if(!(s==="fibarc"&&d.level<0)){var u=e.UI.makeFromTemplate(this.node.find("template"),o),f=d.level*100;u.find(".ciq-heading").text(f.toFixed(1)+"%");var g=u.find("input");d.display&&g.prop("checked",!0),this.setChangeEvent(g,"fib",d.level),u.find(".stx-data").append(g)}}}else a.find(".title").text("Settings"),o=a.find("cq-fibonacci-settings"),o.children(":not(template)").remove();this.node.find("[cq-custom-fibonacci-setting] input").val("")}setChangeEvent(i,t,s){var a=this;function o(){return function(){var c=a.context.stx.currentVectorParameters,h=c.vectorType;if(c.fibonacci&&h!="fibtimezone"){var d=c.fibonacci.fibs||[];if(this.type=="checkbox")for(var u=0;u<d.length;u++){var f=d[u];f.level===s&&(f.display=!!this.checked)}}}}i[0].addEventListener("change",o())}}n.markup=`
		<h4 class="title">Settings</h4>
		<cq-scroll cq-no-maximize>
			<cq-fibonacci-settings>
				<template cq-fibonacci-setting>
					<cq-fibonacci-setting>
						<div class="ciq-heading"></div>
						<div class="stx-data">
							<input type="checkbox">
						</div>
					</cq-fibonacci-setting>
				</template>
			</cq-fibonacci-settings>
			<div cq-custom-fibonacci-setting>
				<input class="ciq-heading" type="text">%
				<div class="ciq-btn stx-data" stxtap="add()">Add</div>
			</div>
		</cq-scroll>
		<div class="ciq-dialog-cntrls">
			<div class="ciq-btn" stxtap="close()">Done</div>
		</div>
	`,e.UI.addComponentDefinition("cq-fib-settings-dialog",n)},pt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}setContext(t){const{stx:s}=t;s.callbackListeners.floatingWindow||(s.callbackListeners.floatingWindow=[]),s.addEventListener("floatingWindow",a=>{const o=this["on"+e.capitalize(a.type)];if(o)return o.call(this,a),!0})}onShortcut({container:t,title:s,tag:a,content:o,width:c,status:h,onClose:d}){if(this.shortcutWindow){this.shortcutWindow.toggle(h).ensureVisible();return}this.shortcutWindow=this.constructor.windowImplementation.get({tag:a,content:o,title:s,container:t||document.body,onClose:d}),this.shortcutWindow.toggle(!0).update({width:c}).positionRelativeTo()}onDocumentation({container:t,title:s,tag:a,content:o,actionButtons:c,width:h,status:d,onClose:u}){function f(y,m){return()=>{y==="close"?m.toggle(!1):typeof y=="function"&&y()}}this.documentationWindow=this.constructor.windowImplementation.get({tag:a,content:o+"<br/>",title:s,container:t||document.body,onClose:u});let g=document.createElement("div");g.classList.add("ciq-window-actions"),this.documentationWindow.bodyEl.appendChild(g);for(let y of c){let m=document.createElement("button");m.innerText=y.label,m.style.marginTop="1em",m.style.marginRight="1em",m.classList.add("ciq-btn"),e.safeClickTouch(m,f(y.action,this.documentationWindow)),g.appendChild(m)}this.context.stx.translateUI&&this.context.stx.translateUI(this.documentationWindow.w),this.documentationWindow.toggle(!0).update({width:h}).positionRelativeTo()}}class r{constructor({content:t,title:s,tag:a,minWidth:o,minHeight:c,container:h,onClose:d}){const u=document.createElement("div");u.innerHTML=this.constructor.markup,u.classList.add("ciq-window"),(h.ownerDocument||document).body.append(u),u.tag=a,u.docWindow=this,Object.assign(this,{isDragging:!1,isResizing:!1,isOpen:!1,xDiff:0,yDiff:0,x:50,y:50,w:u}),this.bindEvents();const f=e.UI.closestContextContainer(h);if(f&&f.currentTheme){u.classList.add(f.currentTheme);const{stx:g}=f.CIQ.UI.context;g.addEventListener("theme",()=>{u.className=`ciq-window ${f.currentTheme}`})}this.titleEl=u.querySelector(".ciq-window-title"),this.bodyEl=u.querySelector(".ciq-window-body"),this.titleBarEl=u.querySelector(".ciq-window-bar"),this.setProps({title:s,content:t,minWidth:o,minHeight:c,container:h,onClose:d}),this.render()}setProps({title:t,content:s,minWidth:a,minHeight:o,container:c,onClose:h}){const{w:d,titleEl:u,bodyEl:f}=this;u.removeAttribute("cq-translate-original"),f.removeAttribute("cq-translate-original"),t!==void 0&&(u.textContent=t),s!==void 0&&(f.innerHTML=s),a!==void 0&&(d.style.minWidth=a+"px"),o!==void 0&&(d.style.minHeight=o+"px"),c&&(this.container=c),h!==void 0&&(this.onClose=h)}bindEvents(){const{w:t}=this,s=d=>t.querySelector(d);s(".ciq-window-bar").addEventListener("mousedown",this.onStartDrag.bind(this));const a=this.toggleCollapse.bind(this);s(".ciq-window-bar").addEventListener("dblclick",a),s(".ciq-window-collapse").addEventListener("click",a),"top, right, bottom, left, top-right, bottom-right, bottom-left, top-left".split(/, /).forEach(d=>{s(`.ciq-window-resize-${d}`).addEventListener("mousedown",h())}),t.ownerDocument.addEventListener("mousemove",this.onMouseMove.bind(this)),t.ownerDocument.addEventListener("mouseup",this.onMouseUp.bind(this)),s(".ciq-window-close").addEventListener("click",this.toggle.bind(this,!1)),t.ownerDocument.defaultView.addEventListener("resize",this.ensureVisible.bind(this));const c=this;function h(){return function(d){if(d.button!==0)return;const u=d.target.className.replace(/ciq-window-resize-/,"");c.isResizing=u,c.downX=d.pageX,c.downY=d.pageY,c.startWidth=c.width,c.startHeight=c.height,c.startLeft=c.x,c.startTop=c.y}}}update({x:t,y:s,width:a,height:o}){return Object.assign(this,{x:t,y:s,width:a,height:o}),this.render(),this}positionRelativeTo({container:t,location:s="center"}={}){const{x:a,y:o,width:c,height:h}=(t||this.container||document.body).getBoundingClientRect(),d=this.w.ownerDocument.documentElement.scrollTop,u=this.w.ownerDocument.documentElement.scrollLeft;return this.width>c-20&&(this.width=c-20),this.height>h-20&&(this.height=h-20),s==="center"&&(this.x=u+(a+c/2-this.width/2),this.y=d+(o+h/2-this.height/2)),this.render(),this}ensureVisible(){if(!this.isOpen)return;const{x:t,y:s,width:a}=this.w.getBoundingClientRect(),{innerWidth:o,innerHeight:c}=this.w.ownerDocument.defaultView;s>c-20&&(this.y=c-20),t>o-a&&(this.x=o-a),this.render()}render(){const{x:t,y:s}=this;Object.assign(this.w.style,{display:this.isOpen?"":"none",transform:"translate("+t+"px, "+s+"px)"}),this.w.classList.toggle("ciq-wdragging",this.isDragging||this.isResizing)}get width(){return this.w.offsetWidth}set width(t){t&&(this.w.style.width=t+"px")}get height(){return this.w.offsetHeight}set height(t){t&&(this.w.style.height=t+"px")}clampX(t){return Math.min(Math.max(t,0),this.w.ownerDocument.defaultView.innerWidth-this.w.offsetWidth)}clampY(t){return Math.min(Math.max(t,0),this.w.ownerDocument.defaultView.innerHeight-this.titleBarEl.offsetHeight-8)}onMouseMove(t){const{isDragging:s,isResizing:a}=this;if(!s&&!a)return;const o=t.pageX-this.downX,c=t.pageY-this.downY;s&&(this.x=this.clampX(o),this.y=this.clampY(c));const{startWidth:h,startHeight:d}=this,u=2;let f,g;if(/left/.test(a)&&(g=this.startWidth-o,this.width=g,this.x=this.startLeft+o),/top/.test(a)&&(f=this.startHeight-c,this.height=f,this.y=this.startTop+c),a&&/right|bottom/.test(a)){this.width=/right/.test(a)?o+h:g||h,this.height=/bottom/.test(a)?c+d:f||d;const y=this.w.ownerDocument.defaultView;this.x+this.width-u>y.innerWidth&&(this.width=y.innerWidth-this.x-u),this.y+this.height-u>y.innerHeight&&(this.height=y.innerHeight-this.y-u)}this.render()}onStartDrag(t){t.button===0&&(this.isDragging=!0,this.downX=t.pageX-this.x,this.downY=t.pageY-this.y)}onMouseUp(){this.isDragging=!1,this.isResizing=!1,this.render()}toggle(t){const s=t===void 0?!this.isOpen:t,a=this.isOpen!==s;return this.isOpen=s,a&&!this.isOpen&&this.onClose&&(this.onClose(),this.isCollapsed&&this.toggleCollapse()),this.render(),this}toggleCollapse(){this.isCollapsed=!this.isCollapsed,this.isCollapsed?(this.prevHeight=this.height,this.w.classList.add("ciq-window-collapsed"),this.height=this.titleBarEl.offsetHeight,this.onCollapse&&this.onCollapse()):(this.height=this.prevHeight,this.w.classList.remove("ciq-window-collapsed"));const t=this.w.querySelector(".ciq-window-collapse");t.title=this.isCollapsed?"Expand":"Collapse",this.render()}}r.markup=`
<div class="ciq-window-bar" title="Drag to reposition. Double click to collapse">
<div class="ciq-window-title"></div>
<span class="ciq-window-collapse" title="Collapse"></span>
<span class="ciq-window-close" title="Click to close">
</span>
</div>
<div class="ciq-window-body"></div>
<div class="ciq-window-resize-left"></div>
<div class="ciq-window-resize-top"></div>
<div class="ciq-window-resize-right"></div>
<div class="ciq-window-resize-bottom"></div>
<div class="ciq-window-resize-bottom-right"></div>
<div class="ciq-window-resize-bottom-left"></div>
<div class="ciq-window-resize-top-left"></div>
<div class="ciq-window-resize-top-right"></div>
`,r.get=function(i){let t;return i.tag&&(t=Array.from((i.container.ownerDocument||document).querySelectorAll(".ciq-window")).find(s=>s.tag===i.tag),t)?(t.docWindow.setProps(i),t.docWindow):new this(i)},n.windowImplementation=r,e.UI.addComponentDefinition("cq-floating-window",n)},ft=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.BaseComponent{connectedCallback(){if(this.attached)return;super.connectedCallback(),this.innerHTML=this.render(),this.columns=2,this.rows=2,this.generateTable(this.columns,this.rows),this.highlightTable(this.columns-1,this.rows-1),this.querySelector("table").addEventListener("mouseleave",()=>{this.generateTable(this.columns+1,this.rows+1),this.highlightTable(this.columns,this.rows)});const i=t=>{let s=document.createElement("div");return s.className="ciq-multi-chart-button "+t,e.safeClickTouch(s,function(a){this.triggerUpdateGridEvent({template:t})}.bind(this)),s};if(this.templates){const t=this.querySelector(".ciq-grid-layout-picker");this.templates.split(" ").forEach(s=>{t.appendChild(i(s))}),t.childNodes.forEach(s=>{const a=getComputedStyle(s);let o=0;a.gridTemplateAreas&&a.gridTemplateAreas!="none"?o=[...new Set(a.gridTemplateAreas.match(/([a-z])+/gi))].length:a.getPropertyValue("--grid-dimension")&&(o=parseInt(a.getPropertyValue("--grid-dimension"))||0,o++);for(let c=0;c<o;c++)s.innerHTML+="<div></div>"})}}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}get maxcols(){return this.getAttribute("maxcols")||4}set maxcols(i){this.setAttribute("maxcols",i)}get maxrows(){return this.getAttribute("maxrows")||4}set maxrows(i){this.setAttribute("maxrows",i)}get templates(){return this.getAttribute("templates")||""}set templates(i){this.setAttribute("templates",i)}get resize(){return this.getAttribute("resize")||""}set resize(i){this.setAttribute("resize",i)}generateTable(i,t){var s=this;this.resize=="fixed"&&(i=this.maxcols,t=this.maxrows);function a(c){let h=parseInt(c.target.dataset.column)+1;h>s.maxcols&&(h=s.maxcols);let d=parseInt(c.target.dataset.row)+1;d>s.maxrows&&(d=s.maxrows),this.resize!="fixed"&&s.generateTable(h,d),s.highlightTable(parseInt(c.target.dataset.column),parseInt(c.target.dataset.row))}let o=this.querySelector("table");if(o){this.cleanTable(i,t),i=i||1,t=t||1;for(let c=1;c<=Math.min(t,this.maxrows);c++){let h;o.childNodes[c-1]?h=o.childNodes[c-1]:(h=document.createElement("tr"),o.appendChild(h));for(let d=1;d<=Math.min(i,this.maxcols);d++)if(!h.childNodes[d-1]){let u=document.createElement("td");u.dataset.row=c,u.dataset.column=d,u.dataset.rows=t,u.dataset.columns=i,u.addEventListener("mouseenter",a),u.addEventListener("click",function(f){this.triggerUpdateGridEvent({columns:f.target.dataset.column,rows:f.target.dataset.row})}.bind(this)),u.appendChild(document.createElement("div")),h.appendChild(u)}}}}triggerUpdateGridEvent({columns:i,rows:t,template:s}){this.columns=+i,this.rows=+t,this.template=s||"",this.highlightTable(this.columns,this.rows),this.highlightTemplate(),this.closest("cq-context, [cq-context]").dispatchEvent(new CustomEvent("update-grid",{detail:{columns:i,rows:t,template:s,container:this.closest("cq-context")},bubbles:!0,composed:!0}))}highlightTable(i,t){for(let c of this.querySelectorAll("td"))c.dataset.column<=i&&c.dataset.row<=t?c.classList.add("highlight"):c.classList.remove("highlight");const s=this.querySelector(".row.count"),a=this.querySelector(".multiply"),o=this.maxrows<2;s.style.display=o?"none":"",a.style.display=o?"none":"",s.innerHTML=t,this.querySelector(".column.count").innerHTML=i}highlightTemplate(i){i&&(this.template=i);const t=this.querySelectorAll(".ciq-grid-layout-picker .ciq-multi-chart-button");if(t.forEach(s=>{s.classList.remove("active")}),this.template){const s=Array.from(t).find(a=>a.classList.contains(this.template));s&&s.classList.add("active")}}cleanTable(i,t){let s=this.querySelector("table");for(;s.childNodes.length>t;)s.removeChild(s.lastChild);for(let a of s.childNodes)for(;a.childNodes.length>i;)a.removeChild(a.lastChild)}render(){return`
				<style>

					.ciq-grid-layout-picker {
						display: grid;
						grid-template-columns: 1fr 1fr 1fr 1fr;
						grid-gap: 10px;
						margin: 5px 0;
					}

					cq-grid-size-picker, cq-grid-size-picker tr, cq-grid-size-picker td{
						display: block;
					}

					cq-grid-size-picker tr{
						margin: 0;
						padding: 0;
						white-space: nowrap;
						line-height: 0;
					}

					cq-grid-size-picker td{
						display: inline-block;
						height: 19px;
						width: 19px;
						margin: 0;
						padding: 0;
						text-align: center;
					}

					cq-grid-size-picker td div{
						pointer-events: none;
						display: inline-block;
						height: 15px;
						width: 15px;
						margin: 2px;
						padding: 0;
						border: solid 1px #ccc;
						border-color: var(--grid-size-border-color, #ccc);
						background: #eee; /* keep a hard coded style in case the var function is unavailable */
						background-color: var(--grid-size-background-color, #eee);
						text-align: center;
					}

					cq-grid-size-picker td:hover div, cq-grid-size-picker td.highlight div{
						border-color: #666;
						border-color: var(--grid-size-border-hl-color, #666);
						background: #ccc;
						background-color: var(--grid-size-background-hl-color, #ccc);
					}

					cq-grid-size-picker p{
						width:100%;
						line-height: 1em;
						text-align: center;
						margin: 5px 0;
					}

					cq-grid-size-picker .multiply{
						transform: rotate(45deg);
						display: inline-block;
					}
				</style>

				<div class="ciq-grid-layout-picker"></div>
				<cq-separator></cq-separator>
				<table class="grid-size-picker"></table>
				<p><span class="row count">1</span> <span class="multiply">+</span> <span class="column count">1</span></p>
			`}}e.UI.addComponentDefinition("cq-grid-size-picker",n)},mt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}setContext(){if(!this.hasAttribute("cq-filter"))return;const i=this.getAttribute("cq-filter")||"Search";this.createFilter(i)}createFilter(i){if(this.filterCreated)return;const t=document.createElement("div");t.classList.add("searchFilter"),this.appendChild(t);const s=document.createElement("input");s.type="search",s.placeholder=i,s.setAttribute("tabindex","-1"),this.hasAttribute("cq-search-icon")&&t.appendChild(this.ownerDocument.createElement("cq-lookup-icon")),t.appendChild(s),this.searchWrapper=t;const a=this.nextElementSibling;let o="";const c=({target:{value:u}})=>{const f=new RegExp(u,"i"),g=this.qsa;g("cq-item",a).forEach(y=>{const m=u&&!f.test(y.textContent)?"add":"remove";y.classList[m]("item-hidden"),o!==u&&(o=u,this.removeFocused.apply(a),g(".cq-keyboard-selected-highlight").forEach(v=>{v.classList.add("disabled")}),s.focus())}),typeof a.scrollToTop=="function"&&a.scrollToTop()};s.addEventListener("input",c),s.addEventListener("keyup",c),s.addEventListener("pointerdown",u=>{u.stopPropagation()});const h=this.getAttribute("cq-filter-min")||15,d=()=>{const u=this.qsa("cq-item",a).length;t.classList[u>h?"add":"remove"]("active")};if(typeof MutationObserver=="undefined"){t.classList.add("active");return}new MutationObserver(d).observe(this.parentElement,{childList:!0,subtree:!0}),d(),this.filterCreated=!0}}e.UI.addComponentDefinition("cq-heading",n)},gt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}disconnectedCallback(){super.disconnectedCallback(),this.attached=!0}setContext(i){this.addDefaultMarkup();const t=new e.UI.HeadsUp(this,i,{followMouse:!0,autoStart:!1});let s=i.config&&i.config.channels?i.config.channels.headsUp:"layout.headsUp";this.channelSubscribe(s,a=>{t[a==="dynamic"||(a||{}).dynamic?"begin":"end"]()})}}n.markup=`
		<svg version="1.1" x="0px" y="0px" viewBox="0 0 215 140" enableBackground="new 0 0 215 140">
			<defs>
				<filter id="ciq-hu-shadow" height="130%">
					<feGaussianBlur in="SourceAlpha" stdDeviation="1"></feGaussianBlur>
					<feOffset dx="0" dy="1" result="offsetblur"></feOffset>
					<feComponentTransfer>
						<feFuncA type="linear" slope="0.2"></feFuncA>
					</feComponentTransfer>
					<feMerge>
						<feMergeNode></feMergeNode>
						<feMergeNode in="SourceGraphic"></feMergeNode>
					</feMerge>
				</filter>
			</defs>
			<polygon
				class="ciq-hu-bg" style="stroke-width: 1;"
				points="198.4,124.4 1,124.4 1,1 214,1 214,137.8"
				filter="url(#ciq-hu-shadow)"
				/>
			<path class="ciq-hu-stroke"
				fill="#398DFF"
				d="M213,2v133.6l-13.7-11.8l-0.6-0.5H198H2V2H213 M215,0H0v125.4h198l17,14.6V0L215,0z">
			</path>
		</svg>
		<div>
			<cq-hu-col1>
				<cq-hu-date></cq-hu-date>
				<cq-hu-price></cq-hu-price>
				<cq-volume-grouping>
					<div>Volume</div>
					<div><cq-volume-visual></cq-volume-visual></div>
					<div><cq-hu-volume></cq-hu-volume><cq-volume-rollup></cq-volume-rollup></div>
				</cq-volume-grouping>
			</cq-hu-col1>
			<cq-hu-col2>
				<div>Open</div><cq-hu-open></cq-hu-open>
				<div>Close</div><cq-hu-close></cq-hu-close>
				<div>High</div><cq-hu-high></cq-hu-high>
				<div>Low</div><cq-hu-low></cq-hu-low>
			</cq-hu-col2>
		</div>
	`,e.UI.addComponentDefinition("cq-hu-dynamic",n)},vt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}disconnectedCallback(){super.disconnectedCallback(),this.attached=!0}setContext(i){this.addDefaultMarkup();const t=new e.UI.HeadsUp(this,i,{autoStart:!0});let s=i.config&&i.config.channels?i.config.channels.headsUp:"layout.headsUp";this.channelSubscribe(s,a=>{t[a==="static"||(a||{}).static?"begin":"end"]()})}}n.markup=`
		<div>
			<div>Price</div><cq-hu-price></cq-hu-price>
			<div>Open</div><cq-hu-open></cq-hu-open>
			<div>Close</div><cq-hu-close></cq-hu-close>
		</div>
		<div>
			<div>Vol</div>
			<cq-volume-section>
				<cq-hu-volume></cq-hu-volume>
				<cq-volume-rollup></cq-volume-rollup>
			</cq-volume-section>
			<div>High</div><cq-hu-high></cq-hu-high>
			<div>Low</div><cq-hu-low></cq-hu-low>
		</div>
	`,e.UI.addComponentDefinition("cq-hu-static",n)},yt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{connectedCallback(){this.attached||(super.connectedCallback(),["mousedown","pointerdown","touchstart"].forEach(i=>this.addEventListener(i,this.mouseTouchDown,{passive:!1})),["mouseup","pointerup","touchend","touchmove","click"].forEach(i=>this.addEventListener(i,this.mouseTouchUp,{passive:!1})))}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}disconnectedCallback(){["mousedown","pointerdown","touchstart"].forEach(i=>this.removeEventListener(i,this.mouseTouchDown)),["mouseup","pointerup","touchend","touchmove"].forEach(i=>this.removeEventListener(i,this.mouseTouchUp)),super.disconnectedCallback()}setContext(){this.addDefaultMarkup();const i="help-feature";let{topNode:t,stx:s}=this.context;e.Help&&!t.hasAttribute(i)&&t.setAttribute(i,""),this.ensureMessagingAvailable(s)}mouseTouchDown(i){!e.Help||!e.Help.Content||!e.Help.Content[this.getAttribute("help-id")]||this.pressTimer||i.button&&i.button>=2||(this.pressTimer=setTimeout(()=>{this.pressTimer=null,setTimeout(()=>this.classList.remove("pressing"),1e3),this.press()},this.context.stx.longHoldTime),this.classList.add("pressing"))}mouseTouchUp(i){!e.Help||!e.Help.Content||!e.Help.Content[this.getAttribute("help-id")]||i.button&&i.button>=2||(i.type==="click"&&(this.classList.contains("pressing")||this.press(),this.classList.remove("pressing")),this.pressTimer&&(clearTimeout(this.pressTimer),this.pressTimer=null))}ensureMessagingAvailable(i){setTimeout(()=>{const t=i.uiContext.topNode;t.querySelector("cq-floating-window")||t.append(document.createElement("cq-floating-window"))})}verifyHelpContent(){if(!e.Help||!e.Help.Content)return;e.Help.Content[this.getAttribute("help-id")]?this.classList.add("help-available"):this.classList.remove("help-available")}press(){if(!e.Help||!e.Help.Content)return;let{stx:i}=this.context,t=this.getAttribute("help-id")||"default",s=e.Help.Content[t]||e.Help.Content.default;if(!s)return;s.actions||(s.actions=[e.Help.Actions.enable]),s.actionButtons=[];function a(o,c){return()=>o.action(c)}for(let o of s.actions){let{label:c,action:h}=o;typeof h=="function"&&(h=a(o,this.parentElement)),s.actionButtons.push({label:c,action:h})}i.dispatch("floatingWindow",{type:"documentation",title:s.title,content:s.content,actionButtons:s.actionButtons,container:i.container.querySelector(".stx-subholder"),onClose:()=>!0,width:500,status:!0,tag:"help"})}}n.markup=`
		<div class="ciq-help-widget"></div>
		<div class="press-indicator">
			<!-- 1x1 transparent image to maintain aspect ratio when sizing by height -->
			<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
		</div>
	`,e.UI.addComponentDefinition("cq-help",n)},bt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}setContext(i){let t=this.constructor.markup;const s=this.getAttribute("cq-toggles");s&&(t=t.replace(/dynamic,static,null/,s)),this.addDefaultMarkup(this,t),this.tooltip=this.querySelector("cq-tooltip");let a=i.config?i.config.channels:{headsUp:"layout.headsUp",crosshair:"layout.crosshair"};this.channelSubscribe(a.headsUp,()=>this.applyValues(a)),this.channelSubscribe(a.crosshair,o=>{(e.isMobile||o)&&this.channelRead(a.headsUp)==="dynamic"&&setTimeout(()=>this.channelWrite(a.headsUp,"static"))}),this.initInfoComponents(i)}setTooltip(i){const{context:{stx:t},tooltip:s}=this;s.innerText=t.translateIf(`Info ${i||"off"}`)}initInfoComponents(i){const t=this.querySelector("cq-toggle").getAttribute("cq-toggles");["dynamic","static"].forEach(function(s){if(new RegExp(s).test(t)&&!i.topNode.querySelector(`cq-hu-${s}`)){const a=document.createElement(`cq-hu-${s}`);i.topNode.append(a)}})}applyValues(i){const t=this.channelRead(i.crosshair),s=this.channelRead(i.headsUp);s==="dynamic"&&(t||e.isMobile)&&setTimeout(()=>this.channelWrite(i.headsUp,"static")),e.isMobile&&s==="static"&&setTimeout(()=>this.channelWrite(i.crosshair,!0)),this.setTooltip(s)}}n.markup=`
		<cq-toggle
			class="ciq-HU"
			cq-member="headsUp"
			cq-toggles="dynamic,static,null">
			<span></span>
			<cq-tooltip>Info</cq-tooltip>
		</cq-toggle>
	`,e.UI.addComponentDefinition("cq-info-toggle",n)},qt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}set(i){const{toggleEl:t,options:s,selected:a,stx:o}=this,{crossX:c,crossY:h}=o.controls,{obj:d}=t.params,u={};s.forEach(g=>{const[y,m]=g.getAttribute("cq-member").split("-"),v=g===a&&i===!0;m?u[y]=Object.assign(u[y]||{},{[m]:v}):u[y]=v}),this.connectedCharts().forEach(g=>{Object.entries(u).forEach(([y,m])=>{typeof m=="object"?g.layout[y]=Object.assign({},g.layout[y],m):g.layout[y]=m}),g.changeOccurred("layout")}),t.params.action==="class"&&t.classList[i?"add":"remove"](t.params.value),t.currentValue=i,t.updateClass(),this.applyValues(this.channels);const f=this.context.topNode.getCharts;if(i){const g=f?this.connectedCharts().find(y=>y.container.closest("cq-context-wrapper.active")):o;this.positionCrosshair(g)}}connectedCharts(){return this.context.topNode.getCharts?this.context.topNode.getCharts():[this.stx]}positionCrosshair(i){if(!i)return;const{dataSegment:t}=i.chart;if(i.container.classList.contains("stx-crosshair-cursor-on")||!t||!t.length)return;const{index:s,Close:a}=h(t);if(s<0)return;const o=i.pixelFromBar(s),c=i.pixelFromPrice(a);i.mousemoveinner(o+i.left,c+i.top);function h(d){let u=d.length;for(;u--&&d[u];){const{Close:f}=d[u];if(f||f===0)return{index:u,Close:f}}return-1}}setSelected(i){const{options:t}=this;this.selected=i,t.forEach(s=>{s.classList[s===i?"add":"remove"]("ciq-active")})}setContext(i){this.tooltip=this.querySelector("cq-tooltip"),this.toggleEl=this.querySelector("cq-toggle"),this.optionsMenu=this.querySelector("cq-menu-dropdown"),this.options=Array.from(this.optionsMenu.querySelectorAll("cq-item"));let{config:{channels:t={}}={}}=i;t.headsUp||(t.headsUp="layout.headsUp"),t.crosshair||(t.crosshair="layout.crosshair"),this.channels=t,this.channelSubscribe(t.headsUp,()=>this.applyValues(t));const s=this.channelRead(t.headsUp)||{},a=this.channelRead(t.crosshair);let o=!1;const c=h=>{this.setSelected(h.target),this.set(!0),this.stx.changeOccurred("layout")};this.options.forEach(h=>{const[,d]=h.getAttribute("cq-member").split("-");!d&&a&&(o=!0),s[d]&&this.setSelected(h),h.selectFC=function(){c({target:this})}}),this.toggleEl.isInfoToggle=!0,this.toggleEl.currentValue=this.selected||o,this.selected||this.setSelected(this.options[0]),e.UI.stxtap(this.optionsMenu,c),e.isMobile&&(this.querySelector("cq-menu").style.display="none"),this.initInfoComponents(i.topNode),this.applyValues(t)}setTooltip(i){const{context:{stx:t},tooltip:s}=this;if(!this.options.some(a=>a.getAttribute("cq-member")==="crosshair")){const a=this.toggleEl.currentValue?"On":"Off";s.innerText=t.translateIf(`Info ${a}`)}}initInfoComponents(i){i.querySelectorAll(".ciq-chart-area").forEach(t=>{this.options.forEach(s=>{const[,a]=s.getAttribute("cq-member").split("-");if(a&&!t.querySelector(`cq-hu-${a}`)){const o=document.createElement(`cq-hu-${a}`);t.append(o)}})})}applyValues(i){const t=this.channelRead(i.crosshair),s=this.channelRead(i.headsUp)||{},{dynamic:a,floating:o,crosssection:c}=s,{channelWrite:h}=this,d=this.connectedCharts();if(e.isMobile){const y=this.context.topNode.querySelector("cq-hu-static");y&&(y.style.display=o?"none":"");const m=this.context.topNode.querySelector("cq-hu-dynamic");if(m&&(m.style.display="none"),a){g(i.headsUp,Object.assign({},s,{dynamic:!1,floating:!0})),this.applyValues(i);return}const v=this.querySelector("cq-item[cq-member*='headsUp-']:not([cq-member*='-dynamic'])"),b=Object.values(s).includes(!0);if(v&&!b&&(this.setSelected(v),t)){const[,q]=v.getAttribute("cq-member").split("-");if(q){const x={};x[q]=!0,g(i.headsUp,Object.assign({},s,x)),this.applyValues(i);return}}}let u=null,f=null;for(const y of this.options){const[m,v]=y.getAttribute("cq-member").split("-");m==="headsUp"&&s[v]?u=y:m==="crosshair"&&(f=y)}u?this.setSelected(u):f&&this.setSelected(f),!t&&(s.static||c)&&g(i.crosshair,!0);function g(y,m){d.forEach(v=>h(y,m,v))}}getCurrentValue(i){const{options:t}=this,{obj:s}=i;for(let a=0;a<t.length;a++){const[o,c]=t[a].getAttribute("cq-member").split("-");if(!c&&s[o]||s[o]&&s[o][c])return!0}return!1}}e.UI.addComponentDefinition("cq-info-toggle-dropdown",n)},Ct=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;let n=!1;class r extends HTMLElement{connectedCallback(){if(this.hasAttribute("attached"))return;this.setAttribute("attached","");var t=this;const s=this.getAttribute("env-container")||"body",a=this.getAttribute("tmpl-src");var o=this.querySelector("cq-context");o||(o=this.appendChild(document.createElement("cq-context")));const c=this.hasAttribute("no-save");this.style.visibility="hidden",e.loadUI(a,o,function(h){if(h)return;var d=t.querySelector("cq-chart-title");d&&d.removeAttribute("cq-browser-tab");for(var u=t.querySelectorAll("cq-ui-manager, cq-dialog, cq-color-picker"),f=0;f<u.length;f++){var g=u[f];g.parentNode.removeChild(g),n||document.querySelector(s).appendChild(g)}n=!0;const y={extendedHours:!0,rangeSlider:!0,inactivityTimer:!0,fullScreen:!1,initialSymbol:t.getAttribute("symbol")||void 0,restore:!c};t.signalEvent=new CustomEvent("signal-chart-ready",{detail:{node:t,params:y}}),t.setAttribute("cq-event-flag",""),t.style.visibility="",t.ownerDocument.body.dispatchEvent(t.signalEvent)})}disconnectedCallback(){this.stx.destroy()}}customElements.define("cq-instant-chart",r)},xt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;if(!e.I18N)console.error("languageDialog component requires first activating i18n feature.");else{class n extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}close(){const i=this.ownerDocument.querySelector("cq-language-dialog");i&&i.closest("cq-dialog,cq-menu").close()}open(i){this.addDefaultMarkup(),super.open(i);const t=this.node.find("cq-languages");t.children(":not(template)").remove();const s=this.node.find("template"),{languages:a}=e.I18N;if(!a)return;const o=this;function c(h){return function(){e.UI.contextsForEach(function(){const{stx:d}=this;e.I18N.localize(d,h),d.preferences.language=h,d.changeOccurred("preferences"),d.draw()},o),e.I18N.translateUI(h,o.querySelector(".title"))}}for(let h in a){const d=e.UI.makeFromTemplate(s,t);d.find("cq-language-name").text(a[h]),d.find("cq-flag").attr("cq-lang",h),e.UI.stxtap(d[0],c(h))}if(this.ownerDocument.body.keystrokeHub){let{tabActiveModals:h}=this.ownerDocument.body.keystrokeHub;h[0]&&this.ownerDocument.body.keystrokeHub.setKeyControlElement(h[0])}}}n.markup=`
		<h4 class="title">Choose language</h4>
		<cq-close></cq-close>
		<cq-languages>
			<template><div keyboard-selectable="true"><cq-flag></cq-flag><cq-language-name></cq-language-name></div></template>
		</cq-languages>
	`,e.UI.addComponentDefinition("cq-language-dialog",n)}},kt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}setContext(i){this.context.setLoader(this)}show(){this.classList.add("stx-show")}hide(){this.classList.remove("stx-show")}}e.UI.addComponentDefinition("cq-loader",n)},wt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;if(!e.ChartEngine.Driver)console.error("lookup component requires first activating quoteFeed feature.");else if(!e.ChartEngine.Driver.Lookup)console.error("lookup component requires first activating symbolLookupBase feature.");else{class n extends e.UI.ContextTag{constructor(){super(),this.usingEmptyDriver=!1,this.currentFilter=null,this.filterElements=null,this.params={},this.overrideIsActive=!1}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}disconnectedCallback(){this.removeClaim(this),super.disconnectedCallback()}acceptText(i,t){var s=this;this.params.driver||(this.context.lookupDriver?this.setDriver(this.context.lookupDriver):(this.setDriver(new e.ChartEngine.Driver.Lookup),this.usingEmptyDriver=!0));var a=this.params.driver.exchanges;function o(h){s.params.driver.exchanges=a,s.results(h)}var c=this.getAttribute("cq-exchanges");c&&(this.params.driver.exchanges=c.split(",")),this.params.driver.acceptText(i,t,null,o)}attachDriver(i){this.driver=i}close(){if(this.keyboardNavigation)this.highlightItem(this.input[0]),setTimeout(this.highlightItem.bind(this,this.input[0]),250),this.removeFocused(this.filterElements),this.resultList[0].keyboardNavigation=null;else{const i=this.ownerDocument.body.keystrokeHub;i&&setTimeout(()=>i.highlightAlign(),250)}this.closest("cq-dialog,cq-menu").close()}forceInput(){var i=this.input[0];this.selectItem({symbol:i.value}),e.blur(i),this.close(),i.value=""}initialize(){this.addDefaultMarkup();var i=this.node;if(this.label=this.querySelector("label"),this.labelName=this.getAttribute("label-name"),this.labelText=this.getAttribute("label-text"),this.label&&this.labelText&&this.labelName){const{config:{chartId:c=""}={}}=this.context;this.label.id=c?`${this.labelName}-${c}`:this.labelName,this.label.innerText=this.labelText,c&&this.setAttribute("aria-labelledby",this.label.id)}if(this.resultList=i.find("cq-scroll"),this.input=i.find("input"),!this.input.length){var t=document.createElement("input");t.setAttribute("type","hidden"),t.value="",this.input=i.append(t)}e.UI.stxtap(this.input[0],function(){this.focus()});var s=this;Array.from(this.input).forEach(function(c){c.addEventListener("paste",function(h){var d=h.target;setTimeout(function(){s.acceptText(d.value,s.currentFilter)},0)})});var a=this.querySelector("cq-lookup-filters");if(a){var o=a.querySelectorAll("cq-filter");o.forEach(function(c){e.UI.stxtap(c,function(){o.forEach(function(d){d.classList.remove("true")}),this.classList.add("true");var h=this.querySelector("cq-translate");h?s.currentFilter=h.getAttribute("original"):s.currentFilter=this.innerHTML,s.acceptText(s.input.val(),s.currentFilter)})})}typeof i.attr("cq-keystroke-claim")!="undefined"&&this.addClaim(this)}isActive(){return this.input[0].value!==""}keyStroke(i,t,s,a){if(a.ctrl||a.cmd||t=="Meta"||t=="Win")return!1;var o=this.input[0],c=!1,h=this.ownerDocument.activeElement,d=h===o;if(!d&&(s.altKey||h&&(h.tagName=="INPUT"||h.tagName=="TEXTAREA")))return!1;var u=!1,f=!1;if(e.climbUpDomTree(this,".stxMenuActive").length&&(f=!0),(d||f)&&(u=!0),!(!u&&(typeof this.node.attr("cq-keystroke-default")=="undefined"||!f&&this.uiManager.topMenu()))){if((t===" "||t==="Spacebar")&&o.value==="")return!1;var g=this,y=this.findFocused(this.filterElements);switch(t){case"Delete":case"Backspace":case"Del":o.value.length&&(window.getSelection().toString()?o.value="":(d||(o.value=o.value.substring(0,o.value.length-1)),o.value.length&&g.acceptText(o.value,g.currentFilter)),c=!0),t=="Backspace"&&(c=!0);break;case"Escape":case"Esc":o.value="",this.close(),e.blur(o),c=!0;break;case"Enter":var m=this.resultList;if(d=m.length&&m[0].focused(),o.value===""&&!d||this.overrideIsActive)break;if(d&&d.selectFC)d.selectFC.apply(d,{});else{var v=o.value,b=["false","0",null].indexOf(this.getAttribute("cq-uppercase"))==-1;b&&(v=v.toUpperCase()),this.selectItem({symbol:v})}e.blur(o),this.close(),o.value="",c=!0;break;case"ArrowRight":case"Right":y.length&&(this.resultList[0].keyboardNavigation&&(this.resultList[0].keyboardNavigation=null),this.focusNextItem(this.filterElements),this.clickFocusedItem(this.filterElements,s));break;case"ArrowLeft":case"Left":this.resultList[0].keyboardNavigation&&(this.resultList[0].keyboardNavigation=null),y.length&&(this.focusNextItem(this.filterElements,!0),this.clickFocusedItem(this.filterElements,s));break;case"ArrowDown":case"Down":if(!this.keyboardNavigation)break;if(y=this.findFocused(this.filterElements),y.length){if(!this.resultList[0].keyboardNavigation){var q=this.resultList[0].querySelector("cq-item");q&&(this.resultList[0].keyboardNavigation=this.keyboardNavigation)}}else for(let w=0;w<this.filterElements.length;w++){let C=this.filterElements[w];if(C.classList.contains("true")){this.focusItem(C);break}}e.blur(o);break;case"ArrowUp":case"Up":if(!this.keyboardNavigation)break;if(this.resultList[0].keyboardNavigation){var x=this.resultList[0].querySelector("cq-item:first-of-type");x&&x.hasAttribute("cq-focused")&&(x.removeAttribute("cq-focused"),this.resultList[0].keyboardNavigation=null,this.highlightFocusedItem(this.filterElements))}else y.length&&(this.removeFocused(y),this.highlightItem(o),e.focus(o));break;default:t.length===1&&(d||(o.value=o.value+t),g.acceptText(o.value,g.currentFilter),c=!0);break}if(c)return this.usingEmptyDriver||!o.value.length&&(t=="Escape"||t=="Esc"||t=="Enter"||!d)?this.close():this.open(),d?{allowDefault:!0}:!0}}open(){setTimeout(this.highlightItem.bind(this,this.input[0]),250),this.closest("cq-dialog,cq-menu").open()}onKeyboardDeselection(){e.blur(this.input[0]),this.close(),this.keyboardNavigation&&this.keyboardNavigation.highlightPosition(),this.resultList[0].keyboardNavigationWait=!1}onKeyboardSelection(){this.highlightItem(this.input[0]),e.focus(this.input[0]),this.resultList[0].keyboardNavigationWait=!0,this.open()}reset(){this.input[0].value="",this.resultList.empty()}results(i){function t(u,f){return function(g){e.blur(u.input[0]),u.selectItem(f),u.input[0].value=""}}this.resultList=e.UI.$(this.resultList),this.resultList.empty();for(var s=0;s<i.length;s++){for(var a=i[s],o="",c=0;c<a.display.length;c++)o+="<SPAN>"+a.display[c]+"</SPAN>";var h=document.createElement("cq-item");h.innerHTML=o,h.setAttribute("role","menuitem"),this.resultList.append(h),h.selectFC=t(this,a.data),e.UI.stxtap(h,h.selectFC)}var d=this.resultList;d[0]&&d[0].top(),this.highlightFocusedItem(this.filterElements)}selectItem(i,t){this.params.cb&&this.params.cb(i,t)}setCallback(i){this.params.cb=i}setContext(i){this.initialize();const t=this.querySelector("cq-lookup-input input"),{config:s,stx:a}=i;if(!s)return;const{channels:o={}}=s;this.channelSubscribe(o.breakpoint||"channel.breakpoint",c=>{var h=a.crossSection?a.crossSection.symbolInputType:"Symbol";c==="break-lg"?h="Enter "+h:c==="break-sm"&&(h=""),t.setAttribute("cq-translate-placeholder-original",h),t.setAttribute("placeholder",a.translateIf(h))}),this.filterElements=this.querySelectorAll("cq-lookup-filters cq-filter"),!this.params.cb&&i.changeSymbol&&(this.params.cb=i.changeSymbol)}changeContext(i){this.params.cb&&i.changeSymbol&&(this.params.cb=i.changeSymbol)}setDriver(i){this.params.driver=i}}n.markup=`
		<label></label>
		<cq-lookup-input cq-no-close>
			<input type="text"
				spellcheck="false"
				autocomplete="off"
				autocorrect="off"
				autocapitalize="none"
				name="symbol"
				placeholder=""
				tabindex="-1"
			>
			<cq-lookup-icon></cq-lookup-icon>
		</cq-lookup-input>
		<cq-lookup-results>
			<cq-lookup-filters cq-no-close role="group" aria-label="Filters">
				<cq-filter class="true">ALL</cq-filter>
				<cq-filter>STOCKS</cq-filter>
				<cq-filter>FX</cq-filter>
				<cq-filter>INDEXES</cq-filter>
				<cq-filter>FUNDS</cq-filter>
				<cq-filter>FUTURES</cq-filter>
			</cq-lookup-filters>
			<cq-scroll role="menu" aria-label="Results"></cq-scroll>
		</cq-lookup-results>
	`,e.UI.addComponentDefinition("cq-lookup",n)}},It=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.DialogContentTag{static get observedAttributes(){return["filter","dialog-title"]}get activeFilter(){return this.getAttribute("filter")}set activeFilter(i){this.setAttribute("filter",i.innerText)}get dialogTitle(){return this.getAttribute("dialog-title")}set dialogTitle(i){this.setAttribute("dialog-title",i)}constructor(i={}){super(),this.params=i,this.swatchColors=e.UI.defaultSwatchColors,this.initialized=!1}acceptText(i){const t=this;this.params.driver.acceptText(i,this.activeFilter,null,s);function s(a){t.results(a)}}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}disconnectedCallback(){this.removeClaim(this),super.disconnectedCallback()}attributeChangedCallback(i,t,s){switch(i){case"dialog-title":this.titleEl&&(this.titleEl.innerText=s);break;case"filter":if(this.form){const{filter:a,symbol:o}=this.form.elements;a.value=s,t!==s&&this.acceptText(o.value)}break}}open(i){const{caller:t}=i,s=this,a=t&&t.hasAttribute("comparison");a&&!i.context.stx.chart.symbol||(this.maintainCase=t&&!["false","0",null].includes(t.getAttribute("cq-maintain-case")),super.open(i),this.isComparison=a,this.dialogTitle=a?"Add Comparison":"Symbol Lookup",a?(this.input.parentElement.parentElement.classList.add("comparison"),e.UI.pickSwatchColor(this,this.swatch)):this.input.parentElement.parentElement.classList.remove("comparison"),this.activeFilter||(this.activeFilter=this.filters.firstElementChild,this.currentFilter=this.filters.firstElementChild,this.filters.firstElementChild.classList.add("true")),this.dialog.setAttribute("native-tabbing",!0),setTimeout(()=>{s.input.focus()},0))}close(){this.channelWrite("channel.lookup",!1,this.context.stx),this.input.value="",super.close()}initialize(){const i=this;this.addDefaultMarkup(),this.titleEl=this.querySelector("h4"),this.closeBtn=this.querySelector("cq-close"),this.form=this.querySelector("form"),this.input=this.querySelector("cq-lookup-input input"),this.filters=this.querySelector("cq-lookup-filters"),this.resultList=this.querySelector(".ciq-lookup-results"),this.resultTemplate=this.querySelector("template#lookupResult"),this.swatch=this.querySelector("cq-swatch"),this.closeBtn.addEventListener("pointerup",()=>{i.reset()}),this.input.addEventListener("input",function(t){i.acceptText(t.target.value)}),this.form.addEventListener("submit",function(t){t.preventDefault(),i.selectItem(i.input.value)}),this.initialized=!0,e.UI.scrollbarStyling&&e.UI.scrollbarStyling.refresh(this.resultList,{maxScrollbarLength:500}),this.addClaim(this),this.filters.addEventListener("pointerup",this.setFilter.bind(this)),this.filters.addEventListener("mousedown",function(t){i.context.stx.ownerWindow.requestAnimationFrame(()=>t.target.blur())}),this.verticalStructure=n.verticalStructure.map(t=>this.querySelector(t))}reset(){const{input:i,resultList:t}=this;for(i.value="";t.firstChild;)t.removeChild(t.firstChild)}results(i){const t=this,{resultList:s}=this;for(;s.firstChild;)s.removeChild(s.firstChild);i.forEach(o=>{const c=document.createElement("LI");let{data:h,display:d}=o;c.classList.add("result");let u=Object.entries(h).filter(f=>d.find(g=>f[1]===g));c.innerHTML=a(u.map(f=>`<span class="${f[0]}">${f[1]}</span>`).join("")),e.UI.stxtap(c.firstChild,function(){t.selectItem(h)}),s.append(c)});function a(o){return`<cq-item tabindex="0">${o}</cq-item>`}}selectItem(i){const t=i.symbol&&i||{symbol:i};let s=i.symbol||i;if(!s||typeof s!="string"||!s.trim().length)return;this.maintainCase||(s=s.toUpperCase()),t.symbol=s;const{stx:a,changeSymbol:o}=this.context,{symbol:c}=a.chart;if(this.isComparison){if(c.toLowerCase()===s.toLowerCase()){a.dispatch("notification","duplicatesymbol");return}a.addSeries(s,{name:"comparison "+s,symbolObject:t,color:this.swatch.style.backgroundColor,isComparison:!0})}else o(t);this.close()}setContext(i){this.context=i,this.dialog=this.closest("cq-dialog"),this.dialog.setAttribute("native-tabbing",!0),this.params.driver||this.setDriver(i.lookupDriver),this.initialized||this.initialize()}setFilter(i){this.currentFilter&&this.currentFilter.classList.remove("true");const t=i.target;i.preventDefault(),t.classList.add("true"),this.activeFilter=t,this.currentFilter=t}setDriver(i){this.params.driver=i}keyStroke(i,t,s){const a=this.context.uiManager.topMenu();if(a&&a.tagName==="CQ-COLOR-PICKER")return;const o=this.ownerDocument.activeElement,c=o.parentElement,h=v=>v.findIndex(b=>b===o);let d,u,f,g;const y=this.verticalStructure.findIndex(v=>v.contains(o)),m=o.tagName==="CQ-ITEM";switch(t){case"ArrowDown":case"Down":m?(d=this.naturalTabElements(this.resultList),u=h(d),g=d[u+1]):(f=this.verticalStructure[y+1],g=this.naturalTabElements(f)[0]);break;case"ArrowUp":case"Up":m?(d=this.naturalTabElements(this.resultList),u=h(d),g=d[u-1],u===0&&(f=this.verticalStructure[y-1],g=this.naturalTabElements(f)[0])):(f=this.verticalStructure[y-1],g=this.naturalTabElements(f)[0]);break;case"ArrowLeft":case"Left":g=o.previousElementSibling;break;case"ArrowRight":case"Right":g=o.nextElementSibling;break;case"Enter":c===this.filters&&this.setFilter(s),o===this.input&&(this.form.requestSubmit?this.form.requestSubmit():this.form.dispatchEvent(new Event("submit")));break}g&&g.focus()}}n.verticalStructure=["cq-lookup-input","cq-lookup-filters",".ciq-lookup-results"],n.markup=`
<h4 class="title">Symbol Lookup</h4>
<cq-close></cq-close>
<form role="search">
<div class="ciq-search-container">
<cq-lookup-input>
	<cq-lookup-icon></cq-lookup-icon>
	<input type="text"
		spellcheck="false"
		autocomplete="off"
		autocorrect="off"
		autocapitalize="none"
		name="symbol"
		placeholder=""
	>
	</cq-lookup-input>
	<cq-swatch-input class="hide-label">
		<label>Color</label>
		<cq-swatch tabindex="0" name="color"></cq-swatch>
		<input name="color" type="hidden"/>
	</cq-swatch-input>
	<button type="submit" class="ciq-btn">GO</button>
</div>
<cq-lookup-filters role="group" aria-label="Filters">
	<button type="button" class="ciq-filter">ALL</button>
	<button type="button" class="ciq-filter">STOCKS</button>
	<button type="button" class="ciq-filter">FX</button>
	<button type="button" class="ciq-filter">INDEXES</button>
	<button type="button" class="ciq-filter">FUNDS</button>
	<button type="button" class="ciq-filter">FUTURES</button>
</cq-lookup-filters>
<input type="hidden" name="filter" />
</form>
<ul class="ciq-lookup-results" aria-label="Results"></ul>
<template id="lookupResult">
	<li><span></span></li>
</template>
`,e.UI.addComponentDefinition("cq-lookup-dialog",n)},St=l=>{const e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}open(i){this.addDefaultMarkup(),super.open(i),i&&(this.opener=i.caller);const{currentVectorParameters:t}=this.context.stx,s=t.measurementline||{},a=this.querySelector('div[fieldname="hoverdisplay"] input');a.checked=s.calloutOnHover,a.changeHandler&&a.removeEventListener("change",a.changeHandler),a.changeHandler=({target:o})=>{const c=o.checked;s.calloutOnHover=c;const h=new Event("change",{bubbles:!0,cancelable:!0});this.opener.dispatchEvent(h)},a.addEventListener("change",a.changeHandler),Object.keys(s.displayGroups).forEach(o=>{const c=this.querySelector(`div[fieldname="${o}"] input`);c&&(c.checked=s.displayGroups[o],c.groupName=o,c.changeHandler&&c.removeEventListener("change",c.changeHandler),c.changeHandler=({target:h})=>{const{checked:d,groupName:u}=h;s.displayGroups[u]=d;const f=new Event("change",{bubbles:!0,cancelable:!0});this.opener.dispatchEvent(f)},c.addEventListener("change",c.changeHandler))})}}n.markup=`
	<h4 class="title">Measurement Line Settings</h4>
	<cq-scroll cq-no-maximize>
		<div class="ciq-drawing-dialog-setting" fieldname="hoverdisplay">
			<div class="ciq-heading">Display Info on Hover</div>
			<div class="stx-data">
				<input type="checkbox">
			</div>
		</div>

		<div class="ciq-drawing-dialog-setting" fieldname="bars">
			<div class="ciq-heading"># Bars</div>
			<div class="stx-data">
				<input type="checkbox">
			</div>
		</div>
		<div class="ciq-drawing-dialog-setting" fieldname="delta">
			<div class="ciq-heading">Delta (% Delta)</div>
			<div class="stx-data">
				<input type="checkbox">
			</div>
		</div>
		<div class="ciq-drawing-dialog-setting" fieldname="annpercent">
			<div class="ciq-heading">Annualized %</div>
			<div class="stx-data">
				<input type="checkbox">
			</div>
		</div>
		<!--<div class="ciq-drawing-dialog-setting" fieldname="totreturn">
			<div class="ciq-heading">Total Return</div>
			<div class="stx-data">
				<input type="checkbox">
			</div>
		</div>-->
		<div class="ciq-drawing-dialog-setting" fieldname="volume">
			<div class="ciq-heading">Volume</div>
			<div class="stx-data">
				<input type="checkbox">
			</div>
		</div>
		<div class="ciq-drawing-dialog-setting" fieldname="studies">
			<div class="ciq-heading">Studies</div>
			<div class="stx-data">
				<input type="checkbox">
			</div>
		</div>
	</cq-scroll>
	<div class="ciq-dialog-cntrls">
		<div class="ciq-btn" stxtap="close()">Done</div>
	</div>
`,e.UI.addComponentDefinition("cq-measurementline-settings-dialog",n)},Et=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends HTMLElement{constructor(){super(),this.activeClassName="stxMenuActive",this.active=!1,this.adjustLiftPosition=this.adjustLiftPosition.bind(this)}get focusElement(){return this.getAttribute("cq-focus")}connectedCallback(){if(this.attached||(this.uiManager=e.UI.getUIManager(this),this.attached=!0,this.hasAttribute("readonly")))return;var i=this;function t(a){i.tap(a)}function s(a){i.captureTap(a)}this.addEventListener("stxtap",s,!0),e.UI.stxtap(this,t),window.addEventListener("resize",this.adjustLiftPosition)}adoptedCallback(){e.UI.flattenInheritance(this,n)}disconnectedCallback(){window.removeEventListener("resize",this.adjustLiftPosition)}captureTap(i){var t=Array.from(e.climbUpDomTree(i.target));this.noClose=t.filter(function(s){var a=s.getAttribute("cq-no-close");return a!==null&&a!==!1}).length,this.noClose||(this.noClose=t.filter(function(s){return s.matches("cq-separator,cq-heading")}).length)}close(){this.uiManager.closeMenu(this)}findLifts(){return[...this.querySelectorAll("*[cq-lift]")].filter(i=>i.closest("cq-menu,cq-dialog")==this)}hide(){if(!this.active)return;this.unlift(),this.classList.remove(this.activeClassName),this.active=!1,this.querySelectorAll("input").forEach(function(s){s==s.ownerDocument.activeElement&&s.blur()});const i=this.querySelector("cq-menu-dropdown");if(i&&(i.disablekeyboardNavigation(),e.UI.BaseComponent.prototype.removeFocused(i.querySelectorAll("[cq-focused]"))),this.ownerDocument.body.keystrokeHub){let{tabActiveModals:s}=this.ownerDocument.body.keystrokeHub;s[0]&&this.ownerDocument.body.keystrokeHub.setKeyControlElement(s[0])}const t=this.querySelector("cq-lookup");t&&t.close()}lift(){const i=e.UI.getMyContext(this);(this.lifts=this.findLifts()).forEach(s=>{if(i&&i.config&&i.config.themes){let o=Object.keys(i.config.themes.builtInThemes);s.classList.remove(...o);let c=o.find(h=>i.topNode.classList.contains(h)===!0);c&&s.classList.add(c)}const a=s.closest("cq-scroll");a&&a.addEventListener("scroll",this.adjustLiftPosition),this.uiManager.lift(s),s.remember.scrollParent=a})}adjustLiftPosition(){this.lifts&&this.lifts.forEach(i=>{const{parentNode:t}=i.remember,s=t.getBoundingClientRect(),a=1;i.style.top=s.bottom-a+"px",i.style.left=s.left+"px"})}onKeyboardDeselection(){this.close()}open(i){for(var t=this.uiManager.activeMenuStack,s=0;s<t.length;s++)if(t[s]===this)return;this.uiManager.openMenu(this,i)}restoreLift(i){if(!i)return;const{remember:t}=i,s=t.scrollParent;s&&s.removeEventListener("scroll",this.adjustLiftPosition),i.doNotDisconnect=!0,i.remove(),delete i.doNotDisconnect,Object.assign(i.style,t.css),t.parentNode.appendChild(i)}show(i){if(!this.active&&(this.active=!0,this.classList.add(this.activeClassName),this.lift(),this.querySelectorAll("cq-scroll, cq-menu-dropdown").forEach(function(t){t.resize&&!t.hasAttribute("cq-no-scroll")&&t.resize()}),this.keyboardNavigation)){const t=this.querySelector("cq-menu-dropdown");t&&this.keyboardNavigation.setKeyControlElement(t,!0)}}tap(i){i.stopPropagation(),i._cancelBubble=i.cancelBubble;var t=this.uiManager;if(this.active)this.noClose||t.closeMenu(this);else{var s=i.target.closest("cq-menu-dropdown");if(s)return;for(var a=!1,o=e.climbUpDomTree(this.parentElement,"cq-menu"),c=0;c<o.length;c++)o[c].active&&(a=!0);if(a||t.closeMenu(null,"CQ-MENU, CQ-COLOR-PICKER"),this.open(),this.focusElement&&!e.isMobile){let h=this.querySelector(this.focusElement);!h&&this.lifts&&this.lifts.length&&(h=this.lifts[0].querySelector(this.focusElement)),h&&h.focus()}}}unlift(){const{lifts:i}=this;i&&(i.forEach(t=>this.restoreLift(t)),this.lifts=null)}}e.UI.addComponentDefinition("cq-menu",n)},Tt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}setContext(i){const t=this.getAttribute("cq-name");if(t&&i.config){const s=i.config.getMenu(t);if(this.addDefaultMarkup(this,s&&s.join("")),!this.innerHTML){const a=e.UI.BaseComponent.selfOrParentElement(this,"cq-menu-dropdown-section");a&&(a.style.display="none")}return}}}e.UI.addComponentDefinition("cq-menu-container",n)},Lt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{constructor(){super()}connectedCallback(){super.connectedCallback(),this.messageQueue=[],this.displayTime=+this.getAttribute("defaultDisplayTime")||10,this.messagePosition=this.getAttribute("defaultPosition")||"top",this.messageTransition=this.getAttribute("defaultTransition")||"",this.displayTimer=null}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}setContext(){const{stx:i}=this.context;i.addEventListener("notification",t=>{this.newMessage(t)}),this.addInjection("append","resizeChart",()=>this.handleResize())}handleResize(){for(let i=0;i<this.messageQueue.length;i++)this.messageQueue[i].isDisplayed&&this.positionElement(this.messageQueue[i])}positionElement(i){const t=this.context.stx.chart.canvas.getBoundingClientRect(),s=this.context.topNode.getBoundingClientRect(),a=i.classList.contains("align-bottom");let o=t.top-s.top,c=t.left-s.left;Object.assign(i.style,{top:a?o+t.height+"px":o+"px",left:c+t.width*.5+"px"})}createMessageElement(i){if(!i.message)return;let{message:t,position:s,type:a,transition:o,displayTime:c,priority:h,callback:d}=i;c=parseInt(c),c!==0&&(c=c||this.displayTime),s=s||this.messagePosition,o=o||this.messageTransition,h=h||0,t.length>160&&(t=t.slice(0,160)+"...");let u=document.createElement("div");u.innerHTML=`
			<div class="cq-message-container">
				<div class="cq-message-icon"></div>
				<div class="cq-message-text"></div>
			</div>`;let f=u.querySelector(".cq-message-text");return e.makeTranslatableElement(f,this.context.stx,t),u.classList.add("cq-toast-message"),u.classList.add("type-"+a),o&&u.classList.add("animate","transition-"+o),s=="bottom"&&u.classList.add("align-bottom"),u.displayTime=c,u.priority=h,u.message=t,e.safeClickTouch(u,function(g,y,m){m.stopPropagation(),y&&y(),this.removeMessageNode(g)}.bind(this,u,d)),this.positionElement(u),u}displayNextMessage(){if(!this.messageQueue.length)return;if(!this.context.topNode.querySelector(".cq-toast-message")){let t=this.messageQueue[0];this.context.topNode.appendChild(t),t.isDisplayed=!0,t.displayTime!==0&&(this.displayTimer=window.setTimeout(this.removeMessageNode.bind(this,t),t.displayTime*1e3))}}removeMessageNode(i){if(i.classList.contains("hide"))return;i.classList.add("hide");let t=i.classList.contains("animate")?500:0;window.setTimeout(()=>{i.remove(),this.messageQueue.splice(this.messageQueue.indexOf(i),1),this.displayTimer&&(this.displayTimer=window.clearTimeout(this.displayTimer)),this.displayNextMessage()},t)}recallMessageNode(i){i.isDisplayed&&(this.displayTimer&&(this.displayTimer=window.clearTimeout(this.displayTimer)),i.isDisplayed=!1,this.context.topNode.removeChild(i))}newMessage(i){if(typeof i=="string"&&this.context.config&&this.context.config.systemMessages&&(i=this.context.config.systemMessages[i]),!i||typeof i!="object")return;if(i.remove){for(const s of this.messageQueue)s.message===i.message&&this.dismissMessage(i.message);return}let t=this.createMessageElement(i);if(t){const s=this.messageQueue.findIndex(a=>a.priority<t.priority);s>=0?(this.messageQueue[s].isDisplayed&&this.recallMessageNode(this.messageQueue[s]),this.messageQueue.splice(s,0,t)):this.messageQueue.push(t),this.displayNextMessage()}}dismissMessage(i){for(const t of this.messageQueue)t.message===i&&this.removeMessageNode(t)}}e.UI.addComponentDefinition("cq-message-toaster",n)},Dt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{constructor(){super(),this.dragMargin=10}connectedCallback(){this.attached||super.connectedCallback()}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}init(){this.isDragging=!1,this.minHeight=parseInt(this.getAttribute("min-height"),10),isNaN(this.minHeight)&&(this.minHeight=25),this.paletteDock=this.parentElement.parentElement,this.dragStrip=this.querySelector(".drag-strip"),this.resizeStrip=this.querySelector(".resize-strip"),this.dragStrip&&(this.dragStrip.addEventListener("mousedown",this.handleDragResize.bind(this,"dragging")),this.dragStrip.addEventListener("touchstart",this.handleDragResize.bind(this,"dragging"),{passive:!1})),this.resizeStrip&&(this.resizeStrip.addEventListener("mousedown",this.handleDragResize.bind(this,"resizing")),this.resizeStrip.addEventListener("touchstart",this.handleDragResize.bind(this,"resizing"),{passive:!1})),this.paletteDock.paletteSubscribe&&(this.sendMessage=this.paletteDock.paletteSubscribe(this.handleMessage.bind(this)))}static get observedAttributes(){return["docked","hide","orientation"]}handlePropertyChange(i,t,s){switch(i){case"docked":s==="false"?(this.setTransform(100,70),this.setHeightByScale(.8)):this.style.transform="";break}}handleDragResize(i,t){this.paletteDock.hasOwnProperty("dragging")&&this.paletteDock.startDrag(this,i)}handleMessage(i,t){return{id:i,message:t}}detach(i,t){let s=this.ownerDocument.body.classList.contains("break-sm");if(this.docked==="true"&&!s){this.docked="false",i=i||10,t=t||10;let a={left:0,width:0};this.paletteDock.getBounds&&(a=this.paletteDock.getChartBoundsOffset()),i>a.left+a.width-this.clientWidth&&(i=a.left+a.width-this.clientWidth),this.setTransformPosition(i,t),this.paletteDock.setChartDimensions(),this.paletteDock.setVerticalPaletteHeight()}}dock(){this.docked==="false"&&(this.docked="true",this.paletteDock.setChartDimensions(),this.paletteDock.setVerticalPaletteHeight())}getHeight(){return this.clientHeight}getWidth(){return this.clientWidth}checkPosition(){let i={top:0,left:0};this.paletteDock.getBounds&&(i=this.paletteDock.getChartBoundsOffset());const s=this.style.transform.match(/-?[0-9]{1,5}(?=px)/g).map(function(a){return parseInt(a)});s[0]+=i.left+this.dragStrip.clientWidth*.5,s[1]+=i.top+this.dragStrip.clientHeight*.5,this.setTransformPosition(s[0],s[1])}setTransformPosition(i,t){let s={top:0,left:0,width:0,height:0};this.paletteDock.getBounds&&(s=this.paletteDock.getChartBoundsOffset());let a=Math.floor(t-s.top-this.dragStrip.clientHeight*.5),o=Math.floor(i-s.left-this.dragStrip.clientWidth*.5);a=Math.min(Math.max(a,this.dragMargin),s.height-(this.dragStrip.clientHeight+this.dragMargin)),o=Math.min(Math.max(o,this.dragMargin),s.width-(this.dragStrip.clientWidth+this.dragMargin)),this.setTransform(o,a)}setTransform(i,t){this.style.transform="translate3d("+i+"px,"+t+"px, 0px)"}setHeightToPosition(i){let t={top:0,height:0};this.paletteDock.getBounds&&(t=this.paletteDock.getBounds());let s=this.getBoundingClientRect(),a=i-s.top;this.orientation==="vertical"&&a>this.minHeight&&a+(s.top-t.top)<t.height&&this.setHeight(a)}setHeightByScale(i){this.style.height=Math.floor(parseInt(this.style.height,10)*i)+"px"}setHeight(i){this.style.height=i+"px"}}e.UI.addComponentDefinition("cq-palette",n)},Ut=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{constructor(){super(),this.dragging=!1,this.paletteRegistry=[],this.mouseOutCk=!1}connectedCallback(){this.attached||super.connectedCallback()}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}initListeners(){const{stx:i,config:t={}}=this.context,s=this;this.setVerticalPaletteHeight(),this.addEventListener("touchend",f=>this.stopDrag(f)),this.addEventListener("touchmove",d,{passive:!1}),this.addEventListener("mouseup",f=>this.stopDrag(f)),this.addEventListener("mouseleave",o),this.addEventListener("mouseenter",c),this.addEventListener("mousemove",h),this.addEventListener("mousedown",this.stopContext.bind(this)),this.addInjection("append","resizeChart",()=>this.handleResize({resizeChart:!1}));const a=(t.channels||{}).drawing||"channel.drawing";this.channelSubscribe(a,u);function o(f){i.showCrosshairs(),s.mouseOutCk=setTimeout(()=>s.stopDrag(),500)}function c(f){if(i.undisplayCrosshairs(),!!s.dragging){if(f.buttons===1){clearTimeout(s.mouseOutCk);return}s.stopDrag()}}function h(f){s.dragging&&(f.stopPropagation(),s.dragging.classList.contains("dragging")&&s.dragging.setTransformPosition(f.clientX,f.clientY),s.dragging.classList.contains("resizing")&&s.dragging.setHeightToPosition(f.clientY))}function d(f){s.dragging&&f.touches[0]&&(f.stopPropagation(),s.dragging.classList.contains("dragging")&&s.dragging.setTransformPosition(f.touches[0].clientX,f.touches[0].clientY),s.dragging.classList.contains("resizing")&&s.dragging.setHeightToPosition(f.touches[0].clientY))}function u(f){s.setChartDimensions(),i.resizeChart()}}setContext(){this.initListeners()}palettePublish(i,t){for(var s=0;s<this.paletteRegistry.length;s++)this.paletteRegistry[s](i,t)}paletteSubscribe(i){return this.paletteRegistry.push(i),this.palettePublish.bind(this)}getBounds(){return this.parentNode.getBoundingClientRect()}getChartBounds(){let i=this.parentNode.getBoundingClientRect(),t={top:0,left:0,height:i.height,width:i.width};for(var s=this.querySelectorAll('[docked="true"]'),a=0;a<s.length;a++){var o=s[a];o.orientation==="vertical"?(t.width-=o.getWidth(),t.left+=o.getWidth()):o.orientation==="horizontal"&&(t.height-=o.getHeight(),t.top+=o.getHeight())}return t}getChartBoundsOffset(){let i=this.parentNode.getBoundingClientRect(),t=this.getChartBounds();return t.top+=i.top,t.left+=i.left,t}startContext(){this.classList.add("context")}stopContext(){this.classList.remove("context"),this.palettePublish("context","stop")}startDrag(i,t){for(var s=this.querySelectorAll('[docked="false"]'),a=0;a<s.length;a++)s[a].style.zIndex=1;t=t||"dragging",this.dragging=i,this.classList.add("dragging"),this.dragging.classList.add(t),this.dragging.style.zIndex=10}stopDrag(i){i&&i.preventDefault(),this.classList.remove("dragging"),this.dragging=!1,this.resizing=!1,this.node.find('[docked="false"]').each(function(){this.node.removeClass("dragging resizing")})}startResize(i){this.resizing=i,this.classList.add("dragging"),this.dragging.classList.add("dragging")}handleResize({resizeChart:i=!0}={}){this.palettePublish("dockWillResize"),this.setChartDimensions(),this.setVerticalPaletteHeight();let t=this.ownerDocument.body.classList.contains("break-sm");for(var s=this.querySelectorAll('[docked="false"]'),a=0;a<s.length;a++){var o=s[a];t?o.dock():o.checkPosition()}this.palettePublish("dockDidResize"),i&&this.context.stx.resizeChart()}setVerticalPaletteHeight(){this.node.find("[orientation=vertical]").each(function(i,t){t.getAttribute("docked")==="true"&&(t.style.height=this.parentNode.clientHeight+"px")}.bind(this))}setChartDimensions(){const i=this.context.stx.container,{top:t,left:s,width:a,height:o}=this.getChartBounds(),{config:c}=this.context,{isMultiChartHost:h}=this.context.topNode;let d=0;c&&c.channels?(this.channelWrite(c.channels.drawingPalettes||"channel.drawingPalettes",{top:t,left:s,width:a,height:o}),h&&(d=this.channelRead(c.channels.sidepanelSize||"channel.sidepanelSize")||0)):(i.style.width=a+"px",i.style.height=o+"px",i.style.top=t+"px",i.style.left=s+"px",h&&(d=+(this.context.topNode.querySelector("cq-side-panel")||{style:{width:""}}).style.width.replace("px","")));for(var u=this.querySelectorAll('[orientation="horizontal"]'),f=0;f<u.length;f++){var g=u[f];g.style.left=s+1+"px",g.style.width=a-d-3+"px"}for(var y=this.querySelectorAll('[orientation="vertical"]'),m=0;m<y.length;m++){var v=y[m];v.docked==="false"?v.style.top=t+"px":v.style.top=0}}dockAllPalettes(){for(var i=this.querySelectorAll('[docked="false"]'),t=0;t<i.length;t++)i[t].dock()}}e.UI.addComponentDefinition("cq-palette-dock",n)},At=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}pairUp(i){this.undo=i,this.undo.redoButton=this;var t=this;e.UI.stxtap(this,function(){t.undo.redo()})}}e.UI.addComponentDefinition("cq-redo",n)},Mt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.BaseComponent{connectedCallback(){if(!this.attached&&(super.connectedCallback(),this.hasAttribute("cq-no-claim")||this.addClaim(this),!this.hasAttribute("cq-no-scroll"))){this.style.overflowY="auto",this.uiManager=e.UI.getUIManager(this),this.uiManager.length>0&&(this.uiManager=this.uiManager[0]),this.addEventListener(e.wheelEvent,function(t){t.stopPropagation()},{passive:!1});var i=this;e.UI.addResizeListener(this,function(){i.resize()}),this.resize(),this.maxHeight=this.getAttribute("cq-max-height"),this.addEventListener("scroll",()=>{this.uiManager.closeOpenColorPicker()})}}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}disconnectedCallback(){this.doNotDisconnect||(this.removeClaim(this),e.UI.removeResizeListener(this),e.UI.scrollbarStyling&&e.UI.scrollbarStyling.destroy(this),super.disconnectedCallback())}focused(){var i=this.node.find("cq-item[cq-focused]");return i.length?i[0]:null}keyStroke(i,t,s){if(!this.keyboardNavigation&&(this.keyboardNavigationWait||!this.matches(".stxMenuActive *")))return;if(!e.trulyVisible(this))return!1;const a=this.querySelectorAll("[keyboard-selectable='true'], cq-item:not(.item-hidden), li");if(a.length){if(t==" "||t=="Spacebar"||t=="Enter"){const o=this.findFocused(a);if(!o||!o.length)return;const c=o[0].querySelectorAll("[keyboard-selectable-child='true'][cq-focused]");if(c.length){const h=o[0].closest("cq-study-legend");h&&h.storeFocused(o,c[0]),this.clickItem(c[0],s)}else this.clickItem(o[0],s)}else if(t=="ArrowDown"||t=="Down")this.focusNextItem(a);else if(t=="ArrowUp"||t=="Up")this.focusNextItem(a,!0);else if(t=="ArrowRight"||t=="Right"){const o=this.findFocused(a);if(!o||!o.length)return;const c=o[0].querySelectorAll("[keyboard-selectable-child='true']");c.length&&this.focusNextItem(c)}else if(t=="ArrowLeft"||t=="Left"){const o=this.findFocused(a)[0];if(!o)return;const c=o.querySelectorAll("[keyboard-selectable-child='true']");c.length&&!this.focusNextItem(c,!0)&&(this.removeFocused(c),this.focusItem(o))}return!0}}focusItem(i){this.scrollToElement(i),super.focusItem(i)}onKeyboardDeselection(){this.keyboardNavigation&&this.keyboardNavigation!==null&&this.keyboardNavigation.highlightPosition()}resize(){var i=this.node,t=this.closest("cq-context");if(!i.parents(".sharing").length&&!this.hasAttribute("cq-no-resize")){this.hasAttribute("cq-no-maximize")&&(this.noMaximize=!0);var s=this.getBoundingClientRect();if(s.height){var a=this.reduceMenuHeight||45,o,c;if(t){var h=t.multiChartContainer,d=(h||t).getBoundingClientRect();o=d.height,c=d.top}else o=this.ownerDocument.defaultView.innerHeight,c=0;if(o){var u=o-(s.top-c)-a,f=i.parents(".stx-holder,.stx-subholder,.chartContainer");f.length&&f.each(function(){var v=this.getBoundingClientRect().top+e.elementDimensions(this).height;u=Math.min(u,v-s.top-5)});for(var g=i.nextAll(),y=0;y<g.length;y++){var m=g[y];m&&!e.trulyVisible(m)||(u-=e.elementDimensions(m,{border:1,padding:1,margin:1}).height)}if(this.maxHeight&&this.maxHeight<u&&(u=this.maxHeight),this.noMaximize||i.css({height:u+"px"}),this.hasAttribute("cq-drop-up-menu")){const v=+this.style.bottom.replace("px",""),b=Math.min(s.top-c-a+v-4,25);i.css({bottom:b+"px"})}i.css({"max-height":u+"px"}),this.refresh()}}}}scrollToElement(i){var t=this.clientHeight,s=this.scrollTop,a=i.offsetTop+i.clientHeight;i.offsetTop>s&&a<t+s||(this.scrollTop=Math.max(a-t,0),this.refresh())}top(){this.scrollTop=0,this.refresh()}scrollToTop(){this.top()}refresh(){e.UI.scrollbarStyling&&e.UI.scrollbarStyling.refresh(this)}}e.UI.addComponentDefinition("cq-scroll",n)},_t=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}setContext(){this.addDefaultMarkup(),e.safeClickTouch(this,()=>this.tap()),e.Share.onClipboard(i=>{e.Share.loadChartFromID(this.context.stx,i)})}tap(i){const{context:t}=this;if(t.config)this.channelWrite(t.config.channels.dialog,{type:"share",params:{context:t}},t.stx);else{const s=this.ownerDocument.querySelector("cq-share-dialog");s&&s.open&&s.open({context:t})}}getClipboard(){return ae(this,null,function*(){const i=yield e.Share.getClipboard();i?e.Share.loadChartFromID(this.context.stx,i):this.tap()})}}n.markup="<div>Share</div>",e.UI.addComponentDefinition("cq-share-button",n)},Nt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;if(!e.Share)console.error("shareDialog component requires first activating share feature.");else{class n extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}open(i){this.addDefaultMarkup(),this.closeTeamsDialog(),super.open(i);const{chartSharing:t}=this.context.config;if(t&&t.getChartLayout?(this.qsa("[cq-share-dialog-div]")[0].classList.add("has-live-chart-sharing"),this.shareChartID()):this.shareChartImage(),this.ownerDocument.body.keystrokeHub){let{tabActiveModals:s}=this.ownerDocument.body.keystrokeHub;s[0]&&this.ownerDocument.body.keystrokeHub.setKeyControlElement(s[0])}}close(){super.close()}createImage(){return ae(this,null,function*(){return new Promise(i=>{var t=this.context.stx,s=this.ownerDocument.querySelector("cq-share-dialog .share-image-container .share-copyable-link");if(s&&(s.innerHTML="Loading..."),e.UI.bypassBindings=!0,e.Share.createImage(t,{hide:[".stx_chart_controls",".stx-btn-panel",".stx_jump_today",".stx-baseline-handle",".ciq-edit",".ciq-close","cq-marker-label"]},function(a){e.UI.bypassBindings=!1;var o=e.uniqueID(),c="https://share.chartiq.com",h=t.getStartDateOffset(),d={layout:t.exportLayout(),drawings:t.exportDrawings(),xOffset:h,startDate:t.chart.dataSegment[h].Date,endDate:t.chart.dataSegment[t.chart.dataSegment.length-1].Date,id:o,symbol:t.chart.symbol},u=c+"/upload/"+o,f={id:o,image:a,config:d};e.Share.uploadImage(a,u,f,function(g,y){if(g!==null)e.alert("error: "+g);else{const m=c+y;s&&(s.innerHTML=m),i(m)}})}),this.ownerDocument.body.keystrokeHub){let{tabActiveModals:a}=this.ownerDocument.body.keystrokeHub;a[0]&&this.ownerDocument.body.keystrokeHub.setKeyControlElement(a[0])}})})}copy_image(){this.copy("image")}copy_layout(){this.copy("layout")}copy(i){var t=this.ownerDocument.querySelector(`.share-${i}-container .share-copyable-link`);if(!t)return;var s=t.innerText,a=document.createElement("input");if(a.type="text",a.value=s,a.contentEditable=!0,a.readOnly=!0,this.ownerDocument.body.appendChild(a),a.focus(),a.select(),!e.isIE){var o=document.createRange();o.selectNodeContents(a);var c=window.getSelection();c.removeAllRanges(),c.addRange(o),a.setSelectionRange(0,s.length)}this.ownerDocument.execCommand("copy"),this.ownerDocument.body.removeChild(a),t.parentElement.classList.add("share-copied");var h=this.ownerDocument.querySelector(`.share-${i}-container .cq-share-copy`);const d=h.innerHTML;i==="image"?h.innerHTML="URL Copied!":h.innerHTML="ID Copied!",setTimeout(()=>{h.innerHTML=d},3e3)}loadChart(i){e.Share.loadChart(this.context.stx,i.e.target.previousElementSibling.value)}activateTab(i){const t=this.qsa(".ciq-share-chart-tab")[i],s=this.qsa(".ciq-share-chart-tab-content")[i];return this.qsa(".ciq-share-chart-tab, .ciq-share-chart-tab-content").forEach(a=>{a.classList.remove("ciq-active")}),t.classList.add("ciq-active"),s.classList.add("ciq-active"),{activeTab:t,activeContent:s}}shareChartID(){return ae(this,null,function*(){const{activeContent:i}=this.activateTab(0);e.Share.saveChartLayout(this.context.stx).then(t=>{const{chartSharing:s}=this.context.config;s.generateURL&&s.generateURL(t).then(a=>{const o=encodeURI(`${a}`),c=this.qsa(".share-layout-container .share-copyable-link")[0];c&&(c.innerHTML=a),i&&i.classList.add("share-layout-loaded"),this.updateSocialLinks("layout",o)})})})}openTeamsDialog(){this.qsa(".ciq-share-teams")[0].classList.add("ciq-active")}closeTeamsDialog(){this.qsa(".ciq-share-teams")[0].classList.remove("ciq-active")}updateTeamsLink(i){const t=i.target.parentElement.querySelector(".ciq-share-teams-link");t.href=`https://teams.microsoft.com/l/chat/0/0?users=${i.target.value}&topicName=View%20Chart&message=${t.getAttribute("ciq-encoded-message")}`}updateSocialLinks(i,t){const{chartSharing:s}=this.context.config;if(s&&s.quickLinks){const a=s.quickLinks;this.qsa(`.share-${i}-container .ciq-share-link`).forEach(o=>{const c=o.getAttribute("cq-share-name");if(a[c]!==!1)switch(c){case"msteams":o.href=`https://teams.microsoft.com/l/chat/0/0?users=&topicName=View%20Chart&message=${t}`,o.addEventListener("click",h=>{h.preventDefault(),this.openTeamsDialog();const d=this.qsa(".ciq-share-teams-link")[0],u=this.qsa(".ciq-share-teams textarea")[0];u.addEventListener("change",this.updateTeamsLink),u.addEventListener("keyup",this.updateTeamsLink),d.setAttribute("ciq-encoded-message",t),d.addEventListener("click",()=>{this.closeTeamsDialog()})});break;case"twitter":o.href=`http://twitter.com/share?text=${t}&hashtags=&url=`;break;case"symphony":o.href=`https://open.symphony.com/?startChat=&message=${t}`}})}}shareChartImage(){return ae(this,null,function*(){this.activateTab(1);const i=yield this.createImage();this.updateSocialLinks("image",encodeURI(i))})}}n.markup=`
		<div class="ciq-share-teams">
			<h4 class="title">Share With Teams</h4>
			<cq-close></cq-close>
			<div>Enter Teams recipients separated by commas:</div>
			<textarea></textarea>
			<div class="ciq-share-teams-buttons">
				<a href="#" target="_blank" class="ciq-btn ciq-share-teams-link" stxtap="shareTeams()">Share</a>
			</div>
		</div>
		<div class="ciq-share-form">
			<h4 class="title">Share Your Chart</h4>
			<cq-close></cq-close>
			<div cq-share-dialog-div>
				<div class="ciq-share-chart-tabs">
					<div class="ciq-share-chart-tab" keyboard-selectable="true" stxtap="shareChartID()">
						<span class="ciq-radio"><span></span></span>
						Live Chart
					</div>
					<div class="ciq-share-chart-tab" keyboard-selectable="true" stxtap="shareChartImage()">
						<span class="ciq-radio"><span></span></span>
						Chart Image
					</div>
				</div>

				<cq-separator></cq-separator>

				<div class="ciq-share-chart-tab-content share-layout-container">
					<div class="share-copy-container">
						<div class="share-copyable-link">Loading...</div>
						<button class="ciq-btn  cq-share-copy" stxtap="copy_layout()">Copy URL</button>
					</div>
					<div class="ciq-share-icons">
						<a href="#" target="_blank" class="ciq-btn ciq-share-link" cq-share-name="twitter">
							<span class="ciq-share-name">Share to Twitter</span>
						</a>
						<a href="#" target="_blank" class="ciq-btn ciq-share-link" cq-share-name="msteams">
							<span class="ciq-share-name">Share to Microsoft Teams</span>
						</a>
						<!--
						<a href="#" target="_blank" class="ciq-btn ciq-share-link" cq-share-name="symphony">
							<span class="ciq-share-name">Share to Symphony</span>
						</a>
						-->
					</div>

					<!--
					<cq-separator></cq-separator>

					<h4 class="title">Load Chart</h4>
					<div class="share-load-container">
						<input type="text" placeholder="Paste share ID" />
						<button class="ciq-btn" stxtap="loadChart()">Load Chart</button>
					</div>
					-->
				</div>
				<div class="ciq-share-chart-tab-content share-image-container">
					<div class="share-copy-container">
						<div class="share-copyable-link">Loading...</div>
						<button class="ciq-btn cq-share-copy" stxtap="copy_image()">Copy URL</button>
					</div>
					<div class="ciq-share-icons">
						<a href="#" target="_blank" class="ciq-btn ciq-share-link" cq-share-name="twitter">
							<span class="ciq-share-name">Share to Twitter</span>
						</a>
						<a href="#" target="_blank" class="ciq-btn ciq-share-link" cq-share-name="msteams">
							<span class="ciq-share-name">Share to Microsoft Teams</span>
						</a>
						<!--
						<a href="#" target="_blank" class="ciq-btn ciq-share-link" cq-share-name="symphony">
							<span class="ciq-share-name">Share to Symphony</span>
						</a>
						-->
					</div>
				</div>
			</div>
		</div>
	`,e.UI.addComponentDefinition("cq-share-dialog",n)}},Ht=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}set(i,t,s,a,o,c){var h=this;h.context.loader&&h.context.loader.show();var d={multiplier:t,base:s,padding:40};a&&(d.periodicity={interval:a,period:o||1,timeUnit:c}),h.context.stx.setSpan(d,function(){h.context.loader&&h.context.loader.hide()})}setContext(i){const t=i.config&&i.config.getMenu("rangeMenu");this.addDefaultMarkup(this,t&&t.join(""))}}n.markup=`
		<div stxtap="set(1,'today');">1D</div>
		<div stxtap="set(5,'day',30,2,'minute');">5D</div>
		<div stxtap="set(1,'month',30,8,'minute');">1M</div>
		<div class="hide-sm" stxtap="set(3,'month');">3M</div>
		<div class="hide-sm" stxtap="set(6,'month');">6M</div>
		<div class="hide-sm" stxtap="set(1,'YTD');">YTD</div>
		<div stxtap="set(1,'year');">1Y</div>
		<div class="hide-sm" stxtap="set(5,'year',1,1,'week');">5Y</div>
		<div class="hide-sm" stxtap="set(1,'all');">All</div>
	`,e.UI.addComponentDefinition("cq-show-range",n)},Pt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}setContext({config:{channels:i={}}={},stx:t}){const s=this.querySelector("div"),a=this.getAttribute("cq-on")||"sidenavOn",o=this.getAttribute("cq-off")||"sidenavOff",c=i.breakpoint||"channel.breakpoint",h=i.sidenav||"layout.sidenav",d=i.sidenavSize||"channel.sidenavSize",u=i.tfc||"channel.tfc",f=()=>{const g=this.channelRead(c);let y=this.channelRead(c)==="break-sm";typeof g=="string"&&g.includes("height")&&(y=s.classList.contains("sidenav"));const m=y&&this.channelRead(h)===a;s.classList.remove("sidenav","ciq-toggles"),s.classList.add(y?"sidenav":"ciq-toggles"),s.classList[m?"add":"remove"]("active"),this.channelWrite(d,m?s.getBoundingClientRect().width:0)};this.channelSubscribe(h,f),this.channelSubscribe(c,f),this.channelSubscribe(u,g=>{g&&this.channelWrite(h,o)})}}e.UI.addComponentDefinition("cq-side-nav",n)},Ot=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{constructor(){super(),this.callbacks=[]}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}setContext(i){const{config:t,stx:s}=i;if(!t)return;const{channels:a={}}=t,o=this.resizeMyself.bind(this),{node:c}=this;this.channelSubscribe(a.breakpoint||"channel.breakpoint",h),this.channelSubscribe(a.tfc||"channel.tfc",d,s);function h(){setTimeout(o)}function d(u){u?c.attr("cq-active",!0):c.removeAttr("cq-active"),h()}}close(){this.node.removeAttr("cq-active");var i=this.node.children();i.each(function(){this.sidePanelActiveClass?this.classList.remove(this.sidePanelActiveClass):this.removeAttribute(this.sidePanelActiveAttribute)});var t=this;setTimeout(function(){t.resizeMyself()},0)}nonAnimatedWidth(){var i=0;return Array.from(this.children).forEach(function(t){i+=e.elementDimensions(t).width}),i}open(i){this.close();var t=this.node.find(i.selector);i.className?(t.addClass(i.className),t.each(function(){this.sidePanelActiveClass=i.className})):(t.attr(i.attribute,"true"),t.each(function(){this.sidePanelActiveAttribute=i.attribute})),this.node.attr("cq-active","true");var s=this;setTimeout(function(){s.resizeMyself()},0)}registerCallback(i){this.callbacks.push(i)}resizeMyself(){var i=this.nonAnimatedWidth();this.node.css({width:i+"px"});for(var t=0;t<this.callbacks.length;t++)this.callbacks[t].call(this,i);const{config:s,stx:a}=this.context||{};if(!s)return;const o=(s.channels||{}).sidepanelSize||"channel.sidepanelSize";this.channelWrite(o,i,a)}}e.UI.addComponentDefinition("cq-side-panel",n)},Qt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}disconnectedCallback(){this.doNotDisconnect||(this.context&&(e.UI.unobserveProperty("studyLibraryHash",this.context.stx.chart,this.listener),this.context.stx.removeEventListener("preferences",this.listener)),super.disconnectedCallback())}initialize(i){this.addDefaultMarkup(),this.params=i||{},this.alwaysDisplayDialog=this.params.alwaysDisplayDialog||!1,this.excludedStudies=this.params.excludedStudies||[],this.params.template||(this.params.template="template"),this.params.template=this.node.find(this.params.template);const{stx:t}=this.context;this.listener=()=>this.renderMenu(t),e.UI.observeProperty("studyLibraryHash",t.chart,this.listener),t.addEventListener("preferences",this.listener),this.listener()}setContext({config:i}){i&&i.menuStudiesConfig&&this.initialize(Object.assign({},i.menuStudiesConfig))}renderMenu(i){if(!e.Studies)return;let t=[],s;for(let y in e.Studies.studyLibrary)s=e.Studies.studyLibrary[y],!(!s||this.excludedStudies[y]||this.excludedStudies[s.name]||s.siqList!==void 0)&&(s.name||(s.name=y),t.push([y,i.translateIf(s.name)]));t.sort(function(y,m){return y[1].localeCompare(m[1],i.locale||"en",{sensitivity:"base",caseFirst:"upper"})});const a=this.node,o=this,c=function(y,m){return function(v){if(v.target.classList.contains("ciq-info-btn")){o.showStudyInfo&&o.showStudyInfo(y),v.stopPropagation();return}f(v.target,y),o.dispatchEvent(new Event("resize"))}},h=a.find("cq-studies-content");for(;h.length>0&&h[0].firstChild;)h[0].removeChild(h[0].firstChild);const d=this.hasAttribute("ciq-favorites");t.forEach(function(y){const m=e.UI.makeFromTemplate(o.params.template);s=e.Studies.studyLibrary[y[0]];const v=m.find("span")[0];e.makeTranslatableElement(v||m[0],i,s.name),m[0].type=y[0];const b=m.find(".fav-marker")[0];b&&(d?e.safeClickTouch(b,g(s)):b.remove()),o.makeTap(m[0],c(y[0],o.context));const q=m.find(".ciq-info-btn")[0];q&&(!e.Studies.Info||!e.Studies.Info[s.name])&&(q.style.display="none"),a.find("cq-studies-content").append(m)}),d&&this.updateOrder();function u(y,m){const{context:v}=o;if(v.config)o.channelWrite(v.config.channels.dialog,{type:"study",params:Object.assign({},y,{context:v,addWhenDone:m})},v.stx);else{y.context=o.context;const b=o.ownerDocument.querySelector("cq-study-dialog");b.addWhenDone=m,b.open(y)}}function f(y,m){const{alwaysDisplayDialog:v={},context:{stx:b}}=o;function q(C,S,k){if(C===!0)return u(S,k),!0;if(typeof C=="object"){for(let T in C)if(T==m&&C[T])return u(S,k),!0}}if(q(o.params.dialogBeforeAddingStudy,{stx:b,name:m},!0))return;const x=v[m]?{interactiveAdd:!1}:null,w=e.Studies.addStudy(b,m,null,null,x);q(o.alwaysDisplayDialog,{sd:w,stx:b})}function g(y,m){return v=>{const b=v.target.parentElement,q=b.classList.contains("ciq-favorite");b.classList.add(q?"ciq-move-down":"ciq-move-up"),setTimeout(()=>{b.classList[q?"remove":"add"]("ciq-favorite"),e.Studies.Favorites[q?"remove":"add"](y.name),o.updateOrder()},500)}}}updateOrder(){const{stx:i}=this.context;e.Studies.Favorites.retrieveList(i,t=>{const s=this.hasAttribute("ciq-favorites"),a=Array.from(this.querySelectorAll("cq-item")),o=t.filter(({isCustomized:d})=>!d).reduce((d,{type:u})=>xe(ue({},d),{[u]:!0}),{}),c=({textContent:d,type:u},{textContent:f,type:g})=>{if(s){if(o[u]&&!o[g])return-1;if(!o[u]&&o[g])return 1}return d.localeCompare(f,i.locale||"en",{sensitivity:"base",caseFirst:"upper"})},h=this.querySelector("cq-studies-content");a.sort(c).forEach(d=>{d.classList[o[d.type]?"add":"remove"]("ciq-favorite"),d.classList.remove("ciq-move-up"),d.classList.remove("ciq-move-down"),h.append(d)})})}}n.markup=`
		<template>
			<cq-item></cq-item>
		</template>
		<cq-studies-content></cq-studies-content>
	`,e.UI.addComponentDefinition("cq-studies",n)},Ft=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}setContext(i){let t=this.constructor.markup;!!i.topNode.querySelector(".ciq-sb-container")||(t=t.split(/\n/g).filter(a=>!/StudyEdit\.addToFavorites/i.test(a)).join(`
`)),this.addDefaultMarkup(this,t),this.classList.add("ciq-context-menu"),super.setContext(i)}}n.markup=`
		<div stxtap="StudyEdit.edit()">Edit Settings...</div>
		<div stxtap="StudyEdit.addToFavorites()">Add to Favorites</div>
		<div stxtap="StudyEdit.remove()">Delete Study</div>
	`,e.UI.addComponentDefinition("cq-study-context",n)},zt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;if(!e.Studies)console.error("studyDialog component requires first activating studies feature.");else{class n extends e.UI.DialogContentTag{connectedCallback(){this.attached||(super.connectedCallback(),this.queuedUpdates={})}close(){if(this.addWhenDone){var i=this.helper,t=e.Studies.addStudy(i.stx,i.name);e.isEmpty(this.queuedUpdates)||(i.sd=t,i.updateStudy(this.queuedUpdates),this.queuedUpdates={}),delete this.addWhenDone}}closeActiveMenu(i){const t=this.ownerDocument.body.keystrokeHub,s=this.querySelector("*.stxMenuActive"),a=e.UI.getUIManager(this);!s||!t||!t.tabActiveElement||t.tabActiveElement.element!==i||(t.tabActiveElement=null,t.highlightHide(),a.closeMenu(s))}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}disconnectedCallback(){e.UI.unobserveProperty("signal",this.helper),super.disconnectedCallback()}formatDateInput(i){return i=i.replace(/-/g,""),i.search(/^\d{8}$/)||(i=i.substring(0,4)+"-"+i.substring(4,6)+"-"+i.substring(6,8)),i}formatTimeInput(i){return i=i.replace(/:/g,""),i.search(/^\d{4,6}$/)||(i=i.substring(0,2)+":"+i.substring(2,4)+(i.length==4?"":":"+i.substring(4,6))),i}hide(){e.isEmpty(this.queuedUpdates)||(this.helper.updateStudy(this.queuedUpdates),this.queuedUpdates={}),this.node.find("cq-menu").each(function(){this.unlift&&this.unlift()}),this.node.find("cq-swatch").each(function(){this.colorPicker&&this.colorPicker.close()})}makeMenu(i,t,s,a){var o=e.UI.makeFromTemplate(this.menuTemplate),c=o.find("cq-menu-dropdown");for(var h in s){var d=document.createElement("cq-item");d.innerText=s[h],d.setAttribute("stxtap","StudyDialog.setSelectOption('"+a+"')"),c.append(d),d.cqMenuWrapper=c.parents("cq-menu")[0],d.setAttribute("name",i),d.setAttribute("value",h),d.context=this.context}var u=o.find("cq-selected");return u.text(s[t]||this.helper.stx.translateIf(t)),o[0]}open(i){this.addDefaultMarkup(),this.selectTemplates(),super.open(i),"axisSelect"in i||(i.axisSelect=this.getAttribute("cq-study-axis"),i.axisSelect===""&&(i.axisSelect=!0)),"panelSelect"in i||(i.panelSelect=this.getAttribute("cq-study-panel"),i.panelSelect===""&&(i.panelSelect=!0)),typeof i.addWhenDone!="undefined"&&(this.addWhenDone=i.addWhenDone);var t=this;this.context.stx,e.UI.unobserveProperty("signal",this.helper),this.helper=new e.Studies.DialogHelper(i),e.UI.observeProperty("signal",this.helper,function(a){t.refreshInputs(),t.refreshOutputs(),t.refreshParameters(i)});var s=this.node;s.find(".title").text(this.helper.title),this.refreshInputs(!0),this.refreshOutputs(!0),this.refreshParameters(i,!0)}refreshInputs(i){var t=this.node.find("cq-study-inputs");i&&t.empty();for(var s=0;s<this.helper.inputs.length;s++){var a=this.helper.inputs[s],o=e.UI.makeFromTemplate(this.inputTemplate);this.menuTemplate=o.find("template[cq-menu]"),o.find(".ciq-heading").text(a.heading),o[0].setAttribute("fieldname",a.name);var c=null,h,d=this.helper.attributes[a.name];if(a.type=="number"){c=document.createElement("input"),c.setAttribute("type","number"),c.value=a.value,this.setChangeEvent(c,"inputs",a.name);for(h in d){var u=d[h];(e.isIE||e.isEdge)&&h=="step"&&Math.floor(u)!=u&&(u="any"),h!=="hidden"&&c.setAttribute(h,u)}}else if(a.type=="text"||a.type=="date"||a.type=="time"){c=document.createElement("input"),c.setAttribute("type",e.UI.supportedInputType(a.type)),a.type=="date"?c.value=this.formatDateInput(a.value):a.type=="time"?c.value=this.formatTimeInput(a.value):c.value=a.value,this.setChangeEvent(c,"inputs",a.name);for(h in d)h!=="hidden"&&c.setAttribute(h,d[h])}else if(a.type=="select")c=this.makeMenu(a.name,a.value,a.options,"inputs"),d&&d.readonly&&c.setAttribute("readonly",d.readonly);else if(a.type=="checkbox"){c=document.createElement("input"),c.setAttribute("type","checkbox"),a.value&&(c.checked=!0),this.setChangeEvent(c,"inputs",a.name);for(h in d)h!=="hidden"&&c.setAttribute(h,d[h])}d&&d.hidden&&o.hide(),c&&o.find(".stx-data").append(c),o[0].originalOuterHTML=o[0].outerHTML;var f=t.find("[fieldname='"+a.name+"']");f.length?f[0].originalOuterHTML!==o[0].originalOuterHTML&&f[0].replaceWith(o[0]):t.append(o)}}refreshOutputs(i){var t=this.node.find("cq-study-outputs");i&&t.empty();for(var s=0;s<this.helper.outputs.length;s++){var a=this.helper.outputs[s],o=e.UI.makeFromTemplate(this.outputTemplate);o[0].initialize({studyDialog:this,output:a.name}),o.find(".ciq-heading").text(a.heading),o[0].setAttribute("fieldname",a.name);var c=o.find("cq-swatch"),h=a.color;typeof h=="object"&&(h=h.color),o[0].originalOuterHTML=o[0].outerHTML;var d=t.find("[fieldname='"+a.name+"']");d.length?d[0].originalOuterHTML!==o[0].originalOuterHTML&&d[0].replaceWith(o[0]):t.append(o),c[0].setColor(h,!1)}}refreshParameters(i,t){var s=this.node.find("cq-study-parameters");t&&s.empty();for(var a=0;a<this.helper.parameters.length;a++){var o=this.helper.parameters[a],c=e.UI.makeFromTemplate(this.parameterTemplate);if(this.menuTemplate=c.find("template[cq-menu]"),!this.menuTemplate.length&&o.options){c.remove();continue}c.find(".ciq-heading").text(o.heading),c[0].setAttribute("fieldname",o.name);var h=c.find("cq-swatch"),d=document.createElement("input"),u,f=!1,g={};if(o.defaultValue.constructor==Boolean){d.setAttribute("type","checkbox"),o.value&&(d.checked=!0),this.setChangeEvent(d,"parameters",o.name+"Enabled"),h.remove(),g=this.helper.attributes[o.name+"Enabled"];for(u in g)u!=="hidden"&&d.setAttribute(u,g[u])}else if(o.defaultValue.constructor==String){var y=o.name;o.defaultColor?(c[0].initialize({studyDialog:this,parameter:o.name+"Color",params:i}),f=!0,y=y+"Value"):h.remove(),o.options?d=this.makeMenu(y,o.value,o.options,"parameters"):d.value=o.value,g=this.helper.attributes[y];for(u in g)u!=="hidden"&&d.setAttribute(u,g[u])}else if(o.defaultValue.constructor==Number){d.setAttribute("type","number"),d.value=o.value,this.setChangeEvent(d,"parameters",o.name+"Value"),c[0].initialize({studyDialog:this,parameter:o.name+"Color",params:i}),f=!0,g=this.helper.attributes[o.name+"Value"];for(u in g){var m=g[u];(e.isIE||e.isEdge)&&u=="step"&&Math.floor(m)!=m&&(m="any"),u!=="hidden"&&d.setAttribute(u,m)}}else continue;g&&g.hidden&&c.not("hr").hide(),c.find(".stx-data").append(d),c[0].originalOuterHTML=c[0].outerHTML;var v=s.find("[fieldname='"+o.name+"']");v.length?v[0].originalOuterHTML!==c[0].originalOuterHTML&&v[0].replaceWith(c[0]):s.append(c),f&&h[0].setColor(o.color,!1)}}setChangeEvent(i,t,s){var a=this;function o(){return function(){var c={};c[t]={},c[t][s]=this.value,(this.type=="checkbox"||this.type=="radio")&&(c[t][s]=this.checked),a.updateStudy(c)}}i.addEventListener("change",o())}setContext(i){this.context=i,i.advertiseAs(this,"StudyDialog")}setSelectOption(i,t){var s=e.UI.$(i.node),a=s.attr("name"),o=s.attr("value"),c=s[0].cqMenuWrapper;c.fieldValue=o;var h=c.querySelector("cq-selected");if(t||(t="inputs"),h){var d=this.helper.stx.translateIf(o);for(var u of this.helper[t])if(u.name===a&&u.options[o]){d=u.options[o];break}h.innerText=d}var f={};f[t]={},f[t][a]=o,this.closeActiveMenu(s[0]),this.updateStudy(f)}updateStudy(i){if(!this.node.find(":invalid").length){if(this.addWhenDone){e.extend(this.queuedUpdates,i);return}this.helper.libraryEntry.deferUpdate?(e.extend(this.queuedUpdates,{inputs:i.inputs}),this.helper.updateStudy({outputs:i.outputs,parameters:i.parameters})):this.helper.updateStudy(i)}}selectTemplates(){this.inputTemplate||(this.inputTemplate=this.querySelector("template[cq-study-input]"),this.outputTemplate=this.querySelector("template[cq-study-output]"),this.parameterTemplate=this.querySelector("template[cq-study-parameters]"))}}n.markup=`
		<h4 class="title">Study here</h4>
		<cq-scroll cq-no-maximize>
			<cq-study-inputs>
				<template cq-study-input>
					<cq-study-input>
						<div class="ciq-heading"></div>
						<div class="stx-data">
							<template cq-menu>
								<cq-menu class="ciq-select">
									<cq-selected></cq-selected>
									<cq-menu-dropdown cq-lift></cq-menu-dropdown>
								</cq-menu>
							</template>
						</div>
					</cq-study-input>
					<hr>
				</template>
			</cq-study-inputs>
			<cq-study-outputs>
				<template cq-study-output>
					<cq-study-output>
						<div class="ciq-heading"></div>
						<cq-swatch cq-overrides="auto"></cq-swatch>
					</cq-study-output>
					<hr>
				</template>
			</cq-study-outputs>
			<cq-study-parameters>
				<template cq-study-parameters>
					<cq-study-parameter>
						<div class="ciq-heading"></div>
						<div class="stx-data"><cq-swatch cq-overrides="auto"></cq-swatch>
							<template cq-menu>
								<cq-menu class="ciq-select">
									<cq-selected></cq-selected>
									<cq-menu-dropdown cq-lift></cq-menu-dropdown>
								</cq-menu>
							</template>
						</div>
					</cq-study-parameter>
					<hr>
				</template>
			</cq-study-parameters>
		</cq-scroll>
		<div class="ciq-dialog-cntrls">
			<div class="ciq-btn" stxtap="close()">Done</div>
		</div>
	`,e.UI.addComponentDefinition("cq-study-dialog",n)}},Rt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.DialogContentTag{}e.UI.addComponentDefinition("cq-study-input",n)},Vt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;if(!e.Studies)console.error("studyLegend component requires first activating studies feature.");else{class n extends e.UI.ModalTag{connectedCallback(){this.attached||(super.connectedCallback(),this.hasAttribute("cq-no-claim")||this.addClaim(this),this.context&&this.context.config&&this.context.config.channels&&this.channelWrite(this.context.config.channels.keyboardNavigation||"channel.keyboardNavigation",{action:"registerElements"}))}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}disconnectedCallback(){this.doNotDisconnect||(this.context&&this.context.config&&this.context.config.channels&&this.channelWrite(this.context.config.channels.keyboardNavigation||"channel.keyboardNavigation",{action:"registerElements"}),this.setActiveState(!1),this.removeClaim(this),super.disconnectedCallback())}begin(){if(!this.init){var i=this.context.stx,t=this.node;this.template=t.find("template[cq-study-legend]"),this.template.length||(this.template=t.find("template")),this.contentKeys=t.attr("cq-content-keys")||"cq-label",this.eventListeners.push(i.addEventListener("layout",this.renderLegend.bind(this)),i.addEventListener("theme",this.renderLegend.bind(this))),this.hasAttribute("cq-marker")&&(this.setAttribute("chart-legend",""),e.UI.stxtap(this,function(){this.setActiveState()})),this.renderLegend(),this.init=!0}}setActiveState(i){let t=this.classList.contains("ciq-active");i=typeof i=="undefined"?!t:i;const s=this.ownerDocument.body.keystrokeHub;i?(this.classList.add("ciq-active"),s&&this.keyboardNavigation&&s.addActiveModal(this)):(this.classList.remove("ciq-active"),s&&s.removeActiveModal(this))}keyStroke(i,t,s){if(!this.keyboardNavigation)return;const a=this.querySelectorAll("[keyboard-selectable='true'], cq-item:not(.item-hidden), cq-comparison-item");if(t==" "||t=="Spacebar"||t=="Enter"){const o=this.findFocused(a);if(!o||!o.length)return;const c=o[0].querySelector("[keyboard-selectable-child='true'][cq-focused]");if(c)this.storeFocused(o,c),this.clickItem(c,s);else{const h=o[0].querySelector("cq-swatch");h?this.clickItem(h,s):this.clickItem(o[0],s)}}else if(t=="ArrowDown"||t=="Down")this.focusNextItem(a);else if(t=="ArrowUp"||t=="Up")this.focusNextItem(a,!0);else if(t=="ArrowRight"||t=="Right"){const o=this.findFocused(a);if(!o||!o.length)return;const c=o[0].querySelectorAll("[keyboard-selectable-child='true']");c.length&&this.focusNextItem(c)}else if(t=="ArrowLeft"||t=="Left"){const o=this.findFocused(a)[0];if(!o)return;const c=o.querySelectorAll("[keyboard-selectable-child='true']");c.length&&!this.focusNextItem(c,!0)&&(this.removeFocused(c),this.focusItem(o))}else if(t==="Tab"||t==="Esc"||t==="Escape"){this.removeFocused(a),this.setActiveState(!1);const o=this.ownerDocument.body.keystrokeHub;o&&o.tabOrderSelect()}}storeFocused(i,t){let s=i[0].querySelector("cq-label")||i[0];const a=t.classList.contains("ciq-switch");a||(s=i[0].previousElementSibling.nodeName!=="TEMPLATE"&&i[0].previousElementSibling||i[0].nextElementSibling,s&&s.querySelector("cq-label")&&(s=s.querySelector("cq-label"))),s&&(this.clickedItem={name:s.textContent.trim(),isSwitch:a,ms:+new Date})}launchColorPicker(){this.setActiveState(!0)}renderLegend(){var i=this.context.stx;this.template.nextAll().remove();function t(I,D){return function(L){L.stopPropagation(),setTimeout(function(){D.permanent||e.Studies.removeStudy(I.context.stx,D),I.node[0].hasAttribute("cq-marker")&&I.context.stx.modalEnd(),I.renderLegend()},0)}}function s(I,D){return function(L){var A=i.layout.studies[D];if(A.permanent||!A.editFunction){i.dispatch("notification","studynoteditable");return}L.stopPropagation(),I.uiManager.closeMenu();var F=I.context.getAdvertised("StudyEdit"),U={stx:i,sd:A,inputs:A.inputs,outputs:A.outputs,parameters:A.parameters};F.editPanel(U)}}var a=this.hasAttribute("cq-overlays-only"),o=this.hasAttribute("cq-panel-only"),c=this.hasAttribute("cq-custom-removal-only"),h=this.hasAttribute("cq-signal-studies-only"),d=this.node.attr("cq-marker-label"),u=!1,f=null,g=this.node.parents(".stx-holder")[0];g&&(f=g.panel.name);var y=this.closest("cq-context");if(y&&y.hasAttribute("ciq-native-mobile")&&(u=!0),e.Studies)for(var m in i.layout.studies){var v=i.layout.studies[m];if(!v.customLegend&&!(c&&!v.study.customRemoval)&&!(o&&v.panel!=f)&&!(a&&!v.overlay&&!v.underlay)&&!((!g||f==="chart")&&e.xor(h,v.signalData))){var b=e.UI.makeFromTemplate(this.template,!0),q=b.find("cq-label");q.html(v.inputs.display),q[0].setAttribute("title",v.inputs.display);var x=function(I,D){return L=>{I.toggleDisabledState(D),D.changeOccurred("layout"),L.target.parentElement.classList[I.disabled?"remove":"add"]("ciq-active")}};!v.signalData&&g&&b[0].insertAdjacentHTML("afterbegin",E(v));var w=document.createElement("span");w.className="ciq-switch",w.setAttribute("keyboard-selectable-child","true"),v.disabled||b.addClass("ciq-active"),e.safeClickTouch(w,x(v,i)),g?b[0].insertBefore(w,b[0].firstElementChild):b.append(w),this.clickedItem&&+new Date-this.clickedItem.ms<100&&this.clickedItem.name.replace(/\u200C/g,"")===v.inputs.display.replace(/\u200C/g,"")&&(this.focusItem(b[0]),this.clickedItem.isSwitch&&this.focusItem(w));var C=b.find(".ciq-close");C.length&&(v.permanent?C.hide():(C[0].setAttribute("keyboard-selectable-child","true"),e.UI.stxtap(C[0],t(this,v))));var S=b.find(".ciq-edit")[0];if(S&&(v.permanent||!v.editFunction))S.style.visibility="hidden";else{var k=S||b[0];e.UI.stxtap(k,u?x(v,i):s(this,m))}e.isMobile&&(e.UI.stxtap(b.find(".ciq-legend-color")[0],()=>{}),e.UI.stxtap(b.find("cq-label")[0],()=>{})),this.setPanelLegendWidth()}}if(typeof d!="undefined"&&!this.node.find("cq-marker-label").length){var T=document.createElement("cq-marker-label");T.innerText=d,this.insertBefore(T,this.firstChild)}this.displayLegendTitle();function E(I){var D=Object.values(I.outputs);1/D.length*100,i.defaultColor||i.getDefaultColor();var L=D.slice(0,3).map((A,F)=>{const U=A.color||A;return`<span style="background: ${U==="auto"?i.defaultColor:U};"></span>`}).join("");return`<div class="ciq-legend-color">${L}</div>`}}displayLegendTitle(){i(this,this.contentKeys)?(this.node.css("display",""),this.node.parents("div.stx-panel-legend").css("width","")):(this.node.css("display","none"),this.node.parents("div.stx-panel-legend").css("width","0px")),this.context.stx.translateUI&&this.context.stx.translateUI(this.node[0]);function i(s,a){return Array.from(s.querySelectorAll(a)).some(t)}function t(s){for(;s;){if(s.nodeName.toLowerCase()==="template")return!1;s=s.parentElement}return!0}}setContext(i){if(!this.init){var t=this;this.parentElement&&(this.node.attr("cq-clone-to-panels")!==void 0&&(t.closest("cq-context").classList.add("stx-panel-legend"),t.spawnPanelLegend(),this.addInjection("append","stackPanel",function(s,a){t.spawnPanelLegend()})),this.begin())}}changeContext(i){if(!this.init){this.context=i,this.setContext(i);return}this.eventListeners.forEach(t=>{this.context.stx.removeEventListener(t)}),this.eventListeners=[i.stx.addEventListener("layout",this.renderLegend.bind(this)),i.stx.addEventListener("theme",this.renderLegend.bind(this))],this.context=i,this.renderLegend()}spawnPanelLegend(){var i=this.context.stx;function t(d){return function(u){d.setActiveState()}}for(var s in i.panels)if(s!=i.chart.panel.name){var a=i.panels[s].subholder.querySelector(".stx-panel-legend");if(a){var o=a.querySelector(this.nodeName);if(!o){if(this.ownerDocument!==document){const d=document.createElement("template");d.innerHTML=this.outerHTML,document.body.append(d),o=e.UI.makeFromTemplate(d)[0],d.remove()}else o=this.cloneNode(!0);o.setAttribute("cq-marker-label",this.getAttribute("cq-clone-to-panels")),o.removeAttribute("cq-clone-to-panels"),o.removeAttribute("cq-overlays-only"),o.removeAttribute("cq-marker"),e.UI.stxtap(o,t(o));var c=o.querySelector("cq-marker-label");c&&c.remove();var h=document.createElement("cq-study-legend-fixed-wrapper");h.appendChild(o),a.appendChild(h),o.begin()}}}}setPanelLegendWidth(){if(this.parentElement.tagName.toLowerCase()!=="cq-study-legend-fixed-wrapper")return;const i=this.node.parents("div.stx-panel-control")[0],t=i.querySelectorAll(".stx-btn-panel");for(let h of t)h.style.marginLeft="";const s=i.querySelector(".stx-btn-panel.stx-show")||null,a=s?s.offsetLeft:null,o=i.lastChild||null,c=o?o.offsetLeft+o.offsetWidth:null;s.style.marginLeft="-"+(c-a+20)+"px"}}e.UI.addComponentDefinition("cq-study-legend",n)}},jt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}setContext(){!this.context.config.plugins.studyBrowser||!e.Studies.Favorites?this.addDefaultMarkup():(this.addDefaultMarkup(this,this.constructor.studyBrowserMarkup),this.closest("cq-menu").classList.add("ciq-study-browser"))}}n.markup=`
	<cq-study-legend cq-no-close>
		<cq-section-dynamic>
			<cq-heading>Current Studies</cq-heading>
			<cq-study-legend-content>
				<template cq-study-legend>
					<cq-item>
						<cq-label class="click-to-edit"></cq-label>
						<div class="ciq-icon ciq-close"></div>
					</cq-item>
				</template>
			</cq-study-legend-content>
			<cq-placeholder>
				<div stxtap="Layout.clearStudies()" class="ciq-btn sm" keyboard-selectable="true">Clear All</div>
			</cq-placeholder>
		</cq-section-dynamic>
	</cq-study-legend>
	<div class="scriptiq-ui">
		<cq-heading>ScriptIQ</cq-heading>
			<cq-item><cq-clickable cq-selector="cq-scriptiq-editor" cq-method="open">New Script</cq-clickable></cq-item>
			<cq-scriptiq-menu></cq-scriptiq-menu>
		<cq-separator></cq-separator>
	</div>
	<cq-heading cq-filter cq-filter-min="15">Studies</cq-heading>
	<cq-studies></cq-studies>
	`,n.studyBrowserMarkup=`
	<cq-study-browser></cq-study-browser>
`,e.UI.addComponentDefinition("cq-study-menu-manager",n)},Bt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.BaseComponent{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}initialize(i){this.params=i}setColor(i){if(this.params){var t={outputs:{}};t.outputs[this.params.output]={},t.outputs[this.params.output].color=i,this.params.studyDialog.updateStudy(t)}}}e.UI.addComponentDefinition("cq-study-output",n)},Wt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}initialize(i){this.params=i}setColor(i){if(this.params){var t={parameters:{}};t.parameters[this.params.parameter]=i,this.params.studyDialog.updateStudy(t)}}}e.UI.addComponentDefinition("cq-study-parameter",n)},$t=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends HTMLElement{constructor(){super(),this.defaultColor=null}connectedCallback(){if(!this.attached){if(this.attached=!0,this.getAttribute("cq-static")){this.style.cursor="default";return}var i=this;e.UI.stxtap(this,function(t){i.launchColorPicker(),t.stopPropagation()})}}adoptedCallback(){e.UI.flattenInheritance(this,n)}getDefaultColor(){if(this.defaultColor)return this.defaultColor;var i=e.UI.getMyContext(this);return i?i.stx.defaultColor:"transparent"}setColor(i,t,s){var a=e.getBackgroundColor(this.parentNode),o=e.chooseForegroundColor(a),c=e.hsl(a);i=="auto"&&(s=!0),i||(i="transparent");var h=i;i=="auto"?h=this.getDefaultColor():i.indexOf("rgba(")===0&&(h=(h.split(",").slice(0,3).join(",")+")").replace(/rgba/,"rgb"));var d=e.hsl(h),u=e.isTransparent(i);this.style.background=this.value=h,s||Math.abs(c[2]-d[2])<.2||u?(this.style.border="solid "+o+" 1px",u&&(this.style.background="linear-gradient(to bottom right, transparent, transparent 49%, "+o+" 50%, transparent 51%, transparent)")):this.style.border="",s&&(a=e.chooseForegroundColor(h),this.style.background="linear-gradient(to bottom right, "+h+", "+h+" 49%, "+a+" 50%, "+a+")"),t!==!1&&e.UI.containerExecute(this,"setColor",i,this)}launchColorPicker(){e.UI.containerExecute(this,"launchColorPicker");var i=e.UI.getUIManager().getColorPicker(this);if(i){i.callback=function(s){return function(a){s.setColor(a,null)}}(this);var t=this.getAttribute("cq-overrides");t&&(t=t.split(",")),i.display({node:this,context:e.UI.getMyContext(this),overrides:t}),this.colorPicker=i}}}e.UI.addComponentDefinition("cq-swatch",n)},Kt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;if(!e.ThemeHelper)console.error("themeDialog component requires first activating theme feature.");else{class n extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}applyChanges(){(this.context.topNode.getCharts?this.context.topNode.getCharts():[this.context.stx]).forEach(s=>{s&&(this.helper.update(s),s.changeOccurred("theme"))})}close(){this.helper.settings=this.revert,this.applyChanges(),super.close()}open(i){this.addDefaultMarkup(),super.open(i);var t=i.themeName;this.initiatingMenu=i.initiatingMenu,this.context=i.context,this.helper=new e.ThemeHelper({stx:this.context.stx}),this.revert=e.clone(this.helper.settings);var s=this;function a(c,h,d,u){var f=s.node.find('cq-theme-piece[cq-piece="'+c+'"]');f.length&&(f[0].piece={obj:h,field:d},f.find("cq-swatch")[0].setColor(h[d],!1))}var o=this.helper.settings;a("cu",o.chartTypes["Candle/Bar"].up,"color"),a("cd",o.chartTypes["Candle/Bar"].down,"color"),a("wu",o.chartTypes["Candle/Bar"].up,"wick"),a("wd",o.chartTypes["Candle/Bar"].down,"wick"),a("bu",o.chartTypes["Candle/Bar"].up,"border"),a("bd",o.chartTypes["Candle/Bar"].down,"border"),a("lc",o.chartTypes.Line,"color"),a("mb",o.chartTypes.Mountain,"basecolor"),a("mc",o.chartTypes.Mountain,"color"),a("bg",o.chart.Background,"color"),a("gl",o.chart["Grid Lines"],"color"),a("dd",o.chart["Grid Dividers"],"color"),a("at",o.chart["Axis Text"],"color"),t||(t="My Theme"),this.node.find("cq-action input").val(t)}save(){var i=this.node.find("cq-action input").val(),t={settings:e.clone(this.helper.settings),name:i,builtIn:null};e.UI.contextsForEach(function(){this.stx.updateListeners("theme")},this);var s=this;this.ownerDocument.querySelectorAll("cq-themes").forEach(function(a){t.builtIn=a.currentLoadedBuiltIn,a.addCustom(t,s.initiatingMenu)}),super.close()}setValue(i,t,s){i[t]=s,this.applyChanges()}}n.markup=`
		<h4 class="title">Create Custom Theme</h4>
		<cq-close></cq-close>
		<cq-scroll cq-no-maximize>
			<cq-section>
				<cq-placeholder>Candle Color
					<cq-theme-piece-container>
						<cq-theme-piece cq-piece="cu"><cq-swatch cq-overrides="Hollow"></cq-swatch></cq-theme-piece>
						<cq-theme-piece cq-piece="cd"><cq-swatch cq-overrides="Hollow"></cq-swatch></cq-theme-piece>
					</cq-theme-piece-container>
				</cq-placeholder>
				<cq-placeholder>Candle Wick
					<cq-theme-piece-container>
						<cq-theme-piece cq-piece="wu"><cq-swatch></cq-swatch></cq-theme-piece>
						<cq-theme-piece cq-piece="wd"><cq-swatch></cq-swatch></cq-theme-piece>
					</cq-theme-piece-container>
				</cq-placeholder>
				<cq-placeholder>Candle Border
					<cq-theme-piece-container>
						<cq-theme-piece cq-piece="bu"><cq-swatch cq-overrides="No Border"></cq-swatch></cq-theme-piece>
						<cq-theme-piece cq-piece="bd"><cq-swatch cq-overrides="No Border"></cq-swatch></cq-theme-piece>
					</cq-theme-piece-container>
				</cq-placeholder>
				<cq-separator></cq-separator>
				<cq-placeholder>Line/Bar Chart
					<cq-theme-piece-container>
						<cq-theme-piece cq-piece="lc"><cq-swatch></cq-swatch></cq-theme-piece>
					</cq-theme-piece-container>
				</cq-placeholder>
				<cq-separator></cq-separator>
				<cq-placeholder>Mountain Base
					<cq-theme-piece-container>
						<cq-theme-piece cq-piece="mb"><cq-swatch></cq-swatch></cq-theme-piece>
					</cq-theme-piece-container>
				</cq-placeholder>
				<cq-placeholder>Mountain Peak
				<cq-theme-piece-container>
					<cq-theme-piece cq-piece="mc"><cq-swatch></cq-swatch></cq-theme-piece>
				</cq-theme-piece-container>
				</cq-placeholder>
			</cq-section>
			<cq-section>
				<cq-placeholder>Background
					<cq-theme-piece-container>
						<cq-theme-piece cq-piece="bg"><cq-swatch></cq-swatch></cq-theme-piece>
					</cq-theme-piece-container>
				</cq-placeholder>
				<cq-placeholder>Grid Lines
					<cq-theme-piece-container>
						<cq-theme-piece cq-piece="gl"><cq-swatch></cq-swatch></cq-theme-piece>
					</cq-theme-piece-container>
				</cq-placeholder>
				<cq-placeholder>Date Dividers
					<cq-theme-piece-container>
						<cq-theme-piece cq-piece="dd"><cq-swatch></cq-swatch></cq-theme-piece>
					</cq-theme-piece-container>
				</cq-placeholder>
				<cq-placeholder>Axis Text
					<cq-theme-piece-container>
						<cq-theme-piece cq-piece="at"><cq-swatch></cq-swatch></cq-theme-piece>
					</cq-theme-piece-container>
				</cq-placeholder>
			</cq-section>
			<cq-action>
				<input><div stxtap="save()" class="ciq-btn">Save</div>
			</cq-action>
		</cq-scroll>
	`,e.UI.addComponentDefinition("cq-theme-dialog",n)}},Yt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.BaseComponent{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}setBoolean(i){e.UI.containerExecute(this,"setValue",this.piece.obj,this.piece.field,i)}setColor(i){(i=="Hollow"||i=="No Border")&&(i="transparent",this.node.find("cq-swatch")[0].setColor("transparent",!1)),e.UI.containerExecute(this,"setValue",this.piece.obj,this.piece.field,i)}}e.UI.addComponentDefinition("cq-theme-piece",n)},Gt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{connectedCallback(){this.attached||super.connectedCallback()}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}setContext({config:i}){if(!i)return;const{chartId:t,themes:{builtInThemes:s,defaultTheme:a}}=i,o=i.themes.nameValueStore||i.nameValueStore;this.initialize({builtInThemes:s,defaultTheme:a,nameValueStore:o,id:t})}addCustom(i,t){this.params.customThemes[i.name]=i,this.currentThemeSettings=i&&i.settings||i,t===this&&(this.currentTheme=i.name),this.configureMenu(),this.persist()}configureMenu(){function i(u,f){return function(g){u.loadBuiltIn(f),u.params.callback&&u.params.callback({theme:u.currentTheme}),u.persist("current")}}function t(u,f){return function(g){u.loadCustom(f),u.params.callback&&u.params.callback({theme:u.currentTheme}),u.persist("current")}}this.builtInMenu.children(":not(template)").remove(),this.customMenu.children(":not(template)").remove();var s,a,o=this.params.builtInThemes;for(var c in o)s=o[c],a=e.UI.makeFromTemplate(this.builtInTemplate),a.text(s),this.makeTap(a[0],i(this,c)),this.builtInMenu.append(a);if(this.context.stx.translateUI&&this.context.stx.translateUI(this.builtInMenu[0]),this.customMenu.length&&this.customTemplate.length){var h=this.params.customThemes;for(var d in h)s=d,a=e.UI.makeFromTemplate(this.customTemplate),a.find("cq-label").text(s),this.makeTap(a.find("cq-item")[0],t(this,d)),a[0].close=function(u,f){return function(){u.removeTheme(f)}}(this,d),this.customMenu.append(a)}}initialize(i){if(this.initialized)return;this.initialized=!0,this.addDefaultMarkup(),this.selectTemplates(this),this.params={},i&&(this.params=i);const t=o=>typeof o=="function";e.ensureDefaults(this.params,{customThemes:{},builtInThemes:{},nameValueStore:e.NameValueStore&&new e.NameValueStore}),this.params.id&&(this.id="themes_"+this.params.id);let s=this,{nameValueStore:a}=this.params;a?(t(a)&&(a=this.params.nameValueStore=new a),a.get("CIQ.Themes.prototype.custom",(o,c)=>{!o&&c&&(s.params.customThemes=c),a.get(s.id+"CIQ.Themes.prototype.current",(h,d)=>{!h&&d&&d.theme?s.loadTheme(d.theme):s.loadTheme(s.params.defaultTheme),s.configureMenu()})})):this.loadTheme(s.params.defaultTheme)}loadBuiltIn(i){this.currentLoadedBuiltIn&&this.removeThemeClass(this.currentLoadedBuiltIn),this.addThemeClass(i),this.currentLoadedBuiltIn=this.currentTheme=i,this.reinitializeChart()}loadCustom(i){this.currentLoadedBuiltIn&&this.removeThemeClass(this.currentLoadedBuiltIn);var t=this.params.customThemes[i];t.builtIn&&this.addThemeClass(t.builtIn),this.currentLoadedBuiltIn=t.builtIn,this.currentTheme=t.name,this.reinitializeChart(t)}loadTheme(i){this.params.customThemes[i]?this.loadCustom(i):this.params.builtInThemes[i]?this.loadBuiltIn(i):this.loadBuiltIn(this.params.defaultTheme)}get contextContainers(){const i=this.context.topNode;return[i].concat(Array.from(i.querySelectorAll("cq-context")))}addThemeClass(i){this.contextContainers.forEach(t=>{t.currentTheme=i,t.classList.add(i)}),this.context.topNode.setCurrentThemeClass=(t,s)=>{t.classList.add(i),s.setThemeSettings(this.currentThemeSettings)}}removeThemeClass(i){this.contextContainers.forEach(t=>t.classList.remove(i))}newTheme(){const{context:i}=this;i.config?this.channelWrite(i.config.channels.dialog,{type:"theme",params:{context:i,initiatingMenu:this}},i.stx):document.querySelector("cq-theme-dialog").open({context:this.context,initiatingMenu:this})}persist(i){this.params.nameValueStore&&((!i||i=="current")&&this.params.nameValueStore.set(this.id+"CIQ.Themes.prototype.current",{theme:this.currentTheme}),(!i||i=="custom")&&this.params.nameValueStore.set("CIQ.Themes.prototype.custom",this.params.customThemes))}removeTheme(i){var t=!1;this.ownerDocument.querySelectorAll("cq-themes").forEach(function(s){delete s.params.customThemes[i],s.configureMenu(),t||(s.persist(),t=!0)})}selectTemplates(){this.builtInMenu||(this.builtInMenu=this.node.find("cq-themes-builtin"),this.builtInTemplate=this.builtInMenu.find("template"),this.customMenu=this.node.find("cq-themes-custom"),this.customTemplate=this.customMenu.find("template"))}reinitializeChart(i){const t=this.context.topNode.getCharts,{styles:s}=this.context.topNode;s?Object.values(s).forEach(o=>{for(let c in o)delete o[c]}):this.context.topNode.styles={};const a=t?this.context.topNode.getCharts():[this.context.stx];this.currentThemeSettings=i&&i.settings||i,a.forEach(o=>{o&&o.setThemeSettings&&o.setThemeSettings(i?i.settings:null)})}}n.markup=`
		<cq-themes-builtin cq-no-close>
			<template>
				<cq-item></cq-item>
			</template>
		</cq-themes-builtin>
		<cq-themes-custom cq-no-close>
			<template>
				<cq-theme-custom>
					<cq-item>
						<cq-label></cq-label>
						<cq-close keyboard-selectable-child="true"></cq-close>
					</cq-item>
				</cq-theme-custom>
			</template>
		</cq-themes-custom>
		<cq-item stxtap="newTheme()"><cq-plus></cq-plus>New Theme</cq-item>
	`,e.UI.addComponentDefinition("cq-themes",n)},Xt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;if(!e.timeZoneMap)console.error("timezoneDialog component requires first activating timezone feature.");else{class n extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}open(i){this.addDefaultMarkup(),super.open(i);var t=this.node;this.context=i.context;var s=this.context.stx;function a(y){return function(m){var v=e.timeZoneMap[y];e.ChartEngine.defaultDisplayTimeZone=v,s.setTimeZone(s.dataZone,v),s.chart.symbol&&s.draw(),g()}}var o=t.find("ul, .ciq-ul"),c=t.find(".ciq-btn");this.template||(this.template=o.find("li.timezoneTemplate")[0].cloneNode(!0)),o.empty();for(var h in e.timeZoneMap){var d=h,u=s.translateIf(d),f=this.template.cloneNode(!0);f.style.display="block",f.innerHTML=u,e.safeClickTouch(f,a(d)),o.append(f)}g();function g(){var y=t.find(".currentUserTimeZone");if(s.displayZone){var m=s.displayZone;for(var v in e.timeZoneMap)e.timeZoneMap[v]===s.displayZone&&(m=v);y.text(s.translateIf("Current Timezone is")+" "+s.translateIf(m)),c.show()}else y.text(s.translateIf("Your timezone is your current location")),c.hide()}}removeTimezone(){e.ChartEngine.defaultDisplayTimeZone=null;var i=this.context.stx;i.displayZone=null,i.setTimeZone(),i.displayInitialized&&i.draw(),this.close()}}n.markup=`
		<h4 class="title">Choose Timezone</h4>
		<cq-close></cq-close>

		<p>To set your timezone use the location button below, or scroll through the following list...</p>
		<p class="currentUserTimeZone"></p>
		<div class="detect">
			<div class="ciq-btn" stxtap="removeTimezone()">Use My Current Location</div>
		</div>
		<div class="timezoneDialogWrapper" style="max-height:360px; overflow: hidden;">
			<cq-scroll cq-no-maximize class="ciq-ul" style="height:360px;">
				<li class="timezoneTemplate" style="display:none;cursor:pointer;"></li>
			</cq-scroll>
		</div>
		<div class="instruct">(Scroll for more options)</div>
	`,e.UI.addComponentDefinition("cq-timezone-dialog",n)}},Zt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{constructor(){super(),this.params={member:null,obj:null,action:"class",value:"active",toggles:[],classes:{},callbacks:[]}}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}disconnectedCallback(){this.disconnectObservable(),super.disconnectedCallback()}disconnectObservable(){const{params:{member:i,obj:t},listener:s}=this;i&&t&&s&&e.UI.unobserveProperty(i,t,s)}begin(){const i=this;this.params.member&&(this.listener=function(t){i.updateFromBinding(i.params)},e.UI.observeProperty(i.params.member,i.params.obj,this.listener)),!this.tapInitialized&&(e.UI.stxtap(this,function(){var t=i.params.toggles,s=i.params.obj;if(t.length>1){for(var a=0;a<t.length;a++){var o=t[a];if(i.currentValue==o){a<t.length-1?i.set(t[a+1]):i.set(t[0]);break}}a==t.length&&i.set(t[0])}else i.currentValue?i.set(!1):i.set(!0);const{stx:c}=this.context;c.draw(),s===c.layout&&c.changeOccurred("layout"),s===c.preferences&&c.changeOccurred("preferences")}),this.tapInitialized=!0)}registerCallback(i,t){t!==!1&&(t=!0),this.params.callbacks.push(i),t&&i.call(this,this.currentValue)}set(i){if(this.isInfoToggle)return this.parentElement.set(i);if(this.params.member){if(this.context&&this.context.topNode.getCharts&&this.hasAttribute("cq-multichart-distribute")){let s=this.context.topNode.getCharts(),a=null;this.params.obj===this.context.stx.layout&&(a="layout"),this.params.obj===this.context.stx.preferences&&(a="preferences"),a&&s.forEach(o=>{o[a][this.params.member]=i,o!==this.context.stx&&o.changeOccurred(a)})}this.params.obj[this.params.member]=i}else{this.currentValue=i;for(var t=0;t<this.params.callbacks.length;t++)this.params.callbacks[t].call(this,this.currentValue)}this.updateClass()}setContext({config:i}){this.currentValue|=!1,this.params.obj=this.context.stx.layout;var t=this.node.attr("cq-member");if(t=="headsUp"&&this.wrapInInfoToggle(),i&&i.channels&&i.channels[t]&&(t=i.channels[t]),t&&t.indexOf(".")!==-1){var s=t.split(".");this.params.obj=this.context.stx[s[0]],typeof this.params.obj=="undefined"&&(this.context.stx[s[0]]=this.params.obj={}),t=s[1]}t&&(this.params.member=t);var a=this.node.attr("cq-action");a&&(this.params.action=a);var o=this.node.attr("cq-value");o&&(this.params.value=o);var c=this.node.attr("cq-toggles");c&&(this.params.toggles=c.split(","));for(var h=0;h<this.params.toggles.length;h++){c=this.params.toggles;var d=c[h];d==="null"?c[h]=null:d==="true"||d==="false"?c[h]=d==="true":isNaN(Number(d))||(c[h]=Number(d))}var u=this.node.attr("cq-toggle-classes");if(u){var f=u.split(/, |,/);this.params.removeClasses=u.split(/, | |,/).filter(g=>g),this.params.classes=this.params.toggles.reduce(function(g,y,m){return g[y]=f[m].split(/ /),g},{})}if(t&&this.params.obj[t]===void 0){const g=c&&c.length?c[c.length-1]:!1;this.params.obj[t]=g}this.begin()}changeContext(i){this.disconnectObservable(),this.context=i,this.setContext(i)}updateFromBinding(i){if(this.currentValue=this.isInfoToggle?this.parentElement.getCurrentValue(i):i.obj[i.member],!this.params.callbacks.length)this.params.action=="class"&&(this.currentValue?this.node.addClass(this.params.value):this.node.removeClass(this.params.value));else for(var t=0;t<this.params.callbacks.length;t++)this.params.callbacks[t].call(this,this.currentValue);this.updateClass(),i.member=="crosshair"&&this.currentValue===!1&&this.context.stx.doDisplayCrosshairs()}updateClass(){const{removeClasses:i,classes:t}=this.params;if(!(!i||this.currentValue===void 0)&&(this.classList.remove(...i),t[this.currentValue][0])){let s=t[this.currentValue];this.classList.add(...s)}}wrapInInfoToggle(){if(!this.closest("cq-info-toggle, cq-info-toggle-dropdown")){var i=document.createElement("cq-info-toggle");this.parentNode.replaceChild(i,this),i.appendChild(this)}}}e.UI.addComponentDefinition("cq-toggle",n)},Jt=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;if(!e.Drawing)console.error("toolbar component requires first activating drawing feature.");else{class n extends e.UI.ContextTag{connectedCallback(){this.attached||(super.connectedCallback(),this.params={toolSelection:this.node.find("*[cq-current-tool]"),lineSelection:this.node.find("*[cq-line-style]"),fontSizeSelection:this.node.find("*[cq-font-size]"),fontFamilySelection:this.node.find("*[cq-font-family]"),fontStyleToggle:this.node.find("cq-annotation-italic"),fontWeightToggle:this.node.find("cq-annotation-bold"),axisLabelToggle:this.node.find("cq-axis-label .ciq-checkbox"),fillColor:this.node.find("cq-fill-color").not("cq-cvp-controller"),lineColor:this.node.find("cq-line-color").not("cq-cvp-controller"),cvpControllers:this.node.find("cq-cvp-controller")},this.params.cvpControllers.prop("toolbar",this),this.noToolSelectedText="")}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}clearDrawings(){this.context.stx.clearDrawings(null,!1)}crosshairs(i){var t=e.UI.$(i.node),s=this.context.stx;this.params.toolSelection.html(t.html()),s.changeVectorType(null),s.layout.crosshair=!0,s.doDisplayCrosshairs(),s.findHighlights(!1,!0),s.changeOccurred("layout"),s.draw(),s.updateChartAccessories(),this.node.find("*[cq-section]").removeClass("ciq-active"),this.emit()}defaultElements(i){var t=[];for(var s in i)s=="color"?t.push("cq-line-color"):s=="fillColor"?t.push("cq-fill-color"):s=="pattern"||s=="lineWidth"?t.push("cq-line-style"):s=="axisLabel"?t.push("cq-axis-label"):s=="font"?t.push("cq-annotation"):s=="parameters"&&t.push("cq-clickable");return t}dirty(i){this.node.find("*[cq-toolbar-dirty]")[i===!1?"removeClass":"addClass"]("ciq-active")}emit(){var i=new Event("change",{bubbles:!0,cancelable:!0});this.dirty(),this.dispatchEvent(i)}getFillColor(i){var t=e.UI.$(i.node),s=this.context.stx.currentVectorParameters.fillColor;(s=="transparent"||s=="auto")&&(s=""),t.css({background:s});var a=e.getBackgroundColor(this.parentNode);if(s&&Math.abs(e.hsl(a)[2]-e.hsl(s)[2])<.2){var o=e.chooseForegroundColor(a);t.css({border:"solid "+o+" 1px"})}else t.css({border:""})}getLineColor(i){var t=e.UI.$(i.node),s=this.context.stx.currentVectorParameters.currentColor;(s=="transparent"||s=="auto")&&(s=""),t.css({background:s});var a=e.getBackgroundColor(this.parentNode);if(!s||Math.abs(e.hsl(a)[2]-e.hsl(s)[2])<.2){var o=e.chooseForegroundColor(a);t.css({border:"solid "+o+" 1px"}),s||t.css({background:"linear-gradient(to bottom right, "+o+", "+o+" 49%, "+a+" 50%, "+a+")"})}else t.css({border:""})}noTool(){var i=this.context.stx;i.changeVectorType(""),i.layout.crosshair&&(i.layout.crosshair=!1,i.changeOccurred("layout"),i.doDisplayCrosshairs()),this.params.toolSelection.text(this.noToolSelectedText),this.params.toolSelection.attr("cq-current-tool",""),this.node.find("*[cq-section]").removeClass("ciq-active"),this.emit()}pickFillColor(i){var t=e.UI.$(i.node),s=this.ownerDocument.querySelector("cq-color-picker");if(!s){console.log("DrawingToolbar.prototype.pickFillColor: no ColorPicker available");return}var a=this;s.callback=function(o){a.context.stx.currentVectorParameters.fillColor=o,a.getFillColor({node:t}),a.emit()},s.display({node:t,context:this.context})}pickLineColor(i){var t=e.UI.$(i.node),s=this.ownerDocument.querySelector("cq-color-picker");if(!s){console.log("DrawingToolbar.prototype.pickLineColor: no ColorPicker available");return}var a=this;s.callback=function(c){a.context.stx.currentVectorParameters.currentColor=c,a.getLineColor({node:t}),a.emit()};var o=t.attr("cq-overrides");o&&(o=o.split(",")),s.display({node:t,context:this.context,overrides:o})}restoreDefaultConfig(i,t){var s=this.context.stx;e.Drawing.restoreDefaultConfig(s,s.currentVectorParameters.vectorType,t),this.node.find("*[cq-toolbar-action='restore']").removeClass("ciq-active"),this.sync(),this.dirty(!1)}saveConfig(){var i=this.context.stx;e.Drawing.saveConfig(i,i.currentVectorParameters.vectorType),this.node.find("*[cq-toolbar-action='restore']").addClass("ciq-active"),this.sync(),this.dirty(!1)}setFibs(i,t){var s=this.context.stx.currentVectorParameters.fibonacci;if(s){for(var a=0;a<s.fibs.length;a++)s.fibs[a].parameters.lineWidth=i,s.fibs[a].parameters.pattern=t;s.timezone.parameters.lineWidth=i,s.timezone.parameters.pattern=t}}setFontFamily(i,t){var s=this.context.stx;s.currentVectorParameters.annotation&&(t=="Default"?s.currentVectorParameters.annotation.font.family=null:s.currentVectorParameters.annotation.font.family=t),this.params.fontFamilySelection.text(t),this.emit()}setFontSize(i,t){var s=this.context.stx;s.currentVectorParameters.annotation&&(s.currentVectorParameters.annotation.font.size=t),this.params.fontSizeSelection.text(t),this.emit()}setContext(i){this.noToolSelectedText=this.params.toolSelection.text(),this.sync(),this.dirty(!1);var t=this;this.eventListeners.push(i.stx.addEventListener("theme",function(s){var a=t.node.find("*[cq-toolbar-dirty]").hasClass("ciq-active");t.sync(),a||t.dirty(!1)}))}setLine(i,t,s){var a=this.context.stx;a.currentVectorParameters.lineWidth=t,a.currentVectorParameters.pattern=s,this.setFibs(t,s),this.currentLineSelectedClass&&this.params.lineSelection.removeClass(this.currentLineSelectedClass),this.currentLineSelectedClass="ciq-"+s+"-"+parseInt(t,10),s=="none"?this.currentLineSelectedClass=null:this.params.lineSelection.addClass(this.currentLineSelectedClass),this.emit()}sync(i){var t=this.context.stx;i?t.currentVectorParameters=e.extend(t.currentVectorParameters||{},i):i=t.currentVectorParameters;var s=this.params;this.setLine(null,i.lineWidth,i.pattern);var a=t.canvasStyle("stx_annotation"),o=i.annotation&&i.annotation.font,c=o&&o.size||a.fontSize;this.setFontSize(null,c);var h=o&&o.family||a.fontFamily;this.setFontFamily(null,h);var d=o&&o.style||a.fontStyle;s.fontStyleToggle[d==="italic"?"addClass":"removeClass"]("ciq-active");var u=o&&o.weight||a.fontWeight;s.fontWeightToggle[u==="bold"||u>=700?"addClass":"removeClass"]("ciq-active"),s.axisLabelToggle[i.axisLabel?"addClass":"removeClass"]("ciq-active"),this.getFillColor({node:s.fillColor}),this.getLineColor({node:s.lineColor}),s.cvpControllers.each(function(){this.sync(i)})}toggleAxisLabel(i){var t=this.context.stx,s=e.UI.$(i.node);t.currentVectorParameters.axisLabel===!0?(t.currentVectorParameters.axisLabel=!1,s.removeClass("ciq-active")):(t.currentVectorParameters.axisLabel=!0,s.addClass("ciq-active")),this.emit()}toggleFontStyle(i,t){var s=this.context.stx,a=e.UI.$(i.node);t=="italic"?s.currentVectorParameters.annotation.font.style=="italic"?(s.currentVectorParameters.annotation.font.style=null,a.removeClass("ciq-active")):(s.currentVectorParameters.annotation.font.style="italic",a.addClass("ciq-active")):t=="bold"&&(s.currentVectorParameters.annotation.font.weight=="bold"?(s.currentVectorParameters.annotation.font.weight=null,a.removeClass("ciq-active")):(s.currentVectorParameters.annotation.font.weight="bold",a.addClass("ciq-active"))),this.emit()}toggleMagnet(i){var t=e.UI.$(i.node),s=this.context.stx;s.preferences.magnet?(t.removeClass("active"),s.preferences.magnet=!1):(t.addClass("active"),s.preferences.magnet=!0),e.clearCanvas(s.chart.tempCanvas,s)}tool(i,t){var s=e.UI.$(i.node);if(t||(t=s.getAttribute("cq-tool")),!!t){var a=this.context.stx;a.clearMeasure(),a.changeVectorType(t),this.params.toolSelection.html(s.html()),this.params.toolSelection.attr("cq-current-tool",t),this.node.find("*[cq-section]").removeClass("ciq-active");var o=!this.node.find("*[cq-toolbar-dirty]").hasClass("ciq-active"),c=e.Drawing.getDrawingParameters(a,t);if(c){this.node.find("*[cq-toolbar-action='save']").addClass("ciq-active");var h=a.preferences.drawings;h&&h[t]&&(this.node.find("*[cq-toolbar-action='restore']").addClass("ciq-active"),o=!0),t==="fibtimezone"&&delete c.parameters;var d=this.params.lineSelection.parent().find(".ciq-none");d.hide();for(var u=this.defaultElements(c),f=0;f<u.length;f++)this.node.find(u[f]).addClass("ciq-active"),u[f]=="cq-fill-color"&&d.show();if(u=e.Drawing[t].prototype.$controls,u)for(f=0;f<u.length;f++)this.node.find(u[f]).addClass("ciq-active")}this.sync(),o&&this.dirty(!1)}}}e.UI.addComponentDefinition("cq-toolbar",n)}},ei=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{constructor(){super(),this.redoButton=null,this.undostack=[],this.redostack=[],this.contexts=[]}connectedCallback(){if(!this.attached){super.connectedCallback();var i=this;e.UI.stxtap(this,function(){i.undo()})}}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}disconnectedCallback(){this.removeClaim(this),super.disconnectedCallback()}clear(i){this.setButtonStyle()}handleEvent(i,t,s){this.undostack.push({context:i,drawings:s.before}),this.redostack=[],this.setButtonStyle()}keyStroke(i,t,s,a){if(t=="z"&&(a.ctrl||a.cmd))return a.shift?this.redo():this.undo(),!0;if(t=="y"&&(a.ctrl||a.cmd))return this.redo(),!0}manageContext(i){this.addClaim(this);var t=this;this.eventListeners.push(i.stx.addEventListener("undoStamp",function(s){t.handleEvent(i,"undoStamp",s)})),this.contexts.push(i)}redo(){var i=this.redostack.pop();if(i){var t=i.context;this.undostack.push({context:t,drawings:t.stx.exportDrawings()});var s=i.drawings;t.stx.abortDrawings(!0),t.stx.importDrawings(s),t.stx.changeOccurred("vector"),t.stx.draw()}this.setButtonStyle()}setButtonStyle(){this.undostack.length?this.node.attr("cq-active","true"):this.node.removeAttr("cq-active"),this.redoButton&&(this.redostack.length?this.redoButton.setAttribute("cq-active","true"):this.redoButton.removeAttribute("cq-active"))}setContext(i){let t=[this.context];this.context.topNode.getCharts&&(t=this.context.topNode.getCharts().map(o=>o.uiContext)),t.forEach(a=>{this.manageContext(a)});var s=this;this.addInjection("append","initializeChart",function(){s.undostack=[],s.redostack=[],s.clear()})}undo(){for(var i=!1,t=0;t<this.contexts.length;t++)this.contexts[t].stx.activeDrawing&&(this.contexts[t].stx.undo(),i=!0);if(!i){var s=this.undostack.pop();if(s){var a=s.context;this.redostack.push({context:a,drawings:a.stx.exportDrawings()});var o=s.drawings;a.stx.abortDrawings(!0),a.stx.importDrawings(o),a.stx.changeOccurred("vector"),a.stx.draw()}this.setButtonStyle()}}}e.UI.addComponentDefinition("cq-undo",n)},ti=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}open(i){this.addDefaultMarkup(),this.querySelector("input").value="",super.open(i)}save(){const i=this.node.find("input").val();if(!i)return;let t=!1;this.updateContext();const s=this.context.stx.exportLayout();this.ownerDocument.querySelectorAll("cq-views").forEach(function(a){const o=a.params.viewObj;let c;for(var h=0;h<o.views.length&&(c=o.views[h],i!=e.first(c));h++);h==o.views.length&&(c={},c[i]={},o.views.push(c)),c[i]=s,delete c[i].candleWidth,a.renderMenu(),t||(t=!0,a.params.nameValueStore&&a.params.nameValueStore.set("stx-views",o.views))}),this.close()}updateContext(){const{topNode:i}=this.context;let t=i.querySelector("cq-context-wrapper.active cq-context");t||i.multiChartContainer&&(t=i.multiChartContainer.querySelector("cq-context-wrapper.active cq-context")),t&&(this.context=t.CIQ.UI.context)}}n.markup=`
		<h4>Save View</h4>
		<div stxtap="close()" class="ciq-icon ciq-close"></div>
		<div style="text-align:center;margin-top:10px;">
		<i>Enter name of view:</i>
		<p>
			<input spellcheck="false" autocomplete="off" autocorrect="off" autocapitalize="none" maxlength="40" placeholder="Name"><br>
		</p>
		<span class="ciq-btn" stxtap="save()">Save</span>
		</div>
	`,e.UI.addComponentDefinition("cq-view-dialog",n)},ii=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{initialize(i){this.params=Object.assign({},i);const{config:t}=this.context;let{nameValueStore:s}=t;e.ensureDefaults(this.params,{viewObj:{views:[]},nameValueStore:s&&new s||e.NameValueStore&&new e.NameValueStore,template:"template[cq-view]"}),this.params.template=this.querySelector(this.params.template);var a=this;this.params.nameValueStore&&this.params.nameValueStore.get("stx-views",function(o,c){!o&&c&&(a.params.viewObj.views=c),a.params.cb&&a.params.cb.call(a),a.renderMenu()})}connectedCallback(){super.connectedCallback()}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}setContext({config:i}){this.addDefaultMarkup(),i&&i.menuViewConfig&&this.initialize(i.menuViewConfig)}renderMenu(){var i=this.node,t=this;function s(g){return function(y){y.stopPropagation();var m=!1;t.ownerDocument.querySelectorAll("cq-views").forEach(function(v){v.params.viewObj.views.splice(g,1),m||(v.params.nameValueStore&&v.params.nameValueStore.set("stx-views",t.params.viewObj.views),m=!0),v.renderMenu()})}}function a(g){return function(y){y.stopPropagation(),t.uiManager.closeMenu(),t.context.loader&&t.context.loader.show();var m=e.first(t.params.viewObj.views[g]);function v(){var b=t.context.stx,q=function(){b.changeOccurred("layout"),t.context.loader&&t.context.loader.hide()};b.importLayout(t.params.viewObj.views[g][m],{managePeriodicity:!0,preserveTicksAndCandleWidth:!0,cb:q})}setTimeout(v,10)}}i.find("cq-views-content cq-item").remove();for(var o=0;o<this.params.viewObj.views.length;o++){var c=e.first(t.params.viewObj.views[o]);if(c!="recent"){var h=e.UI.makeFromTemplate(this.params.template),d=h.find("cq-label"),u=h.find("div");d.length&&(d.addClass("view-name-"+c),d.text(c)),u.length&&e.UI.stxtap(u[0],s(o)),this.makeTap(h[0],a(o)),i.find("cq-views-content").append(h)}}var f=i.find("cq-view-save");if(f){const{context:g}=this,y=this;this.makeTap(f.find("cq-item")[0],function(m){g.config?y.channelWrite(g.config.channels.dialog,{type:"view",params:{context:g}}):y.ownerDocument.querySelector("cq-view-dialog").open({context:g});const v=e.UI.getUIManager(this),b=g.topNode.querySelector(".ciq-views");v&&b&&v.closeMenu(b)})}this.params.renderCB&&this.params.renderCB(i)}}n.markup=`
		<cq-heading>Saved Views</cq-heading>
		<cq-views-content>
			<template cq-view>
				<cq-item>
					<cq-label></cq-label>
					<div class="ciq-icon ciq-close" keyboard-selectable-child="true"></div>
				</cq-item>
			</template>
		</cq-views-content>
		<cq-separator cq-partial></cq-separator>
		<cq-view-save>
			<cq-item><cq-plus></cq-plus>Save View</cq-item>
		</cq-view-save>
	`,e.UI.addComponentDefinition("cq-views",n)},si=l=>{const e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n),this.constructor=n}open(i){this.addDefaultMarkup(),super.open(i),i&&(this.opener=i.caller);const{currentVectorParameters:t}=this.context.stx;t.volumeprofile||(t.volumeprofile={});const s=t.volumeProfile,a=this.querySelector('div[fieldname="Price Buckets"] input');a.value=s.priceBuckets,a.changeHandler&&a.removeEventListener("change",a.changeHandler),a.changeHandler=({target:o})=>{const c=parseInt(o.value);if(isNaN(c))return;s.priceBuckets=c;const h=new Event("change",{bubbles:!0,cancelable:!0});this.opener.dispatchEvent(h)},a.addEventListener("change",a.changeHandler)}}n.markup=`
	<h4 class="title">Volume Profile Settings</h4>
	<cq-scroll cq-no-maximize>
		<div class="ciq-drawing-dialog-setting" fieldname="Price Buckets">
			<div class="ciq-heading">Price Buckets</div>
			<div class="stx-data">
				<input type="number" min="1" step="1">
			</div>
		</div
	</cq-scroll>
	<div class="ciq-dialog-cntrls">
		<div class="ciq-btn" stxtap="close()">Done</div>
	</div>
`,e.UI.addComponentDefinition("cq-volumeprofile-settings-dialog",n)},ni=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n extends e.UI.ContextTag{static get observedAttributes(){return["corrective","decoration","impulse","show-lines","template"]}static templates(){return{"Grand Supercycle":{impulse:["I","II","III","IV","V"],corrective:["a","b","c"],decoration:"enclosed"},Supercycle:{impulse:["I","II","III","IV","V"],corrective:["a","b","c"],decoration:"parentheses"},Cycle:{impulse:["I","II","III","IV","V"],corrective:["a","b","c"],decoration:null},Primary:{impulse:["1","2","3","4","5"],corrective:["A","B","C"],decoration:"enclosed"},Intermediate:{impulse:["1","2","3","4","5"],corrective:["A","B","C"],decoration:"parentheses"},Minor:{impulse:["1","2","3","4","5"],corrective:["A","B","C"],decoration:null},Minute:{impulse:["i","ii","iii","iv","v"],corrective:["a","b","c"],decoration:"enclosed"},Minuette:{impulse:["i","ii","iii","iv","v"],corrective:["a","b","c"],decoration:"parentheses"},"Sub-Minuette":{impulse:["i","ii","iii","iv","v"],corrective:["a","b","c"],decoration:null}}}handlePropertyChange(i,t,s){if(!this.stx)return;let a=this.stx.currentVectorParameters,o=a.waveParameters||{},c;switch(i){case"template":let h=this.templates[s];h&&(c={decoration:h.decoration});break;case"impulse":c={impulse:s&&JSON.parse(s)};break;case"corrective":c={corrective:s&&JSON.parse(s)};break;case"decoration":c={decoration:s};break;case"show-lines":c={showLines:s};break}a.waveParameters=Object.assign(o,c)}constructor(){super(),this.templates=n.templates()}connectedCallback(){if(!this.attached){this.template="Grand Supercycle";var i=this.ownerDocument.querySelector('template[cq-wave-parameters], template[cq-wave-parameters="true"]');e.UI.makeFromTemplate(i,this),this.templateHeader=this.querySelector(".ciq-active-template"),this.impulseHeader=this.querySelector(".ciq-active-impulse"),this.correctiveHeader=this.querySelector(".ciq-active-corrective"),this.decorators={blank:this.querySelector(".ciq-btn:nth-of-type(1n)"),parentheses:this.querySelector(".ciq-btn:nth-of-type(2n)"),enclosed:this.querySelector(".ciq-btn:nth-of-type(3n)")},this.lineToggleCheckbox=this.querySelector("span.ciq-checkbox"),super.connectedCallback()}}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,n)}activate(){const{stx:i}=this;i&&(this.cvp=i.currentVectorParameters,this.cvp.waveParameters||(this.template="Grand Supercycle"),this.update(null,"template",this.template))}setContext(){this.stx=this.context.stx}toggleLines(){let i=this.lineToggleCheckbox,t=this["show-lines"];this["show-lines"]=!t,t?i.classList.remove("ciq-active"):i.classList.add("ciq-active")}update(i,t,s){if(t==="template"){this.template=s,this.templateHeader.innerHTML=s;let o=this.templates[this.template];if(o){this.impulse=JSON.stringify(o.impulse),this.impulseHeader.innerHTML=o.impulse.join(" "),this.corrective=JSON.stringify(o.corrective),this.correctiveHeader.innerHTML=o.corrective.join(" ");for(let h in this.decorators)this.decorators[h].classList.remove("ciq-active");let c=o.decoration||"blank";this.decorators[c].classList.add("ciq-active"),this.decoration=c,this["show-lines"]=!0,this.lineToggleCheckbox.classList.add("ciq-active"),this.cvp.waveParameters=e.clone(o),this.cvp.waveParameters.showLines=!0}else this.cvp.waveParameters={corrective:this.corrective,impulse:this.impulse,decoration:this.decoration,showLines:this["show-lines"]}}else{if(t==="decoration"){for(let o in this.decorators)this.decorators[o].classList.remove("ciq-active");i.node.classList.add("ciq-active"),this.decoration=i.node.getAttribute("decoration")}else if(t==="impulse"||t==="corrective"){let o=s&&s.split(",");this[t]=o,this[t+"Header"].innerHTML=o?o.join(" "):"- - -"}this.templateHeader.innerHTML=this.template="Custom"}}}e.UI.addComponentDefinition("cq-wave-parameters",n)},ai=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;const n=e.UI._webcomponents.list["cq-dialog"];if(!n)console.error("colorPicker component requires first activating dialog component.");else{class r extends n.classDefinition{constructor(){super(),this.params={colorMap:[["#ffffff","#e1e1e1","#cccccc","#b7b7b7","#a0a0a5","#898989","#707070","#626262","#555555","#464646","#363636","#262626","#1d1d1d","#000000"],["#f4977c","#f7ac84","#fbc58d","#fff69e","#c4de9e","#85c99e","#7fcdc7","#75d0f4","#81a8d7","#8594c8","#8983bc","#a187bd","#bb8dbe","#f29bc1"],["#ef6c53","#f38d5b","#f8ae63","#fff371","#acd277","#43b77a","#2ebbb3","#00bff0","#4a8dc8","#5875b7","#625da6","#8561a7","#a665a7","#ee6fa9"],["#ea1d2c","#ee652e","#f4932f","#fff126","#8ec648","#00a553","#00a99c","#00afed","#0073ba","#0056a4","#323390","#66308f","#912a8e","#e9088c"],["#9b0b16","#9e4117","#a16118","#c6b920","#5a852d","#007238","#00746a","#0077a1","#004c7f","#003570","#1d1762","#441261","#62095f","#9c005d"],["#770001","#792e03","#7b4906","#817a0b","#41661e","#005827","#005951","#003b5c","#001d40","#000e35","#04002c","#19002b","#2c002a","#580028"]]}}connectedCallback(){this.attached||(super.connectedCallback(),this.build())}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,r),this.constructor=r}build(){this.addDefaultMarkup();var t=this.node,s=t.attr("cq-colors");if(s){s=s.split(",");var a=Math.ceil(Math.sqrt(s.length));this.params.colorMap=[];for(var o=0,c=[],h=0;h<s.length;h++)o>=a&&(o=0,this.params.colorMap.push(c),c=[]),c.push(s[h]),o++;this.params.colorMap.push(c)}this.cqOverrides=t.find("cq-overrides"),this.template=this.cqOverrides.find("template"),this.initialize()}display(t){var s=e.UI.$(t.node)[0],a=s.getBoundingClientRect();this.node.css({top:"0px",left:"0px"});var o=this.parentNode.getBoundingClientRect(),c=e.elementDimensions(s,{border:!0}),h=a.left-o.left+c.width+10,d=a.top-o.top+15;this.cqOverrides.children(":not(template)").remove();var u=t.context||this.context||e.UI.getMyContext(this);this.uiManager=u.uiManager||e.UI.getUIManager(this);var f=function(k,T){return function(){k.pickColor(T)}},g=0;if(t.overrides&&this.template.length){for(var y,m=0;m<t.overrides.length;m++){var v=t.overrides[m];y=e.UI.makeFromTemplate(this.template,!0),u.stx&&(v=u.stx.translateIf(v)),y.text(v),e.UI.stxtap(y[0],f(this,v=="none"?"transparent":v))}g=e.elementDimensions(y[0]).height}var b=e.elementDimensions(this,{border:!0}),q=this.ownerDocument||document,x=e.guaranteedSize(q).width,w=b.width||c.width*this.colors.children()[0].children.length;h+w>x&&(h=x-w-20);var C=e.guaranteedSize(q).height,S=b.height||c.height*this.colors.children().length+g;d+S>C&&(d=C-S-30),this.node.css({left:h+"px",top:d+"px"}),this.classList.contains("stxMenuActive")?u.e&&u.e.stopPropagation():this.open({context:u}),this.keyboardNavigation&&this.keyboardNavigation.highlightAlign()}initialize(){var t=this;this.colors=this.node.find("cq-colors"),this.colors.length||(this.colors=this.node),this.colors.empty();function s(f,g){return function(){f.pickColor(g)}}for(var a=0;a<this.params.colorMap.length;a++){var o=this.params.colorMap[a],c=document.createElement("ul");this.colors[0].appendChild(c);for(var h=0;h<o.length;h++){var d=document.createElement("li");c.appendChild(d);var u=document.createElement("span");d.appendChild(u),u.style.backgroundColor=o[h],e.UI.stxtap(u,s(t,o[h]))}}this.rowLength=this.params.colorMap[0].length||0}keyStroke(t,s,a){if(t&&t.tabActiveModals[0]!==this)return;const o=this.querySelectorAll("cq-colors span, .ciq-btn");if(!(s==="Escape"||s==="Esc")){if(s==="ArrowRight")this.focusNextItem(o);else if(s==="ArrowLeft")this.focusNextItem(o,!0);else if(s==="ArrowDown")this.focusNextRow(o);else if(s==="ArrowUp")this.focusNextRow(o,{reverse:!0});else if(s=="Enter"){const c=this.findFocused(o);this.clickItem(c[0],a)}}}focusNextRow(t,s){const{reverse:a}=s||{},o=this.findFocused(t);let c=-1;if(o.length)for(c=0;c<t.length&&t[c]!==o[0];c++);if(a)do if(c-=this.rowLength,c<0)break;while(!e.trulyVisible(t[c]));else do if(c+=this.rowLength,c>=t.length){c=t.length-1;break}while(!e.trulyVisible(t[c]));return c>-1&&c<t.length&&t[c]!==o[0]?(this.removeFocused(t),this.focusItem(t[c]),!0):!1}pickColor(t){this.callback&&this.callback(t),this.close()}resize(){}setColors(t){this.params.colorMap=t,this.initialize()}}r.markup=`
		<cq-colors></cq-colors>
		<cq-overrides>
			<template>
				<div class="ciq-btn"></div>
			</template>
		</cq-overrides>
	`,e.UI.addComponentDefinition("cq-color-picker",r)}},oi=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;const n=e.UI._webcomponents.list["cq-palette"];if(!n)console.error("drawingPalette component requires first activating palette component.");else if(!e.Drawing)console.error("drawingPalette component requires first activating drawing feature.");else{class r extends n.classDefinition{constructor(){super(),this.mode="",this.callbacks=[],this.toolSettings={favList:[],toolGroup:""},this.toolGroups=[],this.groupedTools={},this.toolShortcuts={}}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,r),this.constructor=r}disconnectedCallback(){this.removeClaim(this),super.disconnectedCallback()}setupKeyboardActivation(t){if(typeof this.getAttribute("cq-keystroke-claim")!="undefined"){let s=this.context.topNode.querySelectorAll("*[cq-tool][cq-tool-shortcut]");for(let a=0;a<s.length;a++){let o=s[a].getAttribute("cq-tool-shortcut");if(/^[A-Za-z0-9]{1}$/g.test(o)){this.toolShortcuts[o.toUpperCase()]={toolName:s[a].getAttribute("cq-tool"),node:s[a]};let c=s[a].querySelector("label"),h=document.createElement("span");h.classList.add("shortcut"),h.innerHTML=" (Alt+"+o.toUpperCase()+")",c.appendChild(h)}else console.warn("cq-tool-shortcut attribute must be a single letter: "+o+" ignored.")}this.addClaim(this)}}keyStroke(t,s,a,o){if(a.altKey&&!a.ctrlKey&&!a.shiftKey){s=a.code.replace(/^(Key|Digit|Numpad)/,"");let c=this.toolShortcuts[s.toUpperCase()];if(c){const h=this.channels?this.channels.drawing:"channel.drawing";this.channelWrite(h,!0),this.tool({node:c.node},c.toolName)}}else if(a.key==="Escape"){let c=this.context.topNode.querySelector('*[cq-tool="notool"]');c&&this.noTool({node:c})}}handleMessage(t,s){switch(t){case"changeToolSettings":this.activateTool(s.activator,s.toolName);break;case"toggleDrawingPalette":this.togglePalette();break;case"hideDrawingPalette":this.hidePalette();break;case"dockWillResize":this.hidePalette();break;case"dockDidResize":this.resetScroller();break;case"context":s==="stop"&&(this.toolContextMenu.style.display="none")}}loadToolSettings(){if(this.store){let t=this;this.store.get("CIQ.DrawingToolSettings",function(s,a){!s&&a&&a.favList&&(t.toolSettings=Object.assign(t.toolSettings,a))})}}storeToolSettings(){this.store&&this.store.set("CIQ.DrawingToolSettings",JSON.stringify(this.toolSettings))}setContext(t){const{config:s,stx:a}=t;if(s){const{channels:o={},drawingToolGrouping:c=[],nameValueStore:h}=s,{groupedTools:d}=this;s.drawingTools&&(s.drawingTools=s.drawingTools.filter(({tool:u})=>e.Drawing[u])).forEach(u=>{let f=u.group;d[f]=d[f]?[...d[f],u]:[u]}),this.toolGroups=c||[],this.store=h&&new h||e.NameValueStore&&new e.NameValueStore,this.addDefaultMarkup(this,this.getMarkup(s)),this.channels={drawing:o.drawing||"channel.drawing"}}this.init(),this.loadToolSettings(),this.params={toolGroupSelection:this.node.find("*[cq-tool-group-selection]")},this.setFavorites(),this.setMode("grid"),this.setEvenOdd(),this.toolContextMenu=this.createContextMenu(),this.addEventListener("contextmenu",function(o){const c=o.target.hasAttribute("cq-tool-group")?o.target:o.target.parentElement;if(o.preventDefault(),c!==null&&c.getAttribute("cq-tool-group")!==null){let h=c.getBoundingClientRect(),d=this.getBoundingClientRect();this.showToolContextMenu(c.getAttribute("cq-tool"),o.clientY+h.height-d.top,o.clientX-d.left)}}.bind(this)),this.setupKeyboardActivation(),this.pairUndoRedo(),this.toolSettings.toolGroup&&this.setToolGroup({node:this.querySelector('cq-item[cq-tool-group="'+this.toolSettings.toolGroup+'"]')},this.toolSettings.toolGroup),this.channels&&(this.channelSubscribe(this.channels.drawing||"channel.drawing",o=>{const c=a.currentVectorParameters.vectorType;if(o)this.resetScroller(),c||a.changeVectorType(this.priorVectorType||""),this.setActiveTool(c||"notool");else{const{multiChartContainer:h}=this.container.topNode;h&&e.getFromNS(this,"context.config.soloActive.onDraw")?Array.from(h.querySelectorAll("cq-drawing-palette")).forEach(d=>{d.priorVectorType=c}):this.priorVectorType=c,a.changeVectorType(null)}}),this.channelSubscribe(this.channels.breakpoint||"channel.breakpoint",o=>{o==="break-sm"&&this.setMode("list")}))}pairUndoRedo(){const t=this.qs("cq-redo",this),s=this.qs("cq-undo",this);t.pairUp(s)}changeView(t,s){this.setMode(s);for(var a=0;a<this.callbacks.length;a++)this.callbacks[a].call(this,this.mode)}createContextMenu(){let t=document.createElement("div");t.className="menu-item",t.innerHTML="Add/Remove Favorite",t.addEventListener("mousedown",function(a){a.stopPropagation(),a.button<2&&(this.toggleFavorite(a.currentTarget.parentElement.getAttribute("context-tool")),this.paletteDock.stopContext(this))}.bind(this)),t.addEventListener("pointerdown",a=>a.stopPropagation());let s=document.createElement("div");return s.appendChild(t),s.className="tool-context-menu",this.node.append(s),s}registerCallback(t){this.callbacks.push(t)}resetScroller(){const t=this.querySelector(".tool-group cq-scroll");if(!t)return!1;this.setEvenOdd(),t.refresh()}setActiveTool(t){const s=this.querySelector(`cq-item[cq-tool=${t}]`);s&&this.tool({node:s})}setActiveButton(t){this.node.find(".ciq-tool.active").removeClass("active"),t&&t.classList.add("active"),e.trulyVisible(this.ownerDocument.querySelector(".ciq-mobile-palette-toggle"))||this.togglePalette()}setMode(t){t=t==="list"?t:"grid",this.mode=t,this.classList.remove("list","grid"),this.classList.add(this.mode),this.sortToolButtons(),this.resetScroller(),this.paletteDock.handleResize({resizeChart:!0})}setEvenOdd(){const t=this.querySelectorAll(".tool-group cq-scroll .drawing-tools-group");t.length&&t.forEach(s=>{const a=s.querySelectorAll("cq-item");let o=!1;for(let c=0;c<a.length;c++)e.trulyVisible(a[c])&&(a[c].classList[o?"add":"remove"]("odd"),o=!o)})}setFavorites(t=!0){for(var s=this.querySelectorAll(".tool-group [cq-tool]"),a=0;a<s.length;a++){var o=s[a];if(o.querySelector(".fav-marker")===null){let h=document.createElement("div");h.className="fav-marker",h.addEventListener("click",this.handleFavoriteClick.bind(this)),h.addEventListener("touchstart",this.handleFavoriteClick.bind(this),{capture:!0,passive:!1}),h.addEventListener("pointerdown",d=>d.stopPropagation()),o.appendChild(h)}o.getAttribute("cq-tool-group").indexOf("favorite")>=0&&o.setAttribute("cq-tool-group",o.getAttribute("cq-tool-group").replace("favorite","")),this.toolSettings.favList.indexOf(o.getAttribute("cq-tool"))>=0&&o.setAttribute("cq-tool-group",o.getAttribute("cq-tool-group")+" favorite")}this.sortToolButtons();const{multiChartContainer:c}=this.context.topNode;t&&c&&c.getCharts().forEach(h=>{const d=h.uiContext.topNode;if(!d.closest("cq-context-wrapper")||d===this.context.topNode)return;const f=d.querySelector("cq-drawing-palette");setTimeout(()=>{f.loadToolSettings(),f.setFavorites(!1)})})}sortToolButtons(){const t=this.querySelector(".tool-group cq-scroll"),s=t.querySelector(".ps__rail-x, .ps__rail-y"),{groupedTools:a,toolGroups:o,toolSettings:c}=this,{favList:h}=c,d=this.classList.contains("grid")?"grid":"list",u=m=>{s?t.insertBefore(m,s):t.appendChild(m)},f=(m,v)=>{const b=document.createElement("div");return b.setAttribute("class",`drawing-tools-group ${v}`),m.forEach(q=>{const x=q.tool||q;if(v!=="favorites"&&h.includes(x))return;const w=this.querySelector(".tool-group [cq-tool="+x+"]");w&&b.appendChild(w)}),b.insertAdjacentHTML("beforeend","<cq-separator></cq-separator>"),b},g=(m,v)=>{const b=this.querySelector(".tool-group [cq-tool="+m.tool+"]"),q=b.getAttribute("cq-tool-group").includes("favorite");b&&(v?q:!q)&&u(b)},y=()=>{t.querySelectorAll("div.drawing-tools-group").forEach(m=>{m.children.length<=1&&m.remove()})};if(d==="grid"){h.length&&u(f(h,"favorites")),o.forEach(m=>{const v=m.toLowerCase(),b=a[v];if(b){const q=f(b,v);u(q)}});for(const m in a)if(!o.includes(e.capitalize(m))){const v=f(a[m],m);u(v)}}if(d==="list"){for(let m of this.context.config.drawingTools)g(m,!0);for(let m of this.context.config.drawingTools)g(m,!1)}y()}handleFavoriteClick(t){t.stopPropagation(),t.preventDefault(),this.toggleFavorite(t.target.parentElement.getAttribute("cq-tool")),this.hidePalette()}addFavorite(t){this.toolSettings.favList.indexOf(t)<0&&(this.toolSettings.favList.push(t),this.storeToolSettings(),this.setFavorites())}showToolContextMenu(t,s,a){this.toolContextMenu.style.display="block",this.toolContextMenu.style.top=s+"px",this.toolContextMenu.style.left=a+"px",this.toolContextMenu.setAttribute("context-tool",t),this.paletteDock.startContext(this)}toggleFavorite(t){let s=this.toolSettings.favList.indexOf(t);s>=0?this.toolSettings.favList.splice(s,1):this.toolSettings.favList.push(t),this.storeToolSettings(),this.setFavorites(),this.setEvenOdd()}setToolGroup(t,s){this.toolSettings.toolGroup=s,this.querySelector(".tool-group").setAttribute("tool-group-filter",this.toolSettings.toolGroup),this.querySelector(".tool-group cq-scroll").top(),this.setEvenOdd();for(var a=0;a<this.callbacks.length;a++)this.callbacks[a].call(this,this.mode);this.showPalette(),this.params.toolGroupSelection.html(t.node.innerHTML),this.storeToolSettings()}togglePalette(){this.classList.toggle("palette-hide")}hidePalette(){this.classList.add("palette-hide")}showPalette(){this.classList.remove("palette-hide")}activateTool(t,s){let a=null;!t.node&&s?a=this.querySelector("[cq-tool="+s+"]"):a=t.node,this.setActiveButton(a);let o=[this.context.stx];o[0].uiContext.topNode.getCharts&&(o=o[0].uiContext.topNode.getCharts()),o.forEach(c=>{c.clearMeasure(),c.changeVectorType(s=="notool"?"":s),s==="notool"?c.container.classList.remove("stx-crosshair-cursor-on"):c.container.classList.add("stx-crosshair-cursor-on")})}noTool(t,s){this.tool(t,"notool")}tool(t,s){if(s||(s=t.node.getAttribute("cq-tool")),!!s){var a=t.node.querySelector("label").innerHTML;this.activateTool(t,s),this.sendMessage&&this.sendMessage("changeTool",{activator:t,toolName:s,toolLabel:a})}}clearDrawings(){this.sendMessage&&this.sendMessage("clearDrawings")}restoreDefaultConfig(t,s){this.sendMessage&&this.sendMessage("restoreDefaultConfig",{activator:t,all:s})}getMarkup(t){const s=t.getMenu("drawingTools",!0).join(""),a=t.drawingToolGrouping.filter(o=>["All","Favorites"].includes(o)||t.drawingTools.some(({group:c})=>c===o.toLowerCase())).map(o=>`<cq-item
					stxtap="setToolGroup('${o.toLowerCase()}')"
					cq-tool-group="${o.toLowerCase()}">${o}
				</cq-item>`).join("");return this.constructor.markup.replace("{{tools}}",s).replace("{{toolGrouping}}",a)}}r.markup=`
	<div class="palette-container">
		<div class="drag-strip"></div>
			<div class="mini-widget-group">
					<cq-item class="ciq-mini-widget" cq-view="list" stxtap="changeView('list')">
						<cq-help help-id="drawing_palette_list_view"></cq-help>
						<span class="icon"></span><label>List View</label>
					</cq-item>
					<cq-item class="ciq-mini-widget" cq-view="grid" stxtap="changeView('grid')">
						<cq-help help-id="drawing_palette_grid_view"></cq-help>
						<span class="icon"></span><label>Grid View</label>
					</cq-item>
					<cq-item class="ciq-mini-widget" cq-view="detach" stxtap="detach()">
						<cq-help help-id="drawing_palette_detach"></cq-help>
						<span class="icon"></span><label>Detach</label>
					</cq-item>
					<cq-item class="ciq-mini-widget" cq-view="attach" stxtap="dock()">
						<cq-help help-id="drawing_palette_attach"></cq-help>
						<span class="icon"></span><label>Attach</label>
					</cq-item>
			</div>
			<cq-separator></cq-separator>
			<div class="primary-tool-group">
				<cq-item class="ciq-tool active" cq-tool="notool" stxtap="tool()"><cq-help help-id="drawing_palette_notool"></cq-help><span class="icon pointer"></span><label>No Tool</label></cq-item>
				<cq-item class="ciq-tool" cq-tool="measure" stxtap="tool()"><cq-help help-id="drawing_palette_measure"></cq-help><span class="icon measure"></span><label>Measure</label></cq-item>
				<cq-undo class="ciq-tool"><cq-help help-id="drawing_palette_undo"></cq-help><span class="icon undo"></span><label>Undo</label></cq-undo>
				<cq-redo class="ciq-tool"><cq-help help-id="drawing_palette_redo"></cq-help><span class="icon redo"></span><label>Redo</label></cq-redo>
				<cq-menu class="ciq-select">
					<cq-help help-id="drawing_palette_tool_categories"></cq-help>
					<span cq-tool-group-selection>All</span>
					<cq-menu-dropdown class="ciq-tool-group-selection">
						{{toolGrouping}}
					</cq-menu-dropdown>
				</cq-menu>
			</div>
			<cq-separator></cq-separator>
			<div class="tool-group" tool-group-filter="all">
				<cq-scroll cq-no-resize>
					{{tools}}
				</cq-scroll>
				<cq-separator></cq-separator>
				<div class="mini-widget-group mini-widget-foot">
					<cq-toggle class="ciq-mini-widget ciq-magnet" cq-member="preferences.magnet" cq-toggles="true,75,false" cq-toggle-classes="active strong,active," cq-multichart-distribute="true">
						<cq-help help-id="drawing_palette_magnet"></cq-help>
						<span class="icon magnet"></span><label>Magnet</label>
					</cq-toggle>
					<cq-item class="ciq-mini-widget" stxtap="clearDrawings()">
						<cq-help help-id="drawing_palette_clear"></cq-help>
						<span class="icon clear"></span><label>Clear All Drawings</label>
					</cq-item>
					<cq-item class="ciq-mini-widget" stxtap="restoreDefaultConfig(true)">
						<cq-help help-id="drawing_palette_restore"></cq-help>
						<span class="icon restore"></span><label>Restore Default Parameters</label>
					</cq-item>
				</div>
			</div>
		<div class="resize-strip"></div>
	</div>
	`,e.UI.addComponentDefinition("cq-drawing-palette",r)}},ri=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;const n=e.UI._webcomponents.list["cq-palette"];if(!n)console.error("drawingSettings component requires first activating palette component.");else if(!e.Drawing)console.error("drawingSettings component requires first activating drawing feature.");else{class r extends n.classDefinition{connectedCallback(){this.attached||(super.connectedCallback(),e.UI.stxtap(this,function(t){t.stopPropagation()}))}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,r),this.constructor=r}setContext(t){this.addDefaultMarkup(),this.init(),this.params={lineSelection:this.node.find("*[cq-line-style]"),fontSizeSelection:this.node.find("*[cq-font-size]"),fontFamilySelection:this.node.find("*[cq-font-family]"),fontStyleToggle:this.node.find("cq-annotation-italic"),fontWeightToggle:this.node.find("cq-annotation-bold"),fontOptions:this.node.find("cq-annotation"),axisLabelToggle:this.node.find("cq-axis-label .ciq-checkbox"),spanPanelsToggle:this.node.find("cq-span-panels .ciq-checkbox"),showCalloutToggle:this.node.find("cq-show-callout .ciq-checkbox"),fillColor:this.node.find("cq-fill-color").not("cq-cvp-controller"),lineColor:this.node.find("cq-line-color").not("cq-cvp-controller"),cvpControllers:this.node.find("cq-cvp-controller"),waveParameters:this.node.find("cq-wave-parameters")},this.params.cvpControllers.prop("toolbar",this),this.sync(),this.dirty(!1);var s=this;e.UI.contextsForEach(function(){this.stx.setDrawingContainer&&this.stx.setDrawingContainer(s)}),t.stx.addEventListener("theme",function(a){var o=s.node.find("*[cq-toolbar-dirty]").hasClass("ciq-active");s.sync(),o||s.dirty(!1)})}handleMessage(t,s){switch(t){case"changeTool":this.setActiveToolLabel(s.toolLabel),this.toolSettings(s.activator,s.toolName);break;case"clearDrawings":this.clearDrawings();break;case"restoreDefaultConfig":this.restoreDefaultConfig(s.activator,s.all)}}clearDrawings(){const t=this.context.topNode.querySelectorAll("cq-context-wrapper");t.length?t.forEach(s=>{s.classList.contains("active")&&s.querySelector("cq-context").context.stx.clearDrawings(null,!1)}):this.context.stx.clearDrawings(null,!1)}crosshairs(t){var s=this.context.stx;s.changeVectorType(null),s.layout.crosshair=!0,s.doDisplayCrosshairs(),s.findHighlights(!1,!0),s.changeOccurred("layout"),s.draw(),s.updateChartAccessories(),this.node.find("*[cq-section]").removeClass("ciq-active"),this.emit()}tool(t,s){this.toolSettings(t,s),this.setActiveToolLabel(s),this.sendMessage("changeToolSettings",{activator:t,toolName:s})}toolSettings(t,s){var a=this.context.stx;this.node.find("*[cq-section]").removeClass("ciq-active");var o=!this.node.find("*[cq-toolbar-dirty]").hasClass("ciq-active"),c=e.Drawing.getDrawingParameters(a,s);if(c){this.node.find("*[cq-toolbar-action='save']").addClass("ciq-active");var h=a.preferences.drawings;h&&h[s]&&(this.node.find("*[cq-toolbar-action='restore']").addClass("ciq-active"),o=!0),s==="fibtimezone"&&delete c.parameters;var d=this.params.lineSelection.parent().find(".ciq-none");d.hide();for(var u=this.defaultElements(c,s),f=0;f<u.length;f++)this.node.find(u[f]).addClass("ciq-active"),u[f]=="cq-fill-color"&&d.show();if(u=e.Drawing[s].prototype.$controls,u)for(f=0;f<u.length;f++)this.node.find(u[f]).addClass("ciq-active");s==="trendline"&&!a.currentVectorParameters.showCallout&&["fontOptions","fillColor"].forEach(g=>this.params[g].removeClass("ciq-active"))}s==="notool"?(a.changeVectorType(""),this.hide="true"):this.hide="false",this.paletteDock.handleResize(),this.sync(),o&&this.dirty(!1)}defaultElements(t,s){var a=[];for(var o in t)if(o=="color")a.push("cq-line-color");else if(o=="fillColor")a.push("cq-fill-color");else if(o=="pattern"||o=="lineWidth")a.push("cq-line-style");else if(o=="axisLabel")a.push("cq-axis-label");else if(o=="spanPanels")a.push("cq-span-panels");else if(o=="showCallout")a.push("cq-show-callout");else if(o=="font")a.push("cq-annotation");else if(o=="parameters")switch(s){case"volumeprofile":a.push("cq-clickable[cq-volumeprofile-settings]");break;case"measurementline":a.push("cq-clickable[cq-measurementline-settings]");break;default:a.push("cq-clickable[cq-fib-settings]")}return a}dirty(t){this.node.find("*[cq-toolbar-dirty]")[t===!1?"removeClass":"addClass"]("ciq-active")}emit(){var t=new Event("change",{bubbles:!0,cancelable:!0});this.dirty(),this.dispatchEvent(t)}getFillColor(t){var s=e.UI.$(t.node),a=["color-auto","color-transparent"],o=this.context.stx.currentVectorParameters.fillColor;if(s.removeClass(a),a.includes("color-"+o)){s.removeAttr("style"),s.addClass("color-"+o);return}s.css({background:o});var c=e.getBackgroundColor(this.parentNode);if(o&&Math.abs(e.hsl(c)[2]-e.hsl(o)[2])<.2){var h=e.chooseForegroundColor(c);s.css({border:"solid "+h+" 1px"})}else s.css({border:""})}getLineColor(t){var s=e.UI.$(t.node),a=["color-auto","color-transparent"],o=this.context.stx.currentVectorParameters.currentColor;if(s.removeClass(a),a.includes("color-"+o)){s.removeAttr("style"),s.addClass("color-"+o);return}s.css({background:o});var c=e.getBackgroundColor(this.parentNode);if(!o||Math.abs(e.hsl(c)[2]-e.hsl(o)[2])<.2){var h=e.chooseForegroundColor(c);s.css({border:"solid "+h+" 1px"})}else s.css({border:""})}pickFillColor(t){var s=e.UI.$(t.node),a=this.uiManager.getColorPicker(this),o=this;a.callback=function(h){o.context.stx.currentVectorParameters.fillColor=h,o.getFillColor({node:s}),o.emit()};var c=s.attr("cq-overrides");c&&(c=c.split(",")),a.display({node:s,overrides:c,context:o.context})}pickLineColor(t){var s=e.UI.$(t.node),a=this.uiManager.getColorPicker(this),o=this;a.callback=function(h){o.context.stx.currentVectorParameters.currentColor=h,o.getLineColor({node:s}),o.emit()};var c=s.attr("cq-overrides");c&&(c=c.split(",")),a.display({node:s,overrides:c,context:o.context})}restoreDefaultConfig(t,s){var a=this.context.stx;e.Drawing.restoreDefaultConfig(a,a.currentVectorParameters.vectorType,s),this.node.find("*[cq-toolbar-action='restore']").removeClass("ciq-active"),this.sync(),this.dirty(!1)}saveConfig(){var t=this.context.stx;e.Drawing.saveConfig(t,t.currentVectorParameters.vectorType),this.node.find("*[cq-toolbar-action='restore']").addClass("ciq-active"),this.sync(),this.dirty(!1)}setFibs(t,s){var a=this.context.stx.currentVectorParameters.fibonacci;if(a){for(var o=0;o<a.fibs.length;o++)a.fibs[o].parameters.lineWidth=t,a.fibs[o].parameters.pattern=s;a.timezone.parameters.lineWidth=t,a.timezone.parameters.pattern=s}}setFontFamily(t,s){var a=this.context.stx;a.currentVectorParameters.annotation&&(s=="Default"?a.currentVectorParameters.annotation.font.family=null:a.currentVectorParameters.annotation.font.family=s),this.params.fontFamilySelection.text(s),this.emit()}setFontSize(t,s){var a=this.context.stx;a.currentVectorParameters.annotation&&(a.currentVectorParameters.annotation.font.size=s),this.params.fontSizeSelection.text(s),this.emit()}setLine(t,s,a){var o=this.context.stx;o.currentVectorParameters.lineWidth=s,o.currentVectorParameters.pattern=a,this.setFibs(s,a),this.currentLineSelectedClass&&this.params.lineSelection.removeClass(this.currentLineSelectedClass),this.currentLineSelectedClass="ciq-"+a+"-"+parseInt(s,10),a=="none"?this.currentLineSelectedClass=null:this.params.lineSelection.addClass(this.currentLineSelectedClass),this.emit()}setActiveToolLabel(t){t==="No Tool"?t="":t==="freeform"?t="Doodle":t=t+":",this.querySelector(".ciq-active-tool-label").innerHTML=t,this.querySelector(".ciq-mobile-palette-toggle span").innerHTML=t||"Select Tool"}sync(t){var s=this.context.stx;t?s.currentVectorParameters=e.extend(s.currentVectorParameters||{},t):t=s.currentVectorParameters;var a=this.params;this.setLine(null,t.lineWidth,t.pattern);var o=s.canvasStyle("stx_annotation"),c=t.annotation&&t.annotation.font,h=c&&c.size||o.fontSize;this.setFontSize(null,h);var d=c&&c.family||o.fontFamily;this.setFontFamily(null,d);var u=c&&c.style||o.fontStyle;a.fontStyleToggle[u==="italic"?"addClass":"removeClass"]("ciq-active");var f=c&&c.weight||o.fontWeight;a.fontWeightToggle[f==="bold"||f>=700?"addClass":"removeClass"]("ciq-active"),a.axisLabelToggle[t.axisLabel?"addClass":"removeClass"]("ciq-active"),a.showCalloutToggle[t.showCallout?"addClass":"removeClass"]("ciq-active"),a.spanPanelsToggle[t.spanPanels?"addClass":"removeClass"]("ciq-active"),this.getFillColor({node:a.fillColor}),this.getLineColor({node:a.lineColor}),a.cvpControllers.each(function(){this.sync(t)});var g=a.waveParameters;g&&g[0]&&g[0].activate()}toggleCheckbox(t,s){const a=e.UI.$(t.node),o=this.context.stx.currentVectorParameters;o[s]=!o[s],a[o[s]?"addClass":"removeClass"]("ciq-active"),s==="showCallout"&&["fontOptions","fillColor"].forEach(c=>this.params[c][o[s]?"addClass":"removeClass"]("ciq-active")),this.emit()}toggleFontStyle(t,s){var a=this.context.stx,o=e.UI.$(t.node);s=="italic"?a.currentVectorParameters.annotation.font.style=="italic"?(a.currentVectorParameters.annotation.font.style=null,o.removeClass("ciq-active")):(a.currentVectorParameters.annotation.font.style="italic",o.addClass("ciq-active")):s=="bold"&&(a.currentVectorParameters.annotation.font.weight=="bold"?(a.currentVectorParameters.annotation.font.weight=null,o.removeClass("ciq-active")):(a.currentVectorParameters.annotation.font.weight="bold",o.addClass("ciq-active"))),this.emit()}toggleMagnet(t){var s=e.UI.$(t.node),a=this.context.stx;a.preferences.magnet?(s.removeClass("active"),a.preferences.magnet=!1):(s.addClass("active"),a.preferences.magnet=!0),e.UI.contextsForEach(function(){this.stx.preferences.magnet=a.preferences.magnet,this.stx.chart.tempCanvas&&e.clearCanvas(this.stx.chart.tempCanvas,this.stx)})}togglePalette(){this.sendMessage("toggleDrawingPalette")}}r.markup=`
	<div class="palette-container">
		<div class="drag-strip"></div>
			<div class="drawing-settings-wrapper">
					<div class="mini-widget-group">
						<cq-item class="ciq-mini-widget" cq-view="detach" stxtap="detach()"><span class="icon"></span><label>Detach</label></cq-item>
						<cq-item class="ciq-mini-widget" cq-view="attach" stxtap="dock()"><span class="icon"></span><label>Attach</label></cq-item>
					</div>
				<cq-clickable class="ciq-select ciq-mobile-palette-toggle" stxtap="togglePalette()"><span>Select Tool</span></cq-clickable>
				<cq-toolbar-settings>
					<div class="ciq-active-tool-label ciq-heading"></div>
					<cq-fill-color cq-section cq-overrides="none" class="ciq-color" stxbind="getFillColor()" stxtap="pickFillColor()">
						<span></span>
					</cq-fill-color>
					<div>
						<cq-line-color cq-section cq-overrides="auto" class="ciq-color" stxbind="getLineColor()" stxtap="pickLineColor()"><span></span></cq-line-color>
						<cq-line-style cq-section>
							<cq-menu class="ciq-select">
								<span cq-line-style class="ciq-line ciq-selected"></span>
								<cq-menu-dropdown class="ciq-line-style-menu">
									<cq-item stxtap="setLine(1,'solid')"><span class="ciq-line-style-option ciq-solid-1"></span></cq-item>
									<cq-item stxtap="setLine(3,'solid')"><span class="ciq-line-style-option ciq-solid-3"></span></cq-item>
									<cq-item stxtap="setLine(5,'solid')"><span class="ciq-line-style-option ciq-solid-5"></span></cq-item>
									<cq-item stxtap="setLine(1,'dotted')"><span class="ciq-line-style-option ciq-dotted-1"></span></cq-item>
									<cq-item stxtap="setLine(3,'dotted')"><span class="ciq-line-style-option ciq-dotted-3"></span></cq-item>
									<cq-item stxtap="setLine(5,'dotted')"><span class="ciq-line-style-option ciq-dotted-5"></span></cq-item>
									<cq-item stxtap="setLine(1,'dashed')"><span class="ciq-line-style-option ciq-dashed-1"></span></cq-item>
									<cq-item stxtap="setLine(3,'dashed')"><span class="ciq-line-style-option ciq-dashed-3"></span></cq-item>
									<cq-item stxtap="setLine(5,'dashed')"><span class="ciq-line-style-option ciq-dashed-5"></span></cq-item>
									<cq-item stxtap="setLine(0,'none')" class="ciq-none">None</cq-item>
								</cq-menu-dropdown>
							</cq-menu>
						</cq-line-style>
					</div>

					<cq-cvp-controller cq-section cq-cvp-header="1"></cq-cvp-controller>
					<cq-cvp-controller cq-section cq-cvp-header="2"></cq-cvp-controller>
					<cq-cvp-controller cq-section cq-cvp-header="3"></cq-cvp-controller>

					<template cq-cvp-controller>
						<div cq-section>
							<div class="ciq-heading">Dev 1</div>
							<span stxtap="toggleActive()" class="ciq-checkbox">
								<span></span>
							</span>
						</div>
						<cq-line-color cq-section cq-overrides="auto" class="ciq-color" stxbind="getColor()" stxtap="pickColor()">
							<span></span>
						</cq-line-color>
						<cq-line-style cq-section>
							<cq-menu class="ciq-select">
								<span cq-cvp-line-style class="ciq-line ciq-selected"></span>
								<cq-menu-dropdown class="ciq-line-style-menu">
									<cq-item stxtap="setStyle(1, 'solid')"><span class="ciq-line-style-option ciq-solid-1"></span></cq-item>
									<cq-item stxtap="setStyle(3, 'solid')"><span class="ciq-line-style-option ciq-solid-3"></span></cq-item>
									<cq-item stxtap="setStyle(5, 'solid')"><span class="ciq-line-style-option ciq-solid-5"></span></cq-item>
									<cq-item stxtap="setStyle(1, 'dotted')"><span class="ciq-line-style-option ciq-dotted-1"></span></cq-item>
									<cq-item stxtap="setStyle(3, 'dotted')"><span class="ciq-line-style-option ciq-dotted-3"></span></cq-item>
									<cq-item stxtap="setStyle(5, 'dotted')"><span class="ciq-line-style-option ciq-dotted-5"></span></cq-item>
									<cq-item stxtap="setStyle(1, 'dashed')"><span class="ciq-line-style-option ciq-dashed-1"></span></cq-item>
									<cq-item stxtap="setStyle(3, 'dashed')"><span class="ciq-line-style-option ciq-dashed-3"></span></cq-item>
									<cq-item stxtap="setStyle(5, 'dashed')"><span class="ciq-line-style-option ciq-dashed-5"></span></cq-item>
								</cq-menu-dropdown>
							</cq-menu>
						</cq-line-style>
					</template>

					<cq-axis-label cq-section>
						<div class="ciq-heading">Axis Label:</div>
						<span stxtap="toggleCheckbox('axisLabel')" class="ciq-checkbox ciq-active"><span></span></span>
					</cq-axis-label>

					<cq-span-panels cq-section>
						<div class="ciq-heading">Span Panels:</div>
						<span stxtap="toggleCheckbox('spanPanels')" class="ciq-checkbox ciq-active"><span></span></span>
					</cq-span-panels>
	
					<cq-show-callout cq-section>
						<div class="ciq-heading">Show Callout:</div>
						<span stxtap="toggleCheckbox('showCallout')" class="ciq-checkbox"><span></span></span>
					</cq-show-callout>
	
					<cq-annotation cq-section>
						<cq-annotation-italic stxtap="toggleFontStyle('italic')" class="ciq-btn" style="font-style:italic;">I</cq-annotation-italic>
						<cq-annotation-bold stxtap="toggleFontStyle('bold')" class="ciq-btn" style="font-weight:bold;">B</cq-annotation-bold>
						<cq-menu class="ciq-select">
							<span cq-font-size>12px</span>
							<cq-menu-dropdown class="ciq-font-size">
								<cq-item stxtap="setFontSize('8px')">8</cq-item>
								<cq-item stxtap="setFontSize('10px')">10</cq-item>
								<cq-item stxtap="setFontSize('12px')">12</cq-item>
								<cq-item stxtap="setFontSize('13px')">13</cq-item>
								<cq-item stxtap="setFontSize('14px')">14</cq-item>
								<cq-item stxtap="setFontSize('16px')">16</cq-item>
								<cq-item stxtap="setFontSize('20px')">20</cq-item>
								<cq-item stxtap="setFontSize('28px')">28</cq-item>
								<cq-item stxtap="setFontSize('36px')">36</cq-item>
								<cq-item stxtap="setFontSize('48px')">48</cq-item>
								<cq-item stxtap="setFontSize('64px')">64</cq-item>
							</cq-menu-dropdown>
						</cq-menu>
						<cq-menu class="ciq-select">
							<span cq-font-family>Default</span>
							<cq-menu-dropdown class="ciq-font-family">
								<cq-item stxtap="setFontFamily('Default')">Default</cq-item>
								<cq-item stxtap="setFontFamily('Helvetica')">Helvetica</cq-item>
								<cq-item stxtap="setFontFamily('Courier')">Courier</cq-item>
								<cq-item stxtap="setFontFamily('Garamond')">Garamond</cq-item>
								<cq-item stxtap="setFontFamily('Palatino')">Palatino</cq-item>
								<cq-item stxtap="setFontFamily('Times New Roman')">Times New Roman</cq-item>
							</cq-menu-dropdown>
						</cq-menu>
					</cq-annotation>
					<cq-clickable cq-fib-settings cq-selector="cq-fib-settings-dialog" cq-method="open" cq-section>
						<span class="ciq-icon-btn cq-icon-gear">
							<cq-tooltip>Settings</cq-tooltip>
						</span>
					</cq-clickable>
					<cq-clickable cq-volumeprofile-settings cq-selector="cq-volumeprofile-settings-dialog" cq-method="open" cq-section>
						<span class="ciq-icon-btn cq-icon-gear">
							<cq-tooltip>Settings</cq-tooltip>
						</span>
					</cq-clickable>
					<cq-clickable cq-measurementline-settings cq-selector="cq-measurementline-settings-dialog" cq-method="open" cq-section>
						<span class="ciq-icon-btn cq-icon-gear">
							<cq-tooltip>Settings</cq-tooltip>
						</span>
					</cq-clickable>
					<div class="ciq-drawing-edit-only" cq-section>
						<div cq-toolbar-action="done_edit" stxtap="DrawingEdit.endEdit('close')" cq-section><cq-tooltip>Done Editing</cq-tooltip></div>
					</div>
					<br cq-section cq-wave-parameters><!-- This break is not displayed by default but uses  the .ciq-active class to be displayed and push cq-wave-parameters onto a new line in the toolbar -->
					<cq-wave-parameters cq-section></cq-wave-parameters>
					<template cq-wave-parameters>
						<div class="ciq-wave-template" cq-section>
							<div class="ciq-heading">WAVE TEMPLATE</div>
							<cq-menu class="ciq-select">
								<span class="ciq-active-template">WAVE TEMPLATE</span>
								<cq-menu-dropdown>
									<cq-item stxtap="update('template','Grand Supercycle')">Grand Supercycle</cq-item>
									<cq-item stxtap="update('template','Supercycle')">Supercycle</cq-item>
									<cq-item stxtap="update('template','Cycle')">Cycle</cq-item>
									<cq-item stxtap="update('template','Primary')">Primary</cq-item>
									<cq-item stxtap="update('template','Intermediate')">Intermediate</cq-item>
									<cq-item stxtap="update('template','Minor')">Minor</cq-item>
									<cq-item stxtap="update('template','Minute')">Minute</cq-item>
									<cq-item stxtap="update('template','Minuette')">Minuette</cq-item>
									<cq-item stxtap="update('template','Sub-Minuette')">Sub-Minuette</cq-item>
									<cq-item stxtap="update('template','Custom')">Custom</cq-item>
								</cq-menu-dropdown>
							</cq-menu>
						</div>
						<div class="ciq-wave-impulse" cq-section>
							<div class="ciq-heading">IMPULSE</div>
							<cq-menu  class="ciq-select">
								<span class="ciq-active-impulse">IMPULSE</span>
								<cq-menu-dropdown>
									<cq-item stxTap="update('impulse',null)">- - -</cq-item>
									<cq-item stxtap="update('impulse','I,II,III,IV,V')">I II III IV V</cq-item>
									<cq-item stxtap="update('impulse','i,ii,iii,iv,v')">i ii iii iv v</cq-item>
									<cq-item stxtap="update('impulse','1,2,3,4,5')">1 2 3 4 5</cq-item>
									<cq-item stxtap="update('impulse','A,B,C,D,E')">A B C D E</cq-item>
									<cq-item stxtap="update('impulse','a,b,c,d,e')">a b c d e</cq-item>
									<cq-item stxtap="update('impulse','W,X,Y,X,Z')">W X Y X Z</cq-item>
									<cq-item stxtap="update('impulse','w,x,y,x,z')">w x y x z</cq-item>
								</cq-menu-dropdown>
							</cq-menu>
						</div>
						<div class="ciq-wave-corrective" cq-section>
							<div class="ciq-heading">CORRECTIVE</div>
							<cq-menu class="ciq-select">
								<span class="ciq-active-corrective">CORRECTIVE</span>
								<cq-menu-dropdown>
									<cq-item stxtap="update('corrective',null)">- - -</cq-item>
									<cq-item stxtap="update('corrective','A,B,C')">A B C</cq-item>
									<cq-item stxtap="update('corrective','a,b,c')">a b c</cq-item>
									<cq-item stxtap="update('corrective','W,X,Y')">W X Y</cq-item>
									<cq-item stxtap="update('corrective','w,x,y')">w x y</cq-item>
								</cq-menu-dropdown>
							</cq-menu>
						</div>
						<span class="ciq-icon-btn ciq-btn" decoration="none" stxtap="update('decoration',null)" cq-section>
							<cq-tooltip>None</cq-tooltip>
						</span>
						<span class="ciq-icon-btn ciq-btn" decoration="parentheses" stxtap="update('decoration','parentheses')" cq-section>
							<cq-tooltip>Parentheses</cq-tooltip>
						</span>
						<span class="ciq-icon-btn ciq-btn" decoration="enclosed" stxtap="update('decoration','enclosed')" cq-section>
							<cq-tooltip>Enclosed</cq-tooltip>
						</span>
						<div class="ciq-heading ciq-show-lines"  cq-section>
							Show Lines: <span stxtap="toggleLines()" class="ciq-checkbox ciq-active"><span></span></span>
						</div>
					</template>
					<div class="ciq-drawing-edit-hidden" cq-section>
						<div cq-toolbar-action="save" stxtap="saveConfig()" cq-section><div cq-toolbar-dirty></div><cq-tooltip>Save Config</cq-tooltip></div>
						<div cq-toolbar-action="restore" stxtap="restoreDefaultConfig()" cq-section><cq-tooltip>Restore Config</cq-tooltip></div>
					</div>
				</cq-toolbar-settings>
				<cq-measure><span class="mMeasure"></span></cq-measure>
			</div>
		<div class="resize-strip"></div>
	</div>
	`,e.UI.addComponentDefinition("cq-drawing-settings",r)}},ci=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;const n=e.UI._webcomponents.list["cq-scroll"];if(!n)console.error("menuDropdown component requires first activating scroll component.");else{class r extends n.classDefinition{constructor(){super(),this.noMaximize=!0}connectedCallback(){super.connectedCallback()}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,r)}disablekeyboardNavigation(){this.keyboardNavigation&&this.keyboardNavigation.setKeyControlElement()}}e.UI.addComponentDefinition("cq-menu-dropdown",r)}},li={CIQ:p};(typeof __TREE_SHAKE__=="undefined"||!__TREE_SHAKE__)&&li.CIQ.activateImports(Ye,Ge,Xe,Ze,Je,et,tt,it,st,nt,at,ot,rt,ct,lt,ht,dt,ut,pt,ft,mt,gt,vt,yt,bt,qt,Ct,xt,kt,wt,It,St,Et,Tt,Lt,Dt,Ut,At,Mt,_t,Nt,Ht,Pt,Ot,Qt,Ft,zt,Rt,Vt,jt,Bt,Wt,$t,Kt,Yt,Gt,Xt,Zt,Jt,ei,ti,ii,si,ni,ai,oi,ri,ci,null);let hi=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;class n{constructor(t){const{stx:s}=t;if(!s){console.warn("The DataLoader requires an stx parameter");return}if(this.stx=s,this.cssRequired=!0,s.dataLoader=this,e.UI){const a=({value:o})=>{o&&(setTimeout(this.subscribeToChanges,0,o),setTimeout(this.registerHotKeys,0,o))};e.UI.observeProperty("uiContext",s,a),s.addEventListener("destroy",()=>e.UI.unobserveProperty("uiContext",s,a))}}formatData(t,s){const{defaultPlotField:a}=this.stx.chart,{results:o,fields:c}=t,{name:h}=s,d=c.indexOf("DT"),u=c.indexOf("Date"),f=c.indexOf(h),g=f>-1;let y=[d>-1?d:u];g&&y.push(c.indexOf(h)),o.data=o.map(m=>{const v={};return m.split(",").forEach((b,q)=>{if(g&&y.indexOf(q)===-1)return;let x=c[q],w;try{w=JSON.parse(b)}catch(S){w=b}let C=x==="DT"||x==="Date"?w:Number.parseFloat(w);v[c[q]]=C,q===f&&(delete v[c[q]],v[a]=C)}),v})}importData(t){const s=this,{stx:a}=this,o=Object.fromEntries(t.formData.entries());let{color:c,display:h,name:d,panel:u,periodicity:f}=o;f=JSON.parse(f),this.formatData(t,o);const{results:g}=t,{data:y}=g,m={symbol:d,static:!0},v={data:y,symbolObject:m,panel:u==="true"?!0:void 0,color:c};h==="secondary"?a.addSeries(d,v,function(){let b=a.getSeries({symbol:d})[0];const q=a.tickFromDate(b.endPoints.end);a.chart.scroll=a.chart.dataSet.length-1-q+a.chart.maxTicks,s.registerDataWarnings(!0)}):(a.quoteDriver.pause(d),a.loadChart(m,{masterData:y,periodicity:f},()=>{s.registerDataWarnings();const b=a.container.closest("cq-context-wrapper");b&&b.removeEmptyMsg&&b.removeEmptyMsg()}))}registerDataWarnings(t){const{stx:s}=this,a=s.addEventListener("menu",({stx:d,menu:u})=>{u.matches(".ciq-period")&&e.UI.getMyContext(u)===d.uiContext&&d.dispatch("notification","changeperiodicity")});let o,c;t&&(o=s.append("removeSeries",h),c=s.append("deleteHighlighed",h)),s.addEventListener("periodicity",({stx:d,differentData:u})=>{const f=d.getSymbols({static:!0});f&&u&&f.forEach(g=>{d.removeSeries(g,d.chart),h()})}),s.addEventListener("newChart",()=>{h()});function h(){s.getSymbols({static:!0}).length||(s.removeEventListener(a),t&&(s.removeInjection(o),s.removeInjection(c)))}}registerHotKeys(t){const s=e.getFromNS(t.config,"hotkeyConfig.hotkeys");if(!s)return;let a=s.find(({action:o})=>o==="dataLoader");a&&(a.action=()=>{t.getAdvertised("Channel").write(null,"dataLoader",!0)})}subscribeToChanges(t){const{stx:s}=t,a=e.UI.BaseComponent.prototype;a.channelSubscribe("channel.dataLoader",o=>{let c=o?{type:"dataLoader",params:{stx:s,context:t}}:{};a.channelWrite("channel.dialog",c,s)},s)}}class r{constructor(t){const s=new FileReader;this.reader=s,this.file=t}parse(t){return ae(this,null,function*(){const{reader:s}=this;return new Promise((a,o)=>{s.readAsText(t),s.onload=c=>{const h=this.splitResults(s.result),d=h.shift(),f=!!d.match(/"/)?new RegExp(/,(?=")/):new RegExp(/,/);this.fields=d.split(f).map(g=>{let y;try{y=JSON.parse(g)}catch(m){y=g}return y}),h[h.length-1]===""&&h.pop(),this.results=h,a(h)},s.onerror=c=>{console.warn(c),o(c)}})})}determineLineBreak(t){const{length:s}=t,a=`\r
`,o=`
`;let c=Math.floor(s*.05),h=0,d;do{const u=t.substring(h,c);u.indexOf(a)>-1?d=a:u.indexOf(o)>-1?d=o:h+=c}while(!d);return d}splitResults(t){return t.split(this.determineLineBreak(t))}}e.CSVReader=e.CSVReader||r,e.DataLoader=e.DataLoader||n},di=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;e.ExtendedHours=e.ExtendedHours||function(n){var r=n.stx;this.filter=n.filter,r||(r=n,this.filter=!1);var i={};this.stx=r,this.stx.extendedHours=this,this.cssRequired=!0,r.addEventListener("theme",function(t){i={};for(var s in r.layout.marketSessions)i.session||(i.session={}),i.session[s]=r.canvasStyle("stx_market_session "+s)}),r.addEventListener("symbolChange",function(t){t.action=="master"&&r.layout.extended&&!(r.chart.market.market_def&&r.chart.market.sessions.length)&&e.alert("There are no Extended Hours for this instrument.")}),e.UI&&e.UI.KeystrokeHub.addHotKeyHandler("extendedHours",({stx:t})=>{t.container.ownerDocument.body.keystrokeHub.context.advertised.Layout.setExtendedHours()},r),this.prepare=function(t,s){r.layout.extended=t;for(var a in r.layout.marketSessions)i.session={},r.chart.market.disableSession(a);if(r.layout.marketSessions={},t)if(s||(s=["pre","post"]),s.length)for(var o=0;o<s.length;o++)r.layout.marketSessions[s[o]]=!0;else r.layout.marketSessions=s;for(a in r.layout.marketSessions)i.session||(i.session={}),i.session[a]=r.canvasStyle("stx_market_session "+a),r.chart.market.disableSession(a,!0)},this.complete=function(t){if(r.changeOccurred("layout"),!r.chart.market.market_def){t&&t();return}this.filter?(r.createDataSet(),r.draw(),t&&t()):r.loadChart(r.chart.symbol,t)},this.set=function(t,s,a){this.prepare(t,s),this.complete(a)},this.stx.append("drawYAxis",function(t,s){if(this.layout.extended&&!(t.yAxis!=s.yAxis||t.shareChartXAxis===!1||t.hidden)){var a=t.chart;if(!e.ChartEngine.isDailyInterval(this.layout.interval)&&(i.divider=this.canvasStyle("stx_market_session divider"),i.session)){for(var o=a.market,c=[],h={},d,u,f=0;f<a.dataSegment.length;f++){var g=a.dataSegment[f];if(!(!g||!g.DT)){var y=null;if(o.market_def&&(!d||d<=g.DT)){u=o.getSession(g.DT);var m=u!==""&&(!this.layout.marketSessions||!this.layout.marketSessions[u]);d=o[m?"getNextOpen":"getNextClose"](g.DT)}var v=i.session[u];if(v&&(y=v.backgroundColor),h.color&&h.color!=y&&(c.push({start:h.start,end:h.end,color:h.color}),h={}),y){var b=this.layout.candleWidth;g.candleWidth&&(b=g.candleWidth),h.end=this.pixelFromBar(f,a)+b/2,!h.start&&h.start!==0&&(h.start=h.end-b+1),h.color=y}else h={}}}(h.start||h.start===0)&&c.push({start:h.start,end:h.end,color:h.color});var q=e.isTransparent(i.divider.backgroundColor),x=i.divider.width.replace(/px/g,""),w={y0:t.bottom,y1:t.top,color:i.divider.backgroundColor,type:"line",context:a.context,confineToPanel:t,pattern:"dashed",lineWidth:x,deferStroke:!0};for(this.startClip(t.name),a.context.beginPath(),r.highlightedDraggable&&(a.context.globalAlpha*=.3),f=0;f<c.length;f++)a.context.fillStyle=c[f].color,!q&&c[f].start>a.left&&this.plotLine(e.extend({x0:c[f].start,x1:c[f].start},w)),a.context.fillRect(c[f].start,t.top,c[f].end-c[f].start,t.bottom-t.top),!q&&c[f].end<a.right&&this.plotLine(e.extend({x0:c[f].end,x1:c[f].end},w));a.context.stroke(),this.endClip()}}})}},ui=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;e.FullScreen=e.FullScreen||function(n){if(n||(n={}),!n.stx){console.warn("The Full Screen addon requires an stx parameter");return}try{if(window.location.host!==window.top.location.host)throw new Error(window.location.host+" does not match "+window.top.location.host)}catch(t){console.warn("Full screen mode disabled.");return}this.stx=n.stx,this.stx.fullScreen=this,this.fullScreenButton=null,this.fullScreenState=!1,this.addFullScreenButton=function(){this.stx.registerChartControl&&(this.fullScreenButton=this.stx.registerChartControl("stx-full-screen","Full Screen",function(t){return function(s){t.fullScreenToggle(s),s.stopPropagation()}}(this)))},this.fullScreenToggle=function(t){var s=t.target.ownerDocument;s.documentElement.requestFullscreen||s.documentElement.webkitRequestFullscreen||s.documentElement.mozRequestFullscreen||s.documentElement.msRequestFullscreen?this.getFullScreenElement(s)?s.exitFullscreen?s.exitFullscreen():s.webkitExitFullscreen?s.webkitExitFullscreen():s.mozCancelFullScreen?s.mozCancelFullScreen():s.msExitFullscreen&&s.msExitFullscreen():s.documentElement.requestFullscreen?s.documentElement.requestFullscreen():s.documentElement.webkitRequestFullscreen?s.documentElement.webkitRequestFullscreen():s.documentElement.mozRequestFullscreen?s.documentElement.mozRequestFullscreen():s.documentElement.msRequestFullscreen&&s.documentElement.msRequestFullscreen():(this.fullScreenState=!this.fullScreenState,this.fullScreenRender())},this.fullScreenRender=function(){let t=null;if(t=this.stx.container.closest("*[cq-context], cq-context, body"),t){const s="full-screen",a=this.fullScreenState===!0?"add":"remove";this.fullScreenButton&&this.fullScreenButton.classList[a]("active"),t.classList[a](s),this.stx.channel.componentClass=xe(ue({},this.stx.channel.componentClass),{[s]:a}),window.dispatchEvent(new Event("resize"))}},this.onFullScreenChange=function(t){this.getFullScreenElement(t.target.ownerDocument)?this.fullScreenState=!0:this.fullScreenState=!1,this.fullScreenRender()},this.getFullScreenElement=function(t){return t.fullscreenElement||t.webkitCurrentFullScreenElement||t.mozFullScreenElement||t.msFullscreenElement};var r=this.onFullScreenChange.bind(this),i=this;["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"].forEach(function(t){i.stx.container.ownerDocument.addEventListener(t,r),i.stx.addEventListener("destroy",function(){this.container.ownerDocument.removeEventListener(t,r)})}),this.addFullScreenButton()}},pi=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;e.InactivityTimer=e.InactivityTimer||function(n){if(!n.minutes)return;(!n.interval||n.interval<0)&&(n.interval=60),this.stx=n.stx,this.timeout=n.minutes,this.interval=n.interval,this.wakeCB=n.wakeCB,this.sleepCB=n.sleepCB,this.sleepTimer=null,this.sleeping=!1,this.last=new Date().getTime(),this.wakeChart=function(s){clearTimeout(this.sleepTimer),this.last=new Date().getTime(),this.sleeping&&(this.stx.quoteDriver&&this.stx.quoteDriver.updateChartLoop(),this.sleeping=!1,this.stx.container.ownerDocument.body.classList.remove("ciq-sleeping"),s||e.ChartEngine.registeredContainers.forEach(function(a){n.stx!==a.stx&&a.stx.inactivityTimer&&a.stx.inactivityTimer.wakeChart(!0)})),this.sleepTimer=setTimeout(this.sleepChart.bind(this),this.timeout*6e4),this.wakeCB&&this.wakeCB()},this.sleepChart=function(s){this.sleeping||(this.stx.quoteDriver&&this.stx.quoteDriver.updateChartLoop(this.interval),this.sleeping=!0,this.stx.container.ownerDocument.body.classList.add("ciq-sleeping"),s||e.ChartEngine.registeredContainers.forEach(function(a){n.stx!==a.stx&&a.stx.inactivityTimer&&a.stx.inactivityTimer.sleepChart(!0)})),this.sleepCB&&this.sleepCB()};var r=this,i=this.stx.container.ownerDocument;function t(){r.wakeChart()}["mousemove","mousedown","touchstart","touchmove","pointerdown","pointermove","keydown","wheel"].forEach(function(s){i.body.addEventListener(s,t,{passive:!1}),r.stx.addEventListener("destroy",function(){i.body.removeEventListener(s,t),clearTimeout(r.sleepTimer)})}),this.stx.inactivityTimer=this,this.wakeChart()}},fi=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;e.RangeSlider=e.RangeSlider||function(n){this.cssRequired=!0;var r=n.stx;r.slider=this;var i=n.height?n.height:"95px",t=n.chartContainer?n.chartContainer:n.stx.container,s=document.createElement("div");s.className="ciq-chart";var a=document.createElement("div");a.className="chartContainer",s.appendChild(a),t.parentElement.parentElement.insertBefore(s,t.parentElement.nextSibling),Object.assign(s.style,{height:i,paddingTop:"5px",display:"none"}),a.style.height="100%",a.dimensionlessCanvas=!0;var o=this.slider=new e.ChartEngine({container:a,preferences:{labels:!1,whitespace:0}});o.linkedChartEngine=r,o.cleanupGaps=r.cleanupGaps,o.setGapLines(r.chart.gapLines),o.chart.customChart=r.chart.customChart,o.xaxisHeight=30,o.manageTouchAndMouse=!1,o.minimumCandleWidth=0,o.chart.yaxisMarginMultiplier=1;var c=o.chart.panel,h=c.subholder,d=c.close;h.style.cursor="ew-resize",h.classList.add("stx_range_slider"),d&&(d.style.display="inline",e.safeClickTouch(d,function(){r.layout.rangeSlider=!1,r.changeOccurred("layout")}));var u=c.yAxis;u.drawCurrentPriceLabel=!1,Object.defineProperty(u,"position",{get:function(){return r.slider.yAxisPosition||r.chart.panel.yAxis.position},set:function(m){r.slider.yAxisPosition=m}});const{get:f,set:g}=Object.getOwnPropertyDescriptor(e.ChartEngine.YAxis.prototype,"width");Object.defineProperty(u,"width",{get:function(){return Math.max(f.call(u),r.chart.yAxis.width)},set:function(m){g.call(u,m)}}),e.extend(u,n.yAxis),o.chart.baseline.userLevel=!1,o.controls.home&&(o.controls.home.style.width=0),o.initializeChart();const y=m=>o.notifyBreakpoint(m.value);e.UI&&(e.UI.KeystrokeHub.addHotKeyHandler("rangeSlider",({stx:m})=>{m.container.ownerDocument.body.keystrokeHub.context.advertised.Layout.setRangeSlider()},r),e.UI.observeProperty("breakpoint",r.chart,y)),this.updateStyles=function(m,v,b){r.setStyle(m,v,b),this.style=r.canvasStyle("stx_range_slider shading")},this.display=function(m){if(r.layout.rangeSlider!==m){r.layout.rangeSlider=m,r.changeOccurred("layout");return}s.style.display=m?"":"none",r.resizeChart(),s.ownerDocument.defaultView.dispatchEvent(new Event("resize")),m&&(o.resizeChart(),o.initializeChart(),this.requestDraw())},this.setSymbol=function(m){o.chart.panel.display=o.chart.symbol=m,o.chart.symbolObject={symbol:m},o.chart.market=r.chart.market,o.setMainSeriesRenderer(),o.resizeChart(),this.adjustRange(r.chart),this.requestDraw()},this.acceptLayoutChange=function(m){var v=!1;o.layout.rangeSlider!==m.rangeSlider&&r.slider.display(m.rangeSlider);var b=["chartType","aggregationType","periodicity","interval","timeUnit","chartScale","rangeSlider","flipped","extended","marketSessions","kagi","rangebars","renko","priceLines","pandf"];b.forEach(function(q){e.equals(o.layout[q],m[q])||(o.layout[q]=m[q],v=!0)}),e.trulyVisible(s)&&v&&(o.setMainSeriesRenderer(),this.requestDraw())},this.adjustRange=function(m){if(m.dataSet&&!(!m.endPoints||!m.endPoints.begin)){var v=o.chart;if(v.width){var b=0,q=0;if(r.quoteDriver){var x={symbol:m.symbol,symbolObject:m.symbolObject,interval:r.layout.interval};(x.interval=="month"||x.interval=="week")&&!r.dontRoll&&(x.interval="day");var w=r.quoteDriver.getQuoteFeed(x).behavior;w&&w.bufferSize&&(m.moreAvailable&&(b=w.bufferSize),r.isHistoricalMode()&&(q=w.bufferSize))}v.baseline.defaultLevel=m.baseline.actualLevel,v.scroll=Math.max(0,m.dataSet.length-r.tickFromDate(m.endPoints.begin)-b)+1,o.setMaxTicks(v.scroll-q+2)}}},this.copyData=function(m){if(m.dataSet&&m.masterData){var v=o.chart;v.masterData=o.masterData=m.masterData.slice(0),v.dataSet=m.dataSet.slice(0),v.state=m.state,this.requestDraw()}},this.calculateYAxisPosition=function(){var m=o.chart.panel,v=o.getYAxisCurrentPosition(m.yAxis,m);v!=m.yAxis.position&&o.calculateYAxisPositions()},this.drawSlider=function(){if(e.trulyVisible(s)&&!(!r.chart.dataSet||!r.chart.dataSet.length)){var m=this.style;m||(m=this.style=r.canvasStyle("stx_range_slider shading"));var v=r.chart.panel,b=o.chart.context,q=o.chart.segmentImage||[],x=o.layout.candleWidth/2,w=o.tickLeft=Math.max(r.tickFromPixel(v.left+x),0),C=o.tickRight=Math.min(r.tickFromPixel(v.right-x),r.chart.dataSet.length-1),S=o.pixelLeft=o.pixelFromTick(w)-(q[w]?q[w].candleWidth/2:x),k=o.pixelRight=o.pixelFromTick(C)+(q[C]?q[C].candleWidth/2:x),T=h.offsetLeft,E=T+h.offsetWidth;b.save(),b.beginPath(),b.fillStyle=m.backgroundColor,b.fillRect(T,h.offsetTop,S-T,h.offsetHeight),b.fillRect(E,h.offsetTop,k-E,h.offsetHeight),b.strokeStyle=m.borderTopColor,b.lineWidth=parseInt(m.borderWidth,10),b.moveTo(S,h.offsetTop),b.lineTo(S,h.offsetTop+h.offsetHeight),b.moveTo(k,h.offsetTop),b.lineTo(k,h.offsetTop+h.offsetHeight),b.stroke(),b.beginPath(),b.lineWidth=parseInt(m.width,10),b.lineCap="round",b.moveTo(S,h.offsetTop+h.offsetHeight/4),b.lineTo(S,h.offsetTop+3*h.offsetHeight/4),b.moveTo(k,h.offsetTop+h.offsetHeight/4),b.lineTo(k,h.offsetTop+3*h.offsetHeight/4),b.stroke(),b.restore()}},this.requestDraw=function(){this.drawRequested||(this.drawRequested=setTimeout(()=>{o.draw(),this.drawSlider(),this.drawRequested=clearTimeout(this.drawRequested)},100))},r.addEventListener("destroy",function(m){e.UI.unobserveProperty("breakpoint",m.stx.chart,y),o.destroy()}),r.addEventListener("layout",function(m){m.stx.slider.acceptLayoutChange(m.stx.layout)}),r.addEventListener("preferences",function(m){const{language:v}=m.stx.preferences;e.I18N&&o.preferences.language!=v&&e.I18N.setLocale(o,v),o.preferences.language=v,this.slider.requestDraw()}),r.addEventListener("symbolChange",function(m){m.action=="master"&&m.stx.slider.setSymbol(m.symbol)}),r.addEventListener("symbolImport",function(m){m.action=="master"&&m.stx.slider.setSymbol(m.symbol),m.stx.slider.acceptLayoutChange(m.stx.layout)}),r.addEventListener("theme",function(m){o.clearPixelCache();const{multiChartContainer:v}=r.uiContext.topNode,{breakpoint:b}=r.chart;if(v?(o.styles=v.styles[b]||{},v.styles[b]=o.styles):o.styles={},o.container.style.backgroundColor="",e.ThemeHelper){var q=new e.ThemeHelper({stx:m.stx});q.params.stx=o,q.update()}}),r.append("createDataSet",function(...m){const[,,{animationEntry:v}={}]=m||[];v||(this.slider.adjustRange(this.chart),this.slider.copyData(this.chart))}),r.append("draw",function({animationEntry:m}={}){m||!e.trulyVisible(s)||o.chart.dataSet&&(this.slider.calculateYAxisPosition(),this.slider.adjustRange(this.chart),this.slider.requestDraw())}),r.prepend("resizeChart",function(){var m=t.parentElement;if(!m||!m.isConnected)return!0;var v=m.parentElement,b=e.elementDimensions(v).height,q=v.querySelectorAll(".chartContainer");Array.from(q).forEach(function(x){x!==t&&e.trulyVisible(x)&&(b-=e.elementDimensions(x.parentElement,{border:1,padding:1,margin:1}).height)}),m.style.height=b+"px",this.layout.rangeSlider?(s.style.display="",o.resizeChart(),o.initializeChart(),this.slider.requestDraw()):s.style.display="none"}),["mousedown","touchstart","pointerdown"].forEach(function(m){h.addEventListener(m,function(v){var b=o.backOutX(v.pageX);if(!(!b&&b!==0)){b-=v.target.offsetLeft,o.startDrag=b,o.startPixelLeft=o.pixelLeft,o.startPixelRight=o.pixelRight;var q=r.slider.style;q||(q=r.slider.style=r.canvasStyle("stx_range_slider shading"));var x=parseInt(q.borderLeftWidth,10);b+=this.offsetLeft,b<o.pixelRight-x&&(o.needsLeft=!0),b>o.pixelLeft+x&&(o.needsRight=!0),!e.touchDevice&&o.needsLeft&&o.needsRight&&v.target.classList.add("stx-drag-chart")}},{passive:!1})}),["mouseup","mouseover","touchend","pointerup"].forEach(function(m){h.addEventListener(m,function(v){const{which:b,type:q}=v;b===1&&q!=="pointerup"&&q!=="mouseup"||(v.target.classList.remove("stx-drag-chart"),o.chart.panel.subholder.style.cursor="ew-resize",o.startDrag=null,o.needsLeft=!1,o.needsRight=!1)})}),["mousemove","touchmove","pointermove"].forEach(function(m){h.addEventListener(m,function(v){o.timeout||(o.timeout=setTimeout(()=>{const b=()=>o.timeout=clearTimeout(o.timeout),{startDrag:q,startPixelLeft:x,startPixelRight:w,needsLeft:C,needsRight:S}=o;let{tickLeft:k,tickRight:T}=o;if(!q&&q!==0)return b();const{touches:E}=v;let I=(E&&E.length?o.backOutX(E[0].pageX):o.backOutX(v.pageX))-v.target.offsetLeft;if(!I&&I!==0)return b();if(I-=q,C)x+I<o.chart.left&&(I=o.chart.left-x),S&&w+I>=o.chart.right&&(I=o.chart.right-w,o.isHome()||(I+=o.layout.candleWidth/2)),k=o.tickFromPixel(x+I),S&&(T=k+o.tickRight-o.tickLeft);else if(S)T=Math.min(o.tickFromPixel(w+I),r.chart.dataSet.length-1);else return b();let D=r.chart.width/(T-k+1);T>=k&&(C&&S||D>=r.minimumCandleWidth)&&(o.tickLeft=k,o.tickRight=T,r.chart.scroll=r.chart.dataSet.length-k,(!C||!S)&&r.setCandleWidth(D),r.micropixels=0,r.draw()),b()}))},{passive:!1})}),this.adjustRange(r.chart),this.copyData(r.chart),r.draw()}},mi=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;e.Shortcuts=e.Shortcuts||function({stx:n,width:r=580,windowForEachChart:i=!0,config:t}={}){if(!n){console.warn("The Shortcuts addon requires an stx parameter");return}this.stx=n,this.width=r,this.windowForEachChart=i,this.content=this.getShortcutContent(t),this.ensureMessagingAvailable(n),this.enableUI(n),this.cssRequired=!0,n.shortcuts=this,e.UI&&e.UI.KeystrokeHub.addHotKeyHandler("shortcuts",({stx:o,options:c})=>{o.container.ownerDocument.body.keystrokeHub.context.advertised.Layout.showShortcuts()},n);const s=this.stx.container.closest("cq-context"),a=new MutationObserver(()=>this.content=this.getShortcutContent(t));a.observe(s,{attributes:!0}),this.mo=a},e.Shortcuts.prototype.enableUI=function(n){n&&e.UI&&setTimeout(()=>{const r=n.uiContext.getAdvertised("Layout");r.showShortcuts=(i,t)=>this.toggle(t)})},e.Shortcuts.prototype.ensureMessagingAvailable=function(n){setTimeout(()=>{const r=n.uiContext.topNode;Array.from(r.querySelectorAll("cq-floating-window")).find(t=>t.closest("cq-context")===r)||r.append(document.createElement("cq-floating-window"))})},e.Shortcuts.prototype.getShortcutContent=function(n){const r=(n.drawingTools||[]).filter(h=>h.shortcut).map(({label:h,shortcut:d})=>`<div class="ciq-shortcut">
					<div>${h}</div>
					<div><span>Alt</span> + <span>${d.toUpperCase()}</span></div>
				</div>`).join(""),i=h=>h.charCodeAt(h.length-1)<127,t=h=>h===" + "?"<span>+</span>":h.split("+").map(d=>d&&d!==" "?"<span>"+d+"</span>":"").join(" + "),s=h=>h.map(d=>d.replace(/Arrow|Key|Digit|^ | $/g,"")).map(d=>d.replace(/\+/," + ")).reduce((d,u)=>!d.includes(u)&&i(u)?d.concat(u):d,[]).map(t).join("<br>"),a=this.stx.container.closest("cq-context");if(!a){this.mo.disconnect();return}const o=h=>a.hasAttribute(h.toLowerCase()+"-feature"),c=(n.hotkeyConfig&&n.hotkeyConfig.hotkeys||[]).map(({label:h,action:d,commands:u,extension:f})=>f&&!o(f)?"":`<div class="ciq-shortcut"><div>${h||d}</div><div>${s(u)}</div></div>`).join("");return`
		<div class="ciq-shortcut-container">
			<div>
				<div><b>Drawing tools shortcuts</b></div>
				<div>${r}</div>
			</div>
			<hr>
			<div>
				<div><b>Hotkeys</b></div>
				<div>${c}</div>
			</div>
		</div>
	`},e.Shortcuts.prototype.toggle=function(n){this.stx.dispatch("floatingWindow",{type:"shortcut",title:"Shortcuts",content:this.content,container:this.stx.uiContext.topNode,onClose:()=>this.closed=!0,width:this.width,status:n,tag:this.windowForEachChart?void 0:"shortcut"})}},gi=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;e.TableView=e.TableView||function({stx:r,minColumnWidth:i="84px",coverUIMaxWidth:t=400,coverContainer:s,usePreviousCloseForChange:a=!0}={}){if(!r){console.warn("The TableView addon requires an stx parameter");return}this.stx=r,this.viewAdditionalColumns=!1,this.minColumnWidth=i,this.coverUIMaxWidth=t,this.coverContainer=s,this.usePreviousCloseForChange=a,this.builder=n,this.listeners=[],r.tableView=this,this.cssRequired=!0,e.UI&&(this.listener=({value:o})=>{o&&setTimeout(()=>{this.subscribeToChanges(o);const c=e.getFromNS(o.config,"hotkeyConfig.hotkeys",[]).find(({action:h})=>h==="tableView");c&&(c.action=()=>{const{tableView:h}=o.topNode.ownerDocument.body.keystrokeHub.context.stx;if(h)return h.toggle(),!0})})},e.UI.observeProperty("uiContext",r,this.listener)),setTimeout(()=>{this.setup({minColumnWidth:i,coverUIMaxWidth:t,coverContainer:s})})},e.TableView.prototype.setup=function(r){const{stx:i}=this;if(i.destroyed)return;const t=this.builder.getChartCover(i,r),s=this.builder.createToolbar(i,r);t.append(s),t.style.display="none",i.addEventListener("symbolChange",()=>{this.view&&(this.close(),this.builder.createTable(i,r),this.dialog.focus())}),this.dialog=t,this.toolbar={symbol:s.querySelector(".ciq-data-table-title"),copyBtn:s.querySelector(".ciq-data-table-copy"),downloadBtn:s.querySelector(".ciq-data-table-download"),additional:s.querySelector(".ciq-data-table-additionalColumns")}},e.TableView.prototype.open=function(r){r&&(this.params=r);const{config:i={},onClose:t}=this.params||{};if(this.view&&this.close(!1),this.onClose=t,this.builder.createTable(this.stx,i),!this.dialog)return;const{stx:s}=this;if(!s.chart.masterData)return;const a=this.close.bind(this),o=this.dialog.ownerDocument.body.keystrokeHub;o&&o.addActiveModal(this.dialog),setTimeout(()=>this.removeCloseListener=c(this));function c(h){const d=s.uiContext.topNode,u=d.ownerDocument.body,f=m=>{m.target.closest(".ciq-data-table-container")||(a(),r.processCloseEvent?r.processCloseEvent(m):m.stopPropagation())};d.addEventListener("click",f,!0);const g=m=>{const{tableView:v}=u.keystrokeHub.context.stx;if(!(!v||!v.view))if(m.code==="Escape")v.close(),m.preventDefault();else{if(!e.UI||!e.UI.BaseComponent)return;const b=e.UI.BaseComponent.prototype,q=v.view.querySelectorAll("button");if(m.code==="Tab"){let{shiftKey:x}=m||{};b.focusNextItem(q,x,!0);const w=b.findFocused(q);w[0]&&b.highlightItem.call({keyboardNavigation:u.keystrokeHub},w[0])}else if(m.code==="Enter"){const x=b.findFocused(q);x[0]&&b.clickItem(x[0],m)}}};u.addEventListener("keydown",g);const y=e.getFn("UI.getUIManager")(d);return y&&(h.view.show=h.view.hide=function(){},y.openMenu(h.view,{})),()=>{d.removeEventListener("click",f,!0),u.removeEventListener("keydown",g),y&&y.closeMenu(h.view)}}},e.TableView.prototype.close=function(r=!0){let i;if(this.dialog&&(this.dialog.style.display="none"),this.view&&(i=this.view.ownerDocument.body,this.view.remove(),this.view=null),r&&this.onClose&&this.onClose(),this.removeCloseListener&&(this.removeCloseListener(),this.removeCloseListener=null),i&&i.keystrokeHub){let{tabActiveModals:t}=i.keystrokeHub,s=t.indexOf(this);s>-1&&t.splice(s,1),i.keystrokeHub.highlightAlign()}},e.TableView.prototype.toggle=function(){this[this.view?"close":"open"](),this.view||this.dialog.focus()},e.TableView.prototype.subscribeToChanges=function(r,i="channels.tableView"){const{channelSubscribe:t,channelWrite:s}=e.UI.BaseComponent.prototype,{channels:{tableView:a=i}={}}=r.config||{},{stx:o}=this;t(a,c=>{o.tableView&&(c?(o.tableView.open({onClose:()=>{s(a,!1,o)}}),o.tableView.dialog.focus()):o.tableView.close())},o),o.addEventListener("destroy",()=>{this.dialog&&this.dialog.remove(),this.listener&&e.UI.unobserveProperty("uiContext",o,this.listener)})};function n(){}n.colHeaders={date:{label:"Date",alias:"DT"},open:{label:"Open"},high:{label:"High"},low:{label:"Low"},close:{label:"Close"},pctChange:{label:"% Change",cls:"ciq-extra"},pctChangeVsAvg:{label:"% Change vs Average",cls:"ciq-extra"},volume:{label:"Volume",cls:"ciq-extra"}},n.percentDecimalPlaces=2,n.createToolbar=function(r,i={}){const t=this,{symbolDisplay:s,symbol:a}=r.chart,{builder:o}=r.tableView,{dataToCsv:c,downloadCsv:h,getFilenameFormatter:d}=o,{fileNameFormatter:u=d(r)}=i,f=Object.assign({},this.colHeaders);return o.getCoverToolbar({symbol:s||a,viewAdditionalColumns:r.tableView.viewAdditionalColumns,copyFn:y,downloadFn:m,toggleAdditionalColumnsFn:v=>{const{tableView:b}=r;b.viewAdditionalColumns=!b.viewAdditionalColumns,v.currentTarget.classList[b.viewAdditionalColumns?"add":"remove"]("ciq-active"),b.open()},closeFn:()=>r.tableView.close()});function y(){const v=document.createElement("textArea");r.container.ownerDocument.body.appendChild(v),v.textContent=c(t.currentTable,{colHeaders:f,colSeparator:","}),v.select(),r.container.ownerDocument.execCommand("copy"),v.remove(),r.dispatch("notification","copytoclipboard")}function m(){const v=c(t.currentTable,{colHeaders:f,colSeparator:","}),b=u(v);h(v,b,r)}},n.createTable=function(r,i={}){if(!r.chart||!r.chart.dataSegment)return;const{tableView:t}=r,{builder:s}=t,{getChartData:a,dataToHtml:o,getDateFormatter:c,getValueFormatter:h,getVolumeFormatter:d,getSeriesDataNames:u,getStudyDataNames:f}=s,g=Object.assign({},this.colHeaders);if(r.chart.highLowBars||(delete g.open,delete g.high,delete g.low),!t.viewAdditionalColumns)for(let L in g)g[L].cls&&delete g[L];const y=Object.values(g).map(L=>L.label),m=u(r);m.forEach(L=>g[L]={label:L});const v=f(r);v.forEach(L=>{y.includes(L)||(g[L]={label:L})});const b=m.concat(v),{dateFormatter:q=c(r),valueFormatter:x=h(r),percentFormatter:w=h(r,this.percentDecimalPlaces),volumeFormatter:C=d(r),minColumnWidth:S="84px"}=i,k=a(r,{dateFormatter:q,valueFormatter:x,percentFormatter:w,volumeFormatter:C,additionalDataFields:b});this.currentTable=k;const T=t.dialog;T.style.display="";const{symbolDisplay:E,symbol:I}=r.chart,D=`Symbol: ${E||I}`;return t.toolbar.symbol.innerText=D,t.toolbar.symbol.setAttribute("aria-label",D),setTimeout(()=>{const L=o(k,{colHeaders:g,minColumnWidth:S});T.appendChild(L),t.view=L;const A=e.getFromNS(r,"uiContext.config.scrollbarStyling");A&&(A.refresh(T.querySelector("tbody")),A.refresh(T.querySelector(".ciq-data-table-wrapper"),{suppressScrollY:!0})),r.translateUI&&r.translateUI(T),T.classList.remove("loading")}),T},n.dataToHtml=function(r,{colHeaders:i,minColumnWidth:t}){const s=Object.keys(i).length,a=`calc((100% - ${10+s*4}px ) / ${s})`,o=Object.entries(i).map(([,{label:u}],f)=>`<th
			scope="col"
			style="width: ${a};"
			>${u.replace("(","  (")}</th>`),c=r.map(u=>`<tr>${Object.keys(i).map((g,y)=>{const m=u[g];return y===0?`<th scope="row"
							style="width: ${a}"
						>${m}</th>`:`<td style="width: ${a}">${m}</td>`}).join("")}</tr>`),h=document.createElement("div");h.classList.add("ciq-data-table-wrapper");const d=t?`calc(${s} * ${t})`:"";return h.innerHTML=`
		<table class="header-fixed"	aria-description="Data visible in the chart"
		${d?`style="min-width: ${d}"`:""}>
		<thead role="rowgroup">${o.join("")}</thead>
		<tbody role="rowgroup">${c.join("")}</tbody>
		</table>`,h},n.dataToCsv=function(r,{colHeaders:i,colSeparator:t="	"}){const s=Object.entries(i).map(([,{label:c}])=>`"${c}"`).join(t),a=Object.entries(i).map(c=>c[1].alias||c[0]),o=r.map(c=>a.map(h=>`"${h==="DT"?c[h].toISOString():c[h]}"`).join(t));return`${s}
${o.reverse().join(`
`)}`},n.downloadCsv=function(r,i="filename",t=null){const s=new Blob([r],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=window.URL.createObjectURL(s,{type:"text/plain"}),a.download=`${i}.csv`,a.style.display="none";const o=((t||{}).container||{}).ownerDocument||document;o.body.appendChild(a),a.click(),o.body.removeChild(a)},n.getChartData=function(r,{dateFormatter:i,valueFormatter:t,percentFormatter:s,volumeFormatter:a,additionalDataFields:o}){const c=r.chart.dataSegment.filter(g=>g!==null),{usePreviousCloseForChange:h}=r.tableView;let d=[],u=0;const f=c.reduce((g,{Close:y,iqPrevClose:m,Open:v})=>{const b=h?m:v;return typeof y=="undefined"||Number.isNaN(y)||typeof b=="undefined"||Number.isNaN(b)?g:(u++,g+(y-b)/b)},0)/u;return c.forEach((g,y)=>{const{DT:m,displayDate:v,High:b,Low:q,Open:x,Close:w,iqPrevClose:C,Volume:S}=g,k=h?C:x,T=(w-k)/k,E=v||(r.displayZone?e.convertTimeZone(m,r.dataZone,r.displayZone):m),I={DT:m,date:i(E),open:t(x),close:t(w),change:t(w-k),pctChange:s(T*100),pctChangeVsAvg:s((T-f)*100),high:t(b),low:t(q),volume:a(S)};o.forEach(D=>{let L=g[D];if(L==null){I[D]="";return}typeof L=="object"&&(L=L.Close),I[D]=t(L)}),d.push(I)}),d.sort((g,y)=>y.DT-g.DT),d},n.getDateFormatter=function(r){return(i,t)=>i?e.displayableDate(r,r.chart,i,!0):""},n.getValueFormatter=function(r,i){const{chart:{panel:t,yAxis:s},layout:{chartScale:a}}=r;let o;return s.originalPriceFormatter&&s.originalPriceFormatter.func?o=c=>s.originalPriceFormatter.func(r,t,c,i):s.priceFormatter&&a!="percent"&&a!="relative"?o=c=>s.priceFormatter(r,t,c,i):o=c=>r.formatYAxisPrice(c,t,i),c=>o(c).replace(/^-*0\.0*$/,"0")},n.getVolumeFormatter=function(r){return i=>{if(i==null)return"";if(r.internationalizer)return r.internationalizer.priceFormatters[0].format(i);const t=i.toString().split(".");return t[0]=e.commas(t[0]),t[0]}},n.getFilenameFormatter=function(r){return i=>{const t=r.chart.symbolDisplay||r.chart.symbol;let s,a;if(i){const o=i.split(`
`);o.length>1&&([,s=""]=o[o.length-1].match(/^"([^"]*)"/)||[],[,a=""]=o[1].match(/^"([^"]*)"/)||[],s=e.yyyymmddhhmmssmmm(new Date(s)),a=e.yyyymmddhhmmssmmm(new Date(a)))}return`${t}${s?` (${s} _ ${a})`:""}`}},n.getChartCover=function(r,{coverUIMaxWidth:i,coverContainer:t}){const s=t&&r.container.ownerDocument.querySelector(t)||(r.uiContext&&r.container.offsetWidth<i?r.uiContext.topNode:r.container.parentElement.parentElement),a=document.createElement("div");Object.assign(a.style,{top:0,left:0,right:0,bottom:0}),a.classList.add("ciq-data-table-container","loading"),a.setAttribute("role","dialog"),a.setAttribute("aria-label","Data Table"),a.setAttribute("tabindex",0);const o=document.createElement("div");return o.classList.add("ciq-spinner-wrapper"),o.innerHTML='<span class="ciq-spinner"></span>',a.appendChild(o),s.appendChild(a),a},n.getCoverToolbar=function({symbol:r,viewAdditionalColumns:i,copyFn:t,downloadFn:s,toggleAdditionalColumnsFn:a,closeFn:o}){const c=document.createElement("div");c.classList.add("ciq-data-table-toolbar"),c.innerHTML=`
		<div class="ciq-data-table-title"></div>
		<button class="ciq-data-table-copy">${this.copyLabel}</button>
		<button class="ciq-data-table-download">${this.downloadLabel}</button>
		<div>
			<label class="additionalColumns" role="switch">
				<span class="ciq-switch"><span></span></span>
				<span>Show Additional Columns</span>
			</label>
		</div>
		<cq-close role="button" aria-label="close" />
	`;const h=c.querySelector(".ciq-data-table-title");h.textContent=r,h.setAttribute("aria-label",r),h.setAttribute("role","heading");const d=c.querySelector(".ciq-data-table-copy");t?d.addEventListener("click",t):d.style.display="none";const u=c.querySelector(".ciq-data-table-download");s?u.addEventListener("click",function(){u.blur(),s()}):u.style.display="none";const f=c.querySelector(".additionalColumns");return a?f.addEventListener("click",a):f.style.display="none",c.close=o,c},n.copyLabel="Copy",n.downloadLabel="Download",n.getAdditionalColumnLabel=function(r){return`<span>${r?"- ":"+ "}</span>Additional columns`},n.getStudyDataNames=function(r){return Object.values(r.layout.studies||{}).filter(s=>!s.signalData||s.signalData.reveal).map(i).reduce((s,a)=>s.concat(a),[]);function i(s){return Object.keys(s.outputMap).filter(t)}function t(s){return r.chart.dataSegment.some(a=>a&&a[s])}},n.getSeriesDataNames=function(r){return Object.values(r.chart.seriesRenderers||{}).filter(i=>i.params.name!=="_main_series").map(i=>i.seriesParams.map(({symbol:t})=>t)).reduce((i,t)=>i.concat(t),[])}},vi=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;e.Marker?e.Tooltip=e.Tooltip||function(n){if(!e.Marker){console.warn("CIQ.Tooltip addon requires CIQ.Marker module to be enabled.");return}this.cssRequired=!0;const{stx:r,ohl:i,change:t,volume:s,series:a,studies:o,signalStudies:c,interpolation:h,showOverBarOnly:d,showBarHighlight:u=!0,useDataZone:f,caption:g}=n,{container:y}=r.chart;let m=y.querySelector(".hu-tooltip");if(m||(m=document.createElement("table"),m.classList.add("hu-tooltip"),y.appendChild(m)),g){let C=m.querySelector("caption");C||(C=document.createElement("caption"),m.insertBefore(C,m.firstChild)),C.innerHTML=r.translateIf(g)}let v=y.querySelector(".hu-tooltip-highlight");v||(v=document.createElement("div"),v.classList.add("hu-tooltip-highlight"),y.appendChild(v)),e.Marker.Tooltip=function(C){this.className||(this.className="CIQ.Marker.Tooltip"),this.highlightEl=v,C.label="tooltip",e.Marker.call(this,C)},e.inheritsFrom(e.Marker.Tooltip,e.Marker,!1),e.Marker.Tooltip.sameBar=function(C,S){return!(!C||!S||+C.DT!=+S.DT||C.Close!=S.Close||C.Open!=S.Open||C.Volume!=S.Volume)},e.Marker.Tooltip.placementFunction=function(C){if(b())return;const S=30;for(var k=C.stx,T=0;T<C.arr.length;T++){var E=C.arr[T],I=k.barFromPixel(k.cx),D=k.chart.dataSegment[I],L,A=!0,F,U;if(D!="undefined"&&D&&D.DT&&(L=!0,D.High&&(F=k.pixelFromPrice(D.High)),D.Low&&(U=k.pixelFromPrice(D.Low)),k.chart.highLowBars||D.Close&&(F=k.pixelFromPrice(D.Close)-15,U=k.pixelFromPrice(D.Close)+15),d&&!(k.cy>=F&&k.cy<=U)&&(A=!1)),!(k.insideChart&&!k.openDialog&&!k.activeDrawing&&!k.grabbingScreen&&L&&A)){v.style.display="none",E.node.style.left="-50000px",E.node.style.right="auto",E.node.ariaHidden="true",E.lastBar={};return}if(e.Marker.Tooltip.sameBar(k.chart.dataSegment[I],E.lastBar)&&I!=k.chart.dataSegment.length-1){w(E);return}E.lastBar=k.chart.dataSegment[I];const Y=E.lastBar.candleWidth||k.layout.candleWidth,N=parseInt(getComputedStyle(E.node).width,10)+Y/2+S,G=k.chart.panel.left,z=k.pixelFromBar(I),X=y.clientWidth-z,O=z-G,K=X,H=O>N;K>N&&K>O||!H?(E.node.style.left=(z+N<y.clientWidth?Math.round(z+S):y.clientWidth-N)+"px",E.node.style.right="auto"):H?(E.node.style.left="auto",E.node.style.right=Math.round(X+S)+"px"):(E.node.style.left=z-N/2+"px",E.node.style.right=Math.round(X)+"px"),E.node.ariaHidden="false";var P=parseInt(getComputedStyle(E.node).height,10),Q=Math.round(k.backOutY(e.ChartEngine.crosshairY)-P/2);if(Q+P>k.height&&(Q=k.height-P),Q<0&&(Q=0),E.node.style.top=Q+"px",w(E),u&&!k.layout.crosshair){const ee=E.lastBar.candleWidth||k.layout.candleWidth,j=k.pixelFromBar(I)-ee/2;let ie=ee;j+ie>k.chart.width&&(ie=k.chart.width-j),v.style.display="block",v.style.left=j+"px",v.style.width=ie+"px"}else v.style.display="none"}if(e.touchDevice&&k.layout.crosshair){var R=k.overXAxis,Z=k.overYAxis;k.overXAxis=k.overYAxis=!1,k.doDisplayCrosshairs(),k.overXAxis=R,k.overYAxis=Z}};function b(){const{headsUp:C,crosshair:S}=r.layout,k=C&&C.floating||C==="floating",T=S&&r.displayCrosshairs&&["static",null,void 0].includes(C);return r.huTooltip&&!k&&!T?(q(),!0):!1}function q(){const{huTooltip:C}=r,{node:S}=C;S&&(S.style.left="-50000px",S.style.right="auto",S.ariaHidden="true",C.lastBar={},C.highlightEl&&(C.highlightEl.style.display="none"))}function x(){var C=this;if(b())return;var S=C.barFromPixel(C.cx),k=C.chart.dataSegment[S];if(!k){q();return}if(e.Marker.Tooltip.sameBar(k,C.huTooltip.lastBar)&&S!=C.chart.dataSegment.length-1)return;var T=C.huTooltip.node;T.parentElement.querySelectorAll("[auto]").forEach(re=>re.remove()),T.parentElement.querySelectorAll(".hu-tooltip-value").forEach(re=>re.innerHTML="");var E=C.chart.panel,I=E.yAxis,D={},L=[];if(L.push({member:"DT",display:"DT",panel:E,yAxis:I}),L.push({member:"Close",display:"Close",panel:E,yAxis:I}),D.DT=D.Close=1,t&&e.ChartEngine.isDailyInterval(C.layout.interval)&&L.push({member:"Change",display:"Change",panel:E,yAxis:I}),i&&(L.push({member:"Open",display:"Open",panel:E,yAxis:I}),L.push({member:"High",display:"High",panel:E,yAxis:I}),L.push({member:"Low",display:"Low",panel:E,yAxis:I}),D.Open=D.High=D.Low=1),s&&(L.push({member:"Volume",display:"Volume",panel:null,yAxis:null}),D.Volume=1),a){var A=C.chart.seriesRenderers;for(var F in A){var U=A[F];if(U!==C.mainSeriesRenderer){E=C.panels[U.params.panel],I=U.params.yAxis,!I&&U.params.shareYAxis&&(I=E.yAxis);for(var P=0;P<U.seriesParams.length;P++){var Q=U.seriesParams[P],R=Q.symbol,Z=Q.field;R?Z&&R!=Z&&(R=e.createObjectChainNames(R,Z)[0]):R=Z;var Y=Q.display||Q.symbol||Q.field;R&&!D[Y]&&(L.push({member:R,display:Y,panel:E,yAxis:I,isSeries:!0}),D[Y]=1)}}}}if(o||c)for(var N in C.layout.studies){var G=C.layout.studies[N];if(!(!c&&G.signalData&&!G.signalData.reveal)){E=C.panels[G.panel],I=E&&G.getYAxis(C);for(var z in C.layout.studies[N].outputMap)if(z&&!D[z]){var X=z,O=new RegExp(G.type,"ig"),K=X.match(O);if(K&&K.length>1){var H=0;X=X.replace(O,Ne(H))}L.push({member:z,display:X,panel:E,yAxis:I}),D[z]=1}D[N+"_hist"]||(L.push({member:N+"_hist",display:N+"_hist",panel:E,yAxis:I}),D[N+"_hist"]=1),D[N+"_hist1"]||(L.push({member:N+"_hist1",display:N+"_hist1",panel:E,yAxis:I}),D[N+"_hist1"]=1),D[N+"_hist2"]||(L.push({member:N+"_hist2",display:N+"_hist2",panel:E,yAxis:I}),D[N+"_hist2"]=1)}}for(var J=0;J<L.length;J++){var ee=L[J],j=ee.member,ie=ee.display,pe=j=="DT";pe&&!f&&!e.ChartEngine.isDailyInterval(C.layout.interval)&&(j="displayDate"),E=ee.panel,I=ee.yAxis;var se=null;I&&(!E||E!==E.chart.panel?I.decimalPlaces||I.decimalPlaces===0?se=I.decimalPlaces:(I.maxDecimalPlaces||I.maxDecimalPlaces===0)&&(se=I.maxDecimalPlaces):(se=Math.max(I.printDecimalPlaces,E.chart.decimalPlaces),(I.maxDecimalPlaces||I.maxDecimalPlaces===0)&&(se=Math.min(se,I.maxDecimalPlaces))));var _=null,fe=e.existsInObjectChain(k,j);fe?_=fe.obj[fe.member]:j=="Change"&&(_=k.Close-k.iqPrevClose);var de=ie.replace(/^(Result )(.*)/,"$2");if((h||this.cleanupGaps==="stretch")&&L[J].isSeries&&(_===null||typeof _=="undefined")){var Se=C.valueFromInterpolation(S,j,"Close",E,I,this.cleanupGaps==="stretch");if(Se===null)continue;_=Se}if((_||_===0)&&(pe||typeof _!="object"||_.Close||_.Close===0)){var V="";if((_.Close||_.Close===0)&&(_=_.Close),_.constructor==Number)if(I)I.originalPriceFormatter&&I.originalPriceFormatter.func?V=I.originalPriceFormatter.func(C,E,_,se):I.priceFormatter&&I.priceFormatter!=e.Comparison.priceFormat?V=I.priceFormatter(C,E,_,se):V=C.formatYAxisPrice(_,E,se,I);else{V=_;var me=C.internationalizer;if(me){var Ee=me.priceFormatters.length,ge=e.countDecimals(V);ge>=Ee&&(ge=Ee-1),V=me.priceFormatters[ge].format(V)}}else _.constructor==Date?pe&&C.controls.floatDate&&C.controls.floatDate.innerHTML?C.chart.xAxis.noDraw?V="N/A":V=e.displayableDate(C,E.chart,_):(V=e.yyyymmdd(_),e.ChartEngine.isDailyInterval(C.layout.interval)||(V+=" "+_.toTimeString().substring(0,8))):V=_;var ve=T.querySelector('.hu-tooltip [hu-tooltip-field="'+de+'"]');if(ve){ve.querySelector(".hu-tooltip-value").innerHTML=V;var ye=ve.querySelector(".hu-tooltip-name");ye.innerHTML===""&&(ye.innerHTML=de,C.translateUI&&C.translateUI(ye))}else{var oe=document.createElement("tr");oe.setAttribute("hu-tooltip-field",""),oe.setAttribute("auto",!0);var be=document.createElement("td");be.classList.add("hu-tooltip-name"),be.innerHTML=C.translateIf(de),oe.appendChild(be);var qe=document.createElement("td");qe.classList.add("hu-tooltip-value"),qe.innerHTML=V,oe.appendChild(qe);var Me=T.querySelector("tbody")||T;Me.appendChild(oe)}}else{var Ce=T.querySelector('.hu-tooltip [hu-tooltip-field="'+de+'"]');if(Ce){var _e=Ce.querySelector(".hu-tooltip-name");_e.innerHTML!==""&&(Ce.querySelector(".hu-tooltip-value").innerHTML="n/a")}}}C.huTooltip.render();function Ne(re){return function(He){return++re===1?"":He}}}function w(C){if(C.node.style.left!=="-50000px"){var S=r.controls.mSticky;if(S&&S.style.display!=="none"){var k=e.stripPX(C.node.style.top)-e.elementDimensions(S,{padding:!0,border:!0,margin:!0}).height;k<0&&(C.node.style.top=e.stripPX(C.node.style.top)-k+"px",k=0);var T=S.style;e.efficientDOMUpdate(T,"top",k+"px"),e.efficientDOMUpdate(T,"left",C.node.style.left),e.efficientDOMUpdate(T,"right",C.node.style.right)}}}y.addEventListener("mouseout",q),r.append("mousemoveinner",function(){w(this.huTooltip)}),r.append("deleteHighlighted",function(){this.huTooltip.lastBar={},this.headsUpHR()}),r.append("headsUpHR",x),r.append("createDataSegment",x),r.huTooltip=new e.Marker.Tooltip({stx:r,xPositioner:"bar",chartContainer:!0,node:m})}:console.error("tooltip addon requires first activating markers feature.")},yi=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;e.Animation=e.Animation||function(n){if(!n)throw new Error("Invalid constructor arguments.");var r,i,t;if(n instanceof e.ChartEngine?(r=arguments[0],i=arguments[1],t=arguments[2]):(r=n.stx,i=n.animationParameters,t=n.easeMachine),!r)return console.warn("No CIQ.ChartEngine provided. Cannot properly create CIQ.Animation instance");this.cssRequired=!0;var s={stayPut:!1,ticksFromEdgeOfScreen:5,granularity:1e6};i=e.extend(s,i),s.tension&&(r.chart.tension=i.tension),r.tickAnimator=t||new e.EaseMachine("easeOutCubic",1e3);var a=new e.EaseMachine("easeInOutCubic",1e3),o=["#0298d3","#19bcfc","#5dcffc","#9ee3ff"],c=0,h=20,d=0,u=!1,f=null;function g(){u=!1,f=null}if(e.UI){var y=({value:m})=>{s.tension&&(r.chart.tension=m?i.tension:0)};e.UI.observeProperty("animation",r.layout,y),r.addEventListener("destroy",function(){e.UI.unobserveProperty("animation",r.layout,y)})}r.addEventListener(["symbolChange","layout"],function(m){g()}),r.prepend("updateCurrentMarketData",function(m,v,b,q){v||(v=this.chart),q&&q.fromTrade&&v.closePendingAnimation&&(q.finalClose=v.closePendingAnimation.Close)}),r.prepend("updateChartData",function(m,v,b){var q=this;if(v||(v=q.chart),!v||!v.defaultChartStyleConfig||v.defaultChartStyleConfig=="none"||!this.layout.animation||b!==void 0&&(b.animationEntry||b.secondarySeries)||!v.dataSegment)return;function x(O){if(v.masterData)for(var K=v.masterData.length-1;K>=0;K--){var H=v.masterData[K];if(H.Close||H.Close===0){H.Close=O.Close,O.LastSize&&(H.LastSize=O.LastSize),O.LastTime&&(H.LastTime=O.LastTime),O.Open===void 0&&H.Open!==void 0&&(H.Open=O.Close),O.High===void 0&&H.High!==void 0&&(H.High=O.Close),O.Low===void 0&&H.Low!==void 0&&(H.Low=O.Close),q.updateCurrentMarketData({Close:H.Close,DT:H.DT,LastSize:H.LastSize,LastTime:H.LastTime},null,null,{animationLastBar:!0,fromTrade:!0}),q.createDataSet(null,null,{appending:!0});return}}}function w(){v.animatingHorizontalScroll&&(v.animatingHorizontalScroll=!1,q.micropixels=q.nextMicroPixels=q.previousMicroPixels,v.lastTickOffset=0),v.closePendingAnimation&&(x(v.closePendingAnimation),v.closePendingAnimation=null)}var C=q.tickAnimator,S=this.mainSeriesRenderer.supportsAnimation;if(S){if(!C){console.warn("Animation plug-in can not run because the tickAnimator has not been declared. See instructions in animation.js");return}if(this.prevSymbol!=v.symbol&&(this.prevQuote=0,v.closePendingAnimation=null,this.prevSymbol=v.symbol),w(),C.stop(r.ownerWindow),m.length>1){var k=m.splice(0,m.length-1),T=e.clone(b);T.animationEntry=!0,T.bypassGovernor=!0,T.noCreateDataSet=!1,T.appending=!0,q.updateChartData(k,v,T)}}var E=e.clone(b);E||(E={}),E.animationEntry=!0,E.bypassGovernor=!0,E.noCreateDataSet=!1,E.appending=!0,E.firstLoop=!0;var I=this.chart.symbol,D=this.layout.periodicity,L=this.layout.interval,A=this.layout.timeUnit;function F(O,K,H){return function(J){var ee=J.Close;if(!v.dataSet.length||I!=v.symbol||D!=q.layout.periodicity||L!=q.layout.interval||A!=q.layout.timeUnit){C.stop(q.ownerWindow),w();return}var j=e.clone(O);j.Adj_Close=null,j.Close=Math.round(ee*i.granularity)/i.granularity,v.animatingHorizontalScroll&&(q.micropixels=J.micropixels,v.lastTickOffset=J.lineOffset),E.updateDataSegmentInPlace=!C.hasCompleted;var ie=[j];H&&q.layout.interval!=="tick"&&ie.unshift(K),q.updateChartData(ie,v,E),E.firstLoop=!1,C.hasCompleted&&w()}}if(S){var U=m[m.length-1];this.prevQuote=this.currentQuote("Close");var P=!1,Q=!1;if(q.isHome()||(Q=!0),!U||!U.Close||!this.prevQuote||!this.prevQuote.Close)return!1;if(this.extendedHours&&v.market.market_def){var R=U.DT;if(e.ChartEngine.isDailyInterval(L))u=!v.market.isMarketDate(R);else if(!f||f<=R){var Z=v.market.getSession(R);u=Z!==""&&(!this.layout.marketSessions||!this.layout.marketSessions[Z]),f=v.market[u?"getNextOpen":"getNextClose"](R)}if(u)return this.draw(),!1}var Y=D;L=="second"||A=="second"?Y*=1e3:(L=="minute"||A=="minute")&&(Y*=6e4),isNaN(L)||(Y*=L),L=="day"||A=="day"?P=U.DT.getDate()!=this.prevQuote.DT.getDate():L=="week"||A=="week"?P=U.DT.getDate()>=this.prevQuote.DT.getDate()+7:L=="month"||A=="month"?P=U.DT.getMonth()!=this.prevQuote.DT.getMonth():P=U.DT.getTime()>=this.prevQuote.DT.getTime()+Y;var N=!this.mainSeriesRenderer.standaloneBars,G=0;if(P)if(this.animations.zoom.hasCompleted){var z=this.layout.candleWidth;if(v.scroll<=v.maxTicks)for(;this.micropixels>0;)v.scroll++,this.micropixels-=z;G=z*-1,v.scroll<=v.maxTicks?(this.previousMicroPixels=this.micropixels,this.nextMicroPixels=this.micropixels+z,v.dataSegment.length<v.maxTicks-i.ticksFromEdgeOfScreen&&!i.stayPut&&(this.nextMicroPixels=this.micropixels,v.scroll>=v.maxTicks-this.preferences.whitespace/this.layout.candleWidth&&v.scroll++),v.animatingHorizontalScroll=N,v.previousDataSetLength=v.dataSet.length):Q||v.scroll++}else return!1;v.closePendingAnimation={Close:U.Close,Open:U.Open,High:U.High,Low:U.Low};var X=P&&!N?U.Open:this.prevQuote.Close;return C.run(F(U,e.clone(this.prevQuote),P),{Close:X,micropixels:this.nextMicroPixels,lineOffset:G},{Close:U.Close,micropixels:this.micropixels,lineOffset:0},!1,r.ownerWindow),!0}}),r.prepend("renderYAxis",function(m){if(this.grabbingScreen||!this.isHome()||!this.layout.animation)return;var v=this.mainSeriesRenderer.supportsAnimation;if(!v)return;var b=m.panel,q=b.yAxis;if(e.Comparison&&q.priceFormatter==e.Comparison.priceFormat)return;function x(S){return function(k){m.animatedLow=k.low,m.animatedHigh=k.high,S.draw()}}if(!m.prevLowValue&&m.prevLowValue!==0&&(m.prevLowValue=m.animatedLow=m.lowValue),!m.prevHighValue&&m.prevHighValue!==0&&(m.prevHighValue=m.animatedHigh=m.highValue),a.running||(m.animatingVerticalScroll=!1),m.prevLowValue>=m.lowValue&&m.prevHighValue<=m.highValue){m.animatingVerticalScroll&&(q.highValue=m.animatedHigh,q.lowValue=m.animatedLow);return}if(a.running&&a.stop(r.ownerWindow),!(!m.lowValue&&!m.highValue)){var w=m.prevLowValue,C=m.prevHighValue;m.prevLowValue=m.lowValue,m.prevHighValue=m.highValue,m.animatingVerticalScroll=!0,a.run(x(this),{low:w,high:C},{low:m.lowValue,high:m.highValue},!1,r.ownerWindow),q.lowValue=m.animatedLow,q.highValue=m.animatedHigh}}),r.append("draw",function(){if(!u&&this.chart.dataSet&&this.chart.dataSet.length&&this.mainSeriesRenderer.supportsAnimation&&this.layout.animation){d%h===0&&(c++,d=0),d++;var m=this.chart.context,v=this.chart.panel,b=this.currentQuote("Close");if(!b)return;var q=b.Close,x=this.pixelFromTick(b.tick,this.chart);this.chart.lastTickOffset&&(x=x+this.chart.lastTickOffset);var w=this.pixelFromPrice(q,v);this.chart.yAxis.left>x&&this.chart.yAxis.top<=w&&this.chart.yAxis.bottom>=w&&(c>=o.length&&(c=0),m.beginPath(),m.moveTo(x,w),m.arc(x,w,2+c*1.07,0,Math.PI*2,!1),m.fillStyle=o[c],m.fill())}})}},bi=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;e.ContinuousZoom=e.ContinuousZoom||function(n){this.cssRequired=!0,this.update(n),this.stx.continuousZoom=this,this.addSmartZoomButton=function(){var r=this.stx.registerChartControl&&this.stx.registerChartControl("stx-smart-zoom","SmartZoom (Alt + 0)",function(i){return function(t){i.smartZoomToggle(t),t.stopPropagation()}}(this));r&&(this.stx.addEventListener("layout",function(i){i.stx.layout.smartzoom===!0?r.classList.add("active"):r.classList.remove("active")}),this.stx.addEventListener("symbolImport",function(i){i.stx.layout.smartzoom===!1&&r.classList.remove("active")}))},this.smartZoomToggle=function(r){this.smartZoomEnable(!this.stx.layout.smartzoom)},this.smartZoomEnable=function(r){this.stx.layout.smartzoom=r,this.stx.changeOccurred("layout")},this.addSmartZoomButton(),this.smartZoomEnable(!0)},e.ContinuousZoom.prototype.update=function(n){n||(n={}),this.stx=n.stx,this.periodicities=n.periodicities,this.boundaries=n.boundaries},e.ContinuousZoom.prototype.execute=function(n){function r(g){var y=g.period||g.periodicity,m=g.interval,v=g.timeUnit||"minute";switch(isNaN(m)&&(v=m,m=1),v){case"month":m*=4.35;case"week":m*=7;case"day":m*=1440;case"minute":m*=60;case"second":break;case"millisecond":m/=1e3;break;default:return null}return y*m}if(!(!this.stx||!this.stx.layout.smartzoom)){var i=this.periodicities,t=this.boundaries,s=this.stx,a=s.layout,o=s.chart;if(!(!i||!t)&&(!n&&t.maxCandleWidth&&a.candleWidth>t.maxCandleWidth||n&&t.minCandleWidth&&a.candleWidth<t.minCandleWidth||!n&&t.minTicks&&o.maxTicks<t.minTicks||n&&t.maxTicks&&o.maxTicks>t.maxTicks)){for(var c={value:n?Number.MAX_VALUE:0},h=r(a),d=0;d<i.length;d++){var u=r(i[d]);(u>h&&u<c.value&&n||u<h&&u>c.value&&!n)&&(c={value:u,periodicity:i[d]})}var f=c.periodicity;f&&s.setRange({dtLeft:o.xaxis[0].DT,dtRight:o.xaxis[o.xaxis.length-1].DT,dontSaveRangeToLayout:!0,periodicity:f,padding:s.preferences.whitespace})}}}},qi=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;e.Outliers=e.Outliers||function(n){if(n||(n={}),!n.stx){console.warn("The Outliers addon requires an stx parameter");return}Array.isArray(n.altColors)||(n.altColors=["#323390","#66308f","#0073ba","#f4932f","#0056a4","#00a99c","#00a553","#ea1d2c","#e9088c","#fff126","#912a8e","#ee652e","#00afed","#8ec648"]),this.stx=n.stx,this.stx.outliers=this,this.cssRequired=!0,this.multiplier=n.multiplier||3,this.altColors=n.altColors,this.axisData={},this.stx.addEventListener("layout",function(i){Object.keys(i.stx.outliers.axisData).forEach(function(t){this.removeAllMarkers(this.axisData[t]),delete this.axisData[t]}.bind(i.stx.outliers))}),e.UI&&e.UI.KeystrokeHub.addHotKeyHandler("outliers",({stx:i})=>{i.container.ownerDocument.body.keystrokeHub.context.advertised.Layout.setOutliers()},this.stx),this.processDataSet=function(i,t,s){if(!i.length||i.length<=1)return!1;var a=[0,0];if(!this.axisData[s.name]){var o="",c=-1;Object.keys(this.axisData).forEach(function(d){this.axisData[d].panel.name==t.name&&c++}.bind(this)),c>-1&&c<this.altColors.length&&(o=this.altColors[c]),this.axisData[s.name]={axis:s,panel:t,displayState:"none",isFlipped:!1,originalZoom:s.zoom,markerColor:o,markers:{},axisMarkers:{}}}var h=this.axisData[s.name];return Object.assign(h,this.find(i)),this.refreshMarkerArray(h),this.refreshMarkers(h),(h.displayState==="low"||h.displayState==="all")&&h.outlierMin!==null?a[0]=h.outlierMin:a[0]=h.trendMin,(h.displayState==="high"||h.displayState==="all")&&h.outlierMax!==null?a[1]=h.outlierMax:a[1]=h.trendMax,a},this.find=function(i){if(!(!i.length||i.length<=0)){var t=function(w,C){return{quote:w.quote,DT:w.quote.DT,value:w.value,position:C}},s=null,a=null,o=null,c=null,h=null,d=null,u=[],f=i.slice();f.sort(function(w,C){return w.value-C.value});var g=f.length,y=f[Math.floor(g/4)].value,m=f[Math.floor(g*(3/4))].value,v=m-y;s=y-v*this.multiplier,a=m+v*this.multiplier;for(var b=0;b<g;b++){var q=f[b],x=f[g-(b+1)];if(q.value<=s&&u.push(t(q,"low")),x.value>=a&&u.push(t(x,"high")),h===null&&q.value<=s&&(h=q.value),d===null&&x.value>=a&&(d=x.value),o===null&&q.value>s&&(o=q.value),c===null&&x.value<a&&(c=x.value),o!==null&&c!==null)break}return{minValue:s,maxValue:a,trendMin:o,trendMax:c,outlierMin:h,outlierMax:d,activeOutliers:u}}},this.refreshMarkerArray=function(i){this.deprecateMarkers(i);var t=i.markers;i.activeOutliers.forEach(function(s){var a=s.DT.getTime().toString();t[a]||(t[a]={isFresh:!0,type:"quote",value:s.value,marker:this.markOutlier(s,s.position,i)}),t[a].isFresh=!0}.bind(this)),i.outlierMax!==null&&(t.axisHigh||(t.axisHigh={isFresh:!0,type:"axis",value:i.outlierMax,marker:this.markAxis("high",i)}),t.axisHigh.isFresh=!0),i.outlierMin!==null&&(t.axisLow||(t.axisLow={isFresh:!0,type:"axis",value:i.outlierMin,marker:this.markAxis("low",i)}),t.axisLow.isFresh=!0)},this.setDisplayState=function(i,t){i!="high"&&i!="low"&&i!="all"&&(i="none");var s=i;t.displayState=="all"&&i=="high"?s="low":t.displayState=="all"&&i=="low"?s="high":t.displayState=="high"&&i=="low"||t.displayState=="low"&&i=="high"?s="all":t.displayState==i&&(s="none"),t.displayState=s,t.axis.zoom=t.originalZoom,this.refreshMarkers(t),this.stx.draw()},this.deprecateMarkers=function(i){var t=function(s){s.marker&&!s.isFresh?(s.marker.remove&&s.marker.remove(),s.marker=null):s.isFresh=!1};Object.keys(i.markers).forEach(function(s){t(this.markers[s]),this.markers[s].marker||delete this.markers[s]}.bind(i))},this.removeAllMarkers=function(i){Object.keys(i.markers).forEach(function(t){var s=i.markers[t].marker;s&&(s.remove&&s.remove(),s=null),s||delete i.markers[t]})},this.updateMarkerVisibility=function(){Object.keys(this.markers).forEach(function(i){this.displayState=="all"||this.markers[i].marker.node.classList.contains(this.displayState)?this.markers[i].marker.node.style.display="none":this.markers[i].marker.node.style.display="block"}.bind(this))},this.refreshAxisMarkers=function(i,t){var s=!1;i.classList.contains("high")&&(s=!0);var a=t.axis.top;(!t.isFlipped&&!s||t.isFlipped&&s)&&(a=t.axis.bottom-50),i.classList.contains("nano")&&(a=t.axis.top+t.axis.height/2-22);var o=Math.floor(t.axis.left).toString()+"px",c=Math.floor(a).toString()+"px",h=s?t.outlierMax:t.outlierMin;i.style.transform="translate("+o+", "+c+")",i.querySelector(".outlier-value").innerText=this.stx.formatYAxisPrice(h),o==="0px"?i.classList.add("right"):i.classList.remove("right")},this.refreshMarkers=function(i){Object.keys(i.markers).forEach(function(t,s){var a=t.markers[s].marker,o=t.markers[s].value,c=t.markers[s].type;o>t.trendMax&&t.axis.high>=o||o<t.trendMin&&t.axis.low<=o?c=="quote"?a.node.style.display="none":c=="axis"&&a.node.classList.add("compress"):c=="quote"?a.node.style.display="block":c=="axis"&&a.node.classList.remove("compress"),c=="axis"&&this.refreshAxisMarkers(a.node,t),t.axis.height<100?a.node.classList.add("nano"):a.node.classList.remove("nano"),t.axis.height<250?a.node.classList.add("micro"):a.node.classList.remove("micro")}.bind(this,i)),i.isFlipped!==i.axis.flipped&&this.flipMarkers(i)},this.markAxis=function(i,t){var s=document.createElement("div");s.classList.add("outlier-sticker","axis","mini",i),s.innerHTML='<div class="expansion"><div class="pill"><div class="icon"></div></div><div class="tick"></div><span class="outlier-value"></div><div class="compression"><div class="pill"><div class="icon"></div></div></div></span>',this.matchYAxisStyle(s),this.setMarkerColor(s,t.markerColor);var a=this.handleMarkerClick.bind(this,i,t,s);return s.addEventListener("click",a),s.addEventListener("touchend",a),new e.Marker({stx:this.stx,xPositioner:"none",yPositioner:"none",label:"expand",permanent:!0,chartContainer:!0,node:s})},this.markOutlier=function(i,t,s){if(i){s||(s={panel:this.stx.panels.chart}),t=t||"high";var a=document.createElement("div");a.classList.add("outlier-sticker","quote","mini",t),a.innerHTML='<div class="pill"><div class="icon"></div></div><span class="outlier-value">'+this.stx.formatYAxisPrice(i.value,s.panel)+"</span>",this.matchYAxisStyle(a),this.setMarkerColor(a,s.markerColor);var o=this.handleMarkerClick.bind(this,t,s,a);return a.addEventListener("click",o),a.addEventListener("touchend",o),new e.Marker({stx:this.stx,xPositioner:"date",yPositioner:t=="high"?"top":"bottom",x:i.quote.DT,panelName:s.panel.name,node:a})}},this.handleMarkerClick=function(i,t,s){s.classList.contains("nano")&&(i="all"),this.setDisplayState(i,t),this.stx.draw()},this.matchYAxisStyle=function(i){if(this.stx.styles.stx_yaxis){var t=this.stx.styles.stx_yaxis;i.style.fontSize=t.fontSize,i.style.fontFamily=t.fontFamily,i.style.color=t.color,i.style.borderColor=t.color}},this.setMarkerColor=function(i,t){if(t!="")for(var s=i.querySelectorAll(".pill"),a=0;a<s.length;a++)s[a].style.backgroundColor=t},this.flipMarkers=function(i){i.isFlipped=i.axis.flipped,Object.keys(i.markers).forEach(function(t,s){var a=t.markers[s].marker,o=t.markers[s].value,c=t.markers[s].type;t.isFlipped?a.node.classList.add("flipped"):a.node.classList.remove("flipped"),c=="quote"&&(o>t.trendMax?t.isFlipped?a.params.yPositioner="bottom":a.params.yPositioner="top":o<t.trendMin&&(t.isFlipped?a.params.yPositioner="top":a.params.yPositioner="bottom"))}.bind(this,i))};var r=this.stx.determineMinMax;this.stx.determineMinMax=function(i,t,s,a,o,c,h,d,u){return u||(u=[]),h&&d&&this.layout.outliers&&u.push(this.outliers.processDataSet.bind(this.outliers)),r.call(this,i,t,s,a,o,c,h,d,u)}}},Ci=l=>{var e=typeof _CIQ!="undefined"?_CIQ:l.CIQ;e.PlotComplementer=e.PlotComplementer||function(n){var r=n.stx,i=e.uniqueID();n.decorator||(n.decorator={});var t=n.decorator.symbol||"_"+i,s=n.decorator.display||" (addl)";r.plotComplementers||(r.plotComplementers=[]),r.plotComplementers.push(this),this.id=n.id||i,this.defaultRenderingParameters={chartType:"line",width:1,opacity:.5},n.renderingParameters&&(this.defaultRenderingParameters=n.renderingParameters);var a=this;function o(d,u,f,g){function y(x){if(x.quoteDriver&&n.quoteFeed){for(var w=0;w<x.quoteDriver.quoteFeeds.length;w++)if(x.quoteDriver.quoteFeeds[w].engine==n.quoteFeed)return;return"err"}}if(y(d)!="err"&&(g||(g=u),!d.isEquationChart(u)&&(f||(f={}),!f.isComparison&&g&&g.indexOf(t)==-1))){var m=g+t,v=u+t,b=d.getRendererFromSeries(g),q=e.extend({display:u+s,name:m,symbol:v,symbolObject:{symbol:v,generator:a.id,masterSymbol:u},overChart:!1,gapDisplayStyle:!0,permanent:!0,panel:f.panel,yAxis:f.yAxis,shareYAxis:!0,loadData:!!a.quoteFeed,dependentOf:b?b.params.name:d.mainSeriesRenderer.params.name},a.renderingParameters);q.color||(q.color=f.color||"auto"),d.addSeries(m,q,function(x,w){x&&d.removeSeries(m,d.chart),d.chart.seriesRenderers[m]&&(d.chart.seriesRenderers[m].params.display=q.display)})}}function c(d,u,f){u&&u.indexOf(t)==-1&&d.removeSeries(u+t,f)}function h(d){d.action=="master"?(d.prevSymbol||(d.prevSymbol=d.symbol),c(d.stx,d.prevSymbol,d.stx.chart),o(d.stx,d.symbol)):d.action=="add-series"?(c(d.stx,d.id,d.stx.chart),o(d.stx,d.symbol,d.parameters,d.id)):d.action=="remove-series"&&c(d.stx,d.id,d.stx.chart)}r.addEventListener("symbolChange",h),r.addEventListener("symbolImport",h),this.resetRenderingParameters=function(){this.renderingParameters=this.defaultRenderingParameters},this.setQuoteFeed=function(d){if(!(!d.quoteFeed||!d.behavior)){var u=e.clone(d.behavior);u.generator=this.id;var f=d.filter,g=function(y){return f&&!f(y)?!1:y.symbolObject.generator==u.generator};r.attachQuoteFeed(d.quoteFeed,u,g),this.quoteFeed=d.quoteFeed}},this.setQuoteFeed(n),this.resetRenderingParameters()}},xi={CIQ:p};(typeof __TREE_SHAKE__=="undefined"||!__TREE_SHAKE__)&&xi.CIQ.activateImports(hi,di,ui,pi,fi,mi,gi,vi,yi,bi,qi,Ci,null);
